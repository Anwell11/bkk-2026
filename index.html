<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BKK 2026</title>
<style>
:root {
  /* Deep space background */
  --bg: #080e18;
  --surface: rgba(255,255,255,0.06);
  --surface2: rgba(255,255,255,0.04);
  --surface3: rgba(255,255,255,0.08);
  --surface-solid: #0f1c2e;
  --surface2-solid: #152638;
  --surface3-solid: #1d3348;

  /* Liquid glass system */
  --glass: rgba(255,255,255,0.07);
  --glass-hover: rgba(255,255,255,0.11);
  --glass-border: rgba(255,255,255,0.14);
  --glass-border-bright: rgba(255,255,255,0.26);
  --glass-shine: inset 0 1px 0 rgba(255,255,255,0.12), inset 0 -1px 0 rgba(0,0,0,0.15);
  --glass-blur: blur(20px);
  --glass-blur-sm: blur(12px);

  /* Primary — warm gold */
  --amber: #f2c24e;
  --amber-dim: #c9962e;
  --amber-glow: rgba(242,194,78,0.18);
  --amber-glass: rgba(242,194,78,0.10);

  /* Secondary — electric cyan */
  --teal: #38e8ff;
  --teal-dim: #20c4dc;
  --teal-glow: rgba(56,232,255,0.15);
  --teal-glass: rgba(56,232,255,0.08);

  /* Third — periwinkle */
  --blue: #7b9cff;
  --blue-glow: rgba(123,156,255,0.15);

  /* Text */
  --text: #f0e8d2;
  --text-secondary: #8a9db8;
  --text-dim: #4a5c70;

  --border: rgba(255,255,255,0.09);
  --border-light: rgba(255,255,255,0.18);
  --border-accent: rgba(242,194,78,0.30);

  /* Status */
  --red: #ff6080;
  --red-glow: rgba(255,96,128,0.15);
  --orange: #ff9f5a;
  --green: #3dd68c;
  --purple: #c084fc;

  --radius: 16px;
  --radius-sm: 10px;
  --radius-lg: 22px;
  --shadow: 0 8px 32px rgba(0,0,0,0.6);
  --shadow-lg: 0 16px 56px rgba(0,0,0,0.8);
  --shadow-glow: 0 0 40px rgba(242,194,78,0.08);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', sans-serif;
  background: var(--bg); color:var(--text); min-height:100vh; font-size:15px; line-height:1.5;
  overflow-x:hidden;
}
/* Animated ambient background mesh */
body::before {
  content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    radial-gradient(ellipse 80% 50% at 20% 10%, rgba(56,232,255,0.07) 0%, transparent 60%),
    radial-gradient(ellipse 60% 60% at 80% 20%, rgba(242,194,78,0.06) 0%, transparent 55%),
    radial-gradient(ellipse 70% 50% at 50% 80%, rgba(123,156,255,0.05) 0%, transparent 60%),
    radial-gradient(ellipse 40% 40% at 10% 70%, rgba(61,214,140,0.04) 0%, transparent 50%);
  animation: ambientShift 20s ease-in-out infinite alternate;
}
@keyframes ambientShift {
  0%   { opacity:1; transform:scale(1) translate(0,0); }
  33%  { opacity:0.8; transform:scale(1.04) translate(-1%, 1%); }
  66%  { opacity:0.9; transform:scale(0.97) translate(1%, -1%); }
  100% { opacity:1; transform:scale(1.02) translate(-0.5%, 0.5%); }
}
/* Everything sits above the mesh */
.header, .tabs, .content { position:relative; z-index:1; }

button { cursor:pointer; font-family:inherit; }
input, select, textarea { font-family:inherit; }
::-webkit-scrollbar { width:5px; height:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.15); border-radius:10px; }
::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.25); }

/* ── GLASS MIXIN (apply to cards) ─────────────────────────── */
.glass {
  background: var(--glass);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shine), var(--shadow);
}
.glass-sm {
  background: var(--glass);
  backdrop-filter: var(--glass-blur-sm);
  -webkit-backdrop-filter: var(--glass-blur-sm);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shine);
}

.header {
  background: rgba(8,14,24,0.75);
  backdrop-filter: blur(32px) saturate(180%);
  -webkit-backdrop-filter: blur(32px) saturate(180%);
  padding: 12px 24px;
  display: flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;
  border-bottom: 1px solid var(--glass-border);
  position: sticky; top:0; z-index:100;
  box-shadow: 0 1px 0 rgba(255,255,255,0.06), 0 8px 32px rgba(0,0,0,0.4);
}
.header-left { display:flex; align-items:center; gap:12px; }
.logo {
  width:36px; height:36px;
  background:linear-gradient(135deg, var(--amber) 0%, #ffd878 60%, #e8a020 100%);
  border-radius:11px; display:flex; align-items:center; justify-content:center;
  font-size:14px; font-weight:900; color:#120a00; letter-spacing:-0.5px;
  box-shadow: 0 2px 12px rgba(242,194,78,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
}
.header-title { font-size:1.25rem; font-weight:700; color:var(--text); letter-spacing:-0.5px; }
.header-title span { color:var(--text-dim); font-size:0.78rem; font-weight:400; margin-left:6px; letter-spacing:0; }
.countdown { display:flex; gap:5px; align-items:center; }
.cd-box {
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.13);
  border-radius: 10px; padding:5px 9px; text-align:center; min-width:44px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
}
.cd-num { font-size:1.1rem; font-weight:800; color:var(--amber); font-variant-numeric:tabular-nums; }
.cd-label { font-size:0.5rem; color:var(--text-dim); text-transform:uppercase; letter-spacing:1.5px; margin-top:1px; }
.header-rate {
  display:flex; align-items:center; gap:6px; font-size:0.8rem; color:var(--text-secondary);
  background: rgba(255,255,255,0.07); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.13); border-radius:40px; padding:5px 14px 5px 12px;
}
.header-rate input { width:50px; background:transparent; border:none; color:var(--amber); padding:0; text-align:center; font-size:0.83rem; font-weight:700; outline:none; }

.tabs {
  display:flex;
  background: rgba(8,14,24,0.6);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border);
  padding: 0 16px; overflow-x:auto; gap:2px;
  scrollbar-width:none; -ms-overflow-style:none;
}
.tabs::-webkit-scrollbar { display:none; }
.tab {
  padding: 13px 18px; color:var(--text-dim); font-size:0.84rem; font-weight:500;
  border:none; background:none; border-bottom:2px solid transparent;
  transition:all .22s ease; white-space:nowrap; position:relative;
}
.tab:hover { color:var(--text-secondary); }
.tab.active {
  color:var(--amber); border-bottom-color:var(--amber);
  text-shadow: 0 0 20px rgba(242,194,78,0.4);
}

.content { max-width:1240px; margin:0 auto; padding:20px; }
.tab-content { display:none; animation:fadeIn .35s ease; }
.tab-content.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

.section-title {
  font-size:0.75rem; font-weight:700; color:var(--text-dim);
  margin-bottom:16px; padding-bottom:10px;
  border-bottom:1px solid rgba(255,255,255,0.07);
  display:flex; align-items:center; gap:8px;
  text-transform:uppercase; letter-spacing:1.5px;
}
.section-title .icon { font-size:1rem; }

.card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--glass-shine), var(--shadow);
}

/* Flights */
.flights { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:28px; }
.flight-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-top: 2px solid var(--amber);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--glass-shine), var(--shadow-lg), 0 0 0 0.5px rgba(242,194,78,0.1) inset;
  transition: transform .2s ease, box-shadow .2s ease;
}
.flight-card:hover { transform:translateY(-2px); box-shadow:var(--glass-shine), var(--shadow-lg), 0 0 30px rgba(242,194,78,0.08); }
.flight-label { font-size:0.65rem; text-transform:uppercase; letter-spacing:2.5px; color:var(--amber); margin-bottom:8px; font-weight:600; }
.flight-route { font-size:1.5rem; font-weight:700; margin-bottom:2px; letter-spacing:-0.5px; }
.flight-num { font-size:0.82rem; color:var(--text-dim); margin-bottom:16px; }
.flight-times { display:flex; align-items:center; gap:16px; }
.flight-point { flex:1; }
.flight-point .airport { font-size:0.75rem; color:var(--text-dim); margin-bottom:2px; }
.flight-point .time { font-size:1.3rem; font-weight:700; letter-spacing:-0.5px; }
.flight-point .date { font-size:0.78rem; color:var(--text-secondary); margin-top:2px; }
.flight-arrow { color:var(--amber); font-size:1.4rem; flex-shrink:0; opacity:0.7; }

/* ── DESKTOP ITINERARY TABLE ───────────────────────────────── */
.itin-desktop { display:block; }
.itin-mobile  { display:none; }

.itinerary-table { width:100%; border-collapse:separate; border-spacing:3px 3px; }
.itinerary-table thead th {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  padding:14px 10px 12px; font-weight:700; font-size:0.8rem; color:var(--amber);
  text-align:center; border-radius:10px; border:1px solid var(--glass-border);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.12), 0 4px 12px rgba(0,0,0,0.3);
}
.itinerary-table thead th:first-child { background:transparent; box-shadow:none; color:var(--text-dim); font-size:0.7rem; border:none; }
.itinerary-table thead th .day-date { font-size:0.63rem; font-weight:400; color:var(--text-dim); margin-top:3px; }
.itinerary-table td { border:none; padding:2px; vertical-align:stretch; height:1px; }
.itin-time {
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  padding:10px 6px; font-size:0.58rem; font-weight:700;
  color:var(--text-dim); text-align:center; width:72px;
  border-radius:8px; letter-spacing:0.5px; border:1px solid rgba(255,255,255,0.09);
}
.slot {
  padding:10px 8px; font-size:0.68rem; line-height:1.35; text-align:center;
  height:100%; display:flex; align-items:center; justify-content:center;
  border-radius:10px; transition:transform .18s ease, box-shadow .18s ease;
  font-weight:500; letter-spacing:-0.1px;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
}
.slot:hover { transform:scale(1.03); box-shadow:0 4px 16px rgba(0,0,0,0.35); z-index:2; position:relative; }
.slot.sleep {
  background:linear-gradient(135deg, rgba(55,80,120,0.5), rgba(38,55,85,0.38));
  color:#8aa2be; font-style:italic; font-weight:400;
  border:1px solid rgba(120,155,210,0.18);
}
.slot.travel {
  background:linear-gradient(135deg, rgba(56,232,255,0.14), rgba(56,200,240,0.07));
  color:#60d8ff; border-left:3px solid rgba(56,232,255,0.7);
  border-top:1px solid rgba(56,232,255,0.18); border-bottom:1px solid rgba(56,232,255,0.08); border-right:none;
}
.slot.activity {
  background:linear-gradient(135deg, rgba(61,214,140,0.14), rgba(40,180,110,0.07));
  color:#5de8a8; border-left:3px solid rgba(61,214,140,0.7);
  border-top:1px solid rgba(61,214,140,0.18); border-bottom:1px solid rgba(61,214,140,0.08); border-right:none;
}
.slot.eating {
  background:linear-gradient(135deg, rgba(240,192,64,0.16), rgba(220,160,40,0.08));
  color:#f5c842; border-left:3px solid rgba(240,192,64,0.75);
  border-top:1px solid rgba(240,192,64,0.2); border-bottom:1px solid rgba(240,192,64,0.08); border-right:none;
}
.slot.free {
  background:linear-gradient(135deg, rgba(192,132,252,0.14), rgba(160,100,230,0.07));
  color:#d4a8ff; border-left:3px solid rgba(192,132,252,0.7);
  border-top:1px solid rgba(192,132,252,0.18); border-bottom:1px solid rgba(192,132,252,0.08); border-right:none;
}
.slot.prep {
  background:linear-gradient(135deg, rgba(148,170,200,0.14), rgba(120,145,178,0.07));
  color:#9ab0c8; border-left:3px solid rgba(148,170,200,0.5);
  border-top:1px solid rgba(148,170,200,0.14); border-bottom:1px solid rgba(148,170,200,0.06); border-right:none;
}
.slot.empty { background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); }
.itinerary-legend { display:flex; gap:18px; margin-top:18px; flex-wrap:wrap; padding:12px 16px; background:var(--surface2); border-radius:var(--radius-sm); border:1px solid var(--border-light); }
.legend-item { display:flex; align-items:center; gap:7px; font-size:0.72rem; color:var(--text-secondary); }
.legend-dot { width:10px; height:10px; border-radius:4px; }

/* Travelers */
.travelers-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(300px,1fr)); gap:16px; }
.traveler-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius);
  padding:24px; box-shadow:var(--glass-shine), var(--shadow); position:relative;
  transition:all .22s ease;
}
.traveler-card:hover { border-color:var(--glass-border-bright); transform:translateY(-2px); }
.traveler-avatar { width:44px; height:44px; border-radius:50%; background:linear-gradient(135deg, var(--amber), #f0c060); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:1rem; color:#0b0b14; margin-bottom:12px; }
.traveler-name { font-size:1.1rem; font-weight:700; margin-bottom:2px; }
.traveler-detail { font-size:0.82rem; color:var(--text-dim); margin-top:10px; display:flex; justify-content:space-between; align-items:center; }
.traveler-detail label { font-size:0.65rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:500; }
.traveler-detail .value { font-family:'SF Mono','Fira Code','Courier New',monospace; font-size:0.82rem; }
.passport-toggle { background:none; border:none; color:var(--teal); font-size:0.72rem; padding:2px 6px; font-weight:500; }
.passport-toggle:hover { color:var(--amber); }
.traveler-edit-btn { position:absolute; top:14px; right:14px; background:var(--surface2); border:1px solid var(--border); color:var(--text-dim); padding:5px 12px; border-radius:6px; font-size:0.72rem; font-weight:500; transition:all .2s; }
.traveler-edit-btn:hover { color:var(--amber); border-color:var(--amber); background:var(--amber-glow); }

/* Modal */
.modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); z-index:200; align-items:center; justify-content:center; padding:16px; }
.modal-overlay.show { display:flex; }
.modal {
  background: rgba(15,28,46,0.85);
  backdrop-filter: blur(32px) saturate(160%);
  -webkit-backdrop-filter: blur(32px) saturate(160%);
  border: 1px solid var(--glass-border-bright);
  border-radius: var(--radius-lg);
  padding:28px; width:90%; max-width:440px;
  box-shadow: var(--glass-shine), var(--shadow-lg);
  animation:slideUp .28s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes slideUp { from{opacity:0;transform:translateY(20px) scale(0.97)} to{opacity:1;transform:translateY(0) scale(1)} }
.modal h3 { margin-bottom:20px; color:var(--amber); font-size:1.05rem; }
.modal .form-group { margin-bottom:14px; }
.modal .form-group label { display:block; font-size:0.68rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); margin-bottom:5px; font-weight:500; }
.modal .form-group input { width:100%; padding:10px 12px; background:var(--surface3); border:1px solid var(--border-light); color:var(--text); border-radius:var(--radius-sm); font-size:0.88rem; transition:border-color .2s, box-shadow .2s; }
.modal .form-group input:focus { outline:none; border-color:var(--amber); box-shadow:0 0 0 3px var(--amber-glow); }
.modal-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:20px; }

/* Directions Modal */
.dir-modal { max-width:480px; padding:0; overflow:hidden; position:relative; }
.dir-close { position:absolute; top:12px; right:14px; background:none; border:none; color:var(--text-dim); font-size:1.4rem; z-index:5; line-height:1; padding:4px 8px; border-radius:6px; transition:all .2s; }
.dir-close:hover { color:var(--text); background:rgba(255,255,255,0.08); }
.dir-header { padding:24px 24px 16px; }
.dir-route { display:flex; align-items:center; gap:10px; margin-bottom:14px; }
.dir-loc { font-size:0.82rem; font-weight:600; color:var(--text); }
.dir-arrow { color:var(--amber); font-size:1rem; flex-shrink:0; }
.dir-badges { display:flex; gap:8px; flex-wrap:wrap; }
.dir-badge { display:inline-flex; align-items:center; gap:5px; padding:5px 12px; border-radius:20px; font-size:0.7rem; font-weight:600; }
.dir-badge.method { background:var(--amber-glow); color:var(--amber); border:1px solid rgba(232,184,75,0.22); }
.dir-badge.time { background:var(--teal-glow); color:var(--teal); border:1px solid rgba(56,178,172,0.2); }
.dir-badge.cost { background:rgba(72,187,120,0.1); color:#7ee8a8; border:1px solid rgba(72,187,120,0.2); }
.dir-steps { padding:0 24px 24px; }
.dir-steps ol { list-style:none; counter-reset:step; padding:0; margin:0; }
.dir-steps li { counter-increment:step; padding:12px 0 12px 40px; position:relative; font-size:0.8rem; color:var(--text-secondary); line-height:1.55; border-bottom:1px solid var(--border); }
.dir-steps li:last-child { border-bottom:none; }
.dir-steps li::before { content:counter(step); position:absolute; left:0; top:12px; width:26px; height:26px; background:var(--surface3); border:1px solid var(--border); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.68rem; font-weight:700; color:var(--amber); }
.slot.clickable { cursor:pointer; position:relative; }
.slot.clickable::after { content:"tap"; position:absolute; top:4px; right:6px; font-size:0.5rem; opacity:0; text-transform:uppercase; letter-spacing:0.5px; background:rgba(255,255,255,0.1); padding:1px 5px; border-radius:4px; color:var(--text-dim); }
.slot.clickable:hover::after { opacity:1; }
.food-section { padding:0 24px 20px; }
.food-section-title { font-size:0.7rem; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); font-weight:600; margin-bottom:10px; padding-top:16px; border-top:1px solid var(--border); }
.food-section-title:first-child { border-top:none; padding-top:0; }
.food-card { display:flex; justify-content:space-between; align-items:flex-start; padding:10px 14px; background:var(--surface3); border:1px solid var(--border-light); border-radius:var(--radius-sm); margin-bottom:6px; transition:border-color .2s; }
.food-card:hover { border-color:var(--border-light); }
.food-name { font-size:0.8rem; font-weight:600; color:var(--text); margin-bottom:2px; }
.food-desc { font-size:0.7rem; color:var(--text-dim); line-height:1.4; }
.food-price { font-size:0.68rem; font-weight:700; padding:3px 8px; border-radius:12px; white-space:nowrap; flex-shrink:0; margin-left:10px; }
.food-price.p1 { background:rgba(72,187,120,0.1); color:#7ee8a8; }
.food-price.p2 { background:rgba(246,173,85,0.12); color:#f6ad55; }
.food-price.p3 { background:rgba(245,101,101,0.1); color:var(--red); }
.food-note { font-size:0.72rem; color:var(--amber); background:var(--amber-glow); border:1px solid rgba(232,184,75,0.18); padding:10px 14px; border-radius:var(--radius-sm); margin:8px 0 0; line-height:1.45; }
.dir-modal { max-width:520px; max-height:85vh; overflow-y:auto; }

/* Buttons */
.btn { padding:9px 18px; border-radius:40px; border:none; font-size:0.82rem; font-weight:600; transition:all .2s cubic-bezier(0.34,1.56,0.64,1); }
.btn:hover { transform:translateY(-1px); }
.btn:active { transform:translateY(0) scale(0.97); }
.btn-primary {
  background: linear-gradient(135deg, var(--amber) 0%, #e8a820 100%);
  color:#0d0800;
  box-shadow: 0 2px 16px rgba(242,194,78,0.3), inset 0 1px 0 rgba(255,255,255,0.3);
}
.btn-primary:hover { box-shadow:0 4px 24px rgba(242,194,78,0.45), inset 0 1px 0 rgba(255,255,255,0.35); }
.btn-secondary {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  color:var(--text-secondary); border:1px solid var(--glass-border);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
}
.btn-secondary:hover { background:rgba(255,255,255,0.13); border-color:var(--glass-border-bright); }
.btn-teal {
  background: linear-gradient(135deg, var(--teal) 0%, #20c4dc 100%);
  color:#001820;
  box-shadow: 0 2px 16px rgba(56,232,255,0.25), inset 0 1px 0 rgba(255,255,255,0.3);
}
.btn-teal:hover { box-shadow:0 4px 24px rgba(56,232,255,0.4), inset 0 1px 0 rgba(255,255,255,0.35); }
.btn-danger {
  background: rgba(255,96,128,0.1);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  color:var(--red); border:1px solid rgba(255,96,128,0.2);
}
.btn-danger:hover { background:rgba(255,96,128,0.18); }
.btn-sm { padding:6px 14px; font-size:0.73rem; }
.btn-xs { padding:4px 10px; font-size:0.68rem; border-radius:20px; }

/* Expense Form */
.expense-form {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:24px; margin-bottom:24px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.expense-form h3 { color:var(--amber); margin-bottom:18px; font-size:1rem; }
.form-row { display:flex; gap:12px; margin-bottom:14px; flex-wrap:wrap; }
.form-group { display:flex; flex-direction:column; gap:5px; flex:1; min-width:140px; }
.form-group label { font-size:0.68rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:500; }
.form-group input, .form-group select {
  padding:10px 14px;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.12);
  color:var(--text); border-radius:var(--radius-sm); font-size:0.88rem;
  transition:border-color .2s, box-shadow .2s;
}
.form-group input:focus, .form-group select:focus {
  outline:none; border-color:var(--amber);
  box-shadow: 0 0 0 3px var(--amber-glow), inset 0 1px 0 rgba(255,255,255,0.1);
}
.form-group select { cursor:pointer; }
.form-group select option { background:var(--surface2); color:var(--text); }
.checkbox-group { display:flex; flex-wrap:wrap; gap:8px; margin-top:4px; }
.checkbox-label {
  display:flex; align-items:center; gap:6px; font-size:0.82rem; cursor:pointer;
  padding:6px 14px; border-radius:40px;
  background: rgba(255,255,255,0.06); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,0.1); transition:all .2s; user-select:none;
}
.checkbox-label:hover { border-color:rgba(255,255,255,0.2); }
.checkbox-label:has(input:checked) { border-color:rgba(242,194,78,0.45); background:var(--amber-glass); color:var(--amber); }
.checkbox-label input { display:none; }
.checkbox-label .check-dot { width:8px; height:8px; border-radius:50%; border:2px solid var(--text-dim); transition:all .2s; }
.checkbox-label:has(input:checked) .check-dot { background:var(--amber); border-color:var(--amber); }
.split-type-toggle { display:flex; gap:6px; margin-bottom:14px; }
.split-type-btn {
  padding:7px 16px; border-radius:40px;
  background: rgba(255,255,255,0.06); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,0.1); color:var(--text-dim); font-size:0.78rem; font-weight:500; transition:all .2s;
}
.split-type-btn.active { border-color:rgba(242,194,78,0.45); color:var(--amber); background:var(--amber-glass); }
.custom-splits { display:flex; flex-wrap:wrap; gap:10px; margin-top:8px; }
.custom-split-input { display:flex; align-items:center; gap:6px; }
.custom-split-input label { font-size:0.78rem; min-width:55px; color:var(--text-secondary); }
.custom-split-input input { width:90px; padding:7px 10px; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:var(--radius-sm); font-size:0.82rem; }

/* Table */
.expense-table-wrap {
  overflow-x:auto; border-radius:var(--radius-lg);
  border:1px solid var(--glass-border);
  background: rgba(255,255,255,0.04);
  backdrop-filter: var(--glass-blur-sm); -webkit-backdrop-filter: var(--glass-blur-sm);
  box-shadow: var(--glass-shine), var(--shadow);
}
table { width:100%; border-collapse:collapse; font-size:0.82rem; }
th {
  text-align:left; padding:12px 14px;
  background: rgba(255,255,255,0.06);
  color:var(--text-secondary); font-size:0.63rem; text-transform:uppercase;
  letter-spacing:1.2px; font-weight:700; border-bottom:1px solid var(--glass-border);
}
th:first-child { border-radius:var(--radius-lg) 0 0 0; }
th:last-child { border-radius:0 var(--radius-lg) 0 0; }
td { padding:12px 14px; border-bottom:1px solid rgba(255,255,255,0.05); }
tr:nth-child(even) td { background:rgba(255,255,255,0.025); }
tr:hover td { background:rgba(242,194,78,0.04); }
.amount-cell { font-family:'SF Mono','Fira Code','Courier New',monospace; font-weight:600; font-size:0.82rem; }
.cat-icon { margin-right:4px; }
.status-badge { display:inline-block; padding:3px 10px; border-radius:12px; font-size:0.65rem; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; cursor:pointer; }
.status-paid { background:rgba(72,187,120,0.12); color:var(--green); }
.status-pending { background:rgba(237,137,54,0.12); color:var(--orange); }
.actions-cell { display:flex; gap:4px; }

/* Summary Cards */
.summary-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(190px,1fr)); gap:14px; margin-bottom:24px; }
.summary-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg); padding:18px; text-align:center;
  box-shadow: var(--glass-shine), var(--shadow); position:relative; overflow:hidden;
}
.summary-card .accent-bar { position:absolute; top:0; left:0; right:0; height:3px; }
.summary-card .accent-bar.positive { background:linear-gradient(90deg, var(--teal), #5ed4ce); }
.summary-card .accent-bar.negative { background:linear-gradient(90deg, var(--red), #fc8181); }
.summary-card .accent-bar.zero { background:var(--border); }
.summary-avatar { width:36px; height:36px; border-radius:50%; background:var(--surface2); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.82rem; color:var(--amber); margin:0 auto 10px; }
.summary-name { font-weight:600; margin-bottom:10px; font-size:0.88rem; }
.summary-row { display:flex; justify-content:space-between; font-size:0.78rem; margin-top:5px; }
.summary-row .label { color:var(--text-dim); }
.summary-net { font-size:1.1rem; font-weight:700; margin-top:8px; padding-top:8px; border-top:1px solid var(--border); }
.net-positive { color:var(--teal); }
.net-negative { color:var(--red); }
.net-zero { color:var(--text-dim); }

/* Who Owes Whom — Person tabs */
.wow-section {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:24px; margin-top:24px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.wow-section h3 { color:var(--amber); margin-bottom:16px; font-size:1rem; display:flex; align-items:center; gap:8px; }
.person-tabs { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:18px; }
.person-tab {
  padding:8px 18px; border-radius:40px;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  border:1px solid rgba(255,255,255,0.1); color:var(--text-dim);
  font-size:0.82rem; font-weight:600; transition:all .2s; position:relative;
}
.person-tab:hover { border-color:rgba(255,255,255,0.2); color:var(--text-secondary); }
.person-tab.active { border-color:rgba(242,194,78,0.5); color:var(--amber); background:var(--amber-glass); box-shadow:0 0 16px rgba(242,194,78,0.1); }
.person-tab .tab-badge { position:absolute; top:-4px; right:-4px; width:16px; height:16px; border-radius:50%; font-size:0.55rem; display:flex; align-items:center; justify-content:center; font-weight:700; }
.person-tab .tab-badge.has-debt { background:var(--red); color:#fff; }
.person-tab .tab-badge.settled { background:var(--green); color:#fff; }

.person-detail { display:none; animation:fadeIn .25s ease; }
.person-detail.active { display:block; }
.person-summary-bar {
  display:flex; gap:16px; margin-bottom:16px; padding:14px 18px;
  background: rgba(255,255,255,0.06); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border:1px solid var(--glass-border); border-radius:var(--radius);
  flex-wrap:wrap; box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
}
.psb-item { text-align:center; flex:1; min-width:100px; }
.psb-label { font-size:0.62rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); margin-bottom:2px; }
.psb-value { font-size:1rem; font-weight:700; font-family:'SF Mono','Fira Code','Courier New',monospace; }

.debt-item {
  display:flex; align-items:center; gap:12px; padding:14px 16px;
  background: rgba(255,255,255,0.05); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
  border:1px solid var(--glass-border); border-radius:var(--radius);
  margin-bottom:8px; transition:all .2s;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
}
.debt-item:hover { border-color:var(--border-light); }
.debt-item.is-paid { opacity:0.45; }
.debt-icon { font-size:1.1rem; flex-shrink:0; }
.debt-info { flex:1; min-width:0; }
.debt-desc { font-weight:600; font-size:0.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.debt-sub { font-size:0.72rem; color:var(--text-dim); margin-top:2px; }
.debt-amount { font-family:'SF Mono','Fira Code','Courier New',monospace; font-weight:700; font-size:0.92rem; color:var(--amber); text-align:right; min-width:100px; flex-shrink:0; }
.debt-amount.paid { color:var(--green); text-decoration:line-through; opacity:0.6; }
.debt-actions { display:flex; gap:6px; align-items:center; flex-shrink:0; }
.paid-check { color:var(--green); font-size:1.1rem; }

.no-debts { text-align:center; padding:20px; color:var(--text-dim); font-size:0.88rem; }

/* Settings */
.settings-section {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:24px; margin-bottom:16px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.settings-section h3 { color:var(--amber); margin-bottom:14px; font-size:1rem; }
.settings-row { display:flex; align-items:center; gap:12px; margin-bottom:14px; flex-wrap:wrap; }
.settings-row label { font-size:0.85rem; min-width:80px; color:var(--text-secondary); }
.settings-row input { padding:9px 12px; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:var(--radius-sm); width:100px; }

/* Summary card clickable */
.summary-card { cursor:pointer; transition:border-color .2s, transform .2s; }
.summary-card:hover { border-color:var(--border-light); transform:translateY(-2px); }

/* Payer Modal */
.payer-hero { padding:24px 24px 16px; border-bottom:1px solid var(--border); }
.payer-hero-name { font-size:1.1rem; font-weight:700; color:var(--text); margin-bottom:4px; }
.payer-hero-sub { font-size:0.75rem; color:var(--text-dim); }
.payer-stats { display:flex; gap:0; margin-top:14px; background:var(--surface2); border-radius:var(--radius-sm); overflow:hidden; border:1px solid var(--border); }
.payer-stat { flex:1; padding:12px 10px; text-align:center; border-right:1px solid var(--border); }
.payer-stat:last-child { border-right:none; }
.payer-stat-label { font-size:0.58rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:600; margin-bottom:4px; }
.payer-stat-value { font-size:0.95rem; font-weight:700; font-family:'SF Mono','Fira Code','Courier New',monospace; }
.payer-body { padding:20px 24px 24px; }
.payer-exp-block { margin-bottom:20px; background:var(--surface2); border:1px solid var(--border); border-radius:var(--radius-sm); overflow:hidden; }
.payer-exp-header { padding:12px 16px; background:rgba(255,255,255,0.03); border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; }
.payer-exp-title { font-size:0.85rem; font-weight:600; color:var(--text); flex:1; }
.payer-exp-amount { font-size:0.82rem; font-weight:700; font-family:'SF Mono','Fira Code','Courier New',monospace; color:var(--amber); }
.payer-settle-row { display:flex; justify-content:space-between; align-items:center; padding:10px 16px; border-bottom:1px solid var(--border); font-size:0.78rem; }
.payer-settle-row:last-child { border-bottom:none; }
.payer-settle-who { color:var(--text-secondary); }
.payer-settle-who strong { color:var(--text); }
.payer-settle-amount { font-family:'SF Mono','Fira Code','Courier New',monospace; font-weight:600; }
.payer-settle-status { font-size:0.65rem; font-weight:700; padding:2px 8px; border-radius:10px; margin-left:8px; }
.payer-settle-status.paid { background:rgba(72,187,120,0.12); color:var(--green); }
.payer-settle-status.unpaid { background:rgba(237,137,54,0.12); color:var(--orange); }
.payer-exp-footer { padding:10px 16px; background:rgba(232,184,75,0.05); border-top:1px solid var(--border); display:flex; justify-content:space-between; font-size:0.75rem; }
.payer-exp-footer .footer-label { color:var(--text-dim); }
.payer-exp-footer .footer-val { font-weight:700; font-family:'SF Mono','Fira Code','Courier New',monospace; }
.payer-exp-footer .footer-val.settled { color:var(--green); }
.payer-exp-footer .footer-val.partial { color:var(--amber); }
.payer-exp-footer .footer-val.none { color:var(--red); }
.payer-section-title { font-size:0.65rem; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); font-weight:700; margin-bottom:10px; margin-top:20px; padding-bottom:6px; border-bottom:1px solid var(--border); }

/* Total Group Expenses row */
.expense-total-row td { padding:12px 14px; border-top:2px solid var(--border); background:rgba(232,184,75,0.05); font-weight:700; }
.expense-total-label { color:var(--amber); font-size:0.82rem; }
.expense-total-value { font-family:'SF Mono','Fira Code','Courier New',monospace; font-size:0.9rem; color:var(--amber); }

/* Personal Expenses */
.pe-person-tabs { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:20px; }
.pe-person-tab {
  padding:8px 20px; border-radius:40px;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  border:1px solid rgba(255,255,255,0.1); color:var(--text-dim);
  font-size:0.82rem; font-weight:600; transition:all .22s; cursor:pointer;
}
.pe-person-tab:hover { border-color:rgba(255,255,255,0.2); color:var(--text-secondary); }
/* Per-person active colors */
.pe-person-tab.active[data-pe-tab="eduard"]  { border-color:#45e3ff; color:#45e3ff; background:rgba(69,227,255,0.1); }
.pe-person-tab.active[data-pe-tab="anwell"]  { border-color:#e8b84b; color:#e8b84b; background:rgba(232,184,75,0.12); }
.pe-person-tab.active[data-pe-tab="justin"]  { border-color:#3dd68c; color:#3dd68c; background:rgba(61,214,140,0.1); }
.pe-person-tab.active[data-pe-tab="kerr"]    { border-color:#ff9f5a; color:#ff9f5a; background:rgba(255,159,90,0.1); }
.pe-person-tab.active[data-pe-tab="august"]  { border-color:#fb7185; color:#fb7185; background:rgba(251,113,133,0.1); }
.pe-person-tab.active { border-color:var(--teal); color:var(--teal); background:var(--teal-glow); }

.pe-panel { display:none; animation:fadeIn .25s ease; }
.pe-panel.active { display:block; }

.pe-summary-bar {
  display:flex; gap:0;
  background: rgba(255,255,255,0.06);
  backdrop-filter: var(--glass-blur-sm); -webkit-backdrop-filter: var(--glass-blur-sm);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  overflow:hidden; margin-bottom:22px;
  box-shadow: var(--glass-shine);
}
.pe-stat { flex:1; padding:16px 14px; text-align:center; border-right:1px solid var(--border); }
.pe-stat:last-child { border-right:none; }
.pe-stat-label { font-size:0.58rem; text-transform:uppercase; letter-spacing:1.3px; color:var(--text-dim); font-weight:600; margin-bottom:5px; }
.pe-stat-value { font-size:1.05rem; font-weight:700; font-family:'SF Mono','Fira Code','Courier New',monospace; }

.pe-add-form {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:20px 22px; margin-bottom:22px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.pe-add-form h4 { color:var(--teal); font-size:0.9rem; margin-bottom:14px; }

.pe-table-wrap {
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  overflow:hidden;
  background: rgba(255,255,255,0.04);
  backdrop-filter: var(--glass-blur-sm); -webkit-backdrop-filter: var(--glass-blur-sm);
  box-shadow: var(--glass-shine), var(--shadow);
}
.pe-table { width:100%; border-collapse:collapse; font-size:0.82rem; }
.pe-table th { text-align:left; padding:11px 14px; background:var(--surface2); color:var(--text-dim); font-size:0.63rem; text-transform:uppercase; letter-spacing:1.2px; font-weight:600; }
.pe-table td { padding:11px 14px; border-bottom:1px solid var(--border); vertical-align:middle; }
.pe-table tr:last-child td { border-bottom:none; }
.pe-table tr:hover td { background:rgba(255,255,255,0.02); }
.pe-table .pe-total-row td { border-top:2px solid var(--border); background:rgba(56,178,172,0.04); font-weight:700; border-bottom:none; }
.pe-total-label { color:var(--teal); font-size:0.82rem; }
.pe-total-value { font-family:'SF Mono','Fira Code','Courier New',monospace; font-size:0.9rem; color:var(--teal); }
.pe-empty { text-align:center; padding:32px; color:var(--text-dim); font-size:0.85rem; }
.pe-cat-badge { display:inline-block; padding:2px 8px; border-radius:10px; font-size:0.65rem; font-weight:600; background:var(--surface3); color:var(--text-secondary); }

/* Must-Try */
.musttry-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:12px; }
.musttry-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:18px 16px; cursor:pointer; transition:all .25s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: var(--glass-shine), var(--shadow);
  display:flex; flex-direction:column; gap:8px; position:relative; overflow:hidden;
}
.musttry-card::before { content:""; position:absolute; top:0; left:0; right:0; height:3px; }
.musttry-card.day1::before { background:linear-gradient(90deg,#45e3ff,#6f88fc); }
.musttry-card.day2::before { background:linear-gradient(90deg,#3dd68c,#22c55e); }
.musttry-card.day3::before { background:linear-gradient(90deg,#ff9f5a,#f97316); }
.musttry-card.day4::before { background:linear-gradient(90deg,#c084fc,#a78bfa); }
.musttry-card.day5::before { background:linear-gradient(90deg,#ff5f7e,#fb7185); }
.musttry-card.home::before { background:linear-gradient(90deg,#fbbf24,#f59e0b); }
.musttry-card:hover { border-color:var(--glass-border-bright); transform:translateY(-4px) scale(1.01); box-shadow:var(--glass-shine), var(--shadow-lg); }
.musttry-card-emoji { font-size:1.8rem; line-height:1; }
.musttry-card-name { font-size:0.88rem; font-weight:700; color:var(--text); }
.musttry-card-day { font-size:0.65rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:500; }
.musttry-card-tags { display:flex; gap:5px; flex-wrap:wrap; margin-top:4px; }
.musttry-tag { font-size:0.6rem; padding:2px 7px; border-radius:10px; background:var(--surface2); color:var(--text-dim); border:1px solid var(--border); }

/* Must-Try Area Modal */
.mustarea-modal { max-width:580px; max-height:88vh; overflow-y:auto; padding:0; }
.mustarea-hero { padding:28px 28px 20px; border-bottom:1px solid var(--border); }
.mustarea-hero-top { display:flex; align-items:center; gap:14px; margin-bottom:14px; }
.mustarea-emoji { font-size:2.4rem; line-height:1; }
.mustarea-title { font-size:1.2rem; font-weight:700; color:var(--text); margin-bottom:2px; }
.mustarea-day { font-size:0.7rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:500; }
.mustarea-desc { font-size:0.82rem; color:var(--text-secondary); line-height:1.6; }
.mustarea-body { padding:0 28px 28px; }
.mustarea-section { margin-top:22px; }
.mustarea-section-title { font-size:0.65rem; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); font-weight:700; margin-bottom:10px; display:flex; align-items:center; gap:6px; padding-bottom:6px; border-bottom:1px solid var(--border); }
.mustarea-item { display:flex; justify-content:space-between; align-items:flex-start; padding:10px 14px; background:var(--surface3); border:1px solid var(--border-light); border-radius:var(--radius-sm); margin-bottom:6px; transition:border-color .2s; gap:10px; }
.mustarea-item:hover { border-color:var(--border-light); }
.mustarea-item-left { flex:1; min-width:0; }
.mustarea-item-name { font-size:0.82rem; font-weight:600; color:var(--text); margin-bottom:2px; }
.mustarea-item-desc { font-size:0.72rem; color:var(--text-dim); line-height:1.4; }
.mustarea-badge { font-size:0.65rem; font-weight:700; padding:3px 9px; border-radius:10px; white-space:nowrap; flex-shrink:0; }
.mustarea-badge.p1 { background:rgba(72,187,120,0.1); color:#7ee8a8; }
.mustarea-badge.p2 { background:rgba(246,173,85,0.12); color:#f6ad55; }
.mustarea-badge.p3 { background:rgba(245,101,101,0.1); color:var(--red); }
.mustarea-badge.pfree { background:rgba(69,227,255,0.1); color:var(--teal); }
.mustarea-badge.tip { background:rgba(232,184,75,0.1); color:var(--amber); }
.mustarea-note { font-size:0.75rem; color:var(--amber); background:var(--amber-glow); border:1px solid rgba(232,184,75,0.2); padding:10px 14px; border-radius:var(--radius-sm); line-height:1.5; margin-top:10px; }
.mustarea-close { position:absolute; top:14px; right:16px; background:none; border:none; color:var(--text-dim); font-size:1.4rem; z-index:5; line-height:1; padding:4px 8px; border-radius:6px; transition:all .2s; }
.mustarea-close:hover { color:var(--text); background:rgba(255,255,255,0.08); }

/* Must-Try Area Modal — glass */
.mustarea-modal {
  max-width:580px; max-height:92vh; overflow-y:auto; padding:0;
  background: rgba(10,20,36,0.88);
  backdrop-filter: blur(40px) saturate(160%);
  -webkit-backdrop-filter: blur(40px) saturate(160%);
  border: 1px solid var(--glass-border-bright);
  border-radius: var(--radius-lg);
  box-shadow: var(--glass-shine), var(--shadow-lg);
}

/* ── MOBILE ITINERARY ─────────────────────────────────────── */
.itin-day-selector {
  display:flex; gap:8px; overflow-x:auto; padding-bottom:4px;
  margin-bottom:16px; scrollbar-width:none; -ms-overflow-style:none;
}
.itin-day-selector::-webkit-scrollbar { display:none; }
.itin-day-btn {
  flex-shrink:0; padding:8px 18px; border-radius:40px;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.12);
  color:var(--text-dim); font-size:0.8rem; font-weight:600;
  transition:all .22s ease; cursor:pointer; white-space:nowrap;
  font-family:inherit;
}
.itin-day-btn:hover { color:var(--text-secondary); border-color:rgba(255,255,255,0.2); }
.itin-day-btn.active {
  background: var(--amber-glass);
  border-color: rgba(242,194,78,0.4);
  color: var(--amber);
  box-shadow: 0 0 16px rgba(242,194,78,0.15), inset 0 1px 0 rgba(255,255,255,0.12);
}

.itin-timeline { display:flex; flex-direction:column; gap:0; }
.itin-tl-row {
  display:flex; gap:0; align-items:stretch; position:relative;
}
.itin-tl-time-col {
  width:52px; flex-shrink:0; display:flex; flex-direction:column; align-items:center;
  padding-top:14px;
}
.itin-tl-time {
  font-size:0.6rem; font-weight:700; color:var(--text-dim);
  letter-spacing:0.3px; text-align:center; line-height:1; white-space:nowrap;
}
.itin-tl-line {
  width:2px; flex:1; margin-top:6px;
  background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.04) 100%);
  min-height:16px;
}
.itin-tl-row:last-child .itin-tl-line { display:none; }
.itin-tl-dot {
  width:8px; height:8px; border-radius:50%; flex-shrink:0;
  border:2px solid rgba(255,255,255,0.2);
  background:rgba(255,255,255,0.1);
  margin-top:16px; position:relative; z-index:1;
}
/* Dot colors by type */
.itin-tl-row[data-type="sleep"] .itin-tl-dot { border-color:#8aa2be; background:#8aa2be33; }
.itin-tl-row[data-type="travel"] .itin-tl-dot { border-color:#38e8ff; background:#38e8ff33; }
.itin-tl-row[data-type="activity"] .itin-tl-dot { border-color:#3dd68c; background:#3dd68c33; }
.itin-tl-row[data-type="eating"] .itin-tl-dot { border-color:#f2c24e; background:#f2c24e33; }
.itin-tl-row[data-type="free"] .itin-tl-dot { border-color:#c084fc; background:#c084fc33; }
.itin-tl-row[data-type="prep"] .itin-tl-dot { border-color:#8fa0b8; background:#8fa0b833; }

.itin-tl-card {
  flex:1; margin:4px 0 4px 10px; padding:12px 14px;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.09);
  border-radius:12px;
  transition:all .2s ease;
  min-height:44px; display:flex; align-items:center; gap:8px;
}
.itin-tl-card.clickable { cursor:pointer; }
.itin-tl-card.clickable:active { transform:scale(0.98); background:rgba(255,255,255,0.08); }
/* Left accent bar by type */
.itin-tl-card[data-type="sleep"]    { border-left:3px solid rgba(138,162,190,0.5); }
.itin-tl-card[data-type="travel"]   { border-left:3px solid rgba(56,232,255,0.6); }
.itin-tl-card[data-type="activity"] { border-left:3px solid rgba(61,214,140,0.65); }
.itin-tl-card[data-type="eating"]   { border-left:3px solid rgba(242,194,78,0.7); }
.itin-tl-card[data-type="free"]     { border-left:3px solid rgba(192,132,252,0.6); }
.itin-tl-card[data-type="prep"]     { border-left:3px solid rgba(143,160,184,0.45); }
.itin-tl-card.sleep-card            { opacity:0.55; }

.itin-tl-icon { font-size:1.2rem; flex-shrink:0; }
.itin-tl-label { font-size:0.83rem; font-weight:500; color:var(--text); flex:1; line-height:1.3; }
.itin-tl-card.sleep-card .itin-tl-label { color:var(--text-dim); font-style:italic; }
.itin-tl-tap { font-size:0.6rem; color:var(--amber); opacity:0.7; flex-shrink:0; }

/* ── TOAST ───────────────────────────────────────────────── */
.toast {
  position:fixed; bottom:24px; right:24px;
  background: rgba(15,28,46,0.9);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  color:var(--text); border:1px solid var(--glass-border);
  border-left:3px solid var(--green); padding:14px 22px;
  border-radius:var(--radius); box-shadow:var(--glass-shine), var(--shadow-lg);
  transform:translateY(100px); opacity:0;
  transition:all .35s cubic-bezier(.34,1.56,.64,1); z-index:300; font-size:0.85rem;
}
.toast.show { transform:translateY(0); opacity:1; }
.toast.error { border-left-color:var(--red); }

/* ── RESPONSIVE ──────────────────────────────────────────── */
@media(max-width:768px) {
  .header { padding:10px 16px; }
  .header-title { font-size:1.1rem; }
  .content { padding:14px; }
  .flights { grid-template-columns:1fr; }
  .form-row { flex-direction:column; }
  .form-group { min-width:auto; }
  .tabs { padding:0 8px; }
  .tab { padding:12px 14px; font-size:0.8rem; }
  .summary-grid { grid-template-columns:1fr 1fr; }
  .person-summary-bar { gap:8px; }
  .musttry-grid { grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; }
  /* Switch itinerary to mobile timeline */
  .itin-desktop { display:none !important; }
  .itin-mobile  { display:block !important; }
}
@media(max-width:480px) {
  .summary-grid { grid-template-columns:1fr; }
  .flight-times { flex-direction:column; gap:10px; }
  .countdown { gap:4px; }
  .cd-box { min-width:38px; padding:4px 7px; }
  .cd-num { font-size:1rem; }
  .debt-item { flex-wrap:wrap; }
  .debt-amount { min-width:auto; }
  .musttry-grid { grid-template-columns:1fr 1fr; }
  .modal { padding:20px 18px; border-radius:var(--radius-lg); }
  /* Full-screen modal sheet on mobile */
  .modal-overlay { align-items:flex-end; padding:0; }
  .modal { width:100%; max-width:100%; border-radius:var(--radius-lg) var(--radius-lg) 0 0; max-height:92vh; overflow-y:auto; }
  .dir-modal { max-height:88vh; }
  .mustarea-modal { max-height:92vh; }
  /* Tab bar scrolling feel */
  .tabs { padding:0 4px; }
  .tab { padding:12px 12px; font-size:0.77rem; }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="logo">BK</div>
    <div class="header-title">BKK 2026 <span>Bangkok</span></div>
  </div>
  <div class="countdown" id="countdown"></div>
  <div class="header-rate">
    <span>1 THB</span> =
    <input type="number" id="rateInput" step="0.01" min="0">
    <span>PHP</span>
  </div>
</div>

<div class="tabs">
  <button class="tab active" data-tab="overview">Overview</button>
  <button class="tab" data-tab="musttry">Must-Try</button>
  <button class="tab" data-tab="expenses">Group Expenses</button>
  <button class="tab" data-tab="personal">Personal Expenses</button>
  <button class="tab" data-tab="settings">Settings</button>
</div>

<div class="content">
  <!-- OVERVIEW -->
  <div class="tab-content active" id="tab-overview">
    <div class="section-title"><span class="icon">&#9992;</span> Flight Details</div>
    <div class="flights">
      <div class="flight-card">
        <div class="flight-label">Departure</div>
        <div class="flight-route">MNL &rarr; BKK</div>
        <div class="flight-num">5J 931 &middot; Cebu Pacific</div>
        <div class="flight-times">
          <div class="flight-point"><div class="airport">NAIA Terminal 3</div><div class="time">11:45 PM</div><div class="date">March 24, 2026 (Tue)</div></div>
          <div class="flight-arrow">&#9992;</div>
          <div class="flight-point" style="text-align:right"><div class="airport">Suvarnabhumi Airport</div><div class="time">2:45 AM</div><div class="date">March 25, 2026 (Wed)</div></div>
        </div>
      </div>
      <div class="flight-card">
        <div class="flight-label">Return</div>
        <div class="flight-route">BKK &rarr; MNL</div>
        <div class="flight-num">5J 930 &middot; Cebu Pacific</div>
        <div class="flight-times">
          <div class="flight-point"><div class="airport">Suvarnabhumi Airport</div><div class="time">11:25 AM</div><div class="date">March 30, 2026 (Mon)</div></div>
          <div class="flight-arrow">&#9992;</div>
          <div class="flight-point" style="text-align:right"><div class="airport">NAIA Terminal 3</div><div class="time">4:15 PM</div><div class="date">March 30, 2026 (Mon)</div></div>
        </div>
      </div>
    </div>
    <div class="section-title"><span class="icon">&#128197;</span> 6-Day Itinerary</div>
    <!-- Desktop table -->
    <div class="itin-desktop" style="overflow-x:auto"><table class="itinerary-table" id="itineraryGrid"></table></div>
    <!-- Mobile timeline -->
    <div class="itin-mobile">
      <div class="itin-day-selector" id="itinDaySelector"></div>
      <div class="itin-timeline" id="itinTimeline"></div>
    </div>
    <div class="itinerary-legend">
      <div class="legend-item"><div class="legend-dot" style="background:#6e6e8e"></div>Sleep</div>
      <div class="legend-item"><div class="legend-dot" style="background:#7cc4f5"></div>Travel</div>
      <div class="legend-item"><div class="legend-dot" style="background:#7ee8a8"></div>Activity</div>
      <div class="legend-item"><div class="legend-dot" style="background:#f6ad55"></div>Eating</div>
      <div class="legend-item"><div class="legend-dot" style="background:#c4a8f7"></div>Free Time</div>
      <div class="legend-item"><div class="legend-dot" style="background:#9898b0"></div>Prep</div>
    </div>
    <div style="margin-top:14px;"><a href="https://www.google.com/maps/d/u/0/edit?mid=1b000Titzrj3lhr3ksDZC26xUmX0qvAI&usp=sharing" target="_blank" style="color:var(--teal);font-size:0.82rem;text-decoration:none;font-weight:500;">&#128205; Open Trip Map in Google Maps &rarr;</a></div>
  </div>

  <!-- GROUP EXPENSES -->
  <div class="tab-content" id="tab-expenses">
    <div class="expense-form" id="expenseForm">
      <h3 id="formTitle">&#10010; Add Expense</h3>
      <input type="hidden" id="editExpenseId">
      <div class="form-row">
        <div class="form-group" style="flex:2"><label>Description</label><input type="text" id="expDesc" placeholder="e.g. Grab to Chatuchak"></div>
        <div class="form-group"><label>Amount</label><input type="number" id="expAmount" step="0.01" min="0" placeholder="0.00"></div>
        <div class="form-group" style="flex:0.5;min-width:80px"><label>Currency</label><select id="expCurrency"><option value="PHP">PHP</option><option value="THB">THB</option></select></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Paid By</label><select id="expPaidBy"></select></div>
        <div class="form-group"><label>Category</label><select id="expCategory"><option value="food">&#127860; Food</option><option value="transport">&#128663; Transport</option><option value="accommodation">&#127968; Accommodation</option><option value="activity">&#127915; Activity</option><option value="shopping">&#128717; Shopping</option><option value="other">&#128178; Other</option></select></div>
        <div class="form-group"><label>Date</label><input type="date" id="expDate"></div>
      </div>
      <div class="form-group" style="margin-bottom:14px"><label>Split Among</label><div class="checkbox-group" id="splitCheckboxes"></div></div>
      <div class="split-type-toggle">
        <button class="split-type-btn active" data-split="equal">Equal Split</button>
        <button class="split-type-btn" data-split="custom">Custom Split</button>
      </div>
      <div class="custom-splits" id="customSplits" style="display:none"></div>
      <div style="margin-top:14px;display:flex;gap:8px">
        <button class="btn btn-primary" onclick="saveExpense()">Save Expense</button>
        <button class="btn btn-secondary" id="cancelEditBtn" style="display:none" onclick="cancelEdit()">Cancel</button>
      </div>
    </div>

    <div class="section-title"><span class="icon">&#128200;</span> Summary <span style="font-size:0.7rem;font-weight:400;color:var(--text-dim);margin-left:8px">— tap a card for full breakdown</span></div>
    <div class="summary-grid" id="summaryGrid"></div>

    <div class="section-title"><span class="icon">&#128203;</span> All Expenses</div>
    <div class="expense-table-wrap">
      <table><thead><tr><th>Description</th><th>Amount</th><th>Paid By</th><th>Split Among</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead><tbody id="expenseTableBody"></tbody></table>
    </div>

    <div class="wow-section">
      <h3>&#128176; Settlement — Who Owes Whom</h3>
      <p style="font-size:0.78rem;color:var(--text-dim);margin-bottom:16px;margin-top:-8px">Select a person to see what they owe and mark payments as settled.</p>
      <div class="person-tabs" id="personTabs"></div>
      <div id="personDetails"></div>
    </div>
  </div>

  <!-- PERSONAL EXPENSES -->
  <div class="tab-content" id="tab-personal">
    <div class="section-title"><span class="icon">&#128179;</span> Personal Expenses <span style="font-size:0.7rem;font-weight:400;color:var(--text-dim);margin-left:8px">— track your own spending, separate from the group</span></div>
    <div class="pe-person-tabs" id="pePersonTabs"></div>
    <div id="pePanels"></div>
  </div>

  <!-- MUST-TRY -->
  <div class="tab-content" id="tab-musttry">
    <div class="section-title"><span class="icon">&#11088;</span> Must-Try — Click an area to explore</div>
    <div id="mustTryGrid"></div>
  </div>

  <!-- SETTINGS -->
  <div class="tab-content" id="tab-settings">
    <div class="section-title"><span class="icon">&#9881;</span> Settings</div>

    <div class="settings-section">
      <h3>&#128202; Google Sheets Sync</h3>
      <div id="syncStatus" style="margin-bottom:12px;padding:10px;border-radius:8px;font-size:0.85rem;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
        <button class="btn btn-teal btn-sm" onclick="testGsheetsConnection()">&#128270; Test Connection</button>
        <button class="btn btn-secondary btn-sm" onclick="manualSync()">&#128260; Manual Sync</button>
        <button class="btn btn-secondary btn-sm" onclick="toggleAutoSync()"><span id="autoSyncBtnText">&#9654; Enable Auto-Sync</span></button>
      </div>
      <details>
        <summary style="color:var(--text-dim);font-size:0.78rem;cursor:pointer;user-select:none;list-style:none;display:flex;align-items:center;gap:4px">&#9881; Edit sync credentials <span style="font-size:0.65rem">(admin only)</span></summary>
        <div style="margin-top:10px">
          <div class="settings-row">
            <label style="min-width:140px">Spreadsheet ID</label>
            <input type="text" id="spreadsheetId" placeholder="Paste your Google Sheets ID" style="flex:1;max-width:400px">
          </div>
          <div class="settings-row">
            <label style="min-width:140px">API Key</label>
            <input type="password" id="apiKey" placeholder="Paste your API key" style="flex:1;max-width:400px">
          </div>
          <div class="settings-row">
            <label style="min-width:140px">Apps Script URL</label>
            <input type="text" id="webAppUrl" placeholder="Paste your Apps Script Web App URL (for writes)" style="flex:1;max-width:400px">
          </div>
          <div class="settings-row">
            <label style="min-width:140px">Secret Token</label>
            <input type="password" id="syncToken" placeholder="Same token as in your Apps Script code" style="flex:1;max-width:400px">
          </div>
          <button class="btn btn-primary btn-sm" style="margin-top:4px" onclick="saveGsheetsConfig()">&#128190; Save Config</button>
        </div>
      </details>
      <details style="margin-top:14px;cursor:pointer">
        <summary style="color:var(--teal);font-size:0.85rem;font-weight:600">&#128161; How to set up Google Sheets sync</summary>
        <div style="margin-top:8px;font-size:0.82rem;line-height:1.6;color:var(--text-secondary)">
          <p><b>Step 1: Create a Google Sheet</b><br/>Create a new blank Google Sheet. Copy the ID from the URL — it's the long string between <code>/d/</code> and <code>/edit</code>. Share the sheet: click Share → Anyone with the link → Editor.</p>
          <p><b>Step 2: Add the Apps Script</b><br/>In your Google Sheet click <b>Extensions → Apps Script</b>. Delete all existing code, paste the script below, save, then click <b>Deploy → New deployment → Web app</b>. Set Execute as: Me, Who has access: Anyone. Copy the Web App URL.</p>
          <pre style="background:#1c1c32;color:#e8a838;padding:10px;border-radius:6px;font-size:0.75rem;overflow-x:auto;white-space:pre-wrap">// ⚠️ Replace bkk2026abc with your own secret password
// Enter the same password in the dashboard Settings → Secret Token field
var SECRET = "bkk2026abc";

function doPost(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sh = ss.getSheetByName("SyncData") || ss.insertSheet("SyncData");
  try {
    var b = JSON.parse(e.postData.contents);
    if (b.token !== SECRET) {
      return ContentService
        .createTextOutput(JSON.stringify({ok:false,error:"Unauthorized"}))
        .setMimeType(ContentService.MimeType.JSON);
    }
    if (b.action === "write") {
      sh.getRange("A1").setValue(b.data);
      return ContentService
        .createTextOutput(JSON.stringify({ok:true}))
        .setMimeType(ContentService.MimeType.JSON);
    }
  } catch(err) {
    return ContentService
      .createTextOutput(JSON.stringify({ok:false,error:err.message}))
      .setMimeType(ContentService.MimeType.JSON);
  }
  return ContentService
    .createTextOutput(JSON.stringify({ok:false,error:"unknown action"}))
    .setMimeType(ContentService.MimeType.JSON);
}</pre>
          <p><b>Important:</b> Replace <code>bkk2026abc</code> with your own secret password. Deploy with <b>Execute as: Me</b> and <b>Who has access: Anyone with Google Account</b>. Enter the same password in the Secret Token field above. After updating this code, always create a <b>New Version</b> when redeploying.</p>
          <p><b>Step 3: Get a Google API Key</b><br/>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color:var(--amber)">Google Cloud Console</a> → Create Project → Enable "Google Sheets API" → Create Credentials → API Key.</p>
          <p><b>Step 4: Configure &amp; connect</b><br/>Paste your Spreadsheet ID, API Key, Apps Script URL, and Secret Token into the fields above. Click Save Config → Test Connection → Manual Sync.</p>
          <p style="color:var(--orange)"><b>Note:</b> The "SyncData" sheet tab is created automatically on the first write. After setting up, do a Manual Sync first to initialise, then enable Auto-Sync.</p>
        </div>
      </details>
    </div>

    <div class="settings-section">
      <h3>Exchange Rate</h3>
      <div class="settings-row"><label>1 THB =</label><input type="number" id="settingsRate" step="0.01" min="0"> <span style="color:var(--text-secondary)">PHP</span></div>
      <button class="btn btn-primary btn-sm" onclick="updateRate()">Update Rate</button>
    </div>
    <div class="settings-section">
      <h3>Data Management</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn btn-secondary" onclick="exportData()">&#128190; Export JSON</button>
        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">&#128194; Import JSON</button>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
        <button class="btn btn-danger" onclick="resetData()">&#128465; Reset All Data</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="directionsModal" onclick="if(event.target===this)closeDirections()">
  <div class="modal dir-modal">
    <button class="dir-close" onclick="closeDirections()">&times;</button>
    <div id="dirContent"></div>
  </div>
</div>

<div class="modal-overlay" id="payerModal" onclick="if(event.target===this)closePayerModal()">
  <div class="modal dir-modal" style="max-width:560px;max-height:88vh;overflow-y:auto;padding:0;">
    <button class="dir-close" onclick="closePayerModal()" style="top:14px;right:14px">&times;</button>
    <div id="payerModalContent"></div>
  </div>
</div>

<div class="modal-overlay" id="mustAreaModal" onclick="if(event.target===this)closeMustArea()">
  <div class="modal dir-modal mustarea-modal">
    <button class="mustarea-close" onclick="closeMustArea()">&times;</button>
    <div id="mustAreaContent"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const CAT_ICONS = {food:"\u{1F374}",transport:"\u{1F697}",accommodation:"\u{1F3E0}",activity:"\u{1F3AB}",shopping:"\u{1F6CD}",other:"\u{1F4B2}"};

const DEFAULT_DATA = {
  meta: { exchangeRate:1.86, primaryCurrency:"PHP", lastUpdated:new Date().toISOString() },
  travelers: [
    {id:"eduard",firstName:"Eduard Martin",middleName:"Legaspi",lastName:"Carlos",birthDate:"August 18, 1998",passportNumber:"P0609973B"},
    {id:"anwell",firstName:"Anwell Joseph",middleName:"Valencia",lastName:"Patdu",birthDate:"August 11, 1999",passportNumber:"P9430398B"},
    {id:"justin",firstName:"Justin Gabriel",middleName:"Fortaleza",lastName:"Reamillo",birthDate:"July 20, 1997",passportNumber:"P8799117A"},
    {id:"kerr",firstName:"Kerr Lorenzo",middleName:"Co",lastName:"Picazo",birthDate:"November 24, 1997",passportNumber:"P5280022C"},
    {id:"august",firstName:"August",middleName:"",lastName:"",birthDate:"",passportNumber:""}
  ],
  itinerary: [
    {day:1,date:"2026-03-25",label:"Day 1 (Wed)"},
    {day:2,date:"2026-03-26",label:"Day 2 (Thu)"},
    {day:3,date:"2026-03-27",label:"Day 3 (Fri)"},
    {day:4,date:"2026-03-28",label:"Day 4 (Sat)"},
    {day:5,date:"2026-03-29",label:"Day 5 (Sun)"},
    {day:6,date:"2026-03-30",label:"Day 6 (Mon)"}
  ],
  // Each cell: [activity, type, rowspan]. null = skip (covered by rowspan above)
  itinGrid:[
    ["5–6 AM",  ["Arrival","travel",1],["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1]],
    ["6–7 AM",  ["Check-in + Rest","sleep",2],["Zzz","sleep",1],["Wakey + Prep","prep",1],["Zzz","sleep",1],["Wakey + Prep","prep",1],["Zzz","sleep",1]],
    ["7–8 AM",  null,["Wakey + Prep","prep",1],["Quick Brekkie","eating",1],["Wakey + Prep","prep",1],["Quick Brekkie","eating",1],["Prep + Breakfast","eating",1]],
    ["8–9 AM",  ["Prep","prep",1],["Quick Brekkie","eating",1],["Travel to AC","travel",1],["Quick Brekkie + Head to Chatuchak","eating",1],["Khlong Lat Floating Market","activity",3],["Head to Suvarnabhumi","travel",1]],
    ["9–10 AM", ["Chinatown + Stroll","activity",2],["Grand Palace + Wat Pho","activity",3],["Ancient City","activity",3],["Chatuchak Weekend Market Stroll","activity",3],null,["","empty",1]],
    ["10–11 AM",null,null,null,null,null,["","empty",1]],
    ["11 AM–12 PM",["Lunch Break","eating",2],null,null,null,["Early Lunch","eating",1],["","empty",1]],
    ["12–1 PM", null,["Lunch Break","eating",2],["Lunch Break","eating",2],["Lunch Break","eating",1],["FREE TIME: Seacon Bangkae + Space Time / Return to Hotel / Last-minute Shopping / Revisit favorites","free",10],["","empty",1]],
    ["1–2 PM",  ["Song Wat + Talat Noi","activity",3],null,null,["Bang Sue Junction + Ace Jolun","activity",2],null,["","empty",1]],
    ["2–3 PM",  null,["Wat Arun","activity",2],["Ancient City","activity",3],null,null,["","empty",1]],
    ["3–4 PM",  null,null,null,["Go to ICONSIAM + Stroll + Palamig from Chatuchak","activity",2],null,["","empty",1]],
    ["4–5 PM",  ["Go to Airbnb","travel",1],["Go to Airbnb","travel",1],null,null,null,["","empty",1]],
    ["5–6 PM",  ["Rest","free",1],["Rest","free",1],["Go to Airbnb","travel",1],["Go to Khao San Road + Stroll + Dinner (Find Michelin Spot)","eating",4],null,["","empty",1]],
    ["6–7 PM",  ["Prep","prep",1],["Pratunam Area Mall Hop (Platinum + December + Big C + CentralWorld) + Dinner","activity",4],["Rest","free",1],null,null,["","empty",1]],
    ["7–8 PM",  ["Asiatique Dinner Cruise","eating",3],null,["Akara Sky Hanuman Dinner + Drinks","eating",4],null,null,["","empty",1]],
    ["8–9 PM",  null,null,null,null,null,["","empty",1]],
    ["9–10 PM", null,null,null,["Optional: Khao San Drinks. Else: Uwi","free",3],null,["","empty",1]],
    ["10–11 PM",["Go to Airbnb","travel",1],["Go to Airbnb","travel",1],null,null,["Zzz","sleep",1],["","empty",1]],
    ["11 PM–12 AM",["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1],null,["Zzz","sleep",1],["","empty",1]]
  ],
  directions:{
    // DAY 1 (col 1) — row-col keys
    "1-1":{from:"Suvarnabhumi Airport",to:"Airbnb (Ratchathewi)",method:"ARL + BTS",time:"45–50 min",cost:"~62 THB",steps:["Take Airport Rail Link (City Line) from Suvarnabhumi to Phaya Thai station (26 min, 45 THB)","Transfer to BTS Sukhumvit Line at Phaya Thai (N2), ride 1 stop south to Ratchathewi (N1) (17 THB)","Walk to Airbnb from Ratchathewi station"]},
    "4-1":{from:"Airbnb (Ratchathewi)",to:"Chinatown (Yaowarat)",method:"Grab / Taxi",time:"15–25 min",cost:"~70–100 THB",steps:["Book a Grab or taxi from Ratchathewi directly to Yaowarat Road","Alternative: BTS Ratchathewi → Siam → Sukhumvit Line to Asok → MRT Blue Line to Wat Mangkon (Chinatown station)"]},
    "6-1":{from:"Chinatown (Yaowarat)",to:"Lunch spot nearby",method:"Walk",time:"5–10 min",cost:"Free",steps:["Walk along Yaowarat Road — street food stalls and restaurants are everywhere","Pick any spot that looks good along the main strip or side sois"]},
    "8-1":{from:"Chinatown",to:"Song Wat + Talat Noi",method:"Walk",time:"10–15 min",cost:"Free",steps:["From Yaowarat Road, walk south toward the river along Charoen Krung Road","Turn onto Song Wat Road and continue into the Talat Noi neighborhood","The entire area is a connected walking district from Chinatown"]},
    "11-1":{from:"Song Wat + Talat Noi",to:"Airbnb (Ratchathewi)",method:"Grab / Taxi",time:"15–25 min",cost:"~80–120 THB",steps:["Book a Grab from Talat Noi directly back to Ratchathewi","Alternative: Walk to MRT Wat Mangkon or Hua Lamphong → MRT to Sukhumvit → BTS to Ratchathewi (~45 min)"]},
    "14-1":{from:"Airbnb (Ratchathewi)",to:"Asiatique The Riverfront",method:"BTS + Free Boat",time:"40–45 min",cost:"~35–44 THB",steps:["BTS Ratchathewi (N1) → Siam (CEN), transfer to BTS Silom Line","Ride to Saphan Taksin (S6), exit at Exit 2","Walk to Sathorn Pier and board the free Asiatique shuttle boat (runs 16:00–23:30, every 30 min)"]},
    "17-1":{from:"Asiatique The Riverfront",to:"Airbnb (Ratchathewi)",method:"Free Boat + BTS",time:"40–45 min",cost:"~35–44 THB",steps:["Take the free shuttle boat from Asiatique back to Sathorn Pier (last boat ~23:30)","BTS Saphan Taksin (S6) → Siam (CEN), transfer to Sukhumvit Line","Ride 1 stop north to Ratchathewi (N1)"]},

    // DAY 2 (col 2)
    "4-2":{from:"Airbnb (Ratchathewi)",to:"Grand Palace + Wat Pho",method:"Grab / Taxi",time:"20–40 min",cost:"~80–150 THB",steps:["Grab directly to Grand Palace — go early before 8 AM to beat traffic","Alternative: BTS to Saphan Taksin → Chao Phraya Express Boat to Tha Chang Pier (N9) → 5 min walk to entrance"]},
    "7-2":{from:"Grand Palace + Wat Pho",to:"Lunch spot nearby",method:"Walk",time:"5–10 min",cost:"Free",steps:["Many restaurants along Maharaj Road near the Grand Palace","Tha Tien area has great local food stalls and riverside restaurants"]},
    "9-2":{from:"Grand Palace area",to:"Wat Arun",method:"Cross-river Ferry",time:"10–15 min",cost:"8 THB",steps:["Walk from Grand Palace south to Tha Tien Pier (~10 min, passing Wat Pho)","Take the cross-river ferry directly to Wat Arun pier (5 min, 8 THB)","Ferries depart every 10–15 min, 06:00–21:00"]},
    "11-2":{from:"Wat Arun",to:"Airbnb (Ratchathewi)",method:"Grab / Taxi",time:"25–40 min",cost:"~100–150 THB",steps:["Book a Grab from Wat Arun directly to Ratchathewi","Alternative: Cross-river ferry back → Chao Phraya Boat to Sathorn Pier → BTS to Ratchathewi (~60 min)"]},
    "13-2":{from:"Airbnb (Ratchathewi)",to:"Pratunam Area (Platinum / CentralWorld)",method:"Walk",time:"10–15 min",cost:"Free",steps:["Walk south/southeast from Ratchathewi BTS station","Platinum Fashion Mall is ~10 min via the skywalk system","CentralWorld is a further 10 min south, or 1 BTS stop to Chit Lom (E1)"]},
    "17-2":{from:"Pratunam Area",to:"Airbnb (Ratchathewi)",method:"Walk",time:"10–15 min",cost:"Free",steps:["Walk back north to Ratchathewi BTS via the skywalk or street level","Pratunam is in the same neighborhood as your Airbnb"]},

    // DAY 3 (col 3)
    "3-3":{from:"Airbnb (Ratchathewi)",to:"Ancient City (Muang Boran)",method:"BTS + Grab",time:"~1.5 hours",cost:"~145–165 THB",steps:["BTS Ratchathewi (N1) → Siam (CEN) → Sukhumvit Line all the way to Kheha (E24) terminus (~50 min)","From Kheha station, take a Grab/taxi to Ancient City entrance (~15 min, ~80–100 THB)","Tip: Get a Rabbit Card for convenient BTS tap-and-go"]},
    "7-3":{from:"Ancient City",to:"Lunch spot",method:"Inside Ancient City",time:"N/A",cost:"Included",steps:["Several food stalls and restaurants inside Ancient City grounds","Main food court near the central area of the park"]},
    "9-3":{from:"Lunch",to:"Ancient City (cont.)",method:"Continue exploring",time:"N/A",cost:"N/A",steps:["Continue exploring the park after lunch","Rent a bike (~50 THB) to cover more ground — the park is huge (80 hectares)"]},
    "12-3":{from:"Ancient City",to:"Airbnb (Ratchathewi)",method:"Grab + BTS",time:"~1.5 hours",cost:"~145–165 THB",steps:["Grab/taxi from Ancient City back to Kheha BTS (E24)","BTS Kheha → Siam → Ratchathewi (N1)"]},
    "14-3":{from:"Airbnb (Ratchathewi)",to:"Akara Sky Hanuman",method:"BTS",time:"10–15 min",cost:"~17–25 THB",steps:["BTS Ratchathewi (N1) → Siam (CEN) → 2 stops east to Phloen Chit (E2)","Exit and walk via skywalk into One City Centre building (548 Ploenchit Rd)","Take elevator to 61st floor — opens at 16:30, reservations recommended"]},

    // DAY 4 (col 4)
    "3-4":{from:"Airbnb (Ratchathewi)",to:"Chatuchak Weekend Market",method:"BTS",time:"~15 min",cost:"~30–35 THB",steps:["BTS Ratchathewi (N1) northbound to Mo Chit (N8) — 7 stops, ~13 min","Exit Mo Chit (Exit 1), walk 5 min to market","Pro tip: MRT Kamphaeng Phet Exit 2 drops you right inside the market"]},
    "8-4":{from:"Chatuchak",to:"Bang Sue Junction + Ace Jolun",method:"BTS",time:"~10 min",cost:"~17–25 THB",steps:["BTS Mo Chit (N8) → 3 stops south to Ari (N5)","Ace Jolun is near Phaholyothin Soi 2, short walk from Ari BTS"]},
    "10-4":{from:"Ari area",to:"ICONSIAM",method:"BTS + Gold Line",time:"40–50 min",cost:"~44–50 THB",steps:["BTS Ari (N5) → Siam (CEN), transfer to Silom Line","Ride to Krung Thon Buri (S7), transfer to Gold Line monorail","Gold Line to Charoen Nakhon — ICONSIAM connected via covered walkway","Alternative: BTS to Saphan Taksin → free ICONSIAM shuttle boat (every 15 min)"]},
    "12-4":{from:"ICONSIAM",to:"Khao San Road",method:"Grab / Taxi",time:"15–25 min",cost:"~60–100 THB",steps:["Book a Grab from ICONSIAM to Khao San Road (~5 km)","No practical public transit for this route — Grab is fastest"]},
    "16-4":{from:"Khao San Road",to:"Airbnb (Ratchathewi)",method:"Grab / Taxi",time:"15–25 min",cost:"~60–80 THB",steps:["Book a Grab or hail a metered taxi from Khao San Road","No direct rail connection to Khao San — taxi/Grab is best, especially at night"]},

    // DAY 5 (col 5)
    "3-5":{from:"Airbnb (Ratchathewi)",to:"Khlong Lat Mayom Floating Market",method:"BTS + Grab",time:"45–60 min",cost:"~120–200 THB",steps:["Option A: BTS Ratchathewi → Siam → Silom Line to Bang Wa (S12) terminus, then taxi (~15 min, 75–100 THB)","Option B: Direct Grab from Ratchathewi (~30–45 min, ~200 THB)","Tip: Free shuttle bus from MRT Bang Khun Non Exit 3 on weekends (every 20–30 min, 09:00–16:30)"]},
    "6-5":{from:"Khlong Lat Mayom",to:"Early Lunch",method:"Inside market",time:"N/A",cost:"N/A",steps:["Amazing food stalls inside the floating market","Try the boat noodles and grilled seafood — eat at the canal-side tables"]},
    "7-5":{from:"Khlong Lat Mayom / Airbnb",to:"Free Time Activities",method:"Varies",time:"Varies",cost:"Varies",steps:["To Seacon Bangkae: Grab from market (~15–20 min, ~80–120 THB)","To return to Airbnb: Grab or taxi + BTS Bang Wa to Ratchathewi (~120–145 THB)","Seacon Bangkae is near MRT Phasi Charoen (BL36) for return via Blue Line"]},

    // DAY 6 (col 6)
    "3-6":{from:"Airbnb (Ratchathewi)",to:"Suvarnabhumi Airport",method:"BTS + ARL",time:"45–50 min",cost:"~62 THB",steps:["BTS Ratchathewi (N1) → 1 stop north to Phaya Thai (N2)","Transfer to Airport Rail Link at Phaya Thai station","ARL City Line to Suvarnabhumi Airport (26 min, 45 THB)","Tip: Allow 2+ hours before flight. If before 6 AM, take Grab instead (~250–350 THB)"]}
  },
  // Restaurant & cafe suggestions keyed same as directions: "row-col"
  foodGuide:{
    // DAY 1 — Prep/Brekkie at Ratchathewi (row 3 col 1)
    "3-1":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, modern interior, great espresso",price:"$$"},
      {name:"Mono Cafe",desc:"Scrambled eggs over rice with bacon, 100% Arabica coffee",price:"$"},
      {name:"Caturday Cat Cafe",desc:"Cozy cat cafe near Ratchathewi BTS, good drinks",price:"$$"},
      {name:"Piccolo Vicolo",desc:"Hidden alley cafe with greenery, quiet vibes, great lattes",price:"$$"}
    ],restaurants:[
      {name:"On Lok Yun",desc:"Legendary 1933 breakfast spot — toast, soft-boiled eggs, Thai iced coffee",price:"$"},
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand, famous Hainanese chicken rice (10 min walk)",price:"$"}
    ]},
    // DAY 1 — Lunch in Chinatown (row 6 col 1)
    "6-1":{area:"Chinatown (Yaowarat)",restaurants:[
      {name:"Lim Lao Ngow",desc:"Michelin Bib Gourmand — Kuay Jab rolled rice noodles in peppery pork broth",price:"$"},
      {name:"Jek Pui Curry Rice",desc:"70+ year old Michelin Bib Gourmand curry rice — pre-made curries in giant pots",price:"$"},
      {name:"Nai Ek Roll Noodle",desc:"Famous since the 1960s, hand-rolled noodles in rich broth",price:"$"},
      {name:"T&K Seafood",desc:"Iconic green-shirt staff, giant grilled prawns, tom yum, oyster omelette",price:"$$"}
    ]},
    // DAY 1 — Asiatique Dinner (row 14 col 1)
    "14-1":{area:"Asiatique The Riverfront",restaurants:[
      {name:"Sirimahannop",desc:"Dining on a stunning ship replica — steaks, seafood, Thai fusion",price:"$$$"},
      {name:"Wine I Love You",desc:"Live music, open-air riverside seating, 3-course set menu",price:"$$$"},
      {name:"Happy Fish",desc:"Riverside European/Thai/seafood with great river views",price:"$$"},
      {name:"Peppery Thai Bistro",desc:"Elevated authentic Thai cuisine, beautiful plating",price:"$$"}
    ]},
    // DAY 2 — Brekkie at Ratchathewi (row 3 col 2)
    "3-2":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, modern interior, great espresso",price:"$$"},
      {name:"Mono Cafe",desc:"Scrambled eggs over rice with bacon, 100% Arabica coffee",price:"$"},
      {name:"Piccolo Vicolo",desc:"Hidden alley cafe with greenery, quiet vibes, great lattes",price:"$$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand Hainanese chicken rice",price:"$"},
      {name:"On Lok Yun",desc:"Legendary 1933 breakfast — toast, soft-boiled eggs, Thai iced coffee",price:"$"}
    ]},
    // DAY 2 — Lunch near Grand Palace (row 7 col 2)
    "7-2":{area:"Grand Palace / Tha Tien",restaurants:[
      {name:"Supanniga Eating Room (Tha Tien)",desc:"Thai cuisine with Wat Arun views — must-try Isaan dishes",price:"$$"},
      {name:"Ama Art & Eatery",desc:"Opposite Wat Pho — great Pad Thai and basil rice",price:"$"},
      {name:"Err Urban Rustic Thai",desc:"Michelin Plate — retro shophouse, drinking snacks and Thai tapas",price:"$$"},
      {name:"Krua Apsorn",desc:"Famous crab omelette, beloved by locals for decades",price:"$$"}
    ]},
    // DAY 2 — Pratunam Dinner (row 13 col 2)
    "13-2":{area:"Pratunam / CentralWorld",restaurants:[
      {name:"Uno Mas (54th Floor, Centara Grand)",desc:"Upmarket Spanish — tapas, lobster, oysters with stunning skyline views",price:"$$$"},
      {name:"Red Sky Bar (Centara Grand)",desc:"Rooftop bar with 360° views — grilled meats, cocktails, free-flow drinks",price:"$$$"},
      {name:"CentralWorld Food Court",desc:"Massive variety of Thai and international street food",price:"$"},
      {name:"Platinum Fashion Mall Food Court",desc:"Cheap and cheerful local food, authentic Thai dishes",price:"$"},
      {name:"Kaiton Pratunam Chicken Rice",desc:"Legendary late-night chicken rice, green pants staff, right in Pratunam",price:"$"}
    ]},
    // DAY 3 — Brekkie at Ratchathewi (row 2 col 3)
    "2-3":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, modern interior",price:"$$"},
      {name:"Mono Cafe",desc:"Scrambled eggs, bacon, Arabica coffee",price:"$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand, opens early",price:"$"}
    ]},
    // DAY 3 — Lunch at Ancient City (row 7 col 3)
    "7-3":{area:"Ancient City (Muang Boran)",restaurants:[
      {name:"Ancient City Food Court",desc:"Central food court inside the park — pad thai, som tam, curries",price:"$"},
      {name:"Canal-side Food Stalls",desc:"Scattered around the park — boat noodles, grilled meats, Thai sweets",price:"$"},
      {name:"Floating Market Zone",desc:"Recreated floating market area inside the park with local dishes",price:"$"}
    ]},
    // DAY 3 — Akara Sky Hanuman Dinner (row 14 col 3)
    "14-3":{area:"Akara Sky Hanuman (61F, One City Centre)",restaurants:[
      {name:"Akara Sky Hanuman Dome Restaurant",desc:"Refined Thai seafood — grilled lobster, Lobster Tom Yum Mama, green curry",price:"$$$"},
      {name:"Hanuman Rooftop Garden Bar",desc:"360° city views, signature cocktails like 'Amazing Thailand' and 'Songkran' (~620 THB each)",price:"$$$"}
    ],note:"Reservations recommended. Opens 16:30. Nightly cultural shows with Muay Thai and Thai dance at ~20:00. Sky-mirrored observation deck on 61F."},
    // DAY 4 — Brekkie heading to Chatuchak (row 3 col 4)
    "3-4":{area:"Ratchathewi → Chatuchak",cafes:[
      {name:"CASA LAPIN (Ratchathewi)",desc:"Quick specialty coffee before heading out",price:"$$"},
      {name:"Nana Coffee Roasters (Ari)",desc:"Award-winning roaster near Chatuchak — famous timber ring croissants",price:"$$"},
      {name:"Glig Cafe (Ari)",desc:"Seoul-inspired minimalist cafe, great pour-over",price:"$$"},
      {name:"Landhaus Bakery (Ari)",desc:"Authentic Austrian-Bavarian bakery, fresh bread and pastries",price:"$$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Quick Michelin Bib Gourmand breakfast before BTS",price:"$"},
      {name:"Bar Storia (Ari)",desc:"All-day brunch in a photogenic European-vintage setting",price:"$$"}
    ]},
    // DAY 4 — Lunch at Chatuchak (row 7 col 4)
    "7-4":{area:"Chatuchak Weekend Market",restaurants:[
      {name:"Coco JJ Coconut Ice Cream",desc:"THE iconic Chatuchak treat — coconut ice cream in a husk with toppings (~50 THB)",price:"$"},
      {name:"Big Shrimp Pad Thai",desc:"Always packed — massive shrimp pad thai cooked fresh",price:"$"},
      {name:"King Octopus",desc:"Giant whole octopus grilled and sliced on the spot",price:"$"},
      {name:"Moo Yang (Honey Roast Pork) stalls",desc:"Sweet-savory grilled pork skewers, multiple vendors",price:"$"},
      {name:"Khanom Krok stalls",desc:"Crispy coconut pancakes cooked in round molds — a classic",price:"$"}
    ]},
    // DAY 4 — Khao San Road Dinner (row 12 col 4)
    "12-4":{area:"Khao San Road",restaurants:[
      {name:"Khao San Sek",desc:"Michelin Guide 2025 — build-your-own Thai menu in a beautiful townhouse",price:"$$$"},
      {name:"Pad Thai Thip Samai",desc:"'The best pad thai in Bangkok' — queue is worth it, wrapped-in-egg version is a must",price:"$"},
      {name:"Raan Jay Fai",desc:"Michelin-starred street food legend — famous crab omelette and drunken noodles (reserve ahead!)",price:"$$$"},
      {name:"Praya Dining at Praya Palazzo",desc:"Michelin Guide Italian in a stunning riverside villa near Khao San",price:"$$$"}
    ]},
    // DAY 5 — Brekkie at Ratchathewi (row 2 col 5)
    "2-5":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, reliable every morning",price:"$$"},
      {name:"Piccolo Vicolo",desc:"Green alley cafe, peaceful morning spot",price:"$$"}
    ],restaurants:[
      {name:"On Lok Yun",desc:"Classic Thai breakfast — toast, eggs, coffee",price:"$"},
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand, opens early",price:"$"}
    ]},
    // DAY 5 — Early Lunch / Floating Market (row 6 col 5)
    "6-5":{area:"Khlong Lat Mayom Floating Market",restaurants:[
      {name:"Pla Pao (Salt-Crusted Grilled Fish)",desc:"THE must-try — whole snakehead fish grilled in salt crust with spicy sauce",price:"$"},
      {name:"Hoi Tod (Crispy Oyster Omelette)",desc:"Classic Thai canal-side dish, fried crispy with mussels",price:"$"},
      {name:"Boat Noodle stalls",desc:"Rich pork or beef broth noodles served canal-side (~30 THB/bowl)",price:"$"},
      {name:"Kanom Jeen stalls",desc:"Cold rice vermicelli with curry — green curry or fish curry versions",price:"$"},
      {name:"Foy Thong (Golden Threads)",desc:"Delicate Thai dessert — sweet egg yolk threads, unique to floating markets",price:"$"}
    ]},
    // DAY 5 — Free Time food (row 7 col 5)
    "7-5":{area:"Seacon Bangkae / Return to Hotel",restaurants:[
      {name:"Seacon Bangkae Food Court",desc:"Big mall food court with Thai, Japanese, Korean options",price:"$"},
      {name:"MK Suki (Seacon Bangkae)",desc:"Popular Thai hot pot chain — great for groups",price:"$$"},
      {name:"After You Dessert Cafe",desc:"Famous Thai dessert chain — Shibuya Honey Toast is a must",price:"$$"}
    ]},
    // DAY 6 — Last Breakfast (row 2 col 6)
    "2-6":{area:"Ratchathewi (Last Breakfast)",cafes:[
      {name:"CASA LAPIN",desc:"One last specialty coffee before the flight",price:"$$"},
      {name:"Mono Cafe",desc:"Hearty scrambled eggs and bacon for the road",price:"$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Final Michelin Bib Gourmand chicken rice — a perfect goodbye",price:"$"},
      {name:"On Lok Yun",desc:"Classic 1933 Thai breakfast — end the trip where it all began",price:"$"}
    ]}
  },
  // personalExpenses: { [personId]: [{id, desc, amount, currency, category, date, note}] }
  personalExpenses: {},
  expenses: [
    {id:"exp_preset_1",description:"Flight Booking (Roundtrip)",amount:44985.55,currency:"PHP",paidBy:"eduard",splitAmong:["eduard","kerr","justin","anwell","august"],splitType:"equal",customSplits:null,date:"2026-01-15",category:"transport",status:"paid",comments:""},
    {id:"exp_preset_2",description:"Airbnb",amount:26685.61,currency:"PHP",paidBy:"kerr",splitAmong:["eduard","kerr","justin","anwell","august"],splitType:"custom",customSplits:{eduard:5487.12,kerr:5187.12,justin:5487.12,anwell:5487.12,august:5487.12},date:"2026-01-20",category:"accommodation",status:"paid",comments:""}
  ],
  // payments keyed by "personId:expenseId" → { paid:true, date, note }
  payments: {}
};

let data;
const STORAGE_KEY = "bkk2026_v2";

function loadData() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) { try { data = JSON.parse(saved); if (!data.payments || Array.isArray(data.payments)) data.payments = {}; if (!data.personalExpenses || Array.isArray(data.personalExpenses)) data.personalExpenses = {}; return; } catch(e) {} }
  data = JSON.parse(JSON.stringify(DEFAULT_DATA));
  saveData();
}
function saveDataLocal() { data.meta.lastUpdated = new Date().toISOString(); localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
function saveData() {
  saveDataLocal();
  if (autoSyncEnabled && !isSyncing) {
    clearTimeout(saveData._pushTimer);
    saveData._pushTimer = setTimeout(async () => {
      try {
        await gsWrite(data);
        lastSyncTime = new Date().toLocaleTimeString();
        updateSyncStatusUI();
      } catch(e) { /* silent — no webapp or not connected yet */ }
    }, 1500);
  }
}
function showToast(msg, isError) { const t=document.getElementById("toast"); t.textContent=msg; t.className="toast show"+(isError?" error":""); setTimeout(()=>t.className="toast",2800); }
function formatMoney(n,curr) { return (curr||"PHP")+" "+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }
function convertToPhp(amount,currency) { return currency==="PHP"?amount:amount*data.meta.exchangeRate; }
function getNameShort(id) { const t=data.travelers.find(t=>t.id===id); return t?t.firstName.split(" ")[0]:id; }
function getInitials(id) { const t=data.travelers.find(t=>t.id===id); if(!t)return"?"; return ((t.firstName?.[0]||"")+(t.lastName?.[0]||"")).toUpperCase()||id[0].toUpperCase(); }

// Tabs
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById("tab-"+tab.dataset.tab).classList.add("active");
  });
});

// Countdown
function updateCountdown() {
  const dep=new Date("2026-03-24T23:45:00+08:00"),now=new Date(),diff=dep-now,el=document.getElementById("countdown");
  if(diff<=0){el.innerHTML='<span style="color:var(--amber);font-weight:700;font-size:0.9rem;">\u{1F389} Trip time!</span>';return;}
  const d=Math.floor(diff/864e5),h=Math.floor(diff%864e5/36e5),m=Math.floor(diff%36e5/6e4),s=Math.floor(diff%6e4/1e3);
  el.innerHTML=[{n:d,l:"Days"},{n:h,l:"Hrs"},{n:m,l:"Min"},{n:s,l:"Sec"}].map(u=>`<div class="cd-box"><div class="cd-num">${String(u.n).padStart(2,"0")}</div><div class="cd-label">${u.l}</div></div>`).join("");
}

// Itinerary
function renderItinerary() {
  const icons={sleep:"\u{1F634}",travel:"\u{1F695}",activity:"\u{2B50}",eating:"\u{1F374}",free:"\u{1F3B2}",prep:"\u{1F9F3}",empty:""};
  const dirs=data.directions||{};
  const food=data.foodGuide||{};
  const hdr=`<thead><tr><th></th>${data.itinerary.map(d=>`<th>${d.label}<div class="day-date">${new Date(d.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}</div></th>`).join("")}</tr></thead>`;
  const rows=data.itinGrid.map((row,ri)=>{
    const time=row[0];
    let cells="";
    for(let i=1;i<=6;i++){
      const c=row[i];
      if(c===null) continue;
      const [act,type,span]=c;
      const icon=act?(icons[type]||""):"";
      const label=act?`${icon?icon+" ":""}${act}`:"";
      const key=ri+"-"+i;
      const isClickable=!!dirs[key]||!!food[key];
      cells+=`<td${span>1?' rowspan="'+span+'"':''}><div class="slot ${type}${isClickable?' clickable':''}"${isClickable?' onclick="showSlotInfo('+ri+','+i+')"':''}>${label}</div></td>`;
    }
    return `<tr><td class="itin-time">${time}</td>${cells}</tr>`;
  }).join("");
  document.getElementById("itineraryGrid").innerHTML=hdr+"<tbody>"+rows+"</tbody>";
}

// ── MOBILE ITINERARY TIMELINE ───────────────────────────────
let mobileActiveDayIdx = 0;
function renderItineraryMobile() {
  const selEl = document.getElementById("itinDaySelector");
  const tlEl  = document.getElementById("itinTimeline");
  if(!selEl || !tlEl) return;
  const icons={sleep:"😴",travel:"🚌",activity:"⭐",eating:"🍴",free:"🎲",prep:"🧳",empty:""};
  const dirs  = data.directions||{};
  const food  = data.foodGuide||{};
  const days  = data.itinerary||[];

  // Day selector buttons
  selEl.innerHTML = days.map((d,i)=>{
    const shortDate = new Date(d.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"});
    return `<button class="itin-day-btn${i===mobileActiveDayIdx?" active":""}" onclick="switchMobileDay(${i})">${d.label}<span style="display:block;font-size:0.6rem;opacity:0.7;margin-top:1px">${shortDate}</span></button>`;
  }).join("");

  renderMobileTimeline(mobileActiveDayIdx);
}

function switchMobileDay(idx) {
  mobileActiveDayIdx = idx;
  document.querySelectorAll(".itin-day-btn").forEach((b,i)=>b.classList.toggle("active",i===idx));
  renderMobileTimeline(idx);
}

function renderMobileTimeline(dayIdx) {
  const tlEl = document.getElementById("itinTimeline");
  if(!tlEl) return;
  const icons={sleep:"😴",travel:"🚌",activity:"⭐",eating:"🍴",free:"🎲",prep:"🧳",empty:""};
  const dirs  = data.directions||{};
  const food  = data.foodGuide||{};
  const col   = dayIdx+1; // column 1-6

  // Build flat list of slots for this day (skip null = rowspan continuation)
  const slots = [];
  data.itinGrid.forEach((row,ri)=>{
    const time = row[0];
    const cell = row[col];
    if(cell === null) return; // rowspan continuation, skip
    const [act,type] = cell;
    if(!act) return; // empty slot
    const key = ri+"-"+col;
    const isClickable = !!dirs[key]||!!food[key];
    slots.push({time, act, type, key, isClickable, ri});
  });

  tlEl.innerHTML = slots.map(s=>{
    const icon = icons[s.type]||"";
    return `<div class="itin-tl-row" data-type="${s.type}">
      <div class="itin-tl-time-col">
        <div class="itin-tl-time">${s.time}</div>
        <div class="itin-tl-line"></div>
      </div>
      <div class="itin-tl-dot"></div>
      <div class="itin-tl-card${s.isClickable?" clickable":""}${s.type==="sleep"?" sleep-card":""}" data-type="${s.type}"${s.isClickable?` onclick="showSlotInfo(${s.ri},${col})"`:""}>
        ${icon?`<span class="itin-tl-icon">${icon}</span>`:""}
        <span class="itin-tl-label">${s.act}</span>
        ${s.isClickable?`<span class="itin-tl-tap">tap ›</span>`:""}
      </div>
    </div>`;
  }).join("");
}

function showSlotInfo(row,col){
  const key=row+"-"+col;
  const d=(data.directions||{})[key];
  const f=(data.foodGuide||{})[key];
  if(!d&&!f)return;
  let html="";
  // Directions section
  if(d){
    html+=`
    <div class="dir-header">
      <div style="font-size:0.65rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-dim);margin-bottom:10px;font-weight:600">\u{1F9ED} Getting There</div>
      <div class="dir-route">
        <span class="dir-loc">${d.from}</span>
        <span class="dir-arrow">\u2192</span>
        <span class="dir-loc">${d.to}</span>
      </div>
      <div class="dir-badges">
        <span class="dir-badge method">\u{1F68C} ${d.method}</span>
        <span class="dir-badge time">\u{1F552} ${d.time}</span>
        <span class="dir-badge cost">\u{1F4B0} ${d.cost}</span>
      </div>
    </div>
    <div class="dir-steps">
      <ol>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ol>
    </div>`;
  }
  // Food guide section
  if(f){
    const pc=p=>p==="$"?"p1":p==="$$"?"p2":"p3";
    const renderCards=arr=>(arr||[]).map(r=>`<div class="food-card"><div><div class="food-name">${r.name}</div><div class="food-desc">${r.desc}</div></div><span class="food-price ${pc(r.price)}">${r.price}</span></div>`).join("");
    html+=`<div style="padding:${d?'0':'24px'} 0 0"><div style="padding:${d?'0':'0'} 24px 4px;font-size:0.65rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-dim);font-weight:600">\u{1F37D}\u{FE0F} Where to Eat — ${f.area}</div></div>`;
    if(f.cafes&&f.cafes.length){
      html+=`<div class="food-section"><div class="food-section-title">\u2615 Coffee & Cafes</div>${renderCards(f.cafes)}</div>`;
    }
    if(f.restaurants&&f.restaurants.length){
      html+=`<div class="food-section"><div class="food-section-title">\u{1F374} Restaurants & Street Food</div>${renderCards(f.restaurants)}</div>`;
    }
    if(f.note){
      html+=`<div style="padding:0 24px 20px"><div class="food-note">\u{1F4A1} ${f.note}</div></div>`;
    }
  }
  document.getElementById("dirContent").innerHTML=html;
  document.getElementById("directionsModal").classList.add("show");
}
function closeDirections(){
  document.getElementById("directionsModal").classList.remove("show");
}

// ==================== MUST-TRY ====================
const mustTryData = [
  {
    id:"ratchathewi", emoji:"🏠", name:"Ratchathewi / Pratunam", day:"Home Base", dayClass:"home",
    tags:["Food","Cafes","Shopping","Local"],
    desc:"Your Airbnb neighborhood — a surprisingly great local area with legendary chicken rice, cozy cafes, and easy access to Pratunam's massive fashion malls.",
    sections:[
      {title:"☕ Must-Try Cafes", items:[
        {name:"CASA LAPIN", desc:"Specialty coffee temple — excellent espresso, minimalist interiors", price:"$$"},
        {name:"Mono Cafe", desc:"Scrambled eggs over rice + bacon + 100% Arabica coffee — perfect morning combo", price:"$"},
        {name:"Piccolo Vicolo", desc:"Hidden alley cafe, lush greenery, great lattes — worth hunting down", price:"$$"},
        {name:"Caturday Cat Cafe", desc:"Cozy cat cafe near BTS Ratchathewi — unique experience with great drinks", price:"$$"}
      ]},
      {title:"🍴 Must-Eat Restaurants", items:[
        {name:"Go-Ang Pratunam Chicken Rice", desc:"Michelin Bib Gourmand — legendary Hainanese chicken rice, lines form early, cash only", price:"$"},
        {name:"On Lok Yun", desc:"Since 1933 — toast, soft-boiled eggs & Thai iced coffee. Bangkok's most classic breakfast", price:"$"},
        {name:"Kaiton Pratunam Chicken Rice", desc:"Late-night chicken rice legend — unmistakable green-pants staff, open past midnight", price:"$"},
        {name:"Platinum Fashion Mall Food Court", desc:"Dirt-cheap authentic Thai dishes inside the mall — local favorites, cash only", price:"$"}
      ]},
      {title:"🛍️ Shopping", items:[
        {name:"Platinum Fashion Mall", desc:"5-floor fashion wholesale hub — clothes, accessories, everything cheap. 10 min walk from Airbnb", price:"$"},
        {name:"Pratunam Market", desc:"Street-level clothing stalls, bags, and accessories — great for bargaining", price:"$"},
        {name:"CentralWorld", desc:"Massive upscale mall 1 BTS stop away — international brands, food halls, cinema", price:"$$"},
        {name:"Big C Supercenter", desc:"Thai supermarket gold — cheap snacks, Thai chips, seasonings to bring home", price:"$"}
      ]},
      {title:"📍 Instagrammable Spots", items:[
        {name:"Piccolo Vicolo Alley", desc:"Green-draped hidden alley cafe — very photogenic entrance", price:"free"},
        {name:"CentralWorld Plaza", desc:"Giant open-air plaza — great city shots especially at night", price:"free"},
        {name:"Ratchathewi BTS Skywalk", desc:"Glass-covered skywalk connecting to Pratunam — clean lines and city views", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Pratunam Opening Hours", desc:"Platinum Mall: 8AM–8PM. CentralWorld: 10AM–10PM. Street stalls: all day", price:"tip"},
        {name:"BTS Access", desc:"Ratchathewi (N1) is your home station. 1 stop to Siam (CEN), 1 stop to Phaya Thai (ARL)", price:"tip"}
      ]}
    ],
    note:"Your Airbnb is walking distance from some of Bangkok's best value eats and most accessible shopping. Don't overlook this neighborhood!"
  },
  {
    id:"chinatown", emoji:"🏮", name:"Chinatown (Yaowarat)", day:"Day 1", dayClass:"day1",
    tags:["Michelin","Street Food","Night Market","Temple"],
    desc:"Bangkok's most vibrant neighbourhood — neon-lit Yaowarat Road buzzing with street food vendors, Michelin-starred hawker stalls, century-old shophouses, and the energy of a place that never sleeps.",
    sections:[
      {title:"🍜 Michelin & Must-Eat", items:[
        {name:"Lim Lao Ngow", desc:"Michelin Bib Gourmand — Kuay Jab rolled rice noodles in a peppery pork broth, open since 1966", price:"$"},
        {name:"Jek Pui Curry Rice", desc:"70+ yr old Michelin Bib Gourmand — pre-made curries ladled over rice from giant pots", price:"$"},
        {name:"Nai Ek Roll Noodle", desc:"Famous hand-rolled noodles since the 1960s, rich pork broth", price:"$"},
        {name:"T&K Seafood", desc:"Iconic green-shirt staff — giant grilled prawns, tom yum, oyster omelette, always packed", price:"$$"},
        {name:"Guay Jub Ouan Pochana", desc:"Another legendary bowl of rolled noodles — fan favorite for late nights", price:"$"},
        {name:"Pad Thai Fai Ta Lu", desc:"Wok-charred pad thai from a tiny open kitchen — massive queues, worth it", price:"$"}
      ]},
      {title:"🧋 Trending Drinks & Desserts", items:[
        {name:"Milk & Honey Boba", desc:"Hugely popular Thai-style milk tea and boba stalls along Yaowarat Road", price:"$"},
        {name:"Mango Sticky Rice stalls", desc:"Classic Thai dessert available all along Yaowarat — Mamuang Khao Niaow", price:"$"},
        {name:"Durian desserts", desc:"Durian pancakes, durian ice cream, and whole durian — it's wild", price:"$"}
      ]},
      {title:"🛕 Activities & Sights", items:[
        {name:"Wat Mangkon Kamalawat", desc:"Bangkok's largest and most important Chinese temple — ornate interiors, incense, fortune sticks", price:"free"},
        {name:"Sampeng Lane (Soi Wanit 1)", desc:"200-year-old market alleyway — wholesale goods, spices, fabrics, novelties. Extremely fun to browse", price:"free"},
        {name:"Khlong Ong Ang Walkway", desc:"Fairy-light canopy walkway along the canal — magical at night, great for photos", price:"free"},
        {name:"Chinatown Gate", desc:"Iconic red gate at the end of Yaowarat — the classic Chinatown photo backdrop", price:"free"},
        {name:"Talat Noi neighbourhood", desc:"Adjacent area with colonial shophouses and street art — easily walkable from Chinatown", price:"free"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Yaowarat Road at Night", desc:"The neon-lit main strip at night — one of Bangkok's most photogenic scenes", price:"free"},
        {name:"Chinatown Gate Arch", desc:"The big red gate — classic backdrop for Chinatown portraits", price:"free"},
        {name:"Khlong Ong Ang Lights", desc:"Fairy light canopy over the canal walkway — dreamy evening photos", price:"free"},
        {name:"Old Shophouse Facades", desc:"Peeling paint, lanterns, vintage signs — endless street photography opportunities", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Best Time to Go", desc:"Evenings (after 6PM) when street food vendors set up and the neon signs glow", price:"tip"},
        {name:"Getting There", desc:"MRT Blue Line to Wat Mangkon (Chinatown station) — opens 2022, exits right into the action", price:"tip"},
        {name:"Cash Only", desc:"Almost all street food stalls are cash only. Bring small bills (20s and 50s)", price:"tip"}
      ]}
    ],
    note:"Go hungry. Yaowarat Road is one of Asia's greatest street food destinations. Best experienced on foot — just follow your nose."
  },
  {
    id:"songwat", emoji:"🎨", name:"Song Wat + Talat Noi", day:"Day 1", dayClass:"day1",
    tags:["Street Art","Cafes","Hidden Gem","History"],
    desc:"Bangkok's coolest hidden quarter — a network of 200-year-old lanes packed with creative cafes, murals, vintage warehouses turned art spaces, and river views. Completely walkable from Chinatown.",
    sections:[
      {title:"☕ Cafes & Bars", items:[
        {name:"Coffee Room Yaowarat", desc:"Specialty coffee in a beautifully restored shophouse — one of Bangkok's finest", price:"$$"},
        {name:"Local Boys Coffee", desc:"Hip minimalist roastery, excellent pour-overs, very Instagrammable", price:"$$"},
        {name:"e-ga Bangkok", desc:"Quirky art-cafe hybrid — mismatched vintage furniture, specialty drinks, gallery vibes", price:"$$"},
        {name:"RISE Bar", desc:"Rooftop bar with stunning river views and Wat Arun silhouette — perfect at sunset", price:"$$$"},
        {name:"The Old Town Knives & Cleavers Building Cafe", desc:"Atmospheric heritage warehouse cafe — thick walls, cool air, great coffee", price:"$$"}
      ]},
      {title:"🎭 Activities & Sights", items:[
        {name:"Street Art Walk", desc:"Massive murals cover the walls of Talat Noi — free open-air gallery, new pieces added regularly", price:"free"},
        {name:"'I Wanna Bangkok' Sign", desc:"The most famous street art installation in the area — iconic photo spot", price:"free"},
        {name:"Talat Noi Community Walk", desc:"Explore the narrow sois on foot — heritage shophouses, Chinese shrines, river glimpses", price:"free"},
        {name:"Wat Khaek (Sri Maha Mariamman)", desc:"Colorful Hindu temple in the area — extraordinary decorative facade", price:"free"},
        {name:"The Peninsula Pier area", desc:"Walk down to the river edge for stunning views back toward the city", price:"free"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Song Wat Road Murals", desc:"Giant wall murals every few meters along Song Wat Road — endless content", price:"free"},
        {name:"'I Wanna Bangkok' Sign", desc:"THE shot of this neighborhood — do it early before crowds", price:"free"},
        {name:"RISE Rooftop", desc:"Sunset shots with Wat Arun and the Chao Phraya river from rooftop level", price:"$$$"},
        {name:"Talat Noi Lanes", desc:"The narrow sois themselves are photogenic — colonial textures and local life", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Midday timing", desc:"Visit in the mid-afternoon when the light is good for street photography and cafes are quieter", price:"tip"},
        {name:"Walking route", desc:"Start from Chinatown Gate → Song Wat Road → Talat Noi lanes → river viewpoint. 1-2 hours total", price:"tip"}
      ]}
    ],
    note:"Most tourists skip this area — it's one of Bangkok's true hidden gems. Combine with Chinatown for a full Day 1 experience."
  },
  {
    id:"grandpalace", emoji:"👑", name:"Grand Palace + Wat Pho", day:"Day 2", dayClass:"day2",
    tags:["UNESCO","Temple","Massage","Iconic"],
    desc:"Bangkok's most visited landmark — a dazzling complex of golden spires, emerald Buddhas, and ornate Thai architecture. Wat Pho next door houses the world-famous Reclining Buddha and the birthplace of Thai massage.",
    sections:[
      {title:"🏛️ Must-See Sights", items:[
        {name:"Temple of the Emerald Buddha (Wat Phra Kaew)", desc:"Thailand's most sacred temple — the Emerald Buddha inside is only 66cm tall but of immense spiritual significance", price:"free"},
        {name:"Grand Palace Complex", desc:"400-year-old royal complex — stunning Chakri Maha Prasat Hall, ornate Thai architecture throughout", price:"$$"},
        {name:"Reclining Buddha at Wat Pho", desc:"46m long, 15m tall golden reclining Buddha — extraordinarily detailed mother-of-pearl feet soles", price:"$"},
        {name:"Phra Mondop (Library)", desc:"Exquisite gilded library building decorated with ceramic tiles — one of Bangkok's most beautiful structures", price:"free"}
      ]},
      {title:"💆 Experiences", items:[
        {name:"Wat Pho Traditional Thai Massage", desc:"Learn from where Thai massage was founded — 1-hour sessions available (300–450 THB). Book on-site", price:"$"},
        {name:"Guided Temple Walk", desc:"Official guide services at the Grand Palace entrance — highly recommended for context and history", price:"$"},
        {name:"Amulet Market (Tha Maharaj)", desc:"Fascinating market of Buddhist amulets and talismans just outside the complex — free to browse", price:"free"}
      ]},
      {title:"🍴 Where to Eat Nearby", items:[
        {name:"Supanniga Eating Room (Tha Tien)", desc:"Refined Thai cuisine with a rooftop view of Wat Arun across the river — standout Isaan dishes", price:"$$"},
        {name:"Err Urban Rustic Thai", desc:"Michelin Plate — retro shophouse, drinking snacks and Thai sharing plates", price:"$$"},
        {name:"Krua Apsorn", desc:"Famous crab omelette beloved by locals and royalty for decades — queues are normal", price:"$$"},
        {name:"Tha Tien street food stalls", desc:"Simple noodles, pad thai, mango sticky rice right outside the temple gates", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Grand Palace Main Gate", desc:"The iconic white-and-gold entrance — classic Bangkok shot", price:"$$"},
        {name:"Wat Phra Kaew Yaksha Giants", desc:"The massive guardian demon statues at the entrance — striking portraits", price:"$$"},
        {name:"Reclining Buddha feet detail", desc:"The intricate mother-of-pearl inlay on the Buddha's feet — extraordinary macro photography", price:"$"},
        {name:"Tha Tien riverside", desc:"Looking across the river to Wat Arun — one of Bangkok's most iconic views", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Dress Code STRICTLY enforced", desc:"Shoulders and knees must be covered. Sarongs available for rent at the entrance (refundable deposit)", price:"tip"},
        {name:"Go Early", desc:"Open 8:30AM. Arrive before 9AM to beat tour groups — it gets very crowded and very hot by midday", price:"tip"},
        {name:"Entry Fee", desc:"Grand Palace + Wat Phra Kaew: 500 THB (foreigners). Wat Pho: 200 THB — buy separately", price:"tip"},
        {name:"Tuk-tuk scam", desc:"Ignore any tuk-tuk drivers near the entrance saying 'it's closed today' — it's always open", price:"tip"}
      ]}
    ],
    note:"Budget 3–4 hours minimum. The detail on every surface is extraordinary — slow down and look carefully at the mosaics, statues, and murals."
  },
  {
    id:"watarun", emoji:"🌅", name:"Wat Arun (Temple of Dawn)", day:"Day 2", dayClass:"day2",
    tags:["Temple","Sunset","River","Iconic"],
    desc:"One of Thailand's most recognized landmarks — the 79m porcelain-covered prang (tower) of Wat Arun rises dramatically from the west bank of the Chao Phraya, especially spectacular at sunrise and sunset.",
    sections:[
      {title:"🏛️ Must-See", items:[
        {name:"The Central Prang (Tower)", desc:"79 meters of porcelain-encrusted Buddhist tower — climb the steep steps for panoramic river views", price:"$"},
        {name:"Chao Phraya River View", desc:"Standing at Wat Arun looking east at the Bangkok skyline — one of the city's great views", price:"$"},
        {name:"Temple Grounds at Sunset", desc:"The prang turns gold in the late afternoon light — photographers dream shot", price:"$"},
        {name:"Ceramic Detail Work", desc:"Thousands of Chinese porcelain fragments embedded into the tower surface — extraordinary up close", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Looking across from Tha Tien Pier", desc:"Classic Wat Arun full-view shot from the eastern bank — best at golden hour", price:"free"},
        {name:"From inside Wat Arun", desc:"City skyline views looking east from the prang steps", price:"$"},
        {name:"The ferry crossing", desc:"Short 5-min river crossing gives great water-level shots of the prang rising from the river", price:"$"},
        {name:"Prang base up close", desc:"Extreme close-up of the porcelain mosaic work — abstract and stunning", price:"$"}
      ]},
      {title:"🚤 Getting There", items:[
        {name:"Cross-river Ferry", desc:"From Tha Tien Pier (next to Wat Pho) — 5 min crossing, boats every 10–15 min, 6AM–9PM", price:"$"},
        {name:"Entry Fee", desc:"100 THB for foreigners. Dress code enforced — sarongs available at entrance", price:"$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Best Time", desc:"Late afternoon (4–5 PM) for golden light on the prang. Or sunrise for dramatic misty photos with few crowds", price:"tip"},
        {name:"Combine with Grand Palace", desc:"Cross the river from Tha Tien after visiting Grand Palace and Wat Pho — they're all in the same area", price:"tip"}
      ]}
    ],
    note:"The view of Wat Arun from across the river (at sunset!) is arguably Bangkok's single most beautiful sight. Don't miss it."
  },
  {
    id:"ancientcity", emoji:"🏯", name:"Ancient City (Muang Boran)", day:"Day 3", dayClass:"day3",
    tags:["Culture","Outdoor","History","Full Day"],
    desc:"A sprawling 80-hectare open-air museum in Samut Prakan — 116 full-scale replicas of Thailand's most important temples and monuments, set in a map-shaped park. One of Thailand's greatest hidden treasures.",
    sections:[
      {title:"🗺️ Must-See Structures", items:[
        {name:"Sanphet Prasat Palace", desc:"Exact replica of the original Ayutthaya palace — gold spires and teak interiors", price:"$$"},
        {name:"Prasat Hin Phimai", desc:"Replica of the famous Khmer temple in Nakhon Ratchasima — stunning Angkor-era architecture", price:"$$"},
        {name:"Ancient Town of Sukhothai", desc:"Life-size replica of Sukhothai's ancient core — wandering through feels like actual history", price:"$$"},
        {name:"Erawan Museum (nearby)", desc:"Giant three-headed elephant museum nearby — incredible art collection inside", price:"$$"},
        {name:"Floating Market Zone", desc:"A recreated floating market inside the park with local vendors and canal boats", price:"$"}
      ]},
      {title:"🚴 Activities", items:[
        {name:"Rent a Bicycle", desc:"Bicycle rental inside the park (~50 THB) — essential for covering the 80 hectare grounds", price:"$"},
        {name:"Golf Cart Rental", desc:"Electric golf carts available for rent — great for groups or if it's too hot to cycle", price:"$$"},
        {name:"Guided Segway Tour", desc:"Segway tours of the park available — fun way to cover ground quickly", price:"$$"},
        {name:"Cultural Performances", desc:"Live performances of traditional Thai dance and drama on weekends", price:"free"}
      ]},
      {title:"🍴 Food Inside the Park", items:[
        {name:"Central Food Court", desc:"Main food court near the park entrance — pad thai, som tam, curries, and drinks", price:"$"},
        {name:"Canal-side Stalls", desc:"Scattered food stalls throughout the park — boat noodles, grilled meats, Thai sweets", price:"$"},
        {name:"Floating Market Food", desc:"Vendor boats serving local dishes along the canals inside the replica floating market zone", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Sanphet Prasat Reflection Pool", desc:"The palace reflected in the surrounding moat — stunning symmetry for photos", price:"$$"},
        {name:"Khmer Temple Silhouette", desc:"The Prasat Hin Phimai replica photographed against the sky looks remarkably like the real thing", price:"$$"},
        {name:"Ancient Town Street", desc:"Walking through the replica ancient town feels like a film set — endless photography", price:"$$"},
        {name:"Early Morning Mist", desc:"Arrive right at opening (9AM) for atmospheric mist over the structures", price:"$$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Entry Fee", desc:"700 THB (adult foreigners). Discounted to 350 THB after 4PM — great if doing a half-day afternoon visit", price:"tip"},
        {name:"How to Get There", desc:"BTS to Kheha (E24 terminus) then Grab to the entrance (~15 min, 80–100 THB). Total ~1.5hrs from Ratchathewi", price:"tip"},
        {name:"Time Required", desc:"Allow a full day (6+ hours) to see everything properly. It's genuinely huge", price:"tip"},
        {name:"What to Bring", desc:"Sunscreen, water, and comfortable walking shoes. It's very exposed — hat essential", price:"tip"}
      ]}
    ],
    note:"Massively underrated and often skipped by tourists. This is genuinely one of the best cultural experiences in all of Southeast Asia."
  },
  {
    id:"chatuchak", emoji:"🛍️", name:"Chatuchak Weekend Market", day:"Day 4", dayClass:"day4",
    tags:["Market","Shopping","Food","Massive"],
    desc:"One of the world's largest weekend markets — 15,000+ stalls across 27 zones covering everything from vintage clothing and antiques to live animals, street food, and local design. Pure organized chaos.",
    sections:[
      {title:"🍜 Must-Try Food", items:[
        {name:"Coco JJ Coconut Ice Cream", desc:"THE iconic Chatuchak experience — coconut ice cream served in a coconut husk with toppings (~50 THB). Queue is worth it", price:"$"},
        {name:"King Octopus", desc:"Whole octopus grilled and sliced on the spot — spectacular spectacle and delicious", price:"$"},
        {name:"Big Shrimp Pad Thai", desc:"Massive shrimp pad thai wok-fried fresh — always packed with good reason", price:"$"},
        {name:"Moo Yang (Honey Roast Pork)", desc:"Sweet-savory grilled pork skewers, multiple vendors throughout the market", price:"$"},
        {name:"Khanom Krok", desc:"Crispy coconut-cream pancakes cooked in round cast-iron molds — sweet/savory versions", price:"$"},
        {name:"Thai Iced Tea stalls", desc:"Bright orange cha yen — everywhere, perfect for the heat", price:"$"}
      ]},
      {title:"🛍️ Shopping Highlights", items:[
        {name:"Zones 2–6 (Clothing)", desc:"Vintage, streetwear, indie labels, custom pieces — best clothing zone in any market in Asia", price:"$"},
        {name:"Zone 7 (Art & Crafts)", desc:"Local artists selling original prints, ceramics, jewellery, and handmade goods", price:"$"},
        {name:"Zone 13 (Antiques)", desc:"Vintage Thai goods, Buddha statues, old coins, colonial-era items", price:"$$"},
        {name:"Zone 26 (Books)", desc:"Secondhand books, vintage magazines, old maps — treasure-hunting paradise", price:"$"},
        {name:"JJ Mall (indoor)", desc:"Air-conditioned indoor extension of Chatuchak — fashion, accessories, cafes. Great heat escape", price:"$"}
      ]},
      {title:"☕ Cafes", items:[
        {name:"Nana Coffee Roasters", desc:"Award-winning roastery just outside Chatuchak — famous for their timber ring croissants and exceptional pour-over", price:"$$"},
        {name:"Glig Cafe (Ari)", desc:"Seoul-inspired minimalist cafe a few stops south — great for a post-market coffee", price:"$$"},
        {name:"Chatuchak Park Stalls", desc:"Multiple iced coffee and fresh fruit juice stalls throughout the market", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Coconut Ice Cream Shot", desc:"Coco JJ — the coconut shell + colorful toppings + holding it = perfect market food shot", price:"$"},
        {name:"King Octopus in action", desc:"Video the whole octopus being sliced — dramatic and viral-worthy", price:"$"},
        {name:"Chatuchak Market Clock Tower", desc:"The central clock tower is the landmark navigation point — great orientation shot", price:"free"},
        {name:"Vintage clothing stalls", desc:"Racks upon racks of colorful vintage — styled shots in the clothing zone", price:"$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Opening Hours", desc:"Saturday–Sunday only, 9AM–6PM. Gets extremely crowded 11AM–2PM — go early or late", price:"tip"},
        {name:"Cash Only", desc:"Vast majority of vendors are cash only. Plenty of ATMs on site", price:"tip"},
        {name:"Navigation", desc:"Get the free Chatuchak map at the entrance. Section signs are color-coded. Food is near the clock tower", price:"tip"},
        {name:"Getting There", desc:"BTS Mo Chit (N8, Exit 1) or MRT Kamphaeng Phet (Exit 2) — MRT drops you right inside the market", price:"tip"}
      ]}
    ],
    note:"Wear light clothing, bring cash, and go early before it gets unbearably hot. Budget 3–5 hours minimum. The market is genuinely enormous."
  },
  {
    id:"bangsuejolun", emoji:"🎪", name:"Bang Sue / Ari + Ace Jolun", day:"Day 4", dayClass:"day4",
    tags:["Street Art","Cool Kids","Cafes","Local Scene"],
    desc:"Bangkok's trendiest local neighborhoods — Ari is the city's most coveted residential district lined with indie cafes, artisan bakeries and boutiques. Ace Jolun is a creative compound with street art, food vendors and design shops.",
    sections:[
      {title:"☕ Cafes & Bakeries", items:[
        {name:"Nana Coffee Roasters", desc:"Award-winning roastery — their timber ring croissants are legendary, specialty pour-over coffee", price:"$$"},
        {name:"Glig Cafe", desc:"Seoul-inspired minimalist cafe — great pour-over, very photogenic interior", price:"$$"},
        {name:"Yellow Lane", desc:"Converted shophouse cafe famous for Japanese-style sandos (sandwiches) and good coffee", price:"$$"},
        {name:"Landhaus Bakery", desc:"Authentic Austrian-Bavarian bakery — fresh-baked sourdough, pretzels, and pastries", price:"$$"},
        {name:"Bar Storia", desc:"All-day brunch in a European-vintage setting — stunning decor, great food photos", price:"$$"}
      ]},
      {title:"🎨 Activities", items:[
        {name:"Ace Jolun Creative Compound", desc:"Bangkok's hippest creative hub — street art compound with pop-up food stalls, design shops, weekend market", price:"free"},
        {name:"Pearl Art Space", desc:"Contemporary art gallery in Ari — rotating exhibitions, free to browse", price:"free"},
        {name:"Or Tor Kor Market", desc:"Premium fresh market right next to Chatuchak — high-quality fruits, ready-to-eat Thai food, famous for durian", price:"$"},
        {name:"Ari Walking Street", desc:"Phaholyothin Soi 7 area — great street-level exploration with local shops and cafes", price:"free"}
      ]},
      {title:"🍴 Restaurants", items:[
        {name:"Or Tor Kor Market Food Stalls", desc:"Premium prepared foods — northern Thai dishes, fresh seafood, tropical fruits", price:"$"},
        {name:"Soul Food Mahanakorn", desc:"Beloved Thai comfort food restaurant in Ari — craft cocktails, excellent local dishes", price:"$$"},
        {name:"Ace Jolun Food Vendors", desc:"Rotating food vendors inside the compound — typically great quality street food", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Ace Jolun Street Art", desc:"Entire compound covered in murals — Bangkok street art at its best", price:"free"},
        {name:"Nana Coffee Roasters Timber Ring Croissant", desc:"The most photogenic pastry in Bangkok — get it before noon (sells out)", price:"$$"},
        {name:"Yellow Lane Sando", desc:"Japanese-style egg sando or katsu sando — beloved food photography subject", price:"$$"},
        {name:"Ari's cafe exteriors", desc:"The whole street is lined with photogenic converted shophouses", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Getting to Ari", desc:"BTS Ari (N5) — exit right into the neighborhood. Everything is walkable from the station", price:"tip"},
        {name:"Ace Jolun Location", desc:"Near Phaholyothin Soi 2 (a short Grab from Ari BTS). Weekend events are especially lively", price:"tip"},
        {name:"Or Tor Kor", desc:"Right next to Chatuchak MRT/BTS stations — easy to combine in one visit", price:"tip"}
      ]}
    ],
    note:"Perfect for the late afternoon after Chatuchak. The Ari neighborhood gives a real glimpse of how cool Bangkok locals actually live."
  },
  {
    id:"iconsiam", emoji:"🏙️", name:"ICONSIAM", day:"Day 4", dayClass:"day4",
    tags:["Mall","Luxury","River","Must-See"],
    desc:"Bangkok's most spectacular shopping mall — a 525,000 sqm riverside megadevelopment that feels more like a theme park. Home to SookSiam (indoor floating market), river water shows, and spectacular skyline views.",
    sections:[
      {title:"🌟 Must-Do Experiences", items:[
        {name:"SookSiam Indoor Floating Market", desc:"Full-size traditional Thai floating market recreated indoors on the ground floor — regional food and crafts from all 77 provinces. Completely unique", price:"free"},
        {name:"Chao Phraya River Waterfront", desc:"The outdoor riverside promenade — stunning views back at Bangkok skyline, especially at sunset", price:"free"},
        {name:"Light and Water Show", desc:"Free nightly water and light show on the river — check times at the venue", price:"free"},
        {name:"Glass Bridge", desc:"The iconic glass-floored bridge over the ground-floor water feature — great for photos", price:"free"}
      ]},
      {title:"🛍️ Shopping", items:[
        {name:"ICONLUXE", desc:"Separate luxury wing — Hermes, Chanel, LV, Dior, Cartier, and more. Just window shopping is fun", price:"$$$"},
        {name:"Thai Design Brands Zone", desc:"Dedicated section for Thai-designed fashion, accessories, and homewares — unique souvenirs", price:"$$"},
        {name:"Takashimaya (ICONSIAM)", desc:"Japanese department store concept — great for quality products and food hall", price:"$$"},
        {name:"Free Tourist Card", desc:"Get the ICONSIAM Tourist Privilege Card at the info desk — free discounts at many shops and restaurants", price:"free"}
      ]},
      {title:"🍴 Restaurants", items:[
        {name:"Baan Khanitha", desc:"Legendary upscale Thai cuisine — refined royal Thai dishes in an elegant setting", price:"$$$"},
        {name:"Fallabella Riverfront", desc:"European riverside dining with excellent views of the Chao Phraya", price:"$$$"},
        {name:"SookSiam Food Stalls", desc:"Authentic regional Thai food from every province — excellent value, eat like a local", price:"$"},
        {name:"ICONSIAM Food Hall", desc:"Curated food hall on the upper floors — Thai and international, better quality than average mall food", price:"$$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"SookSiam Gondola Boats", desc:"Actual wooden gondola boats floating inside the mall — unreal photo opportunity", price:"free"},
        {name:"Chao Phraya at Sunset", desc:"The riverside promenade at golden hour — Bangkok skyline reflected in the water", price:"free"},
        {name:"Glass Bridge Over Water", desc:"Standing on the glass floor bridge looking down at the water below", price:"free"},
        {name:"ICONSIAM exterior at night", desc:"The illuminated facade reflected in the river — spectacular wide-angle photography", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"How to Get There", desc:"BTS to Saphan Taksin (S6), then take the free ICONSIAM shuttle boat (every 15 min, 16:00–23:30). Or BTS Gold Line to Charoen Nakhon", price:"tip"},
        {name:"Tourist Card", desc:"Get the free tourist privilege card at the information desk on arrival — saves money at shops and restaurants", price:"tip"},
        {name:"Opening Hours", desc:"10AM–10PM daily. Restaurants often open until midnight", price:"tip"}
      ]}
    ],
    note:"Don't just treat this as a shopping mall — SookSiam alone is worth the trip. The riverside views at sunset are among Bangkok's best."
  },
  {
    id:"khaosan", emoji:"🍻", name:"Khao San Road", day:"Day 4", dayClass:"day4",
    tags:["Nightlife","Street Food","Backpacker","Michelin"],
    desc:"Bangkok's most famous backpacker strip — a chaotic, neon-lit carnival of street food, bars, clothing stalls, and international travelers. Touristy? Yes. Worth experiencing? Absolutely.",
    sections:[
      {title:"🍴 Michelin & Must-Eat", items:[
        {name:"Pad Thai Thip Samai", desc:"'The best Pad Thai in Bangkok' — wrapped in egg, ultra-thin noodles, 15 min walk away. Queue up", price:"$"},
        {name:"Khao San Sek", desc:"Michelin Guide 2025 — build-your-own Thai set menu in a beautiful townhouse. Make a reservation", price:"$$$"},
        {name:"Raan Jay Fai", desc:"Michelin-starred street food legend — famous crab omelette and drunken noodles. Reserve WEEKS ahead or queue from 2PM", price:"$$$"},
        {name:"Praya Dining", desc:"Michelin Guide-listed Italian in a stunning colonial riverside villa near Khao San — elegant contrast", price:"$$$"}
      ]},
      {title:"🍹 Nightlife & Bars", items:[
        {name:"Brick Bar", desc:"Legendary Khao San live music bar — Thai bands playing rock covers, great atmosphere", price:"$$"},
        {name:"The Club (Khao San)", desc:"Bangkok's most iconic backpacker club — cheap buckets, packed dance floor, 2AM closing", price:"$$"},
        {name:"Roof Bar Khao San", desc:"Rooftop bar above the street level — elevated views of the Khao San chaos below", price:"$$"},
        {name:"Soi Rambuttri", desc:"The slightly calmer, cooler parallel street — better bars, more mature crowd, still very fun", price:"$$"}
      ]},
      {title:"🛍️ Street Shopping", items:[
        {name:"Custom stamp souvenirs", desc:"Thai name stamps carved on the spot — a classic backpacker souvenir", price:"$"},
        {name:"Harem pants and tie-dye", desc:"The quintessential Southeast Asia backpacker market clothing", price:"$"},
        {name:"Thai boxing shorts", desc:"Genuine Muay Thai shorts for ~200 THB — actually high quality", price:"$"}
      ]},
      {title:"🛕 Sights Nearby", items:[
        {name:"Wat Chana Songkhram", desc:"Peaceful temple directly opposite the chaos of Khao San — beautiful contrast", price:"free"},
        {name:"Sanam Luang (Royal Field)", desc:"Large open ceremonial ground near the Grand Palace — 10 min walk", price:"free"},
        {name:"Soi Rambuttri Area", desc:"The whole area around Rambuttri is full of atmospheric little cafes and guesthouses", price:"free"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Thip Samai Pad Thai", desc:"The famous egg-wrapped pad thai is a great food photo subject — shoot before eating", price:"$"},
        {name:"Khao San Road at Night", desc:"The whole strip lit up at night — chaotic, colorful, cinematic", price:"free"},
        {name:"Thai Boxing Shorts Market", desc:"Rows of Muay Thai shorts hanging in the market stalls — colorful and very Thai", price:"$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Thip Samai Queue", desc:"Pad Thai Thip Samai opens at 5PM — arrive early or expect a 30-45 min queue. Worth it", price:"tip"},
        {name:"Raan Jay Fai", desc:"Close to Khao San, closes when ingredients run out — try to go for early dinner, not late night", price:"tip"},
        {name:"Stay safe", desc:"Ignore tuk-tuk offers near Khao San, keep bags in front, normal urban common sense applies", price:"tip"}
      ]}
    ],
    note:"Even if you hate tourist traps — at least one night on Khao San Road is a Bangkok rite of passage. Lean into the chaos."
  },
  {
    id:"asiatique", emoji:"🎡", name:"Asiatique The Riverfront", day:"Day 1", dayClass:"day1",
    tags:["Nightlife","Shows","River","Shopping"],
    desc:"Bangkok's most popular riverside night bazaar — a sprawling warehouse district transformed into an open-air shopping, dining, and entertainment complex. Free ferry from Sathorn Pier, free Ferris wheel views, nightly shows.",
    sections:[
      {title:"🎭 Must-Do Shows", items:[
        {name:"Calypso Cabaret (Ladyboy Show)", desc:"World-famous Thai cabaret show — elaborate costumes, lip-sync performances, fantastic entertainment. Shows at 19:30 and 21:00", price:"$$"},
        {name:"Muay Thai Live Show", desc:"Professional Muay Thai boxing show at the dedicated arena — Tue–Sun, multiple times nightly", price:"$$"},
        {name:"Siam Niramit Bangkok", desc:"Grand-scale cultural performance — 150 performers, 500 costumes, spectacular stage effects", price:"$$$"}
      ]},
      {title:"🎡 Attractions", items:[
        {name:"60m Observation Ferris Wheel", desc:"Ride the giant Ferris wheel for panoramic views over the Chao Phraya — a signature Asiatique experience", price:"$"},
        {name:"Sirimahannop Ship", desc:"Full-size replica of a vintage ship permanently moored — houses restaurants and is extraordinarily photogenic at night", price:"free"},
        {name:"1,500+ Shopping Stalls", desc:"Clothing, accessories, Thai crafts, souvenirs — wandering the warehouse corridors is entertaining itself", price:"free"}
      ]},
      {title:"🍴 Restaurants", items:[
        {name:"Sirimahannop Restaurant", desc:"Dining aboard the ship replica — steaks, seafood, Thai fusion, stunning ambiance", price:"$$$"},
        {name:"Wine I Love You", desc:"Live music, open-air riverside seating, 3-course set menu with wine pairings", price:"$$$"},
        {name:"Happy Fish", desc:"European and Thai seafood with excellent river views", price:"$$"},
        {name:"Peppery Thai Bistro", desc:"Elevated authentic Thai cuisine with beautiful plating", price:"$$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Sirimahannop at Night", desc:"The illuminated ship replica against the dark river — one of the most dramatic shots in Bangkok", price:"free"},
        {name:"Ferris Wheel at Night", desc:"The glowing Ferris wheel reflected in the river — spectacular wide shots", price:"$"},
        {name:"Riverside Promenade", desc:"Walking the riverside with the Bangkok skyline across the water", price:"free"},
        {name:"Warehouse corridors", desc:"The lit-up night market corridors with shopfronts — very atmospheric and photogenic", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Getting There", desc:"BTS to Saphan Taksin (S6) → free Asiatique shuttle boat from Sathorn Pier (runs 16:00–23:30, every 30 min)", price:"tip"},
        {name:"Opening Hours", desc:"Opens 17:00, most active 18:00–23:00. Last shuttle boat back ~23:30", price:"tip"},
        {name:"Calypso Tickets", desc:"Book Calypso Cabaret tickets online in advance — shows sell out on weekends", price:"tip"},
        {name:"Dinner Timing", desc:"Eat dinner at Asiatique before the 19:30 show — everything is walkable within the complex", price:"tip"}
      ]}
    ],
    note:"Best visited in the evening — everything comes alive after dark. Make it a dinner + show night for the full experience."
  },
  {
    id:"khlonglatmayom", emoji:"⛵", name:"Khlong Lat Mayom Floating Market", day:"Day 5", dayClass:"day5",
    tags:["Floating Market","Local","Canal Food","Weekend Only"],
    desc:"Bangkok's most beloved traditional floating market — a genuine local experience far from the tourist trail. Wooden boats loaded with food line the Khlong Lat Mayom canal, weekends only.",
    sections:[
      {title:"🍽️ Must-Try Canal Food", items:[
        {name:"Pla Pao (Salt-Crusted Grilled Fish)", desc:"THE signature dish — whole snakehead fish encrusted in salt and grilled over charcoal, served with spicy dipping sauce. Unmissable", price:"$"},
        {name:"Hoi Tod (Crispy Oyster Omelette)", desc:"Pan-fried oysters in a crispy egg batter — a canal-side classic", price:"$"},
        {name:"Boat Noodles", desc:"Rich pork or beef broth noodles served from canal-side boats — ~30 THB per bowl, must eat 3+", price:"$"},
        {name:"Kanom Jeen (Rice Vermicelli + Curry)", desc:"Cold rice noodles served with green or fish curry — quintessentially Thai, unique to markets like this", price:"$"},
        {name:"Foy Thong (Golden Threads)", desc:"Delicate Thai dessert of sweet egg yolk threads spun into golden wisps — very traditional, very special", price:"$"},
        {name:"Mango Sticky Rice", desc:"Classic khao niaow ma muang — glutinous rice with fresh mango and coconut cream from floating vendors", price:"$"}
      ]},
      {title:"🚣 Market Experience", items:[
        {name:"Walk the Canal Boardwalk", desc:"The entire market lines the canal edges — walk the full length and back to see everything before choosing", price:"free"},
        {name:"Boat Vendor Interaction", desc:"Vendors paddle wooden boats right to the bank — wave them over, point, pay cash", price:"free"},
        {name:"Paddleboat Rental", desc:"Rent a small paddleboat to explore the canal from the water — unique perspective", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Salt-Crusted Fish on the Grill", desc:"The whole fish crusted in white salt on a charcoal grill — dramatic food photography", price:"$"},
        {name:"Wooden Boats on the Canal", desc:"Overloaded wooden vendor boats on the canal — quintessential Thai floating market shot", price:"free"},
        {name:"Golden Threads Dessert", desc:"Foy Thong — the intricate golden egg threads are visually extraordinary and unique", price:"$"},
        {name:"Canal Reflections", desc:"Early morning when the market opens, the canal is mirror-calm — perfect reflection shots", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Weekends Only", desc:"Saturday and Sunday only, 8AM–5PM. Opens early — go before 11AM to beat the crowds", price:"tip"},
        {name:"Getting There", desc:"Option A: BTS Bang Wa (S12 terminus) then taxi. Option B: Free shuttle from MRT Bang Khun Non (Exit 3) weekends only. Option C: Direct Grab (~200 THB)", price:"tip"},
        {name:"Cash Only", desc:"Bring small Thai baht bills. No card or phone pay accepted at most stalls", price:"tip"},
        {name:"Mosquito Repellent", desc:"It's a canal market — bring repellent especially for morning visits", price:"tip"}
      ]}
    ],
    note:"This is the real deal. Khlong Lat Mayom is what floating markets used to be before tourist dollars changed them. Go early, eat everything."
  },
  {
    id:"pratunam", emoji:"🏬", name:"Pratunam / CentralWorld Area", day:"Day 2", dayClass:"day2",
    tags:["Shopping","Malls","Rooftop","Sky Bars"],
    desc:"Bangkok's commercial core — from Platinum Fashion Mall's floor-to-ceiling cheap fashion to CentralWorld's 8 floors of international brands, capped with rooftop bars and sky-high restaurants at dizzying views.",
    sections:[
      {title:"🛍️ Shopping", items:[
        {name:"Platinum Fashion Mall", desc:"5-floor wholesale fashion paradise — clothes from 100 THB, accessories, bags. Hugely popular with Thais and Asian tourists", price:"$"},
        {name:"CentralWorld", desc:"One of Southeast Asia's largest malls — 500+ stores, Isetan, Uniqlo, Nike, cinemas, and an enormous food hall", price:"$$"},
        {name:"Big C Extra Pratunam", desc:"Huge Thai supermarket — souvenir snacks, instant noodles, sauces, all the things to bring home", price:"$"},
        {name:"Amari Watergate Shopping", desc:"Designer boutiques and beauty brands in an upscale hotel setting", price:"$$$"},
        {name:"Pratunam Street Market", desc:"Street-level market stalls for clothing, bags, and accessories — great bargaining spot", price:"$"}
      ]},
      {title:"☁️ Rooftop Bars & Sky Dining", items:[
        {name:"Red Sky Bar (Centara Grand)", desc:"55th floor 360° rooftop bar — stunning Bangkok skyline views, craft cocktails, grilled meats", price:"$$$"},
        {name:"Uno Mas (Centara Grand, 54F)", desc:"Spanish tapas and seafood at 54th floor with spectacular skyline panorama", price:"$$$"},
        {name:"Zenith Rooftop Bar (Hotel Indigo)", desc:"Rooftop pool bar with views over CentralWorld and Lumpini Park", price:"$$$"},
        {name:"Above Eleven", desc:"Tropic-themed rooftop bar + Nikkei restaurant, great cocktails", price:"$$$"}
      ]},
      {title:"🍴 Must-Eat", items:[
        {name:"Kaiton Pratunam Chicken Rice", desc:"The most famous late-night chicken rice in Bangkok — green-pants staff, open till 2AM, right in Pratunam", price:"$"},
        {name:"Go-Ang Pratunam Chicken Rice", desc:"Michelin Bib Gourmand — arguably better, opens morning. Queue from 7AM", price:"$"},
        {name:"CentralWorld Food Hall", desc:"Massive variety of quality Thai and international dishes — sit-down level above the food court", price:"$$"},
        {name:"Platinum Food Court", desc:"Dirt cheap authentic Thai — pad krapao, boat noodles, mango sticky rice", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Red Sky Bar Rooftop", desc:"Bangkok skyline photography from 55 floors up — golden hour and night shots are extraordinary", price:"$$$"},
        {name:"CentralWorld Main Atrium", desc:"The enormous glass atrium — architectural photography and crowd shots", price:"free"},
        {name:"Platinum Mall exterior", desc:"The dense Pratunam market area at ground level — very Bangkok urban energy", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"From Ratchathewi", desc:"Walk 10–15 min south to Pratunam, or 1 BTS stop to Chit Lom (E1) for CentralWorld/Erawan", price:"tip"},
        {name:"Rooftop Dress Code", desc:"Smart casual required for Red Sky and sky bars. No flip-flops or shorts", price:"tip"},
        {name:"Platinum Hours", desc:"8AM–8PM. Gets very crowded on weekends — weekday mornings are best for browsing", price:"tip"}
      ]}
    ],
    note:"Your Airbnb is walking distance from Pratunam — a massive advantage. Take advantage and pop in anytime for snacks or last-minute shopping."
  }
];

function renderMustTry() {
  const grid = document.getElementById("mustTryGrid");
  if (!grid) return;
  const dayOrder = {"Day 1":0,"Day 2":1,"Day 3":2,"Day 4":3,"Day 5":4,"Home Base":5};
  const sorted = [...mustTryData].sort((a,b)=>(dayOrder[a.day]??9)-(dayOrder[b.day]??9));
  grid.className = "musttry-grid";
  grid.innerHTML = sorted.map(area=>`
    <div class="musttry-card ${area.dayClass}" onclick="showMustArea('${area.id}')">
      <div class="musttry-card-emoji">${area.emoji}</div>
      <div class="musttry-card-name">${area.name}</div>
      <div class="musttry-card-day">${area.day}</div>
      <div class="musttry-card-tags">${area.tags.map(t=>`<span class="musttry-tag">${t}</span>`).join("")}</div>
    </div>`).join("");
}

function showMustArea(id) {
  const area = mustTryData.find(a => a.id === id);
  if (!area) return;
  const pc = p => p==="$"?"p1":p==="$$"?"p2":p==="$$$"?"p3":p==="free"?"pfree":"tip";
  const renderItems = items => items.map(item => `
    <div class="mustarea-item">
      <div class="mustarea-item-left">
        <div class="mustarea-item-name">${item.name}</div>
        <div class="mustarea-item-desc">${item.desc}</div>
      </div>
      <span class="mustarea-badge ${pc(item.price)}">${item.price==="free"?"Free":item.price==="tip"?"Tip":item.price}</span>
    </div>
  `).join("");
  const sectionsHtml = area.sections.map(s => `
    <div class="mustarea-section">
      <div class="mustarea-section-title">${s.title}</div>
      ${renderItems(s.items)}
    </div>
  `).join("");
  const html = `
    <div class="mustarea-hero">
      <div class="mustarea-hero-top">
        <div class="mustarea-emoji">${area.emoji}</div>
        <div><div class="mustarea-title">${area.name}</div><div class="mustarea-day">${area.day}</div></div>
      </div>
      <div class="mustarea-desc">${area.desc}</div>
    </div>
    <div class="mustarea-body">
      ${sectionsHtml}
      ${area.note?`<div class="mustarea-note">💡 ${area.note}</div>`:""}
    </div>
  `;
  document.getElementById("mustAreaContent").innerHTML = html;
  document.getElementById("mustAreaModal").classList.add("show");
}

function closeMustArea() {
  document.getElementById("mustAreaModal").classList.remove("show");
}

// Expense form
let splitType="equal";
function renderExpenseForm(){
  document.getElementById("expPaidBy").innerHTML=data.travelers.map(t=>`<option value="${t.id}">${getNameShort(t.id)}</option>`).join("");
  document.getElementById("splitCheckboxes").innerHTML=data.travelers.map(t=>`<label class="checkbox-label"><input type="checkbox" value="${t.id}" checked onchange="updateCustomSplitInputs()"><span class="check-dot"></span>${getNameShort(t.id)}</label>`).join("");
  document.getElementById("expDate").value=new Date().toISOString().slice(0,10);
  updateCustomSplitInputs();
}
document.querySelectorAll(".split-type-btn").forEach(btn=>{btn.addEventListener("click",()=>{document.querySelectorAll(".split-type-btn").forEach(b=>b.classList.remove("active"));btn.classList.add("active");splitType=btn.dataset.split;document.getElementById("customSplits").style.display=splitType==="custom"?"flex":"none";updateCustomSplitInputs();});});
function getCheckedPeople(){return[...document.querySelectorAll("#splitCheckboxes input:checked")].map(c=>c.value);}
function updateCustomSplitInputs(){const p=getCheckedPeople(),c=document.getElementById("customSplits");if(splitType!=="custom"){c.innerHTML="";return;}c.innerHTML=p.map(id=>`<div class="custom-split-input"><label>${getNameShort(id)}</label><input type="number" step="0.01" min="0" id="csplit_${id}" placeholder="0.00"></div>`).join("");}

function saveExpense(){
  const desc=document.getElementById("expDesc").value.trim(),amount=parseFloat(document.getElementById("expAmount").value),currency=document.getElementById("expCurrency").value,paidBy=document.getElementById("expPaidBy").value,category=document.getElementById("expCategory").value,date=document.getElementById("expDate").value,people=getCheckedPeople();
  if(!desc){showToast("Enter a description",true);return;} if(!amount||amount<=0){showToast("Enter a valid amount",true);return;} if(people.length<1){showToast("Select at least 1 person",true);return;}
  let customSplits=null;
  if(splitType==="custom"){customSplits={};let total=0;for(const id of people){const v=parseFloat(document.getElementById("csplit_"+id)?.value||0);customSplits[id]=v;total+=v;}if(Math.abs(total-amount)>0.02){showToast(`Custom splits (${total.toFixed(2)}) must equal total (${amount.toFixed(2)})`,true);return;}}
  const editId=document.getElementById("editExpenseId").value;
  if(editId){const exp=data.expenses.find(e=>e.id===editId);Object.assign(exp,{description:desc,amount,currency,paidBy,splitAmong:people,splitType,customSplits,date,category});}
  else{data.expenses.push({id:"exp_"+Date.now(),description:desc,amount,currency,paidBy,splitAmong:people,splitType,customSplits,date,category,status:"pending",comments:""});}
  saveData();clearExpenseForm();renderExpenses();showToast(editId?"Expense updated!":"Expense added!");
}
function clearExpenseForm(){document.getElementById("expDesc").value="";document.getElementById("expAmount").value="";document.getElementById("editExpenseId").value="";document.getElementById("formTitle").innerHTML="\u271A Add Expense";document.getElementById("cancelEditBtn").style.display="none";document.querySelectorAll("#splitCheckboxes input").forEach(c=>c.checked=true);splitType="equal";document.querySelectorAll(".split-type-btn").forEach(b=>b.classList.toggle("active",b.dataset.split==="equal"));document.getElementById("customSplits").style.display="none";updateCustomSplitInputs();}
function cancelEdit(){clearExpenseForm();}
function editExpense(id){const exp=data.expenses.find(e=>e.id===id);if(!exp)return;document.getElementById("editExpenseId").value=id;document.getElementById("formTitle").innerHTML="\u270E Edit Expense";document.getElementById("cancelEditBtn").style.display="";document.getElementById("expDesc").value=exp.description;document.getElementById("expAmount").value=exp.amount;document.getElementById("expCurrency").value=exp.currency;document.getElementById("expPaidBy").value=exp.paidBy;document.getElementById("expCategory").value=exp.category;document.getElementById("expDate").value=exp.date;document.querySelectorAll("#splitCheckboxes input").forEach(c=>{c.checked=exp.splitAmong.includes(c.value);});splitType=exp.splitType;document.querySelectorAll(".split-type-btn").forEach(b=>b.classList.toggle("active",b.dataset.split===splitType));document.getElementById("customSplits").style.display=splitType==="custom"?"flex":"none";updateCustomSplitInputs();if(exp.customSplits){for(const[id,val]of Object.entries(exp.customSplits)){const el=document.getElementById("csplit_"+id);if(el)el.value=val;}}document.getElementById("expenseForm").scrollIntoView({behavior:"smooth"});}
function deleteExpense(id){if(!confirm("Delete this expense?"))return;data.expenses=data.expenses.filter(e=>e.id!==id);saveData();renderExpenses();showToast("Expense deleted");}
function toggleStatus(id){const exp=data.expenses.find(e=>e.id===id);exp.status=exp.status==="paid"?"pending":"paid";saveData();renderExpenses();}

// ==================== DEBT COMPUTATION ====================
// Returns array of { expenseId, description, category, owedTo, amount (PHP), paymentKey }
function getDebtsForPerson(personId) {
  const debts = [];
  data.expenses.forEach(exp => {
    if (!exp.splitAmong.includes(personId)) return;
    if (exp.paidBy === personId) return; // you don't owe yourself
    let share;
    if (exp.splitType === "custom" && exp.customSplits) {
      share = convertToPhp(exp.customSplits[personId] || 0, exp.currency);
    } else {
      share = convertToPhp(exp.amount, exp.currency) / exp.splitAmong.length;
    }
    if (share < 0.01) return;
    const paymentKey = personId + ":" + exp.id;
    debts.push({
      expenseId: exp.id,
      description: exp.description,
      category: exp.category,
      owedTo: exp.paidBy,
      amount: share,
      paymentKey
    });
  });
  return debts;
}

function isDebtPaid(paymentKey) {
  return !!(data.payments && data.payments[paymentKey]?.paid);
}

function toggleDebtPaid(paymentKey, personId) {
  if (!data.payments) data.payments = {};
  if (data.payments[paymentKey]?.paid) {
    delete data.payments[paymentKey];
  } else {
    data.payments[paymentKey] = { paid: true, date: new Date().toISOString().slice(0,10) };
  }
  saveData();
  renderExpenses();
  // Re-select the same person tab
  selectPersonTab(personId);
}

// ==================== RENDER ====================
let selectedPerson = null;

function selectPersonTab(id) {
  selectedPerson = id;
  document.querySelectorAll(".person-tab").forEach(t => t.classList.toggle("active", t.dataset.person === id));
  document.querySelectorAll(".person-detail").forEach(d => d.classList.toggle("active", d.dataset.person === id));
}

function renderExpenses() {
  // ── Expense table with total row ──
  const totalPhp = data.expenses.reduce((s, e) => s + convertToPhp(e.amount, e.currency), 0);
  const rows = data.expenses.map(exp => `
    <tr>
      <td><span class="cat-icon">${CAT_ICONS[exp.category]||""}</span>${exp.description}</td>
      <td class="amount-cell">${formatMoney(exp.amount,exp.currency)}</td>
      <td>${getNameShort(exp.paidBy)}</td>
      <td style="font-size:0.78rem;color:var(--text-secondary)">${exp.splitAmong.map(id=>getNameShort(id)).join(", ")}</td>
      <td style="font-size:0.78rem;color:var(--text-dim)">${exp.date}</td>
      <td><span class="status-badge status-${exp.status}" onclick="toggleStatus('${exp.id}')">${exp.status}</span></td>
      <td><div class="actions-cell"><button class="btn btn-secondary btn-xs" onclick="editExpense('${exp.id}')">Edit</button><button class="btn btn-danger btn-xs" onclick="deleteExpense('${exp.id}')">Del</button></div></td>
    </tr>`).join("");
  const totalRow = `<tr class="expense-total-row">
    <td colspan="4" class="expense-total-label">&#127758; Total Group Expenses</td>
    <td colspan="3" class="expense-total-value">${formatMoney(totalPhp)}</td>
  </tr>`;
  document.getElementById("expenseTableBody").innerHTML = rows + totalRow;

  // ── Compute balances ──
  const rawBalances = {};
  data.travelers.forEach(t => { rawBalances[t.id] = {paid:0, owed:0}; });
  data.expenses.forEach(exp => {
    const php = convertToPhp(exp.amount, exp.currency);
    if (rawBalances[exp.paidBy]) rawBalances[exp.paidBy].paid += php;
    exp.splitAmong.forEach(id => {
      if (!rawBalances[id]) return;
      let share;
      if (exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[id]||0,exp.currency);
      else share=php/exp.splitAmong.length;
      rawBalances[id].owed += share;
    });
  });

  // ── Summary cards (clickable) ──
  // Net after accounting for payments already marked paid
  document.getElementById("summaryGrid").innerHTML = data.travelers.map(t => {
    const b = rawBalances[t.id];
    // "Total still owed to you" = your paid amount minus shares already settled back to you
    const debtsOwedToMe = [];
    data.expenses.forEach(exp => {
      if (exp.paidBy !== t.id) return;
      const php = convertToPhp(exp.amount, exp.currency);
      exp.splitAmong.forEach(debtor => {
        if (debtor === t.id) return;
        let share;
        if (exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[debtor]||0,exp.currency);
        else share=php/exp.splitAmong.length;
        if (share < 0.01) return;
        const pk = debtor+":"+exp.id;
        debtsOwedToMe.push({share, paid: isDebtPaid(pk)});
      });
    });
    const totalRecoverable = debtsOwedToMe.reduce((s,d)=>s+d.share,0);
    const totalRecovered   = debtsOwedToMe.filter(d=>d.paid).reduce((s,d)=>s+d.share,0);
    const totalStillOwed   = totalRecoverable - totalRecovered;

    // How much this person still owes others (unpaid debts)
    const myDebts = getDebtsForPerson(t.id);
    const iStillOwe = myDebts.filter(d=>!isDebtPaid(d.paymentKey)).reduce((s,d)=>s+d.amount,0);
    const fullySettled = iStillOwe < 0.01;
    const barCls = totalStillOwed>0.01?"positive":!fullySettled?"negative":"zero";

    return `<div class="summary-card" onclick="openPayerModal('${t.id}')">
      <div class="accent-bar ${barCls}"></div>
      <div class="summary-avatar">${getInitials(t.id)}</div>
      <div class="summary-name">${getNameShort(t.id)}</div>
      <div class="summary-row"><span class="label">Paid by ${getNameShort(t.id)}</span><span style="font-weight:600">${formatMoney(b.paid)}</span></div>
      <div class="summary-row"><span class="label">Their share</span><span>${formatMoney(b.owed)}</span></div>
      ${b.paid>0.01?`<div class="summary-row" style="margin-top:4px;padding-top:6px;border-top:1px solid var(--border)"><span class="label" style="color:var(--text-secondary)">Still owed back</span><span style="color:${totalStillOwed>0.01?'var(--orange)':'var(--green)'};">${formatMoney(totalStillOwed)}</span></div>`:''}
      <div style="margin-top:10px;padding-top:10px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
        <span style="font-size:0.65rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);font-weight:600">Still owes</span>
        <span style="font-size:1rem;font-weight:700;font-family:'SF Mono','Fira Code','Courier New',monospace;color:${fullySettled?'var(--green)':'var(--red)'};">${fullySettled?'PHP 0.00':formatMoney(iStillOwe)}</span>
      </div>
      <div style="font-size:0.58rem;color:var(--text-dim);text-align:center;margin-top:6px;opacity:0.7;">tap for details</div>
    </div>`;
  }).join("");

  // ── Who Owes Whom ──
  renderWhoOwesWhom();
}

// ── Payer Detail Modal ──
function openPayerModal(payerId) {
  const payer = data.travelers.find(t=>t.id===payerId);
  if (!payer) return;
  const payerName = getNameShort(payerId);

  // Collect all expenses paid by this person
  const myExpenses = data.expenses.filter(e=>e.paidBy===payerId);

  // Stats
  const totalPaidOut = myExpenses.reduce((s,e)=>s+convertToPhp(e.amount,e.currency),0);
  // How much this person owes others
  const myDebts = getDebtsForPerson(payerId);
  const totalIOwe = myDebts.reduce((s,d)=>s+d.amount,0);
  const totalIPaid = myDebts.filter(d=>isDebtPaid(d.paymentKey)).reduce((s,d)=>s+d.amount,0);
  const totalIStillOwe = totalIOwe - totalIPaid;

  let html = `<div class="payer-hero">
    <div class="dir-route" style="margin-bottom:8px">
      <div class="summary-avatar" style="width:40px;height:40px;font-size:0.9rem;margin:0">${getInitials(payerId)}</div>
      <div><div class="payer-hero-name">${[payer.firstName,payer.lastName].filter(Boolean).join(" ")||payerName}</div>
      <div class="payer-hero-sub">Expense breakdown &amp; settlement summary</div></div>
    </div>
    <div class="payer-stats">
      <div class="payer-stat">
        <div class="payer-stat-label">Total Paid Out</div>
        <div class="payer-stat-value" style="color:var(--amber)">${formatMoney(totalPaidOut)}</div>
      </div>
      <div class="payer-stat">
        <div class="payer-stat-label">I Owe Others</div>
        <div class="payer-stat-value" style="color:var(--red)">${formatMoney(totalIStillOwe)}</div>
      </div>
      <div class="payer-stat">
        <div class="payer-stat-label">I've Paid Back</div>
        <div class="payer-stat-value" style="color:var(--green)">${formatMoney(totalIPaid)}</div>
      </div>
    </div>
  </div>
  <div class="payer-body">`;

  if (myExpenses.length === 0) {
    html += `<div class="no-debts" style="margin:20px 0">&#128179; ${payerName} hasn't paid for any group expenses yet.</div>`;
  } else {
    html += `<div class="payer-section-title">&#128176; Expenses Paid by ${payerName}</div>`;
    myExpenses.forEach(exp => {
      const phpAmt = convertToPhp(exp.amount, exp.currency);
      // build settlement rows for debtors on this expense
      const debtors = exp.splitAmong.filter(id=>id!==payerId);
      let settleRows = "";
      let settledTotal = 0;
      let unsettledTotal = 0;
      debtors.forEach(debtorId=>{
        let share;
        if(exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[debtorId]||0,exp.currency);
        else share=phpAmt/exp.splitAmong.length;
        if(share<0.01)return;
        const pk = debtorId+":"+exp.id;
        const paid = isDebtPaid(pk);
        if(paid) settledTotal+=share; else unsettledTotal+=share;
        settleRows+=`<div class="payer-settle-row">
          <span class="payer-settle-who"><strong>${getNameShort(debtorId)}</strong> → ${payerName}</span>
          <span style="display:flex;align-items:center;gap:6px">
            <span class="payer-settle-amount">${formatMoney(share)}</span>
            <span class="payer-settle-status ${paid?'paid':'unpaid'}">${paid?'PAID':'NOT PAID'}</span>
          </span>
        </div>`;
      });
      // self-share row
      let selfShare=0;
      if(exp.splitAmong.includes(payerId)){
        if(exp.splitType==="custom"&&exp.customSplits) selfShare=convertToPhp(exp.customSplits[payerId]||0,exp.currency);
        else selfShare=phpAmt/exp.splitAmong.length;
      }
      const footerCls = unsettledTotal<0.01?"settled":settledTotal>0?"partial":"none";
      const footerLabel = unsettledTotal<0.01?"\u2705 Fully settled":`${formatMoney(settledTotal)} settled / ${formatMoney(unsettledTotal)} pending`;
      html+=`<div class="payer-exp-block">
        <div class="payer-exp-header">
          <span class="cat-icon">${CAT_ICONS[exp.category]||""}</span>
          <span class="payer-exp-title">${exp.description}</span>
          <span class="payer-exp-amount">${formatMoney(exp.amount,exp.currency)}</span>
        </div>
        ${selfShare>0.01?`<div class="payer-settle-row" style="background:rgba(255,255,255,0.015)"><span class="payer-settle-who" style="color:var(--text-dim)">Your own share</span><span class="payer-settle-amount" style="color:var(--text-dim)">${formatMoney(selfShare)}</span></div>`:""}
        ${settleRows}
        ${debtors.length>0?`<div class="payer-exp-footer"><span class="footer-label">${footerLabel}</span><span class="footer-val ${footerCls}">${formatMoney(settledTotal+unsettledTotal)} total owed back</span></div>`:""}
      </div>`;
    });
  }

  // Bottom section: what THIS person owes others
  if (myDebts.length > 0) {
    html += `<div class="payer-section-title" style="margin-top:24px">&#128197; ${payerName}'s Outstanding Debts</div>`;
    myDebts.forEach(d=>{
      const paid = isDebtPaid(d.paymentKey);
      html+=`<div class="payer-settle-row" style="background:var(--surface2);border-radius:var(--radius-sm);margin-bottom:6px;border:1px solid var(--border)">
        <span class="payer-settle-who"><strong>${payerName}</strong> → ${getNameShort(d.owedTo)} <span style="color:var(--text-dim);font-size:0.7rem">(${d.description})</span></span>
        <span style="display:flex;align-items:center;gap:6px">
          <span class="payer-settle-amount">${formatMoney(d.amount)}</span>
          <span class="payer-settle-status ${paid?'paid':'unpaid'}">${paid?'PAID':'NOT PAID'}</span>
        </span>
      </div>`;
    });
  }

  html += `</div>`;
  document.getElementById("payerModalContent").innerHTML = html;
  document.getElementById("payerModal").classList.add("show");
}

function closePayerModal() {
  document.getElementById("payerModal").classList.remove("show");
}

function renderWhoOwesWhom() {
  const tabsEl = document.getElementById("personTabs");
  const detailsEl = document.getElementById("personDetails");

  let tabsHtml = "";
  let detailsHtml = "";

  data.travelers.forEach(t => {
    const debts = getDebtsForPerson(t.id);
    const unpaidCount = debts.filter(d => !isDebtPaid(d.paymentKey)).length;
    const totalUnpaid = debts.filter(d => !isDebtPaid(d.paymentKey)).reduce((s,d) => s+d.amount, 0);
    const totalAll = debts.reduce((s,d) => s+d.amount, 0);
    const totalPaid = debts.filter(d => isDebtPaid(d.paymentKey)).reduce((s,d) => s+d.amount, 0);
    const allPaid = debts.length > 0 && unpaidCount === 0;

    let badgeHtml = "";
    if (debts.length > 0) {
      badgeHtml = allPaid
        ? `<span class="tab-badge settled">\u2713</span>`
        : `<span class="tab-badge has-debt">${unpaidCount}</span>`;
    }

    tabsHtml += `<button class="person-tab${selectedPerson===t.id?" active":""}" data-person="${t.id}" onclick="selectPersonTab('${t.id}')">${getNameShort(t.id)}${badgeHtml}</button>`;

    detailsHtml += `<div class="person-detail${selectedPerson===t.id?" active":""}" data-person="${t.id}">`;

    if (debts.length === 0) {
      detailsHtml += `<div class="no-debts">\u2705 ${getNameShort(t.id)} doesn't owe anyone!</div>`;
    } else {
      detailsHtml += `<div class="person-summary-bar">
        <div class="psb-item"><div class="psb-label">Total Share</div><div class="psb-value" style="color:var(--red)">${formatMoney(totalAll)}</div></div>
        <div class="psb-item"><div class="psb-label">Already Paid</div><div class="psb-value" style="color:var(--green)">${formatMoney(totalPaid)}</div></div>
        <div class="psb-item"><div class="psb-label">Still Owe</div><div class="psb-value" style="color:${totalUnpaid<0.01?'var(--green)':'var(--amber)'}">${formatMoney(totalUnpaid)}</div></div>
      </div>`;

      debts.forEach(d => {
        const paid = isDebtPaid(d.paymentKey);
        detailsHtml += `
          <div class="debt-item${paid?" is-paid":""}">
            <div class="debt-icon">${CAT_ICONS[d.category]||"\u{1F4B2}"}</div>
            <div class="debt-info">
              <div class="debt-desc">${d.description}</div>
              <div class="debt-sub">Your share — pay back <strong>${getNameShort(d.owedTo)}</strong></div>
            </div>
            <div class="debt-amount${paid?" paid":""}">${formatMoney(d.amount)}</div>
            <div class="debt-actions">
              ${paid
                ? `<span class="paid-check">\u2705</span><button class="btn btn-danger btn-xs" onclick="toggleDebtPaid('${d.paymentKey}','${t.id}')" title="Undo">Undo</button>`
                : `<button class="btn btn-teal btn-sm" onclick="toggleDebtPaid('${d.paymentKey}','${t.id}')">Mark Paid</button>`
              }
            </div>
          </div>`;
      });
    }
    detailsHtml += `</div>`;
  });

  tabsEl.innerHTML = tabsHtml;
  detailsEl.innerHTML = detailsHtml;

  // Auto-select first person if none selected
  if (!selectedPerson || !data.travelers.find(t=>t.id===selectedPerson)) {
    const first = data.travelers[0];
    if (first) selectPersonTab(first.id);
  }
}

// Settings
function updateRate(){const r=parseFloat(document.getElementById("settingsRate").value);if(!r||r<=0){showToast("Enter a valid rate",true);return;}data.meta.exchangeRate=r;document.getElementById("rateInput").value=r;saveData();renderExpenses();showToast("Exchange rate updated!");}
function exportData(){const b=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download="bkk2026-backup.json";a.click();URL.revokeObjectURL(u);showToast("Data exported!");}
function importData(event){const f=event.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(e){try{const imp=JSON.parse(e.target.result);if(!imp.travelers||!imp.expenses)throw new Error("Invalid format");if(!imp.payments||Array.isArray(imp.payments))imp.payments={};data=imp;saveData();renderAll();showToast("Data imported!");}catch(err){showToast("Invalid file: "+err.message,true);}};r.readAsText(f);event.target.value="";}
function resetData(){if(!confirm("Reset ALL data to defaults? This cannot be undone."))return;if(!confirm("Are you really sure?"))return;data=JSON.parse(JSON.stringify(DEFAULT_DATA));saveData();selectedPerson=null;renderAll();showToast("Data reset to defaults");}

document.getElementById("rateInput").addEventListener("change",function(){const r=parseFloat(this.value);if(r>0){data.meta.exchangeRate=r;document.getElementById("settingsRate").value=r;saveData();renderExpenses();}});

// ==================== PERSONAL EXPENSES ====================
const PE_CATS = {
  food:      {label:"🍜 Food & Drinks",   color:"rgba(246,173,85,0.12)",  text:"#f6ad55"},
  shopping:  {label:"🛍️ Shopping",        color:"rgba(183,148,244,0.12)", text:"#c4a8f7"},
  transport: {label:"🚗 Transport",        color:"rgba(99,179,237,0.12)",  text:"#7cc4f5"},
  activity:  {label:"🎟️ Activities",      color:"rgba(104,211,145,0.12)", text:"#7ee8a8"},
  beauty:    {label:"💆 Health & Beauty",  color:"rgba(252,129,129,0.12)", text:"#fc8181"},
  other:     {label:"📦 Other",            color:"rgba(160,160,190,0.1)",  text:"#9898b0"}
};

let peSelectedPerson = null;
let peEditId = null;

function getPeList(personId) {
  if (!data.personalExpenses) data.personalExpenses = {};
  if (!data.personalExpenses[personId]) data.personalExpenses[personId] = [];
  return data.personalExpenses[personId];
}

function renderPersonalExpenses() {
  const tabsEl   = document.getElementById("pePersonTabs");
  const panelsEl = document.getElementById("pePanels");
  if (!tabsEl || !panelsEl) return;

  if (!peSelectedPerson) peSelectedPerson = data.travelers[0]?.id || null;

  // Tabs
  tabsEl.innerHTML = data.travelers.map(t =>
    `<button class="pe-person-tab${peSelectedPerson===t.id?" active":""}" data-pe-tab="${t.id}" onclick="peSwitchPerson('${t.id}')">${getNameShort(t.id)}</button>`
  ).join("");

  // Panels
  panelsEl.innerHTML = data.travelers.map(t => {
    const list = getPeList(t.id);
    const totalPhp = list.reduce((s,e) => s + convertToPhp(e.amount, e.currency), 0);
    const totalThb = list.filter(e=>e.currency==="THB").reduce((s,e)=>s+e.amount,0);
    const totalPhpOnly = list.filter(e=>e.currency==="PHP").reduce((s,e)=>s+e.amount,0);
    const catTotals = {};
    list.forEach(e => {
      const php = convertToPhp(e.amount, e.currency);
      catTotals[e.category] = (catTotals[e.category]||0) + php;
    });
    const topCat = Object.entries(catTotals).sort((a,b)=>b[1]-a[1])[0];

    // Build category breakdown chips
    const catChips = Object.entries(catTotals).sort((a,b)=>b[1]-a[1]).map(([cat,amt]) => {
      const c = PE_CATS[cat]||PE_CATS.other;
      return `<span style="display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:12px;font-size:0.68rem;font-weight:600;background:${c.color};color:${c.text};margin:2px;">${c.label.split(" ").slice(0,2).join(" ")} <span style="opacity:0.8">${formatMoney(amt)}</span></span>`;
    }).join("");

    // Form id scoped to person
    const fid = `pe_${t.id}`;

    return `<div class="pe-panel${peSelectedPerson===t.id?" active":""}" data-pe-person="${t.id}">

      <!-- Stats bar -->
      <div class="pe-summary-bar">
        <div class="pe-stat">
          <div class="pe-stat-label">Total Spent</div>
          <div class="pe-stat-value" style="color:var(--teal)">${formatMoney(totalPhp)}</div>
        </div>
        <div class="pe-stat">
          <div class="pe-stat-label">in THB</div>
          <div class="pe-stat-value" style="color:var(--text-secondary)">${totalThb.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} ฿</div>
        </div>
        <div class="pe-stat">
          <div class="pe-stat-label">Entries</div>
          <div class="pe-stat-value" style="color:var(--text-secondary)">${list.length}</div>
        </div>
        <div class="pe-stat">
          <div class="pe-stat-label">Top Category</div>
          <div class="pe-stat-value" style="color:var(--text-secondary);font-size:0.75rem;">${topCat?(PE_CATS[topCat[0]]||PE_CATS.other).label.split(" ").slice(0,2).join(" "):"—"}</div>
        </div>
      </div>

      ${list.length>1?`<div style="margin-bottom:16px;display:flex;flex-wrap:wrap;gap:4px">${catChips}</div>`:""}

      <!-- Add / Edit form -->
      <div class="pe-add-form">
        <h4 id="${fid}_formTitle">&#43; Add Personal Expense</h4>
        <input type="hidden" id="${fid}_editId">
        <div class="form-row">
          <div class="form-group" style="flex:2"><label>Description</label><input type="text" id="${fid}_desc" placeholder="e.g. Chang beer at 7-Eleven"></div>
          <div class="form-group"><label>Amount</label><input type="number" id="${fid}_amount" step="0.01" min="0" placeholder="0.00"></div>
          <div class="form-group" style="flex:0.5;min-width:80px"><label>Currency</label>
            <select id="${fid}_currency"><option value="THB">THB</option><option value="PHP">PHP</option></select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Category</label>
            <select id="${fid}_cat">
              ${Object.entries(PE_CATS).map(([k,v])=>`<option value="${k}">${v.label}</option>`).join("")}
            </select>
          </div>
          <div class="form-group"><label>Date</label><input type="date" id="${fid}_date" value="${new Date().toISOString().slice(0,10)}"></div>
          <div class="form-group" style="flex:2"><label>Note <span style="color:var(--text-dim);font-weight:400">(optional)</span></label><input type="text" id="${fid}_note" placeholder="e.g. Chatuchak souvenir"></div>
        </div>
        <div style="display:flex;gap:8px;margin-top:4px">
          <button class="btn btn-teal" onclick="peSave('${t.id}')">Save</button>
          <button class="btn btn-secondary" id="${fid}_cancelBtn" style="display:none" onclick="peCancel('${t.id}')">Cancel</button>
        </div>
      </div>

      <!-- Table -->
      <div class="pe-table-wrap">
        ${list.length===0
          ? `<div class="pe-empty">&#128683; No personal expenses yet — add your first one above!</div>`
          : `<table class="pe-table">
              <thead><tr>
                <th>Description</th><th>Category</th><th>Amount</th><th>In PHP</th><th>Date</th><th>Note</th><th>Actions</th>
              </tr></thead>
              <tbody>
                ${list.map(e => {
                  const c = PE_CATS[e.category]||PE_CATS.other;
                  return `<tr>
                    <td style="font-weight:500">${e.desc}</td>
                    <td><span class="pe-cat-badge" style="background:${c.color};color:${c.text}">${c.label.split(" ").slice(0,2).join(" ")}</span></td>
                    <td class="amount-cell">${e.currency==="THB"?e.amount.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})+" ฿":formatMoney(e.amount,"PHP")}</td>
                    <td class="amount-cell" style="color:var(--teal)">${formatMoney(convertToPhp(e.amount,e.currency))}</td>
                    <td style="color:var(--text-dim);font-size:0.78rem">${e.date}</td>
                    <td style="color:var(--text-dim);font-size:0.75rem;max-width:140px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${e.note||"—"}</td>
                    <td><div class="actions-cell">
                      <button class="btn btn-secondary btn-xs" onclick="peEdit('${t.id}','${e.id}')">Edit</button>
                      <button class="btn btn-danger btn-xs" onclick="peDel('${t.id}','${e.id}')">Del</button>
                    </div></td>
                  </tr>`;
                }).join("")}
              </tbody>
              <tfoot><tr class="pe-total-row">
                <td colspan="3" class="pe-total-label">&#127760; Total Personal Spend</td>
                <td class="pe-total-value" colspan="4">${formatMoney(totalPhp)}</td>
              </tr></tfoot>
            </table>`
        }
      </div>
    </div>`;
  }).join("");
}

function peSwitchPerson(id) {
  peSelectedPerson = id;
  peEditId = null;
  renderPersonalExpenses();
}

function peSave(personId) {
  const fid = `pe_${personId}`;
  const desc   = document.getElementById(`${fid}_desc`).value.trim();
  const amount = parseFloat(document.getElementById(`${fid}_amount`).value);
  const currency = document.getElementById(`${fid}_currency`).value;
  const cat    = document.getElementById(`${fid}_cat`).value;
  const date   = document.getElementById(`${fid}_date`).value;
  const note   = document.getElementById(`${fid}_note`).value.trim();
  const editId = document.getElementById(`${fid}_editId`).value;

  if (!desc) { showToast("Enter a description", true); return; }
  if (!amount || amount <= 0) { showToast("Enter a valid amount", true); return; }

  const list = getPeList(personId);
  if (editId) {
    const entry = list.find(e=>e.id===editId);
    if (entry) Object.assign(entry, {desc, amount, currency, category:cat, date, note});
  } else {
    list.push({id:"pe_"+Date.now(), desc, amount, currency, category:cat, date, note});
  }
  if (!data.personalExpenses) data.personalExpenses = {};
  data.personalExpenses[personId] = list;
  saveData();
  renderPersonalExpenses();
  showToast(editId ? "Entry updated!" : "Expense added!");
}

function peEdit(personId, entryId) {
  const list  = getPeList(personId);
  const entry = list.find(e=>e.id===entryId);
  if (!entry) return;
  peSelectedPerson = personId;
  renderPersonalExpenses(); // ensure panel is rendered
  const fid = `pe_${personId}`;
  document.getElementById(`${fid}_editId`).value   = entry.id;
  document.getElementById(`${fid}_desc`).value     = entry.desc;
  document.getElementById(`${fid}_amount`).value   = entry.amount;
  document.getElementById(`${fid}_currency`).value = entry.currency;
  document.getElementById(`${fid}_cat`).value      = entry.category;
  document.getElementById(`${fid}_date`).value     = entry.date;
  document.getElementById(`${fid}_note`).value     = entry.note||"";
  document.getElementById(`${fid}_formTitle`).innerHTML = "&#9998; Edit Expense";
  document.getElementById(`${fid}_cancelBtn`).style.display = "";
  document.querySelector(`[data-pe-person="${personId}"] .pe-add-form`).scrollIntoView({behavior:"smooth", block:"center"});
}

function peCancel(personId) {
  peEditId = null;
  renderPersonalExpenses();
}

function peDel(personId, entryId) {
  if (!confirm("Delete this entry?")) return;
  data.personalExpenses[personId] = getPeList(personId).filter(e=>e.id!==entryId);
  saveData();
  renderPersonalExpenses();
  showToast("Entry deleted");
}

function renderAll(){document.getElementById("rateInput").value=data.meta.exchangeRate;document.getElementById("settingsRate").value=data.meta.exchangeRate;renderItinerary();renderItineraryMobile();renderExpenseForm();renderExpenses();renderPersonalExpenses();renderMustTry();}

// ==================== GOOGLE SHEETS SYNC ====================
const GS_CONFIG_KEY = "bkk2026_gsconfig";
const SYNC_SHEET_NAME = "SyncData";
const SYNC_INTERVAL_MS = 30000; // 30 seconds
// ⬇️ FILL IN YOUR CREDENTIALS HERE before deploying — friends will auto-sync with no setup needed
let gsConfig = {
  spreadsheetId: "19ElCtLGd5Po6ByqtFdFwcA5X7Dowxsh2wm7w8lr2l-w",
  apiKey:         "AIzaSyDFLMC24AlylHs-o8xjNbtncp_e-L0huUk",
  webAppUrl:      "https://script.google.com/macros/s/AKfycbwNv93BFoUNhPqatochkwxF9Qbp3SoVMZiPLA_KVoGhPetDUsXmRK2OtqI2RgB0_jhZUQ/exec",
  syncToken:      "bkk2026"
};
let autoSyncEnabled = false;
let autoSyncTimer = null;
let lastSyncTime = null;
let isSyncing = false;

function loadGsConfig() {
  try {
    const saved = localStorage.getItem(GS_CONFIG_KEY);
    // Merge: baked defaults supply values, localStorage overrides any that were manually changed
    if (saved) gsConfig = Object.assign({}, gsConfig, JSON.parse(saved));
  } catch(e) {}
  document.getElementById("spreadsheetId").value = gsConfig.spreadsheetId || "";
  document.getElementById("apiKey").value = gsConfig.apiKey || "";
  document.getElementById("webAppUrl").value = gsConfig.webAppUrl || "";
  document.getElementById("syncToken").value = gsConfig.syncToken || "";
  updateSyncStatusUI();
}

function saveGsheetsConfig() {
  gsConfig.spreadsheetId = document.getElementById("spreadsheetId").value.trim();
  gsConfig.apiKey = document.getElementById("apiKey").value.trim();
  gsConfig.webAppUrl = document.getElementById("webAppUrl").value.trim();
  gsConfig.syncToken = document.getElementById("syncToken").value.trim();
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Enter both Spreadsheet ID and API Key", true); return; }
  localStorage.setItem(GS_CONFIG_KEY, JSON.stringify(gsConfig));
  showToast("Config saved! Click Test Connection to verify.");
  updateSyncStatusUI();
}

function updateSyncStatusUI() {
  const el = document.getElementById("syncStatus");
  const btnText = document.getElementById("autoSyncBtnText");
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) {
    el.style.cssText = "background:rgba(107,107,138,0.12);border:1px solid rgba(107,107,138,0.2);color:var(--text-dim)";
    el.innerHTML = "&#9889; Not configured. Enter your Spreadsheet ID and API Key below.";
    btnText.innerHTML = "&#9654; Enable Auto-Sync";
    return;
  }
  if (autoSyncEnabled) {
    el.style.cssText = "background:rgba(56,178,172,0.1);border:1px solid rgba(56,178,172,0.25);color:var(--teal)";
    el.innerHTML = "&#128308; Auto-Sync <b>ON</b> &mdash; syncing every 30s" + (lastSyncTime ? " &middot; Last: " + lastSyncTime : "");
    btnText.innerHTML = "&#9646;&#9646; Disable Auto-Sync";
  } else {
    el.style.cssText = "background:rgba(232,168,56,0.08);border:1px solid rgba(232,168,56,0.2);color:var(--amber)";
    el.innerHTML = "&#9711; Connected but Auto-Sync is <b>OFF</b>. Use Manual Sync or enable Auto-Sync." + (lastSyncTime ? " &middot; Last sync: " + lastSyncTime : "");
    btnText.innerHTML = "&#9654; Enable Auto-Sync";
  }
}

// READ from Google Sheets (public read via API key)
async function gsRead() {
  const { spreadsheetId, apiKey } = gsConfig;
  const range = encodeURIComponent(SYNC_SHEET_NAME + "!A1");
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
  const res = await fetch(url);
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    const msg = err.error?.message || `HTTP ${res.status}`;
    // "Unable to parse range" means the SyncData sheet tab doesn't exist yet — treat as empty
    if (msg.includes("Unable to parse range") || msg.includes("not found")) return null;
    throw new Error(msg);
  }
  const json = await res.json();
  const val = json.values?.[0]?.[0];
  return val ? JSON.parse(val) : null;
}

// WRITE to Google Sheets via Apps Script Web App URL (stored in config)
async function gsWrite(payload) {
  const { webAppUrl, syncToken } = gsConfig;
  if (!webAppUrl) throw new Error("NO_WEBAPP");

  const body = JSON.stringify({ action: "write", token: syncToken || "", data: JSON.stringify(payload) });

  // IMPORTANT: Use Content-Type: text/plain so the browser treats this as a "simple request"
  // and skips the CORS preflight. Apps Script does not handle OPTIONS preflight requests,
  // causing "Failed to fetch" if any other Content-Type is used. This works on both
  // file:// and https:// origins without needing mode: "no-cors".
  const res = await fetch(webAppUrl, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body
  });

  // Apps Script always returns HTTP 200 — check the JSON body for actual errors
  const text = await res.text();
  try {
    const json = JSON.parse(text);
    if (json.ok === false) throw new Error(json.error || "Write failed");
    return json;
  } catch(e) {
    if (e.message.includes("Write failed") || e.message.includes("Unauthorized")) throw e;
    // Response wasn't parseable JSON but request went through — treat as success
    return { ok: true };
  }
}

async function testGsheetsConnection() {
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Save your config first", true); return; }
  showToast("Testing connection...");
  try {
    await gsRead();
    showToast("Connection successful! Google Sheets is accessible.");
    lastSyncTime = new Date().toLocaleTimeString();
    updateSyncStatusUI();
  } catch(e) {
    showToast("Connection failed: " + e.message, true);
  }
}

async function manualSync() {
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Configure Google Sheets first", true); return; }
  if (isSyncing) return;
  isSyncing = true;
  showToast("Syncing...");
  try {
    const remote = await gsRead();
    if (remote && remote.meta?.lastUpdated) {
      const remoteTime = new Date(remote.meta.lastUpdated);
      const localTime = new Date(data.meta.lastUpdated || 0);
      if (localTime > remoteTime) {
        // Local is strictly newer — push
        try {
          await gsWrite(data);
          showToast("Pushed local data to Google Sheets!");
        } catch(we) {
          if (we.message === "NO_WEBAPP") {
            showToast("Read-only mode: your data is newer. Set up Apps Script to push changes.", true);
          } else throw we;
        }
      } else {
        // Remote is same age or newer — always pull so other sessions' changes appear
        if (!remote.payments || Array.isArray(remote.payments)) remote.payments = {};
        data = remote;
        saveDataLocal();
        renderAll();
        if (remoteTime > localTime) {
          showToast("Pulled latest data from Google Sheets!");
        } else {
          showToast("Up to date!");
        }
      }
    } else {
      // Nothing in sheet yet (tab missing or empty) — push our data
      try {
        await gsWrite(data);
        showToast("✅ Initialized! Data written to Google Sheets for the first time.");
      } catch(we) {
        if (we.message === "NO_WEBAPP") {
          showToast("Sheet is empty — add your Apps Script URL to enable writing (see setup guide below).", true);
        } else throw we;
      }
    }
    lastSyncTime = new Date().toLocaleTimeString();
    updateSyncStatusUI();
  } catch(e) {
    showToast("Sync error: " + e.message, true);
  } finally {
    isSyncing = false;
  }
}

function toggleAutoSync() {
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Configure Google Sheets first", true); return; }
  autoSyncEnabled = !autoSyncEnabled;
  if (autoSyncEnabled) {
    manualSync();
    autoSyncTimer = setInterval(manualSync, SYNC_INTERVAL_MS);
    showToast("Auto-Sync enabled — every 30 seconds");
  } else {
    clearInterval(autoSyncTimer);
    autoSyncTimer = null;
    showToast("Auto-Sync disabled");
  }
  updateSyncStatusUI();
}

loadData();renderAll();updateCountdown();setInterval(updateCountdown,1000);
loadGsConfig();
// Auto-start sync if credentials are baked in — friends need zero setup
const _hasCreds = gsConfig.spreadsheetId && !gsConfig.spreadsheetId.includes("PASTE")
               && gsConfig.apiKey && !gsConfig.apiKey.includes("PASTE")
               && gsConfig.webAppUrl && !gsConfig.webAppUrl.includes("PASTE");
if (_hasCreds) {
  manualSync();
  autoSyncEnabled = true;
  autoSyncTimer = setInterval(manualSync, SYNC_INTERVAL_MS);
  updateSyncStatusUI();
}
</script>
</body>
</html>
