<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BKK 2026</title>
<style>
:root {
  /* Deep space background */
  --bg: #080e18;
  --surface: rgba(255,255,255,0.06);
  --surface2: rgba(255,255,255,0.04);
  --surface3: rgba(255,255,255,0.08);
  --surface-solid: #0f1c2e;
  --surface2-solid: #152638;
  --surface3-solid: #1d3348;

  /* Liquid glass system */
  --glass: rgba(255,255,255,0.07);
  --glass-hover: rgba(255,255,255,0.11);
  --glass-border: rgba(255,255,255,0.14);
  --glass-border-bright: rgba(255,255,255,0.26);
  --glass-shine: inset 0 1px 0 rgba(255,255,255,0.12), inset 0 -1px 0 rgba(0,0,0,0.15);
  --glass-blur: blur(20px);
  --glass-blur-sm: blur(12px);

  /* Primary — warm gold */
  --amber: #f2c24e;
  --amber-dim: #c9962e;
  --amber-glow: rgba(242,194,78,0.18);
  --amber-glass: rgba(242,194,78,0.10);

  /* Secondary — electric cyan */
  --teal: #38e8ff;
  --teal-dim: #20c4dc;
  --teal-glow: rgba(56,232,255,0.15);
  --teal-glass: rgba(56,232,255,0.08);

  /* Third — periwinkle */
  --blue: #7b9cff;
  --blue-glow: rgba(123,156,255,0.15);

  /* Text */
  --text: #f0e8d2;
  --text-secondary: #8a9db8;
  --text-dim: #4a5c70;

  --border: rgba(255,255,255,0.09);
  --border-light: rgba(255,255,255,0.18);
  --border-accent: rgba(242,194,78,0.30);

  /* Status */
  --red: #ff6080;
  --red-glow: rgba(255,96,128,0.15);
  --orange: #ff9f5a;
  --green: #3dd68c;
  --purple: #c084fc;

  --radius: 16px;
  --radius-sm: 10px;
  --radius-lg: 22px;
  --shadow: 0 8px 32px rgba(0,0,0,0.6);
  --shadow-lg: 0 16px 56px rgba(0,0,0,0.8);
  --shadow-glow: 0 0 40px rgba(242,194,78,0.08);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', sans-serif;
  background: var(--bg); color:var(--text); min-height:100vh; font-size:15px; line-height:1.5;
  overflow-x:hidden;
}
/* Animated ambient background mesh */
body::before {
  content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    radial-gradient(ellipse 80% 50% at 20% 10%, rgba(56,232,255,0.07) 0%, transparent 60%),
    radial-gradient(ellipse 60% 60% at 80% 20%, rgba(242,194,78,0.06) 0%, transparent 55%),
    radial-gradient(ellipse 70% 50% at 50% 80%, rgba(123,156,255,0.05) 0%, transparent 60%),
    radial-gradient(ellipse 40% 40% at 10% 70%, rgba(61,214,140,0.04) 0%, transparent 50%);
  animation: ambientShift 20s ease-in-out infinite alternate;
}
@keyframes ambientShift {
  0%   { opacity:1; transform:scale(1) translate(0,0); }
  33%  { opacity:0.8; transform:scale(1.04) translate(-1%, 1%); }
  66%  { opacity:0.9; transform:scale(0.97) translate(1%, -1%); }
  100% { opacity:1; transform:scale(1.02) translate(-0.5%, 0.5%); }
}
/* Everything sits above the mesh */
.header, .tabs, .content { position:relative; z-index:1; }

button { cursor:pointer; font-family:inherit; }
input, select, textarea { font-family:inherit; }
::-webkit-scrollbar { width:5px; height:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.15); border-radius:10px; }
::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.25); }

/* ── GLASS MIXIN (apply to cards) ─────────────────────────── */
.glass {
  background: var(--glass);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shine), var(--shadow);
}
.glass-sm {
  background: var(--glass);
  backdrop-filter: var(--glass-blur-sm);
  -webkit-backdrop-filter: var(--glass-blur-sm);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shine);
}

.header {
  background: rgba(8,14,24,0.75);
  backdrop-filter: blur(32px) saturate(180%);
  -webkit-backdrop-filter: blur(32px) saturate(180%);
  padding: 12px 24px;
  display: flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px;
  border-bottom: 1px solid var(--glass-border);
  position: sticky; top:0; z-index:100;
  box-shadow: 0 1px 0 rgba(255,255,255,0.06), 0 8px 32px rgba(0,0,0,0.4);
}
.header-left { display:flex; align-items:center; gap:12px; }
.logo {
  width:36px; height:36px;
  background:linear-gradient(135deg, var(--amber) 0%, #ffd878 60%, #e8a020 100%);
  border-radius:11px; display:flex; align-items:center; justify-content:center;
  font-size:14px; font-weight:900; color:#120a00; letter-spacing:-0.5px;
  box-shadow: 0 2px 12px rgba(242,194,78,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
}
.header-title { font-size:1.25rem; font-weight:700; color:var(--text); letter-spacing:-0.5px; }
.header-title span { color:var(--text-dim); font-size:0.78rem; font-weight:400; margin-left:6px; letter-spacing:0; }
.countdown { display:flex; gap:5px; align-items:center; }
.cd-box {
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.13);
  border-radius: 10px; padding:5px 9px; text-align:center; min-width:44px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
}
.cd-num { font-size:1.1rem; font-weight:800; color:var(--amber); font-variant-numeric:tabular-nums; }
.cd-label { font-size:0.5rem; color:var(--text-dim); text-transform:uppercase; letter-spacing:1.5px; margin-top:1px; }
.header-rate {
  display:flex; align-items:center; gap:6px; font-size:0.8rem; color:var(--text-secondary);
  background: rgba(255,255,255,0.07); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.13); border-radius:40px; padding:5px 14px 5px 12px;
}
.header-rate input { width:50px; background:transparent; border:none; color:var(--amber); padding:0; text-align:center; font-size:0.83rem; font-weight:700; outline:none; }
.header.compact .header-title { font-size:1.08rem; }
.header.compact .header-title span { font-size:0.68rem; }

.tabs {
  display:flex;
  background: rgba(8,14,24,0.78);
  backdrop-filter: blur(28px) saturate(160%); -webkit-backdrop-filter: blur(28px) saturate(160%);
  border-bottom: 1px solid var(--glass-border);
  padding: 8px 16px; overflow-x:auto; gap:4px;
  scrollbar-width:none; -ms-overflow-style:none;
}
.tabs::-webkit-scrollbar { display:none; }
.tab {
  display:flex; align-items:center; gap:7px;
  padding: 8px 16px; color:var(--text-dim); font-size:0.82rem; font-weight:600;
  border:1px solid transparent; background:transparent; border-radius:12px;
  transition:all .22s ease; white-space:nowrap; position:relative;
}
.tab svg { width:15px; height:15px; flex-shrink:0; opacity:0.6; transition:opacity .2s; }
.tab:hover { color:var(--text-secondary); background:rgba(255,255,255,0.04); }
.tab:hover svg { opacity:0.8; }
.tab.active {
  color:var(--amber); background:rgba(242,194,78,0.10);
  border-color:rgba(242,194,78,0.28);
  box-shadow:0 0 16px rgba(242,194,78,0.06), inset 0 1px 0 rgba(255,255,255,0.08);
  text-shadow: 0 0 20px rgba(242,194,78,0.3);
}
.tab.active svg { opacity:1; }

.mobile-nav {
  display:none;
  position:fixed; left:0; right:0; bottom:0; z-index:120;
}
.mobile-nav-inner {
  margin:0 auto 18px; max-width:430px; padding:10px 12px;
  border-radius:28px;
  background: rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  backdrop-filter: blur(26px) saturate(160%);
  -webkit-backdrop-filter: blur(26px) saturate(160%);
  box-shadow: 0 24px 80px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.06);
  position:relative;
}
.mobile-nav-row {
  display:flex; align-items:flex-end; justify-content:space-between; gap:4px;
}
.mobile-tab {
  flex:1; min-width:64px;
  display:flex; flex-direction:column; align-items:center; gap:6px;
  background:transparent; border:none; color:var(--text-dim);
  font-size:0.6rem; font-weight:800; letter-spacing:0.16em; text-transform:uppercase;
  padding:6px 4px 4px; cursor:pointer;
  transition:transform .2s ease, color .2s ease;
}
.mobile-tab .mobile-icon {
  width:42px; height:42px; border-radius:16px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.12);
  color:var(--text-secondary);
  transition:all .2s ease;
}
.mobile-tab.active { color:var(--amber); transform:translateY(-12px); }
.mobile-tab.active .mobile-icon {
  color:var(--amber);
  border-color: rgba(242,194,78,0.35);
  background: rgba(242,194,78,0.08);
  box-shadow: 0 0 18px rgba(242,194,78,0.18);
}
.mobile-tab .mobile-icon {
  width:42px; height:42px; border-radius:16px;
}

.content { max-width:1240px; margin:0 auto; padding:20px; }
.tab-content { display:none; animation:fadeIn .35s ease; }
.tab-content.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

.section-title {
  font-size:0.62rem; font-weight:900; color:var(--text-dim);
  margin-bottom:14px; margin-top:22px;
  display:inline-flex; align-items:center; gap:8px;
  text-transform:uppercase; letter-spacing:0.2em;
  padding:5px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
}
.section-title .icon { font-size:0.9rem; }

.card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--glass-shine), var(--shadow);
}

/* Flights */
.flights { display:grid; grid-template-columns:1fr; gap:16px; margin-bottom:28px; }
.flight-sub {
  margin-top:16px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.08);
}
.flight-sub:first-child { margin-top:0; padding-top:0; border-top:none; }
.flight-sub-label { font-size:0.65rem; text-transform:uppercase; letter-spacing:2.5px; color:var(--amber); margin-bottom:8px; font-weight:600; }
.flight-sub .flight-route { font-size:1.2rem; }
.flight-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-top: 1px solid rgba(242,194,78,0.22);
  border-radius: var(--radius);
  padding: 16px 20px;
  box-shadow: var(--glass-shine), var(--shadow-lg);
  transition: transform .2s ease, box-shadow .2s ease;
}
.flight-card:hover { transform:translateY(-2px); box-shadow:var(--glass-shine), var(--shadow-lg), 0 0 24px rgba(242,194,78,0.07); }
.flight-header { display:flex; align-items:center; justify-content:space-between; gap:10px; }
.flight-summary { align-items:center; }
.flight-summary-left {
  width:34px; height:34px; border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(242,194,78,0.08);
  border:1px solid rgba(242,194,78,0.2);
  color:var(--amber);
  flex-shrink:0;
}
.flight-summary-main { flex:1; min-width:0; }
.flight-summary-top {
  display:flex; align-items:center; gap:7px;
  font-size:0.9rem; font-weight:700; letter-spacing:-0.2px;
}
.flight-summary-main .flight-route { font-size:inherit; letter-spacing:inherit; margin:0; }
.flight-summary-sep { color:var(--text-dim); font-weight:400; font-size:0.85rem; }
.flight-summary-time { color:var(--text); font-size:0.9rem; font-weight:700; letter-spacing:-0.2px; }
.flight-summary-sub { margin-top:3px; font-size:0.72rem; color:var(--text-dim); letter-spacing:0.1px; }
.flight-body { margin-top:14px; padding-top:14px; border-top:1px solid rgba(255,255,255,0.07); }
.flight-toggle {
  width:32px; height:32px; border-radius:10px;
  background: rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.1);
  color:var(--text-dim); cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all .2s ease; flex-shrink:0;
}
.flight-toggle:hover { color:var(--text); background:rgba(255,255,255,0.07); border-color:rgba(255,255,255,0.18); }
.flight-card.collapsed .flight-body { display:none; }
.flight-card.collapsed .flight-toggle { transform:rotate(-90deg); }
.flight-label { font-size:0.65rem; text-transform:uppercase; letter-spacing:2.5px; color:var(--amber); margin-bottom:8px; font-weight:600; }
.flight-route { font-size:1.5rem; font-weight:700; margin-bottom:2px; letter-spacing:-0.5px; }
.flight-num { font-size:0.82rem; color:var(--text-dim); margin-bottom:16px; }
.flight-times { display:flex; align-items:center; gap:16px; }
.flight-point { flex:1; }
.flight-point .airport { font-size:0.75rem; color:var(--text-dim); margin-bottom:2px; }
.flight-point .time { font-size:1.3rem; font-weight:700; letter-spacing:-0.5px; }
.flight-point .date { font-size:0.78rem; color:var(--text-secondary); margin-top:2px; }
.flight-arrow { color:var(--amber); font-size:1.4rem; flex-shrink:0; opacity:0.7; }

/* ── DESKTOP ITINERARY TABLE ───────────────────────────────── */
.itin-desktop { display:block; }
.itin-mobile  { display:none; }

.itinerary-table { width:100%; border-collapse:separate; border-spacing:3px 3px; }
.itinerary-table thead th {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  padding:14px 10px 12px; font-weight:700; font-size:0.8rem; color:var(--amber);
  text-align:center; border-radius:10px; border:1px solid var(--glass-border);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.12), 0 4px 12px rgba(0,0,0,0.3);
}
.itinerary-table thead th:first-child { background:transparent; box-shadow:none; color:var(--text-dim); font-size:0.7rem; border:none; }
.itinerary-table thead th .day-date { font-size:0.63rem; font-weight:400; color:var(--text-dim); margin-top:3px; }
.itinerary-table td { border:none; padding:2px; vertical-align:stretch; height:1px; }
.itin-time {
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  padding:10px 6px; font-size:0.58rem; font-weight:700;
  color:var(--text-dim); text-align:center; width:72px;
  border-radius:8px; letter-spacing:0.5px; border:1px solid rgba(255,255,255,0.09);
}
.slot {
  padding:10px 8px; font-size:0.68rem; line-height:1.35; text-align:center;
  height:100%; display:flex; align-items:center; justify-content:center;
  border-radius:10px; transition:transform .18s ease, box-shadow .18s ease;
  font-weight:500; letter-spacing:-0.1px;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
}
.slot:hover { transform:scale(1.03); box-shadow:0 4px 16px rgba(0,0,0,0.35); z-index:2; position:relative; }
.slot.sleep {
  background:linear-gradient(135deg, rgba(55,80,120,0.5), rgba(38,55,85,0.38));
  color:#8aa2be; font-style:italic; font-weight:400;
  border:1px solid rgba(120,155,210,0.18);
}
.slot.travel {
  background:linear-gradient(135deg, rgba(56,232,255,0.14), rgba(56,200,240,0.07));
  color:#60d8ff; border-left:3px solid rgba(56,232,255,0.7);
  border-top:1px solid rgba(56,232,255,0.18); border-bottom:1px solid rgba(56,232,255,0.08); border-right:none;
}
.slot.activity {
  background:linear-gradient(135deg, rgba(61,214,140,0.14), rgba(40,180,110,0.07));
  color:#5de8a8; border-left:3px solid rgba(61,214,140,0.7);
  border-top:1px solid rgba(61,214,140,0.18); border-bottom:1px solid rgba(61,214,140,0.08); border-right:none;
}
.slot.eating {
  background:linear-gradient(135deg, rgba(240,192,64,0.16), rgba(220,160,40,0.08));
  color:#f5c842; border-left:3px solid rgba(240,192,64,0.75);
  border-top:1px solid rgba(240,192,64,0.2); border-bottom:1px solid rgba(240,192,64,0.08); border-right:none;
}
.slot.free {
  background:linear-gradient(135deg, rgba(192,132,252,0.14), rgba(160,100,230,0.07));
  color:#d4a8ff; border-left:3px solid rgba(192,132,252,0.7);
  border-top:1px solid rgba(192,132,252,0.18); border-bottom:1px solid rgba(192,132,252,0.08); border-right:none;
}
.slot.prep {
  background:linear-gradient(135deg, rgba(148,170,200,0.14), rgba(120,145,178,0.07));
  color:#9ab0c8; border-left:3px solid rgba(148,170,200,0.5);
  border-top:1px solid rgba(148,170,200,0.14); border-bottom:1px solid rgba(148,170,200,0.06); border-right:none;
}
.slot.empty { background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); }
.itinerary-legend { display:flex; gap:18px; margin-top:18px; flex-wrap:wrap; padding:12px 16px; background:var(--surface2); border-radius:var(--radius-sm); border:1px solid var(--border-light); }
.legend-item { display:flex; align-items:center; gap:7px; font-size:0.72rem; color:var(--text-secondary); }
.legend-dot { width:10px; height:10px; border-radius:4px; }

/* Travelers */
.travelers-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(300px,1fr)); gap:16px; }
.traveler-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius);
  padding:24px; box-shadow:var(--glass-shine), var(--shadow); position:relative;
  transition:all .22s ease;
}
.traveler-card:hover { border-color:var(--glass-border-bright); transform:translateY(-2px); }
.traveler-avatar { width:44px; height:44px; border-radius:50%; background:linear-gradient(135deg, var(--amber), #f0c060); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:1rem; color:#0b0b14; margin-bottom:12px; }
.traveler-name { font-size:1.1rem; font-weight:700; margin-bottom:2px; }
.traveler-detail { font-size:0.82rem; color:var(--text-dim); margin-top:10px; display:flex; justify-content:space-between; align-items:center; }
.traveler-detail label { font-size:0.65rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:500; }
.traveler-detail .value { font-family:'SF Mono','Fira Code','Courier New',monospace; font-size:0.82rem; }
.passport-toggle { background:none; border:none; color:var(--teal); font-size:0.72rem; padding:2px 6px; font-weight:500; }
.passport-toggle:hover { color:var(--amber); }
.traveler-edit-btn { position:absolute; top:14px; right:14px; background:var(--surface2); border:1px solid var(--border); color:var(--text-dim); padding:5px 12px; border-radius:6px; font-size:0.72rem; font-weight:500; transition:all .2s; }
.traveler-edit-btn:hover { color:var(--amber); border-color:var(--amber); background:var(--amber-glow); }

/* Modal */
.modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); z-index:200; align-items:center; justify-content:center; padding:16px; }
.modal-overlay.show { display:flex; }
.modal {
  background: rgba(15,28,46,0.85);
  backdrop-filter: blur(32px) saturate(160%);
  -webkit-backdrop-filter: blur(32px) saturate(160%);
  border: 1px solid var(--glass-border-bright);
  border-radius: var(--radius-lg);
  padding:28px; width:90%; max-width:440px;
  box-shadow: var(--glass-shine), var(--shadow-lg);
  animation:slideUp .28s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes slideUp { from{opacity:0;transform:translateY(20px) scale(0.97)} to{opacity:1;transform:translateY(0) scale(1)} }
.modal h3 { margin-bottom:20px; color:var(--amber); font-size:1.05rem; }
.modal .form-group { margin-bottom:14px; }
.modal .form-group label { display:block; font-size:0.68rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); margin-bottom:5px; font-weight:500; }
.modal .form-group input { width:100%; padding:10px 12px; background:var(--surface3); border:1px solid var(--border-light); color:var(--text); border-radius:var(--radius-sm); font-size:0.88rem; transition:border-color .2s, box-shadow .2s; }
.modal .form-group input:focus { outline:none; border-color:var(--amber); box-shadow:0 0 0 3px var(--amber-glow); }
.modal-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:20px; }

/* Directions Modal */
.dir-modal { max-width:480px; padding:0; overflow:hidden; position:relative; }
.dir-close { position:absolute; top:12px; right:14px; background:none; border:none; color:var(--text-dim); font-size:1.4rem; z-index:5; line-height:1; padding:4px 8px; border-radius:6px; transition:all .2s; }
.dir-close:hover { color:var(--text); background:rgba(255,255,255,0.08); }
.dir-header { padding:24px 24px 16px; }
.dir-route { display:flex; align-items:center; gap:10px; margin-bottom:14px; }
.dir-loc { font-size:0.82rem; font-weight:600; color:var(--text); }
.dir-arrow { color:var(--amber); font-size:1rem; flex-shrink:0; }
.dir-badges { display:flex; gap:8px; flex-wrap:wrap; }
.dir-badge { display:inline-flex; align-items:center; gap:5px; padding:5px 12px; border-radius:20px; font-size:0.7rem; font-weight:600; }
.dir-badge.method { background:var(--amber-glow); color:var(--amber); border:1px solid rgba(232,184,75,0.22); }
.dir-badge.time { background:var(--teal-glow); color:var(--teal); border:1px solid rgba(56,178,172,0.2); }
.dir-badge.cost { background:rgba(72,187,120,0.1); color:#7ee8a8; border:1px solid rgba(72,187,120,0.2); }
.dir-steps { padding:0 24px 24px; }
.dir-steps ol { list-style:none; counter-reset:step; padding:0; margin:0; }
.dir-steps li { counter-increment:step; padding:12px 0 12px 40px; position:relative; font-size:0.8rem; color:var(--text-secondary); line-height:1.55; border-bottom:1px solid var(--border); }
.dir-steps li:last-child { border-bottom:none; }
.dir-steps li::before { content:counter(step); position:absolute; left:0; top:12px; width:26px; height:26px; background:var(--surface3); border:1px solid var(--border); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.68rem; font-weight:700; color:var(--amber); }
.slot.clickable { cursor:pointer; position:relative; }
.slot.clickable::after { content:"tap"; position:absolute; top:4px; right:6px; font-size:0.5rem; opacity:0; text-transform:uppercase; letter-spacing:0.5px; background:rgba(255,255,255,0.1); padding:1px 5px; border-radius:4px; color:var(--text-dim); }
.slot.clickable:hover::after { opacity:1; }
.food-section { padding:0 24px 20px; }
.food-section-title { font-size:0.7rem; text-transform:uppercase; letter-spacing:1.5px; color:var(--text-dim); font-weight:600; margin-bottom:10px; padding-top:16px; border-top:1px solid var(--border); }
.food-section-title:first-child { border-top:none; padding-top:0; }
.food-card { display:flex; justify-content:space-between; align-items:flex-start; padding:10px 14px; background:var(--surface3); border:1px solid var(--border-light); border-radius:var(--radius-sm); margin-bottom:6px; transition:border-color .2s; }
.food-card:hover { border-color:var(--border-light); }
.food-name { font-size:0.8rem; font-weight:600; color:var(--text); margin-bottom:2px; }
.food-desc { font-size:0.7rem; color:var(--text-dim); line-height:1.4; }
.food-price { font-size:0.68rem; font-weight:700; padding:3px 8px; border-radius:12px; white-space:nowrap; flex-shrink:0; margin-left:10px; }
.food-price.p1 { background:rgba(72,187,120,0.1); color:#7ee8a8; }
.food-price.p2 { background:rgba(246,173,85,0.12); color:#f6ad55; }
.food-price.p3 { background:rgba(245,101,101,0.1); color:var(--red); }
.food-note { font-size:0.72rem; color:var(--amber); background:var(--amber-glow); border:1px solid rgba(232,184,75,0.18); padding:10px 14px; border-radius:var(--radius-sm); margin:8px 0 0; line-height:1.45; }
.dir-modal { max-width:520px; max-height:85vh; overflow-y:auto; }

/* Buttons */
.btn { padding:9px 18px; border-radius:40px; border:none; font-size:0.82rem; font-weight:600; transition:all .2s cubic-bezier(0.34,1.56,0.64,1); }
.btn:hover { transform:translateY(-1px); }
.btn:active { transform:translateY(0) scale(0.97); }
.btn-primary {
  background: linear-gradient(135deg, var(--amber) 0%, #e8a820 100%);
  color:#0d0800;
  box-shadow: 0 2px 16px rgba(242,194,78,0.3), inset 0 1px 0 rgba(255,255,255,0.3);
}
.btn-primary:hover { box-shadow:0 4px 24px rgba(242,194,78,0.45), inset 0 1px 0 rgba(255,255,255,0.35); }
.btn-secondary {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  color:var(--text-secondary); border:1px solid var(--glass-border);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
}
.btn-secondary:hover { background:rgba(255,255,255,0.13); border-color:var(--glass-border-bright); }
.btn-teal {
  background: linear-gradient(135deg, var(--teal) 0%, #20c4dc 100%);
  color:#001820;
  box-shadow: 0 2px 16px rgba(56,232,255,0.25), inset 0 1px 0 rgba(255,255,255,0.3);
}
.btn-teal:hover { box-shadow:0 4px 24px rgba(56,232,255,0.4), inset 0 1px 0 rgba(255,255,255,0.35); }
.btn-danger {
  background: rgba(255,96,128,0.1);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  color:var(--red); border:1px solid rgba(255,96,128,0.2);
}
.btn-danger:hover { background:rgba(255,96,128,0.18); }
.btn-sm { padding:6px 14px; font-size:0.73rem; }
.btn-xs { padding:4px 10px; font-size:0.68rem; border-radius:20px; }

/* Expense Form */
.expense-form {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:24px; margin-bottom:24px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.expense-form h3 { color:var(--amber); margin-bottom:18px; font-size:1rem; }
.form-row { display:flex; gap:12px; margin-bottom:14px; flex-wrap:wrap; }
.form-group { display:flex; flex-direction:column; gap:5px; flex:1; min-width:140px; }
.form-group label { font-size:0.68rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); font-weight:500; }
.form-group input, .form-group select {
  padding:10px 14px;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.12);
  color:var(--text); border-radius:var(--radius-sm); font-size:0.88rem;
  transition:border-color .2s, box-shadow .2s;
}
.form-group input:focus, .form-group select:focus {
  outline:none; border-color:var(--amber);
  box-shadow: 0 0 0 3px var(--amber-glow), inset 0 1px 0 rgba(255,255,255,0.1);
}
.form-group select { cursor:pointer; }
.form-group select option { background:var(--surface2); color:var(--text); }
.checkbox-group { display:flex; flex-wrap:wrap; gap:8px; margin-top:4px; }
.checkbox-label {
  display:flex; align-items:center; gap:6px; font-size:0.82rem; cursor:pointer;
  padding:6px 14px; border-radius:40px;
  background: rgba(255,255,255,0.06); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,0.1); transition:all .2s; user-select:none;
}
.checkbox-label:hover { border-color:rgba(255,255,255,0.2); }
.checkbox-label:has(input:checked) { border-color:rgba(242,194,78,0.45); background:var(--amber-glass); color:var(--amber); }
.checkbox-label input { display:none; }
.checkbox-label .check-dot { width:8px; height:8px; border-radius:50%; border:2px solid var(--text-dim); transition:all .2s; }
.checkbox-label:has(input:checked) .check-dot { background:var(--amber); border-color:var(--amber); }
.split-type-toggle { display:flex; gap:6px; margin-bottom:14px; }
.split-type-btn {
  padding:7px 16px; border-radius:40px;
  background: rgba(255,255,255,0.06); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,0.1); color:var(--text-dim); font-size:0.78rem; font-weight:500; transition:all .2s;
}
.split-type-btn.active { border-color:rgba(242,194,78,0.45); color:var(--amber); background:var(--amber-glass); }
.custom-splits { display:flex; flex-wrap:wrap; gap:10px; margin-top:8px; }
.custom-split-input { display:flex; align-items:center; gap:6px; }
.custom-split-input label { font-size:0.78rem; min-width:55px; color:var(--text-secondary); }
.custom-split-input input { width:90px; padding:7px 10px; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:var(--radius-sm); font-size:0.82rem; }

/* Table */
.expense-table-wrap {
  overflow-x:auto; border-radius:var(--radius-lg);
  border:1px solid var(--glass-border);
  background: rgba(255,255,255,0.04);
  backdrop-filter: var(--glass-blur-sm); -webkit-backdrop-filter: var(--glass-blur-sm);
  box-shadow: var(--glass-shine), var(--shadow);
}
table { width:100%; border-collapse:collapse; font-size:0.82rem; }
th {
  text-align:left; padding:12px 14px;
  background: rgba(255,255,255,0.06);
  color:var(--text-secondary); font-size:0.63rem; text-transform:uppercase;
  letter-spacing:1.2px; font-weight:700; border-bottom:1px solid var(--glass-border);
}
th:first-child { border-radius:var(--radius-lg) 0 0 0; }
th:last-child { border-radius:0 var(--radius-lg) 0 0; }
td { padding:12px 14px; border-bottom:1px solid rgba(255,255,255,0.05); }
tr:nth-child(even) td { background:rgba(255,255,255,0.025); }
tr:hover td { background:rgba(242,194,78,0.04); }
.amount-cell { font-family:'SF Mono','Fira Code','Courier New',monospace; font-weight:600; font-size:0.82rem; }
.cat-icon { margin-right:4px; }
.status-badge { display:inline-block; padding:3px 10px; border-radius:12px; font-size:0.65rem; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; cursor:pointer; }
.status-paid { background:rgba(72,187,120,0.12); color:var(--green); }
.status-pending { background:rgba(237,137,54,0.12); color:var(--orange); }
.actions-cell { display:flex; gap:4px; }

/* Summary Cards */
.summary-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(190px,1fr)); gap:14px; margin-bottom:24px; }
.summary-card {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg); padding:18px; text-align:center;
  box-shadow: var(--glass-shine), var(--shadow); position:relative; overflow:hidden;
}
.summary-card .accent-bar { position:absolute; top:0; left:0; right:0; height:3px; }
.summary-card .accent-bar.positive { background:linear-gradient(90deg, var(--teal), #5ed4ce); }
.summary-card .accent-bar.negative { background:linear-gradient(90deg, var(--red), #fc8181); }
.summary-card .accent-bar.zero { background:var(--border); }
.summary-avatar { width:36px; height:36px; border-radius:50%; background:var(--surface2); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.82rem; color:var(--amber); margin:0 auto 10px; }
.summary-name { font-weight:600; margin-bottom:10px; font-size:0.88rem; }
.summary-row { display:flex; justify-content:space-between; font-size:0.78rem; margin-top:5px; }
.summary-row .label { color:var(--text-dim); }
.summary-net { font-size:1.1rem; font-weight:700; margin-top:8px; padding-top:8px; border-top:1px solid var(--border); }
.net-positive { color:var(--teal); }
.net-negative { color:var(--red); }
.net-zero { color:var(--text-dim); }

/* Who Owes Whom — Person tabs */
.wow-section {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:24px; margin-top:24px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.wow-section h3 { color:var(--amber); margin-bottom:16px; font-size:1rem; display:flex; align-items:center; gap:8px; }
.person-tabs { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:18px; }
.person-tab {
  padding:8px 18px; border-radius:40px;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  border:1px solid rgba(255,255,255,0.1); color:var(--text-dim);
  font-size:0.82rem; font-weight:600; transition:all .2s; position:relative;
}
.person-tab:hover { border-color:rgba(255,255,255,0.2); color:var(--text-secondary); }
.person-tab.active { border-color:rgba(242,194,78,0.5); color:var(--amber); background:var(--amber-glass); box-shadow:0 0 16px rgba(242,194,78,0.1); }
.person-tab .tab-badge { position:absolute; top:-4px; right:-4px; width:16px; height:16px; border-radius:50%; font-size:0.55rem; display:flex; align-items:center; justify-content:center; font-weight:700; }
.person-tab .tab-badge.has-debt { background:var(--red); color:#fff; }
.person-tab .tab-badge.settled { background:var(--green); color:#fff; }

.person-detail { display:none; animation:fadeIn .25s ease; }
.person-detail.active { display:block; }
.person-summary-bar {
  display:flex; gap:16px; margin-bottom:16px; padding:14px 18px;
  background: rgba(255,255,255,0.06); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border:1px solid var(--glass-border); border-radius:var(--radius);
  flex-wrap:wrap; box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
}
.psb-item { text-align:center; flex:1; min-width:100px; }
.psb-label { font-size:0.62rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); margin-bottom:2px; }
.psb-value { font-size:1rem; font-weight:700; font-family:'SF Mono','Fira Code','Courier New',monospace; }

.debt-item {
  display:flex; align-items:center; gap:12px; padding:14px 16px;
  background: rgba(255,255,255,0.05); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
  border:1px solid var(--glass-border); border-radius:var(--radius);
  margin-bottom:8px; transition:all .2s;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
}
.debt-item:hover { border-color:var(--border-light); }
.debt-item.is-paid { opacity:0.45; }
.debt-icon { font-size:1.1rem; flex-shrink:0; }
.debt-info { flex:1; min-width:0; }
.debt-desc { font-weight:600; font-size:0.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.debt-sub { font-size:0.72rem; color:var(--text-dim); margin-top:2px; }
.debt-amount { font-family:'SF Mono','Fira Code','Courier New',monospace; font-weight:700; font-size:0.92rem; color:var(--amber); text-align:right; min-width:100px; flex-shrink:0; }
.debt-amount.paid { color:var(--green); text-decoration:line-through; opacity:0.6; }
.debt-actions { display:flex; gap:6px; align-items:center; flex-shrink:0; }
.paid-check { color:var(--green); font-size:1.1rem; }

.no-debts { text-align:center; padding:20px; color:var(--text-dim); font-size:0.88rem; }

/* Settings */
.settings-section {
  background: var(--glass);
  backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius:var(--radius-lg);
  padding:24px; margin-bottom:16px;
  box-shadow: var(--glass-shine), var(--shadow);
}
.settings-section h3 { color:var(--amber); margin-bottom:14px; font-size:1rem; }
.settings-row { display:flex; align-items:center; gap:12px; margin-bottom:14px; flex-wrap:wrap; }
.settings-row label { font-size:0.85rem; min-width:80px; color:var(--text-secondary); }
.settings-row input { padding:9px 12px; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:var(--radius-sm); width:100px; }

/* Summary card clickable */
.summary-card { cursor:pointer; transition:border-color .2s, transform .2s; }
.summary-card:hover { border-color:var(--border-light); transform:translateY(-2px); }

/* Payer Modal */
#payerModal .modal {
  max-width:560px !important;
  max-height:92vh !important;
  border-radius:38px !important;
  background: radial-gradient(120% 110% at 12% 0%, rgba(255,204,51,0.08), rgba(17,21,31,0.96) 38%, rgba(10,12,19,0.98) 100%);
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:0 34px 90px rgba(0,0,0,0.75), inset 0 1px 0 rgba(255,255,255,0.08);
}
.payer-hero {
  padding:22px 20px 12px;
}
.payer-head {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:14px;
}
.payer-identity {
  display:flex;
  align-items:center;
  gap:14px;
  min-width:0;
}
.payer-avatar-lg {
  width:64px; height:64px; border-radius:18px;
  background:linear-gradient(145deg, #ffc21d, #d79d0f);
  border:1px solid rgba(255,255,255,0.15);
  box-shadow:0 16px 30px rgba(242,194,78,0.24);
  color:#1b1305;
  display:flex; align-items:center; justify-content:center;
  font-size:1.55rem; font-weight:900;
  flex-shrink:0;
  position:relative;
}
.payer-avatar-lg::after {
  content:"";
  position:absolute;
  width:14px; height:14px;
  border-radius:50%;
  right:-5px; bottom:-5px;
  background:#16d56c;
  border:2px solid #0c1019;
  box-shadow:0 0 0 3px rgba(22,213,108,0.16);
}
.payer-hero-name {
  font-size:1.55rem;
  line-height:1.1;
  letter-spacing:-0.02em;
  font-weight:800;
  color:#f5f7ff;
  margin:0;
}
.payer-hero-sub {
  margin-top:8px;
  width:max-content;
  padding:5px 10px;
  border-radius:999px;
  border:1px solid rgba(255,209,85,0.24);
  background:rgba(255,209,85,0.08);
  font-size:0.62rem;
  color:#f6c63c;
  letter-spacing:0.14em;
  text-transform:uppercase;
  font-weight:800;
}
.payer-close-btn {
  width:44px;
  height:44px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,0.11);
  background:rgba(255,255,255,0.05);
  color:rgba(255,255,255,0.62);
  font-size:1.55rem;
  line-height:1;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  cursor:pointer;
}
.payer-stats {
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:10px;
}
.payer-stat {
  padding:12px 10px 10px;
  text-align:center;
  border-radius:18px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.09);
}
.payer-stat-label {
  font-size:0.55rem;
  text-transform:uppercase;
  letter-spacing:0.18em;
  color:rgba(255,255,255,0.4);
  font-weight:700;
  margin-bottom:6px;
}
.payer-stat-value {
  font-size:1.04rem;
  font-weight:800;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  line-height:1.05;
}
.payer-stat-currency {
  margin-top:5px;
  font-size:0.56rem;
  font-weight:700;
  letter-spacing:0.15em;
  text-transform:uppercase;
  color:rgba(255,255,255,0.32);
}
.payer-body { padding:12px 14px 18px; }
.payer-section-head {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 6px;
  margin:6px 0 10px;
}
.payer-section-title {
  font-size:0.72rem;
  text-transform:uppercase;
  letter-spacing:0.2em;
  color:rgba(255,255,255,0.5);
  font-weight:800;
}
.payer-section-count {
  font-size:0.68rem;
  color:rgba(255,255,255,0.35);
}
.payer-exp-block {
  margin-bottom:14px;
  background:linear-gradient(175deg, rgba(36,41,51,0.82), rgba(23,29,39,0.88));
  border:1px solid rgba(255,255,255,0.08);
  border-radius:26px;
  overflow:hidden;
  box-shadow:0 12px 34px rgba(0,0,0,0.35);
}
.payer-exp-header {
  padding:14px 14px 12px;
  background:rgba(255,255,255,0.015);
  border-bottom:1px solid rgba(255,255,255,0.07);
  display:flex;
  align-items:center;
  gap:10px;
}
.payer-exp-icon {
  width:38px; height:38px; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  background:linear-gradient(145deg, rgba(255,192,18,0.3), rgba(214,155,20,0.12));
  border:1px solid rgba(255,211,97,0.28);
}
.payer-exp-title { font-size:1.15rem; font-weight:800; color:#f4f6ff; line-height:1.1; flex:1; }
.payer-exp-sub { font-size:0.66rem; color:rgba(255,255,255,0.36); margin-top:4px; }
.payer-exp-amount { font-size:1.16rem; font-weight:900; font-family:'SF Mono','Fira Code','Courier New',monospace; color:#f6c63c; }
.payer-exp-currency { font-size:0.6rem; color:rgba(255,255,255,0.28); text-align:right; margin-top:4px; letter-spacing:0.09em; text-transform:uppercase; }
.payer-self-share {
  margin:10px 12px 8px;
  border-radius:11px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.07);
  padding:8px 11px;
  display:flex; justify-content:space-between; align-items:center;
}
.payer-self-share .label { font-size:0.66rem; color:rgba(255,255,255,0.5); font-weight:700; }
.payer-self-share .value { font-size:0.84rem; font-family:'SF Mono','Fira Code','Courier New',monospace; color:rgba(255,255,255,0.78); font-weight:700; }
.payer-settle-row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px 11px;
  border-top:1px solid rgba(255,255,255,0.06);
  font-size:0.8rem;
}
.payer-settle-left { display:flex; align-items:center; gap:9px; min-width:0; }
.payer-settle-avatar {
  width:32px; height:32px; border-radius:50%;
  background:rgba(86,116,165,0.35);
  border:1px solid rgba(163,188,228,0.25);
  color:#cde0ff; font-size:0.76rem; font-weight:800;
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0;
}
.payer-settle-who { color:rgba(255,255,255,0.84); font-weight:700; font-size:0.92rem; }
.payer-settle-sub { color:rgba(255,255,255,0.3); font-size:0.62rem; margin-top:2px; }
.payer-settle-amount { font-family:'SF Mono','Fira Code','Courier New',monospace; font-weight:700; color:rgba(255,255,255,0.7); font-size:0.92rem; }
.payer-settle-status { font-size:0.62rem; font-weight:800; padding:5px 12px; border-radius:999px; margin-left:10px; letter-spacing:0.08em; }
.payer-settle-status.paid { background:rgba(22,213,108,0.18); color:#31e47d; border:1px solid rgba(22,213,108,0.34); }
.payer-settle-status.unpaid { background:rgba(255,115,92,0.16); color:#ff8c73; border:1px solid rgba(255,115,92,0.34); }
.payer-exp-footer {
  padding:12px 12px;
  background:linear-gradient(90deg, rgba(22,213,108,0.13), rgba(22,213,108,0.05));
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.payer-exp-footer .footer-label {
  color:#31e47d;
  font-size:0.74rem;
  font-weight:800;
  letter-spacing:0.1em;
  text-transform:uppercase;
}
.payer-exp-footer .footer-val {
  font-weight:700;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  color:rgba(255,255,255,0.5);
  font-size:0.8rem;
}
.payer-exp-footer.warn { background:linear-gradient(90deg, rgba(232,184,75,0.14), rgba(232,184,75,0.06)); }
.payer-exp-footer.warn .footer-label { color:var(--amber); }
.payer-exp-footer.none { background:linear-gradient(90deg, rgba(255,96,128,0.15), rgba(255,96,128,0.06)); }
.payer-exp-footer.none .footer-label { color:var(--red); }
.payer-cta-wrap { margin-top:12px; }
.payer-cta-btn {
  width:100%;
  border:none;
  border-radius:999px;
  padding:15px 18px;
  color:#160e05;
  font-weight:900;
  letter-spacing:0.16em;
  text-transform:uppercase;
  font-size:0.9rem;
  background:linear-gradient(145deg, #f5b312, #d98606);
  box-shadow:0 16px 40px rgba(245,179,18,0.36), inset 0 1px 0 rgba(255,255,255,0.3);
}

/* Total Group Expenses row */
.expense-total-row td { padding:12px 14px; border-top:2px solid var(--border); background:rgba(232,184,75,0.05); font-weight:700; }
.expense-total-label { color:var(--amber); font-size:0.82rem; }
.expense-total-value { font-family:'SF Mono','Fira Code','Courier New',monospace; font-size:0.9rem; color:var(--amber); }

/* Group Section Redesign */
#tab-expenses .section-title {
  border-bottom:none;
  padding-bottom:0;
  margin-bottom:12px;
}
#tab-expenses .group-kicker {
  margin-top:14px;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#tab-expenses .group-kicker.group-kicker-first { margin-top:22px; }
#tab-expenses .group-kicker-left {
  display:flex;
  align-items:center;
  gap:8px;
  font-size:0.66rem;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:0.17em;
  color:rgba(255,255,255,0.46);
}
#tab-expenses .group-kicker-dot {
  width:6px;
  height:6px;
  border-radius:50%;
  background:var(--amber);
  box-shadow:0 0 8px rgba(242,194,78,0.45);
}
#tab-expenses .group-kicker-link {
  font-size:0.64rem;
  font-weight:800;
  letter-spacing:0.11em;
  text-transform:uppercase;
  color:var(--amber);
  cursor:pointer;
}
.group-add-expense-btn {
  width:100%;
  border:none;
  border-radius:22px;
  padding:16px 18px;
  font-size:0.95rem;
  font-weight:800;
  letter-spacing:0.02em;
  color:#1b1406;
  background:linear-gradient(145deg, #f9d857 0%, #f3b528 50%, #eda800 100%);
  box-shadow: 0 0 0 1px rgba(242,194,78,0.5), 0 16px 48px rgba(242,194,78,0.35), inset 0 1px 0 rgba(255,255,255,0.4);
  transition:transform .18s ease, box-shadow .2s ease;
}
.group-add-expense-btn:active { transform:scale(0.98); }
.group-add-expense-btn:hover { box-shadow: 0 0 0 1px rgba(242,194,78,0.6), 0 20px 56px rgba(242,194,78,0.42), inset 0 1px 0 rgba(255,255,255,0.4); }

#tab-expenses .summary-grid {
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:2px 2px 10px;
  scrollbar-width:none;
}
#tab-expenses .summary-grid::-webkit-scrollbar { display:none; }
#tab-expenses .summary-card {
  min-width:172px;
  max-width:172px;
  text-align:left;
  border-radius:26px;
  padding:16px 14px 15px;
  background:linear-gradient(158deg, rgba(26,30,40,0.88), rgba(17,22,32,0.9));
  border:1px solid rgba(255,255,255,0.1);
  box-shadow:0 20px 52px rgba(0,0,0,0.5);
}
#tab-expenses .summary-card .accent-bar { display:none; }
#tab-expenses .summary-card .summary-avatar {
  margin:0 0 10px 0;
  width:34px;
  height:34px;
  font-size:0.66rem;
  border-color:rgba(255,255,255,0.18);
  background:rgba(255,255,255,0.06);
}
#tab-expenses .summary-card .summary-name { font-size:1rem; margin-bottom:12px; font-weight:700; }
#tab-expenses .summary-card .summary-row {
  display:block;
  margin-top:0;
}
#tab-expenses .summary-card .summary-row .label {
  display:block;
  color:rgba(255,255,255,0.42);
  font-size:0.56rem;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.09em;
  margin-bottom:4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
#tab-expenses .summary-card .summary-row .value {
  display:block;
  font-size:1rem;
  font-weight:800;
  letter-spacing:0.01em;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  color:rgba(255,255,255,0.95);
}
#tab-expenses .summary-card .summary-row.summary-highlight {
  margin-top:10px;
  padding-top:10px;
  border-top:1px solid rgba(255,255,255,0.07);
}
#tab-expenses .summary-card[data-person="eduard"] { box-shadow:var(--glass-shine), var(--shadow), 0 0 28px rgba(232,184,75,0.16); }
#tab-expenses .summary-card[data-person="anwell"] { box-shadow:var(--glass-shine), var(--shadow), 0 0 28px rgba(69,227,255,0.14); }
#tab-expenses .summary-card[data-person="justin"] { box-shadow:var(--glass-shine), var(--shadow), 0 0 28px rgba(192,132,252,0.14); }

.group-expense-list {
  display:grid;
  gap:10px;
  margin-bottom:8px;
}
.expense-overflow {
  display:grid;
  gap:10px;
  margin-top:10px;
}
[id^="peHistory_"] {
  display:grid;
  gap:10px;
  margin-top:0;
}
.group-expense-card {
  border-radius:20px;
  padding:13px 14px;
  background: linear-gradient(145deg, rgba(30,35,46,0.88), rgba(20,26,36,0.9));
  backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
  border:1px solid rgba(255,255,255,0.08);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  box-shadow:0 16px 40px rgba(0,0,0,0.45);
}
.group-expense-main { display:flex; align-items:center; gap:12px; min-width:0; }
.group-expense-icon {
  width:44px; height:44px; border-radius:14px; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  background: linear-gradient(145deg, rgba(246,201,73,0.28), rgba(241,169,44,0.16));
  border:1px solid rgba(242,194,78,0.32);
  color:var(--amber);
}
.group-expense-title {
  font-size:0.98rem;
  font-weight:700;
  color:var(--text);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.group-expense-sub {
  margin-top:3px;
  font-size:0.68rem;
  color:var(--text-dim);
}
.group-expense-right { text-align:right; flex-shrink:0; }
.group-expense-amt {
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  font-size:1.02rem;
  font-weight:800;
}
#tab-expenses .group-expense-card .status-badge {
  margin-top:5px;
  padding:2px 8px;
  border-radius:999px;
  font-size:0.54rem;
  letter-spacing:0.14em;
  font-weight:800;
}
.group-expense-actions { display:flex; gap:6px; justify-content:flex-end; margin-top:6px; opacity:.85; }
.group-total-spend {
  margin-top:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 2px;
}
.group-total-label {
  font-size:0.62rem;
  text-transform:uppercase;
  letter-spacing:0.18em;
  color:var(--text-dim);
  font-weight:800;
}
.group-total-value {
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  color:var(--amber);
  font-size:2.05rem;
  font-weight:900;
}

.group-expense-modal {
  max-width:520px;
  max-height:92vh;
  padding:0;
  overflow-y:auto;
  overflow-x:hidden;
  border-radius:34px;
  background:
    radial-gradient(110% 55% at 15% 0%, rgba(242,194,78,0.13), transparent 60%),
    radial-gradient(100% 50% at 85% 100%, rgba(242,194,78,0.08), transparent 55%),
    linear-gradient(160deg, rgba(14,18,28,0.97), rgba(11,15,24,0.96));
  border:1px solid rgba(255,255,255,0.14);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 30px 90px rgba(0,0,0,0.75);
}
.group-expense-shell {
  padding:22px 18px 18px;
}
.group-expense-shell > * { position:relative; z-index:1; }
.group-expense-head {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:16px;
}
.group-expense-close {
  width:38px; height:38px; border-radius:50%;
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(255,255,255,0.05);
  color:rgba(255,255,255,0.7);
  display:flex; align-items:center; justify-content:center;
  font-size:1.2rem;
}
.group-expense-head h3 {
  color:#fff;
  font-size:1.9rem;
  margin:0;
}
.group-expense-form .form-group label {
  font-size:0.62rem;
  letter-spacing:0.2em;
  color:rgba(255,255,255,0.42);
}
.group-expense-form .form-row {
  gap:10px;
  margin-bottom:10px;
}
.group-expense-form .form-group input,
.group-expense-form .form-group select {
  border-radius:16px;
  padding:12px 14px;
  background:rgba(255,255,255,0.09);
  border:1px solid rgba(255,255,255,0.16);
  color:rgba(255,255,255,0.95);
  font-weight:600;
}
.group-expense-form .form-group input:focus,
.group-expense-form .form-group select:focus {
  border-color:rgba(242,194,78,0.55);
}
.group-expense-form .form-group select {
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  background-image:
    linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.82) 50%),
    linear-gradient(135deg, rgba(255,255,255,0.82) 50%, transparent 50%);
  background-position:
    calc(100% - 18px) calc(50% - 2px),
    calc(100% - 12px) calc(50% - 2px);
  background-size:6px 6px, 6px 6px;
  background-repeat:no-repeat;
  padding-right:34px;
}
.group-expense-form .form-group select option {
  background:#121722;
  color:#f4f6ff;
  font-weight:600;
}
.group-expense-form #expAmount {
  font-size:2rem;
  font-weight:800;
  color:var(--amber);
}
.group-expense-form .split-type-toggle {
  padding:2px;
  border-radius:999px;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.12);
  width:max-content;
}
.group-expense-form .split-type-btn {
  border-radius:999px;
  font-size:0.62rem;
  letter-spacing:0.08em;
  text-transform:uppercase;
  font-weight:800;
  padding:7px 14px;
}
.group-expense-form .split-type-btn.active {
  background:#f5c329;
  color:#201508;
  border-color:transparent;
}
.group-expense-form .checkbox-group {
  display:flex;
  flex-wrap:nowrap;
  overflow-x:auto;
  gap:10px;
  padding:2px 0 4px;
  scrollbar-width:none;
}
.group-expense-form .checkbox-group::-webkit-scrollbar { display:none; }
.group-expense-form .checkbox-label {
  flex-shrink:0;
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
  border:none;
  background:transparent;
  padding:0;
  color:var(--text-dim);
}
.group-expense-form .checkbox-label .check-dot {
  width:52px;
  height:52px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,0.22);
  background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all .18s ease;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.14);
}
.group-expense-form .checkbox-label .check-dot::before {
  content:attr(data-initials);
  font-size:0.72rem;
  font-weight:800;
  color:rgba(255,255,255,0.52);
}
.group-expense-form .checkbox-label:has(input:checked) .check-dot {
  background: rgba(242,194,78,0.18);
  border-color: rgba(242,194,78,0.85);
  box-shadow: 0 0 0 3px rgba(242,194,78,0.12), inset 0 1px 0 rgba(255,255,255,0.2);
}
.group-expense-form .checkbox-label:has(input:checked) .check-dot::before { color:#ffe9b0; text-shadow:0 0 6px rgba(242,194,78,0.28); }
.group-expense-form .checkbox-label:has(input:checked) .cb-name { color:rgba(255,255,255,0.42); }
.group-expense-form .checkbox-label .cb-name {
  font-size:0.68rem;
  font-weight:700;
  letter-spacing:0.01em;
}
.group-expense-save {
  width:100%;
  margin-top:16px;
  padding:15px 16px;
  border-radius:999px;
  border:none;
  font-size:0.95rem;
  font-weight:900;
  letter-spacing:0.13em;
  text-transform:uppercase;
  color:#1f1407;
  background:linear-gradient(180deg, #f8ce2c 0%, #f2c214 100%);
  box-shadow: 0 10px 26px rgba(242,194,78,0.28), inset 0 1px 0 rgba(255,255,255,0.35);
}
.group-expense-save:hover { box-shadow: 0 12px 28px rgba(242,194,78,0.33), inset 0 1px 0 rgba(255,255,255,0.35); }
.group-expense-save:active { transform:scale(0.985); box-shadow: 0 6px 16px rgba(242,194,78,0.26), inset 0 1px 0 rgba(255,255,255,0.32); }
.group-table-desktop { display:none; }

#tab-expenses .wow-section {
  margin-top:16px;
  border-radius:30px;
  padding:18px 14px 14px;
  background:linear-gradient(150deg, rgba(255,255,255,0.07), rgba(255,255,255,0.025));
}
#tab-expenses .wow-section h3 {
  margin-bottom:2px;
  font-size:0.72rem;
  letter-spacing:0.18em;
  text-transform:uppercase;
  color:rgba(255,255,255,0.45);
}
#tab-expenses .wow-section h3::before {
  content:"\25A3";
  color:var(--amber);
  margin-right:8px;
}
#tab-expenses .wow-section p { display:none; }

#tab-expenses .person-tabs {
  display:flex;
  justify-content:space-between;
  gap:6px;
  margin:12px 0 14px;
}
#tab-expenses .person-tab {
  flex:1;
  min-width:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  padding:0;
  border:none;
  border-radius:0;
  background:transparent;
  backdrop-filter:none;
  -webkit-backdrop-filter:none;
  box-shadow:none;
  color:rgba(255,255,255,0.5);
}
#tab-expenses .person-tab .tab-badge {
  top:36px;
  right:18%;
}
#tab-expenses .person-avatar {
  width:52px; height:52px;
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  border:2px solid rgba(255,255,255,0.2);
  background:rgba(255,255,255,0.08);
  color:rgba(255,255,255,0.8);
  font-size:1.05rem;
  font-weight:800;
  letter-spacing:0.02em;
  transition:all .2s ease;
}
#tab-expenses .person-name {
  font-size:0.72rem;
  font-weight:700;
}
#tab-expenses .person-tab.active {
  color:var(--amber);
  background:transparent;
  box-shadow:none;
}
#tab-expenses .person-tab.active .person-avatar {
  border-color:rgba(242,194,78,0.85);
  box-shadow:0 0 0 3px rgba(242,194,78,0.18);
  color:#ffe6a4;
}

#tab-expenses .person-summary-bar {
  border-radius:16px;
  padding:12px 8px;
  gap:0;
  margin-bottom:10px;
}
#tab-expenses .psb-item { min-width:auto; }
#tab-expenses .psb-label { font-size:0.52rem; }
#tab-expenses .psb-value { font-size:0.92rem; }

#tab-expenses .debt-item {
  border-radius:14px;
  padding:10px 12px;
  background:rgba(255,255,255,0.055);
}
#tab-expenses .debt-desc { font-size:0.76rem; }
#tab-expenses .debt-sub { font-size:0.62rem; }
#tab-expenses .debt-amount { font-size:0.84rem; min-width:74px; }
#tab-expenses .debt-actions .btn.btn-teal.btn-sm {
  padding:6px 9px;
  font-size:0.62rem;
}

/* Personal Expenses */
.pe-person-tabs { display:flex; gap:8px; flex-wrap:nowrap; overflow-x:auto; margin-bottom:16px; padding-bottom:4px; scrollbar-width:none; }
.pe-person-tabs::-webkit-scrollbar { display:none; }
.pe-person-tab {
  white-space:nowrap;
  padding:9px 18px; border-radius:999px;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  border:1px solid rgba(255,255,255,0.1); color:var(--text-dim);
  font-size:0.86rem; font-weight:600; transition:all .22s; cursor:pointer;
}
.pe-person-tab:hover { border-color:rgba(255,255,255,0.2); color:var(--text-secondary); }
/* Per-person active colors */
.pe-person-tab.active[data-pe-tab="eduard"],
.pe-person-tab.active[data-pe-tab="anwell"],
.pe-person-tab.active[data-pe-tab="justin"],
.pe-person-tab.active[data-pe-tab="kerr"],
.pe-person-tab.active[data-pe-tab="august"],
.pe-person-tab.active { border-color:rgba(242,194,78,0.62); color:var(--amber); background:rgba(242,194,78,0.14); box-shadow:0 0 0 1px rgba(242,194,78,0.2) inset; }

.pe-panel { display:none; animation:fadeIn .25s ease; }
.pe-panel.active { display:block; }

.pe-overview-card {
  border-radius:30px;
  padding:22px 18px 18px;
  background:linear-gradient(145deg, rgba(24,21,13,0.94), rgba(14,14,17,0.94));
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.08), 0 24px 64px rgba(0,0,0,0.5);
  position:relative;
  overflow:hidden;
  margin-bottom:22px;
}
.pe-overview-card::before {
  content:"";
  position:absolute;
  inset:auto -80px -110px auto;
  width:220px;
  height:220px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(242,194,78,0.2), rgba(242,194,78,0) 68%);
  pointer-events:none;
}
.pe-kicker {
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:12px;
  font-size:0.66rem;
  text-transform:uppercase;
  letter-spacing:0.18em;
  font-weight:800;
  color:rgba(255,255,255,0.55);
}
.pe-kicker .dot {
  width:7px; height:7px; border-radius:50%;
  background:var(--amber);
  box-shadow:0 0 10px rgba(242,194,78,0.5);
}
.pe-total-php {
  font-size:3.05rem;
  line-height:1;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  font-weight:900;
  color:var(--amber);
  letter-spacing:-0.02em;
}
.pe-total-thb {
  margin-top:6px;
  color:rgba(255,255,255,0.58);
  font-size:1.15rem;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
}
.pe-overview-stats {
  margin-top:16px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.pe-over-stat {
  border-radius:16px;
  padding:11px 12px;
  background:rgba(5,8,16,0.54);
  border:1px solid rgba(255,255,255,0.08);
}
.pe-over-stat .label {
  font-size:0.58rem;
  text-transform:uppercase;
  letter-spacing:0.16em;
  color:rgba(255,255,255,0.4);
  font-weight:700;
}
.pe-over-stat .val {
  margin-top:8px;
  font-size:1.6rem;
  line-height:1;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  font-weight:800;
  color:#f4f7ff;
}
.pe-over-stat .val.small {
  font-size:1.2rem;
  font-family:'Inter',sans-serif;
}
.pe-list-head {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.pe-list-title {
  font-size:1.04rem;
  text-transform:uppercase;
  letter-spacing:0.12em;
  color:rgba(255,255,255,0.55);
  font-weight:800;
}
.pe-list-chip {
  border-radius:999px;
  padding:5px 11px;
  font-size:0.66rem;
  line-height:1;
  color:var(--amber);
  border:1px solid rgba(242,194,78,0.28);
  background:rgba(242,194,78,0.1);
  font-weight:700;
  letter-spacing:0.08em;
  text-transform:uppercase;
  display:inline-flex;
  align-items:center;
}
.pe-expense-stack { display:grid; gap:10px; }
.pe-expense-card {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  border-radius:22px;
  padding:14px;
  background:linear-gradient(150deg, rgba(30,26,18,0.9), rgba(14,16,22,0.93));
  border:1px solid rgba(255,255,255,0.09);
  box-shadow:0 16px 38px rgba(0,0,0,0.42);
}
.pe-expense-left { display:flex; align-items:center; gap:12px; min-width:0; }
.pe-expense-icon {
  width:46px; height:46px; border-radius:14px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.35rem;
  background:rgba(52,39,21,0.78);
  border:1px solid rgba(242,194,78,0.24);
  flex-shrink:0;
}
.pe-expense-name {
  font-size:1.03rem;
  font-weight:700;
  color:#f3f7ff;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.pe-expense-meta {
  margin-top:3px;
  color:rgba(255,255,255,0.38);
  font-size:0.76rem;
}
.pe-expense-right { text-align:right; flex-shrink:0; }
.pe-expense-main {
  font-size:1.65rem;
  line-height:0.95;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  font-weight:900;
  color:var(--amber);
}
.pe-expense-sub {
  margin-top:5px;
  color:rgba(255,255,255,0.38);
  font-size:0.72rem;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
}
.pe-expense-actions { margin-top:7px; display:flex; gap:6px; justify-content:flex-end; }
.pe-empty {
  text-align:center;
  padding:24px 14px;
  color:rgba(255,255,255,0.5);
  border-radius:18px;
  border:1px dashed rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.03);
  font-size:0.92rem;
}
.pe-history-btn {
  width:100%;
  margin-top:12px;
  padding:14px;
  border-radius:18px;
  border:1px dashed rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.02);
  color:rgba(255,255,255,0.45);
  font-size:0.88rem;
  letter-spacing:0.04em;
  font-weight:600;
}
.pe-add-fab {
  position:sticky;
  margin-top:16px;
  margin-left:auto;
  bottom:88px;
  width:66px;
  height:66px;
  border-radius:20px;
  border:none;
  background:linear-gradient(165deg, #f8ce2c, #efb70f);
  color:#231807;
  font-size:2.3rem;
  line-height:1;
  box-shadow:0 0 0 1px rgba(242,194,78,0.45), 0 16px 38px rgba(242,194,78,0.35);
}

/* Personal Add Modal */
.pe-modal {
  max-width:500px;
  max-height:92vh;
  padding:0;
  border-radius:34px;
  overflow-y:auto;
  background:linear-gradient(160deg, rgba(10,11,16,0.97), rgba(8,11,20,0.95));
  border:1px solid rgba(255,255,255,0.12);
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.08), 0 28px 88px rgba(0,0,0,0.75);
}
.pe-modal-shell { padding:18px 14px 14px; position:relative; }
.pe-modal-head {
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:12px;
}
.pe-modal-back {
  width:38px; height:38px; border-radius:50%;
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(255,255,255,0.05);
  color:rgba(255,255,255,0.7);
  font-size:1rem;
  display:flex; align-items:center; justify-content:center;
}
.pe-modal-title {
  margin:0;
  font-size:1.06rem;
  font-weight:900;
  letter-spacing:0.01em;
  color:#fff;
  text-transform:uppercase;
  font-style:italic;
}
.pe-modal-card {
  border-radius:28px;
  padding:12px 12px 14px;
  border:1px solid rgba(255,255,255,0.1);
  background:linear-gradient(165deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
}
.pe-cur-switch {
  display:flex;
  gap:6px;
  padding:4px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(0,0,0,0.42);
}
.pe-cur-btn {
  flex:1;
  border:none;
  border-radius:999px;
  padding:9px 10px;
  font-size:0.7rem;
  letter-spacing:0.11em;
  text-transform:uppercase;
  font-weight:800;
  color:rgba(255,255,255,0.5);
  background:transparent;
}
.pe-cur-btn.active {
  background:linear-gradient(180deg, #f8d22b, #f2bf14);
  color:#231806;
  box-shadow:0 8px 20px rgba(242,194,78,0.27), inset 0 1px 0 rgba(255,255,255,0.32);
}
.pe-amount-wrap {
  margin:16px 0 14px;
  text-align:center;
}
.pe-amount-label {
  font-size:0.56rem;
  letter-spacing:0.35em;
  text-transform:uppercase;
  color:rgba(255,214,111,0.9);
  font-weight:800;
}
.pe-amount-input-row {
  margin-top:12px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  gap:8px;
}
.pe-amount-sym {
  font-size:2rem;
  line-height:1;
  color:rgba(242,194,78,0.6);
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  font-weight:700;
}
.pe-amount-input {
  width:100%;
  max-width:250px;
  background:transparent;
  border:none;
  border-bottom:1px solid rgba(242,194,78,0.32);
  color:#fff;
  text-align:center;
  font-size:4rem;
  line-height:1;
  font-weight:900;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  padding:0 4px 6px;
}
.pe-amount-input::placeholder { color:rgba(255,255,255,0.13); }
.pe-amount-input:focus { outline:none; border-bottom-color:rgba(242,194,78,0.7); }
.pe-form-grid { display:grid; gap:10px; }
.pe-input-group label {
  display:flex; align-items:center; gap:8px;
  margin:0 0 5px 2px;
  font-size:0.58rem;
  letter-spacing:0.17em;
  text-transform:uppercase;
  color:rgba(255,255,255,0.45);
  font-weight:800;
}
.pe-input-group label .ico { color:var(--amber); }
.pe-input-group input, .pe-input-group select, .pe-input-group textarea {
  width:100%;
  border-radius:18px;
  border:1px solid rgba(255,255,255,0.1);
  background:rgba(0,0,0,0.42);
  color:#fff;
  padding:12px 14px;
  font-size:0.9rem;
  font-weight:600;
}
.pe-input-group textarea { resize:none; min-height:74px; }
.pe-input-group input:focus, .pe-input-group select:focus, .pe-input-group textarea:focus {
  outline:none;
  border-color:rgba(242,194,78,0.55);
  box-shadow:0 0 0 3px rgba(242,194,78,0.17);
}
.pe-modal-row-2 { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.pe-save-btn {
  margin-top:14px;
  width:100%;
  border:none;
  border-radius:999px;
  padding:15px 14px;
  text-transform:uppercase;
  letter-spacing:0.13em;
  font-weight:900;
  font-size:0.92rem;
  color:#1f1407;
  background:linear-gradient(180deg, #f8ce2c 0%, #f2c214 100%);
  box-shadow:0 12px 30px rgba(242,194,78,0.3), inset 0 1px 0 rgba(255,255,255,0.35);
}
.pe-discard-btn {
  margin-top:10px;
  width:100%;
  border:none;
  background:transparent;
  color:rgba(255,255,255,0.35);
  font-size:0.66rem;
  letter-spacing:0.24em;
  text-transform:uppercase;
  font-weight:700;
}
.pe-modal-mini-stats {
  margin-top:12px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}
.pe-mini {
  border-radius:18px;
  padding:10px 12px;
  border:1px solid rgba(255,255,255,0.1);
  background:linear-gradient(145deg, rgba(41,33,20,0.82), rgba(19,20,28,0.86));
}
.pe-mini .l {
  font-size:0.56rem;
  letter-spacing:0.17em;
  text-transform:uppercase;
  color:rgba(255,255,255,0.42);
  font-weight:700;
}
.pe-mini .v {
  margin-top:6px;
  color:#f6c63c;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  font-size:1.65rem;
  line-height:1;
  font-weight:800;
}
.pe-mini .v.alt { color:#ffe9b0; }

/* Must-Try */
.musttry-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:16px; }
.musttry-card {
  position:relative; overflow:hidden; cursor:pointer;
  border-radius:28px;
  background:linear-gradient(130deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02) 60%);
  border:1px solid rgba(255,255,255,0.1);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5);
  transition:transform .22s ease, border-color .22s ease, box-shadow .22s ease;
}
.musttry-card:hover {
  transform:translateY(-3px);
  border-color:rgba(255,255,255,0.18);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.14), 0 26px 70px rgba(0,0,0,0.6);
}
.musttry-card:active { transform:scale(0.985); }
/* Day-based neon glows */
.musttry-card.day1 { box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5), 0 0 40px rgba(255,88,110,0.12); }
.musttry-card.day2 { box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5), 0 0 40px rgba(66,205,135,0.12); }
.musttry-card.day3 { box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5), 0 0 40px rgba(255,160,88,0.12); }
.musttry-card.day4 { box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5), 0 0 40px rgba(176,132,255,0.12); }
.musttry-card.day5 { box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5), 0 0 40px rgba(255,118,178,0.12); }
.musttry-card.home { box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 18px 50px rgba(0,0,0,0.5), 0 0 40px rgba(242,194,78,0.12); }
.musttry-card.day1 { background:linear-gradient(130deg, rgba(255,104,104,0.16), rgba(74,104,190,0.16) 68%, rgba(255,255,255,0.03)); }
.musttry-card.day2 { background:linear-gradient(130deg, rgba(78,210,132,0.16), rgba(40,140,95,0.16) 68%, rgba(255,255,255,0.03)); }
.musttry-card.day3 { background:linear-gradient(130deg, rgba(255,160,96,0.16), rgba(168,120,72,0.16) 68%, rgba(255,255,255,0.03)); }
.musttry-card.day4 { background:linear-gradient(130deg, rgba(190,132,255,0.16), rgba(106,106,220,0.16) 68%, rgba(255,255,255,0.03)); }
.musttry-card.day5 { background:linear-gradient(130deg, rgba(255,120,170,0.15), rgba(132,100,230,0.15) 68%, rgba(255,255,255,0.03)); }
.musttry-card.home { background:linear-gradient(130deg, rgba(245,180,72,0.15), rgba(245,110,72,0.15) 68%, rgba(255,255,255,0.03)); }
.musttry-card-inner {
  display:flex; align-items:center; gap:16px;
  padding:20px 20px;
}
.musttry-card-emoji {
  width:60px; height:60px; flex-shrink:0;
  border-radius:18px;
  font-size:1.9rem; line-height:1;
  display:flex; align-items:center; justify-content:center;
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.1);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.12), 0 10px 24px rgba(0,0,0,0.35);
}
.musttry-card-text { flex:1; min-width:0; }
.musttry-card-name { font-size:1.05rem; font-weight:700; color:#f3f5ff; letter-spacing:-0.02em; margin-bottom:3px; }
.musttry-day-pill { display:none; }
.musttry-card-day {
  font-size:0.62rem; text-transform:uppercase; letter-spacing:0.2em;
  font-weight:800;
}
.musttry-card.day1 .musttry-card-day { color:#ff7b7b; }
.musttry-card.day2 .musttry-card-day { color:#58de99; }
.musttry-card.day3 .musttry-card-day { color:#ffb07b; }
.musttry-card.day4 .musttry-card-day { color:#bf9dff; }
.musttry-card.day5 .musttry-card-day { color:#ff88bc; }
.musttry-card.home .musttry-card-day { color:#f7c35a; }
.musttry-card-tags { margin-top:9px; display:flex; flex-wrap:wrap; gap:6px; }
.musttry-tag {
  font-size:0.58rem; font-weight:700; letter-spacing:0.1em; text-transform:uppercase;
  color:rgba(255,255,255,0.55);
  border-radius:10px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.09);
  padding:3px 9px;
}
.musttry-arrow {
  flex-shrink:0;
  width:34px; height:34px; border-radius:50%;
  display:grid; place-items:center;
  color:rgba(255,255,255,0.35);
  font-size:1.4rem;
  line-height:1;
  font-weight:400;
  border:1px solid rgba(255,255,255,0.09);
  background:rgba(255,255,255,0.03);
  margin-left:4px;
}

/* Must-Try Area Modal */
.mustarea-close {
  position:absolute; top:14px; right:14px;
  width:34px; height:34px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.1);
  color:rgba(255,255,255,0.72);
  border-radius:12px;
  font-size:1.2rem; z-index:6; line-height:1;
  transition:all .2s;
}
.mustarea-close:hover { color:#fff; background:rgba(255,255,255,0.1); }
.mustarea-modal {
  max-width:560px; max-height:92vh; overflow-y:auto; overflow-x:hidden; padding:0;
  background: linear-gradient(160deg, rgba(8,12,22,0.95), rgba(9,13,25,0.9));
  backdrop-filter: blur(36px) saturate(170%);
  -webkit-backdrop-filter: blur(36px) saturate(170%);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 30px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.09), 0 30px 90px rgba(0,0,0,0.72);
  scrollbar-width:none;
  -ms-overflow-style:none;
}
.mustarea-modal::-webkit-scrollbar { width:0; height:0; }
#mustAreaModal .mustarea-modal,
#mustAreaModal #mustAreaContent,
#mustAreaModal .mustarea-layout,
#mustAreaModal .mustarea-body,
#mustAreaModal .mustarea-section,
#mustAreaModal .mustarea-item {
  width:100%;
  max-width:100%;
  box-sizing:border-box;
}
.mustarea-layout {
  width:100%;
  max-width:none;
  margin:0;
}
.mustarea-hero {
  position:relative;
  padding:38px 26px 22px;
  text-align:center;
  border-bottom:1px solid rgba(255,255,255,0.1);
}
.mustarea-hero::before {
  content:"";
  position:absolute; inset:0 auto auto 0; width:100%; height:100%;
  background: radial-gradient(circle at 50% -10%, rgba(255,120,170,0.18), transparent 55%);
  pointer-events:none;
}
.mustarea-modal.day1-theme .mustarea-hero::before { background:radial-gradient(circle at 50% -10%, rgba(255,92,110,0.24), transparent 55%); }
.mustarea-modal.day2-theme .mustarea-hero::before { background:radial-gradient(circle at 50% -10%, rgba(70,205,135,0.24), transparent 55%); }
.mustarea-modal.day3-theme .mustarea-hero::before { background:radial-gradient(circle at 50% -10%, rgba(255,160,88,0.22), transparent 55%); }
.mustarea-modal.day4-theme .mustarea-hero::before { background:radial-gradient(circle at 50% -10%, rgba(176,138,255,0.22), transparent 55%); }
.mustarea-modal.day5-theme .mustarea-hero::before { background:radial-gradient(circle at 50% -10%, rgba(255,118,178,0.22), transparent 55%); }
.mustarea-modal.home-theme .mustarea-hero::before { background:radial-gradient(circle at 50% -10%, rgba(242,194,78,0.24), transparent 55%); }
.mustarea-day-kicker {
  display:inline-flex; align-items:center; gap:6px;
  font-size:0.58rem; font-weight:900; letter-spacing:0.24em; text-transform:uppercase;
  color:rgba(255,255,255,0.4);
  margin-bottom:16px;
  padding:5px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
}
.mustarea-emoji {
  width:58px; height:58px; margin:0 auto 12px;
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:2rem; line-height:1;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.14);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.16), 0 14px 34px rgba(0,0,0,0.45);
}
.mustarea-title { font-size:2rem; font-weight:800; letter-spacing:-0.04em; color:#f4f6ff; line-height:1.06; }
.mustarea-day { display:none; }
.mustarea-desc {
  margin:12px auto 0;
  max-width:92%;
  font-size:0.85rem; color:rgba(255,255,255,0.62); line-height:1.55;
}
.mustarea-body {
  padding:16px 16px 20px;
  position:relative;
}
.mustarea-body > * { position:relative; z-index:1; }
.mustarea-section {
  margin-top:14px;
  margin-left:-4px;
  margin-right:-4px;
  position:relative;
  width:100%;
  border-radius:18px;
  padding:10px;
  overflow:hidden;
  box-sizing:border-box;
}
.mustarea-section > * { position:relative; z-index:1; }
.mustarea-section-title {
  display:flex; align-items:center; gap:7px;
  font-size:0.6rem; letter-spacing:0.2em; text-transform:uppercase; font-weight:900;
  /* break out of section padding to fill full width */
  width:calc(100% + 20px);
  margin:-10px -10px 12px;
  padding:9px 10px;
  border-radius:18px 18px 0 0;
  background:rgba(255,255,255,0.07);
}
.mustarea-section-title::before {
  content:"";
  width:6px; height:6px; border-radius:50%; flex-shrink:0;
  background:currentColor; opacity:0.75;
}
.mustarea-section.cat-eat { background:rgba(255,92,170,0.05); }
.mustarea-section.cat-drink { background:rgba(74,140,255,0.05); }
.mustarea-section.cat-activity { background:rgba(176,132,255,0.05); }
.mustarea-section.cat-photo { background:rgba(52,212,132,0.05); }
.mustarea-section.cat-tips { background:rgba(242,194,78,0.05); }
.mustarea-section.cat-eat .mustarea-section-title { background:rgba(255,92,170,0.18); }
.mustarea-section.cat-drink .mustarea-section-title { background:rgba(74,140,255,0.18); }
.mustarea-section.cat-activity .mustarea-section-title { background:rgba(176,132,255,0.18); }
.mustarea-section.cat-photo .mustarea-section-title { background:rgba(52,212,132,0.18); }
.mustarea-section.cat-tips .mustarea-section-title { background:rgba(242,194,78,0.18); }
.mustarea-item {
  display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
  padding:14px 14px;
  width:100%;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:18px;
  margin-bottom:8px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
}
.mustarea-item-left { flex:1; min-width:0; }
.mustarea-item-name { font-size:1.05rem; font-weight:700; color:#f2f5ff; line-height:1.2; margin-bottom:4px; }
.mustarea-item-desc { font-size:0.8rem; color:rgba(255,255,255,0.58); line-height:1.45; }
.mustarea-item-address {
  display:flex; align-items:baseline; gap:4px;
  font-size:0.7rem; color:rgba(255,255,255,0.38); margin-top:5px; line-height:1.3;
}
.mustarea-item-actions { display:flex; flex-wrap:wrap; gap:5px; margin-top:8px; }
.mustarea-item-link {
  display:inline-flex; align-items:center; gap:4px;
  padding:4px 10px; border-radius:20px;
  font-size:0.65rem; font-weight:800; letter-spacing:0.07em; text-transform:uppercase;
  text-decoration:none; border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.05); color:rgba(255,255,255,0.6);
  transition:all .15s ease;
}
.mustarea-item-link:hover { background:rgba(255,255,255,0.12); color:#fff; border-color:rgba(255,255,255,0.28); }
.mustarea-item-link.lk-maps  { color:#7bc8ff; border-color:rgba(123,200,255,0.28); background:rgba(123,200,255,0.07); }
.mustarea-item-link.lk-menu  { color:#f8d58f; border-color:rgba(248,213,143,0.28); background:rgba(248,213,143,0.07); }
.mustarea-item-link.lk-book  { color:#a2eac0; border-color:rgba(162,234,192,0.28); background:rgba(162,234,192,0.07); }
.mustarea-item-link.lk-site  { color:#d2b2ff; border-color:rgba(210,178,255,0.28); background:rgba(210,178,255,0.07); }
.mustarea-item-link.lk-reserve { color:#f8d58f; border-color:rgba(248,213,143,0.28); background:rgba(248,213,143,0.07); }
.mustarea-item-link.lk-michelin { color:#ff9db5; border-color:rgba(255,157,181,0.28); background:rgba(255,157,181,0.07); }
.mustarea-item-link.lk-tickets  { color:#7bc8ff; border-color:rgba(123,200,255,0.28); background:rgba(123,200,255,0.07); }
.mustarea-item-photo {
  flex-shrink:0; width:72px; height:72px; border-radius:10px;
  overflow:hidden; align-self:flex-start;
}
.mustarea-item-photo img { width:100%; height:100%; object-fit:cover; display:block; }
.mustarea-section.cat-eat .mustarea-section-title { color:#ffa2d7; }
.mustarea-section.cat-drink .mustarea-section-title { color:#9dc0ff; }
.mustarea-section.cat-activity .mustarea-section-title { color:#d2b2ff; }
.mustarea-section.cat-photo .mustarea-section-title { color:#a2eac0; }
.mustarea-section.cat-tips .mustarea-section-title { color:#f8d58f; }
.mustarea-badge {
  flex-shrink:0;
  min-width:30px; height:30px;
  border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  padding:0 10px;
  font-size:0.67rem; font-weight:800; letter-spacing:0.05em; text-transform:uppercase;
  border:1px solid transparent;
}
.mustarea-badge.p1 { background:rgba(52,199,89,0.15); color:#4ce385; border-color:rgba(52,199,89,0.25); }
.mustarea-badge.p2 { background:rgba(255,205,88,0.15); color:#ffcf74; border-color:rgba(255,205,88,0.25); }
.mustarea-badge.p3 { background:rgba(255,96,128,0.16); color:#ff8ea8; border-color:rgba(255,96,128,0.26); }
.mustarea-badge.pfree { background:rgba(144,149,173,0.2); color:#d4d7e2; border-color:rgba(165,170,194,0.35); }
.mustarea-badge.tip { background:rgba(103,232,249,0.14); color:#72e6fa; border-color:rgba(103,232,249,0.26); }
.mustarea-note {
  margin-top:12px;
  font-size:0.78rem; line-height:1.5;
  color:#f9cb76;
  background:rgba(245,181,73,0.1);
  border:1px solid rgba(245,181,73,0.2);
  border-radius:14px;
  padding:10px 12px;
}

/* ── MOBILE ITINERARY ─────────────────────────────────────── */
.itin-day-selector {
  display:flex; gap:8px; overflow-x:auto; padding-bottom:4px;
  margin-bottom:16px; scrollbar-width:none; -ms-overflow-style:none;
}
.itin-day-selector::-webkit-scrollbar { display:none; }
.itin-day-btn {
  flex-shrink:0; width:112px; padding:0; border-radius:28px;
  background:transparent; border:none;
  color:var(--text-dim); transition:all .22s ease; cursor:pointer;
  font-family:inherit;
}
.itin-day-btn .day-pill {
  border-radius:28px;
  background: rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.12);
  padding:14px 10px;
  text-align:center;
  backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
}
.itin-day-btn.active .day-pill {
  background: #0a0b0f;
  border:1px solid rgba(242,194,78,0.55);
  box-shadow: 0 22px 70px rgba(242,194,78,0.22), inset 0 1px 0 rgba(255,255,255,0.08);
}
.itin-day-label { font-size:0.68rem; font-weight:800; letter-spacing:0.18em; color:rgba(255,255,255,0.3); }
.itin-day-date { margin-top:4px; font-size:2.1rem; font-weight:900; line-height:1; color:rgba(255,255,255,0.4); }
.itin-day-month { margin-top:4px; font-size:0.7rem; font-weight:800; letter-spacing:0.2em; color:rgba(255,255,255,0.25); }
.itin-day-btn.active .itin-day-label { color:rgba(242,194,78,0.95); }
.itin-day-btn.active .itin-day-date { color:#fff; }
.itin-day-btn.active .itin-day-month { color:rgba(242,194,78,0.9); }

.itin-timeline { display:flex; flex-direction:column; gap:0; }
.itin-tl-row {
  display:flex; gap:0; align-items:flex-start; position:relative;
}
.itin-tl-time-col {
  width:74px; flex-shrink:0; display:flex; flex-direction:column; align-items:center;
  padding-top:8px;
}
.itin-tl-time {
  font-size:0.68rem; font-weight:800; color:rgba(242,194,78,0.85);
  letter-spacing:0.08em; text-align:center; line-height:1.2;
  margin-bottom:8px; white-space:normal;
}
.itin-tl-line {
  width:2px; flex:1; margin-top:6px;
  background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.04) 100%);
  min-height:16px;
}
.itin-tl-row:last-child .itin-tl-line { display:none; }
.itin-tl-dot {
  width:18px; height:18px; border-radius:50%; flex-shrink:0;
  border:2px solid rgba(255,255,255,0.2);
  background:rgba(255,255,255,0.12);
  margin-top:2px; position:relative; z-index:1;
  box-shadow: 0 18px 45px rgba(0,0,0,0.55), 0 0 0 4px rgba(255,255,255,0.05);
}
/* Dot colors by type */
.itin-tl-row[data-type="sleep"] .itin-tl-dot { border-color:#8aa2be; background:#8aa2be33; }
.itin-tl-row[data-type="travel"] .itin-tl-dot { border-color:#38e8ff; background:#38e8ff33; }
.itin-tl-row[data-type="activity"] .itin-tl-dot { border-color:#3dd68c; background:#3dd68c33; }
.itin-tl-row[data-type="eating"] .itin-tl-dot { border-color:#f2c24e; background:#f2c24e33; }
.itin-tl-row[data-type="free"] .itin-tl-dot { border-color:#c084fc; background:#c084fc33; }
.itin-tl-row[data-type="prep"] .itin-tl-dot { border-color:#8fa0b8; background:#8fa0b833; }

.itin-tl-card {
  flex:1; margin:6px 0 6px 12px; padding:16px 16px;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius:22px;
  transition:all .2s ease;
  min-height:58px; display:flex; align-items:center; gap:10px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.06);
}
.itin-tl-card.clickable { cursor:pointer; }
.itin-tl-card.clickable:active { transform:scale(0.98); background:rgba(255,255,255,0.08); }
/* Left accent bar by type */
.itin-tl-card[data-type="sleep"]    { border-left:3px solid rgba(138,162,190,0.5); }
.itin-tl-card[data-type="travel"]   { border-left:3px solid rgba(56,232,255,0.6); }
.itin-tl-card[data-type="activity"] { border-left:3px solid rgba(61,214,140,0.65); }
.itin-tl-card[data-type="eating"]   { border-left:3px solid rgba(242,194,78,0.7); }
.itin-tl-card[data-type="free"]     { border-left:3px solid rgba(192,132,252,0.6); }
.itin-tl-card[data-type="prep"]     { border-left:3px solid rgba(143,160,184,0.45); }
.itin-tl-card.sleep-card            { opacity:0.55; }

.itin-tl-icon { font-size:1.2rem; flex-shrink:0; }
.itin-tl-label { font-size:0.98rem; font-weight:700; color:var(--text); flex:1; line-height:1.3; }
.itin-tl-card.sleep-card .itin-tl-label { color:var(--text-dim); font-style:italic; }
.itin-tl-tap { font-size:0.6rem; color:var(--amber); opacity:0.7; flex-shrink:0; }

/* ── OVERVIEW RECOMMENDATION MODAL ───────────────────────── */
#directionsModal .rec-modal {
  max-width:480px;
  padding:0;
  max-height:88vh;
  background: rgba(13,14,20,0.96);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:32px;
  box-shadow: 0 30px 100px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.07);
  backdrop-filter: blur(40px);
  -webkit-backdrop-filter: blur(40px);
  position:relative;
  overflow:hidden;
}
#directionsModal .rec-modal::before {
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(ellipse 80% 45% at 20% 0%, rgba(242,194,78,0.1), transparent 60%);
  pointer-events:none; z-index:0;
}
#directionsModal .rec-content {
  position:relative; z-index:1;
  padding:28px 24px 28px 28px;
  max-height:calc(88vh - 20px);
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
#directionsModal .rec-content::-webkit-scrollbar { display:none; }
#directionsModal .rec-close {
  position:absolute; right:16px; top:16px;
  width:36px; height:36px; border-radius:50%;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.05);
  color:rgba(255,255,255,0.65);
  font-size:1rem; line-height:1;
  z-index:2; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all .2s;
}
#directionsModal .rec-close:hover { background:rgba(255,255,255,0.1); color:#fff; }

/* Prevent header overlap with close buttons in all modals */
#dirContent {
  padding-right:40px;
}
#payerModalContent {
  padding-right:0;
}
#mustAreaContent {
  padding-right:0;
}
#directionsModal .rec-tag {
  display:inline-flex; align-items:center; gap:7px;
  font-size:0.6rem; font-weight:900; letter-spacing:0.22em;
  color:rgba(242,194,78,0.85);
  padding:5px 12px;
  border-radius:999px;
  background:rgba(242,194,78,0.08);
  border:1px solid rgba(242,194,78,0.2);
}
#directionsModal .rec-tag-dot {
  width:6px; height:6px; border-radius:50%; flex-shrink:0;
  background:var(--amber);
  box-shadow:0 0 6px rgba(242,194,78,0.6);
}
#directionsModal .rec-title {
  margin-top:16px;
  font-size:2.4rem; font-weight:900; line-height:0.96; letter-spacing:-0.03em;
}
#directionsModal .rec-subtitle {
  margin-top:6px; font-size:1.05rem; font-weight:700; color:rgba(242,194,78,0.88);
  letter-spacing:0.01em;
}
#directionsModal .rec-mode {
  margin-top:22px;
  border-radius:22px;
  background: rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.1);
  padding:12px 14px;
  display:flex; gap:12px; align-items:center;
  box-shadow: 0 18px 60px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.06);
}
#directionsModal .rec-mode-icon {
  width:44px; height:44px; border-radius:16px;
  display:flex; align-items:center; justify-content:center;
  background: linear-gradient(180deg, rgba(242,194,78,0.35), rgba(242,194,78,0.18));
  border:1px solid rgba(242,194,78,0.25);
  font-size:1.2rem;
}
#directionsModal .rec-mode-label {
  font-size:0.55rem; font-weight:800; letter-spacing:0.22em; color:rgba(255,255,255,0.4);
}
#directionsModal .rec-mode-value {
  margin-top:4px; font-size:1.15rem; font-weight:900;
}
#directionsModal .rec-metrics {
  margin-top:14px; display:grid; grid-template-columns:1fr 1fr; gap:12px;
}
#directionsModal .rec-metric {
  border-radius:22px;
  background: rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.1);
  padding:10px 12px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.06);
}
#directionsModal .rec-metric-label {
  font-size:0.55rem; font-weight:800; letter-spacing:0.22em; color:rgba(255,255,255,0.35);
}
#directionsModal .rec-metric-head {
  display:flex; align-items:center; gap:8px;
  font-size:0.55rem; font-weight:800; letter-spacing:0.22em; color:rgba(255,255,255,0.35);
}
#directionsModal .rec-metric-emoji {
  width:16px; height:16px; display:inline-flex; align-items:center; justify-content:center;
  font-size:0.8rem; opacity:0.9;
}
#directionsModal .rec-metric-value {
  margin-top:8px; font-size:1.05rem; font-weight:900;
}
#directionsModal .rec-steps { margin-top:22px; }
#directionsModal .rec-step {
  position:relative; padding-left:64px; margin-top:18px;
}
#directionsModal .rec-step::before {
  content:"";
  position:absolute; left:24px; top:18px; bottom:-18px;
  width:2px; background:rgba(255,255,255,0.1);
}
#directionsModal .rec-step:last-child::before { display:none; }
#directionsModal .rec-step-num {
  position:absolute; left:0; top:6px;
  width:46px; height:46px; border-radius:50%;
  background:linear-gradient(180deg, rgba(242,194,78,0.95), rgba(242,194,78,0.6));
  display:flex; align-items:center; justify-content:center;
  color:#1b1205; font-weight:900;
  box-shadow: 0 16px 50px rgba(242,194,78,0.22);
}
#directionsModal .rec-step-title {
  font-size:1.1rem; font-weight:800; color:rgba(255,255,255,0.92);
}
#directionsModal .rec-step-body {
  margin-top:6px; font-size:1rem; color:rgba(255,255,255,0.55);
}
#directionsModal .rec-food {
  margin-top:24px;
  border-top:1px solid rgba(255,255,255,0.08);
  padding-top:20px;
}
#directionsModal .rec-food-section { margin-top:14px; }
#directionsModal .rec-food-title {
  font-size:0.7rem; font-weight:800; letter-spacing:0.2em; color:rgba(255,255,255,0.4);
}
#directionsModal .rec-food-card {
  margin-top:12px; padding:14px 16px;
  border-radius:18px;
  background: rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.1);
  display:flex; justify-content:space-between; gap:10px;
}
#directionsModal .rec-food-name { font-size:0.95rem; font-weight:700; }
#directionsModal .rec-food-desc { font-size:0.8rem; color:rgba(255,255,255,0.55); margin-top:2px; }
#directionsModal .rec-food-badge {
  font-size:0.7rem; font-weight:800; padding:4px 10px; border-radius:10px; height:fit-content;
}
#directionsModal .rec-food-badge.p1 { background:rgba(61,214,140,0.15); color:#7ee8a8; }
#directionsModal .rec-food-badge.p2 { background:rgba(246,173,85,0.18); color:#f6ad55; }
#directionsModal .rec-food-badge.p3 { background:rgba(255,96,128,0.18); color:var(--red); }
#directionsModal .rec-food-badge.tip { background:rgba(242,194,78,0.18); color:var(--amber); }
#directionsModal .rec-note {
  margin-top:12px; font-size:0.85rem; color:var(--amber);
  background: rgba(242,194,78,0.12); border:1px solid rgba(242,194,78,0.18);
  padding:10px 12px; border-radius:12px;
}
#directionsModal .rec-footer {
  margin-top:24px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.08);
  display:flex; align-items:center; justify-content:space-between;
  border-radius:999px; padding:12px 16px;
  background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08);
}
#directionsModal .rec-footer span { font-size:0.7rem; letter-spacing:0.2em; font-weight:800; color:rgba(255,255,255,0.4); }

/* ── TOAST ───────────────────────────────────────────────── */
.toast {
  position:fixed; bottom:24px; right:24px;
  background: rgba(15,28,46,0.9);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  color:var(--text); border:1px solid var(--glass-border);
  border-left:3px solid var(--green); padding:14px 22px;
  border-radius:var(--radius); box-shadow:var(--glass-shine), var(--shadow-lg);
  transform:translateY(100px); opacity:0;
  transition:all .35s cubic-bezier(.34,1.56,.64,1); z-index:300; font-size:0.85rem;
}
.toast.show { transform:translateY(0); opacity:1; }
.toast.error { border-left-color:var(--red); }

/* ── DESKTOP ENHANCEMENTS ───────────────────────────────── */
@media(min-width:769px) {
  .content { padding:24px 28px; }
  /* Settings: 2-column card layout (only when active so display:none isn't overridden) */
  #tab-settings.active {
    display:grid; grid-template-columns:1fr 1fr; gap:16px; align-items:start;
  }
  #tab-settings .settings-kicker { grid-column:1/-1; margin-bottom:4px; }
  /* Google Sheets card (2nd child = 1st .settings-card) spans full width */
  #tab-settings > div:nth-child(2) { grid-column:1/-1; }
  /* Group: constrain avatar-tab row so it doesn't stretch too wide */
  #tab-expenses .person-tabs { max-width:520px; }
  /* Must-try: 2-col already set in base style; slightly wider gap on desktop */
  .musttry-grid { gap:18px; }
}

/* ── RESPONSIVE ──────────────────────────────────────────── */
@media(max-width:768px) {
  body { background:#0b0d12; }
  body::before {
    background:
      radial-gradient(ellipse 70% 50% at 20% 10%, rgba(245,158,11,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 60% 60% at 80% 20%, rgba(59,130,246,0.10) 0%, transparent 55%),
      radial-gradient(ellipse 70% 50% at 50% 85%, rgba(168,85,247,0.10) 0%, transparent 60%);
    animation: ambientShift 22s ease-in-out infinite alternate;
  }
  .header { padding:12px 16px; gap:10px; background:rgba(9,11,16,0.7); }
  .logo {
    width:34px; height:34px; border-radius:12px;
    background:linear-gradient(180deg,#f7c95a,#f0a81d);
    box-shadow: 0 10px 30px rgba(245,158,11,0.25);
  }
  .header-title { font-size:1.1rem; }
  .header-title span { font-size:0.6rem; letter-spacing:0.2em; color:#f5c24c; }
  .header-rate { border-radius:16px; padding:6px 10px; background:rgba(255,255,255,0.04); }
  .header-rate input { width:44px; font-size:0.75rem; }
  .content { padding:16px; padding-bottom:120px; max-width:430px; margin:0 auto; }
  .tabs { display:none; }
  .mobile-nav { display:block; }
  .tab-content#tab-overview .section-title { display:none; }
  .tab-content#tab-overview .itinerary-legend { display:none; }
  .flights { grid-template-columns:1fr; }
  .flight-card { border-radius:26px; padding:14px 16px; border-top:none; background:rgba(255,255,255,0.04); }
  .flight-header { align-items:center; }
  .flight-label { letter-spacing:0.18em; font-size:0.6rem; color:#f5c24c; }
  .flight-route { font-size:0.9rem; }
  .flight-num { font-size:0.7rem; }
  .flight-toggle { width:32px; height:32px; border-radius:10px; }
  .flight-summary { align-items:center; }
  .flight-summary-left { width:34px; height:34px; border-radius:10px; }
  .flight-summary-top { font-size:0.88rem; }
  .flight-summary-time { font-size:0.88rem; }
  .flight-summary-sub { font-size:0.68rem; }
  .flight-sub { margin-top:12px; padding-top:12px; }
  .flight-sub .flight-route { font-size:0.95rem; }
  .flight-times { margin-top:10px; }
  .form-row { flex-direction:column; }
  .form-group { min-width:auto; }
  .summary-grid { grid-template-columns:1fr 1fr; }
  .person-summary-bar { gap:8px; }
  .musttry-grid { grid-template-columns:1fr; gap:12px; }
  .group-expense-list { display:grid; }
  .group-table-desktop { display:none; }
  .group-expense-modal { max-height:90vh; border-radius:30px 30px 0 0; }
  .group-expense-shell { padding:20px 14px 16px; }
  #tab-expenses .summary-grid { padding-bottom:4px; }
  .group-total-value { font-size:1.35rem; }
  .itin-day-selector { gap:10px; margin-bottom:18px; }
  .itin-day-btn { width:96px; }
  .itin-day-btn .day-pill { border-radius:24px; background:rgba(255,255,255,0.04); }
  .itin-day-btn.active .day-pill { background:#0e1016; }
  .itin-day-label { font-size:0.6rem; letter-spacing:0.2em; }
  .itin-day-date { font-size:1.9rem; }
  .itin-day-month { font-size:0.6rem; }
  .itin-tl-time-col { width:60px; }
  .itin-tl-time { font-size:0.6rem; letter-spacing:0.2em; color:#f5c24c; }
  .itin-tl-time { margin-bottom:8px; letter-spacing:0.12em; }
  .itin-tl-time-col { padding-top:6px; width:72px; }
  .itin-tl-dot { width:14px; height:14px; margin-top:2px; }
  .itin-tl-card { border-radius:24px; padding:14px 14px; min-height:52px; }
  .itin-tl-label { font-size:0.9rem; }
  .mobile-nav-inner {
    border-radius:26px;
    background:rgba(255,255,255,0.04);
  }
  .mobile-tab .mobile-icon {
    background:rgba(255,255,255,0.04);
    border:1px solid rgba(255,255,255,0.08);
  }
  .mobile-tab.active .mobile-icon {
    background:rgba(245,158,11,0.14);
    border-color:rgba(245,158,11,0.35);
  }
  /* Switch itinerary to mobile timeline */
  .itin-desktop { display:none !important; }
  .itin-mobile  { display:block !important; }
}
@media(max-width:480px) {
  .summary-grid { grid-template-columns:1fr; }
  .flight-times { flex-direction:column; gap:10px; }
  .countdown { gap:4px; }
  .cd-box { min-width:38px; padding:4px 7px; }
  .cd-num { font-size:1rem; }
  .debt-item { flex-wrap:wrap; }
  .debt-amount { min-width:auto; }
  .musttry-grid { grid-template-columns:1fr; }
  .modal { padding:20px 18px; border-radius:var(--radius-lg); }
  /* Full-screen modal sheet on mobile */
  .modal-overlay { align-items:flex-end; padding:0; }
  .modal { width:100%; max-width:100%; border-radius:var(--radius-lg) var(--radius-lg) 0 0; max-height:92vh; overflow-y:auto; }
  #personalExpenseModal.modal-overlay {
    align-items:center;
    padding:14px;
  }
  #personalExpenseModal .pe-modal {
    width:min(92vw, 420px);
    max-width:420px;
    max-height:86vh;
    border-radius:28px;
  }
  .dir-modal { max-height:88vh; }
  .mustarea-modal { max-height:92vh; }
  #directionsModal.modal-overlay { align-items:center; padding:16px; }
  #directionsModal .rec-modal { border-radius:40px; max-height:90vh; }
  #directionsModal .rec-content { padding:26px 22px 24px; }
  #directionsModal .rec-title { font-size:2.1rem; }
  #directionsModal .rec-subtitle { font-size:1.35rem; }
  #directionsModal .rec-metrics { grid-template-columns:1fr 1fr; }
  #directionsModal .rec-mode { border-radius:20px; }
  #directionsModal .rec-metric { border-radius:20px; }
  #directionsModal .rec-step-title { font-size:1rem; }
  #directionsModal .rec-step-body { font-size:0.95rem; }
  #directionsModal .rec-footer { border-radius:20px; }
  /* Tab bar scrolling feel */
  .tabs { padding:0 4px; }
  .tab { padding:12px 12px; font-size:0.77rem; }
}

/* ── MOBILE NAV SVG ICONS ─────────────────────────────── */
.mobile-tab .mobile-icon svg {
  width:22px; height:22px; display:block;
}
.mobile-tab.active .mobile-icon svg { color:var(--amber); }

/* ── GROUP ADD EXPENSE BUTTON ──────────────────────────── */
.group-add-expense-btn {
  display:flex; align-items:center; justify-content:center;
  gap:10px;
}
.group-add-expense-btn .btn-icon-wrap {
  width:26px; height:26px; border-radius:50%;
  background:rgba(0,0,0,0.2);
  border:1.5px solid rgba(0,0,0,0.22);
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.22);
}
.group-add-expense-btn .btn-icon-wrap svg {
  width:13px; height:13px; color:#1b1406;
}

/* ── GROUP SUMMARY CARDS 4-LABEL ──────────────────────── */
#tab-expenses .summary-card .summary-divider {
  height:1px; background:rgba(255,255,255,0.07);
  margin:8px 0;
}
#tab-expenses .summary-card .summary-row {
  margin-top:5px;
}
#tab-expenses .summary-card .summary-row.summary-highlight {
  margin-top:0;
  padding-top:0;
  border-top:none;
}

/* ── PERSONAL BUDGET AREA ─────────────────────────────── */
.pe-budget-section {
  margin-bottom:16px;
}
.pe-budget-card {
  border-radius:18px;
  padding:14px 16px;
  background:linear-gradient(145deg, rgba(26,21,13,0.9), rgba(14,14,17,0.92));
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:0 12px 32px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.07);
}
.pe-budget-header {
  display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;
}
.pe-budget-label {
  font-size:0.62rem; text-transform:uppercase; letter-spacing:0.16em;
  color:var(--text-dim); font-weight:800;
}
.pe-budget-pct {
  font-size:0.68rem; font-weight:700; color:var(--teal);
}
.pe-budget-input-row {
  display:flex; align-items:center; gap:6px; margin-bottom:10px;
}
.pe-budget-sym { font-size:1rem; color:rgba(242,194,78,0.5); font-weight:700; }
.pe-budget-input {
  flex:1; background:transparent; border:none; outline:none;
  color:var(--amber); font-size:1.3rem; font-weight:800;
  font-family:'SF Mono','Fira Code','Courier New',monospace;
  padding:0; min-width:0;
}
.pe-budget-input::placeholder { color:rgba(242,194,78,0.28); }
.pe-budget-progress-track {
  height:5px; border-radius:3px; background:rgba(255,255,255,0.08); overflow:hidden;
}
.pe-budget-progress-fill {
  height:100%; border-radius:3px;
  transition:width .4s ease, background .3s ease;
}

/* ── SETTINGS REDESIGN ────────────────────────────────── */
.settings-kicker {
  display:flex; align-items:center; gap:8px; margin-bottom:20px;
  font-size:0.66rem; text-transform:uppercase; letter-spacing:0.2em;
  color:var(--text-dim); font-weight:800;
}
.settings-card {
  background:rgba(255,255,255,0.04);
  backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border:1px solid rgba(255,255,255,0.09);
  border-radius:24px; padding:20px;
  margin-bottom:14px;
  box-shadow:0 8px 32px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.07);
}
.settings-card-head {
  display:flex; align-items:center; gap:12px; margin-bottom:16px;
}
.settings-card-icon {
  width:40px; height:40px; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.1rem; flex-shrink:0;
}
.settings-card-title { font-size:0.95rem; font-weight:700; }
.settings-card-sub { font-size:0.7rem; color:var(--text-dim); margin-top:2px; }
.settings-sync-on { display:flex; align-items:center; gap:6px; font-size:0.7rem; font-weight:600; color:var(--teal); }
.settings-sync-dot { width:7px; height:7px; border-radius:50%; background:var(--teal); box-shadow:0 0 6px rgba(56,232,255,0.7); animation:blink 2s infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.4} }
.settings-last-sync {
  background:rgba(0,0,0,0.25); border-radius:12px; padding:10px 14px;
  font-size:0.78rem; color:var(--text-secondary); text-align:center; margin-bottom:12px;
  border:1px solid rgba(255,255,255,0.06);
}
.settings-btn-row { display:flex; gap:8px; margin-bottom:10px; }
.settings-btn {
  flex:1; padding:13px 10px; border-radius:14px;
  border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.06);
  color:var(--text-secondary); font-size:0.78rem; font-weight:600;
  display:flex; align-items:center; justify-content:center; gap:7px;
  transition:all .2s; cursor:pointer;
}
.settings-btn:hover { background:rgba(255,255,255,0.1); border-color:rgba(255,255,255,0.18); }
.settings-btn.full { flex:none; width:100%; }
.settings-btn.danger {
  background:rgba(255,96,128,0.08); border-color:rgba(255,96,128,0.2); color:var(--red);
}
.settings-btn.danger:hover { background:rgba(255,96,128,0.14); }
.settings-btn svg { width:16px; height:16px; flex-shrink:0; }
.settings-rate-row {
  display:flex; align-items:center; gap:12px;
  background:rgba(0,0,0,0.25); border-radius:14px;
  padding:14px 16px; margin-bottom:14px;
  border:1px solid rgba(255,255,255,0.07);
}
.settings-rate-label { font-size:0.72rem; color:var(--text-dim); white-space:nowrap; font-weight:600; }
.settings-rate-input {
  flex:1; background:transparent; border:none; outline:none;
  color:var(--amber); font-size:1.6rem; font-weight:800;
  text-align:center; font-family:'SF Mono','Fira Code','Courier New',monospace;
  padding:0; min-width:0;
}
.settings-rate-currency { font-size:0.82rem; color:var(--text-secondary); font-weight:600; white-space:nowrap; }
.settings-help-link {
  display:flex; align-items:center; justify-content:center; gap:5px;
  color:rgba(242,194,78,0.7); font-size:0.72rem; font-weight:500;
  margin-top:8px; cursor:pointer; border:none; background:none; width:100%;
}
.settings-help-link:hover { color:var(--amber); }
.settings-creds-details { margin-top:12px; }
.settings-creds-details summary {
  color:var(--text-dim); font-size:0.75rem; cursor:pointer; user-select:none;
  list-style:none; display:flex; align-items:center; gap:5px; font-weight:500;
}
.settings-creds-inner { margin-top:12px; }
.settings-creds-inner .settings-row { flex-direction:column; align-items:stretch; }
.settings-creds-inner .settings-row label { font-size:0.68rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-dim); margin-bottom:5px; font-weight:500; }
.settings-creds-inner .settings-row input { padding:10px 12px; background:var(--surface2); border:1px solid var(--border); color:var(--text); border-radius:var(--radius-sm); font-size:0.88rem; width:100%; }
</style>
</head>
<body>

<div class="header" id="mainHeader">
  <div class="header-left">
    <div class="logo">BK</div>
    <div class="header-title">BKK 2026 <span>Bangkok</span></div>
  </div>
  <div class="countdown" id="countdown"></div>
  <div class="header-rate" id="headerRate">
    <span>1 THB</span> =
    <input type="number" id="rateInput" step="0.01" min="0">
    <span>PHP</span>
  </div>
</div>

<div class="tabs">
  <button class="tab active" data-tab="overview"><svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><rect x="3" y="3" width="7.5" height="7.5" rx="1.5"/><rect x="13.5" y="3" width="7.5" height="7.5" rx="1.5"/><rect x="3" y="13.5" width="7.5" height="7.5" rx="1.5"/><rect x="13.5" y="13.5" width="7.5" height="7.5" rx="1.5"/></svg>Overview</button>
  <button class="tab" data-tab="musttry"><svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>Must-Try</button>
  <button class="tab" data-tab="expenses"><svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.9 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>Group</button>
  <button class="tab" data-tab="personal"><svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>Personal</button>
  <button class="tab" data-tab="settings"><svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96a7.37 7.37 0 00-1.62-.94l-.36-2.54A.484.484 0 0014 2h-4a.49.49 0 00-.48.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87a.48.48 0 00.12.61l2.03 1.58A7.2 7.2 0 004.82 12c0 .31.02.64.07.94L2.86 14.52c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h4c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.21.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>Settings</button>
</div>

<div class="content">
  <!-- OVERVIEW -->
  <div class="tab-content active" id="tab-overview">
    <div class="section-title"><span class="icon">&#9992;</span> Flight Details</div>
    <div class="flights">
      <div class="flight-card">
        <div class="flight-header flight-summary">
          <div class="flight-summary-left"><svg viewBox="0 0 24 24" fill="currentColor" style="width:18px;height:18px;"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5z"/></svg></div>
          <div class="flight-summary-main">
            <div class="flight-summary-top">
              <span class="flight-route">MNL &rarr; BKK</span>
              <span class="flight-summary-sep">&middot;</span>
              <span class="flight-summary-time">11:45 PM</span>
            </div>
            <div class="flight-summary-sub">Mar 24, 2026 &middot; 5J 931</div>
          </div>
          <button class="flight-toggle" type="button" aria-label="Toggle flight details"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;"><polyline points="6 9 12 15 18 9"/></svg></button>
        </div>
        <div class="flight-body">
          <div class="flight-sub">
            <div class="flight-sub-label">Departure</div>
            <div class="flight-route">MNL &rarr; BKK</div>
            <div class="flight-num">5J 931 &middot; Cebu Pacific</div>
            <div class="flight-times">
              <div class="flight-point"><div class="airport">NAIA Terminal 3</div><div class="time">11:45 PM</div><div class="date">March 24, 2026 (Tue)</div></div>
              <div class="flight-arrow">&#9992;</div>
              <div class="flight-point" style="text-align:right"><div class="airport">Suvarnabhumi Airport</div><div class="time">2:45 AM</div><div class="date">March 25, 2026 (Wed)</div></div>
            </div>
          </div>
          <div class="flight-sub">
            <div class="flight-sub-label">Return</div>
            <div class="flight-route">BKK &rarr; MNL</div>
            <div class="flight-num">5J 930 &middot; Cebu Pacific</div>
            <div class="flight-times">
              <div class="flight-point"><div class="airport">Suvarnabhumi Airport</div><div class="time">11:25 AM</div><div class="date">March 30, 2026 (Mon)</div></div>
              <div class="flight-arrow">&#9992;</div>
              <div class="flight-point" style="text-align:right"><div class="airport">NAIA Terminal 3</div><div class="time">4:15 PM</div><div class="date">March 30, 2026 (Mon)</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="section-title"><span class="icon">&#128197;</span> 6-Day Itinerary</div>
    <!-- Desktop table -->
    <div class="itin-desktop" style="overflow-x:auto"><table class="itinerary-table" id="itineraryGrid"></table></div>
    <!-- Mobile timeline -->
    <div class="itin-mobile">
      <div class="itin-day-selector" id="itinDaySelector"></div>
      <div class="itin-timeline" id="itinTimeline"></div>
    </div>
    <div class="itinerary-legend">
      <div class="legend-item"><div class="legend-dot" style="background:#6e6e8e"></div>Sleep</div>
      <div class="legend-item"><div class="legend-dot" style="background:#7cc4f5"></div>Travel</div>
      <div class="legend-item"><div class="legend-dot" style="background:#7ee8a8"></div>Activity</div>
      <div class="legend-item"><div class="legend-dot" style="background:#f6ad55"></div>Eating</div>
      <div class="legend-item"><div class="legend-dot" style="background:#c4a8f7"></div>Free Time</div>
      <div class="legend-item"><div class="legend-dot" style="background:#9898b0"></div>Prep</div>
    </div>
    <div style="margin-top:14px;"><a href="https://www.google.com/maps/d/u/0/edit?mid=1b000Titzrj3lhr3ksDZC26xUmX0qvAI&usp=sharing" target="_blank" style="color:var(--teal);font-size:0.82rem;text-decoration:none;font-weight:500;">&#128205; Open Trip Map in Google Maps &rarr;</a></div>
  </div>

  <!-- GROUP EXPENSES -->
  <div class="tab-content" id="tab-expenses">
    <button class="group-add-expense-btn" onclick="openGroupExpenseModal()">
      <span class="btn-icon-wrap" aria-hidden="true"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="8" y1="2" x2="8" y2="14"/><line x1="2" y1="8" x2="14" y2="8"/></svg></span>
      Add New Expense
    </button>

    <div class="group-kicker group-kicker-first">
      <span class="group-kicker-left"><span class="group-kicker-dot"></span>Member Summary</span>
    </div>
    <div class="summary-grid" id="summaryGrid"></div>

    <div class="group-kicker">
      <span class="group-kicker-left"><span class="group-kicker-dot"></span>All Expenses</span>
      <span class="group-kicker-link" id="expViewAllBtn">View All</span>
    </div>
    <div class="group-expense-list" id="expenseList"></div>
    <div class="expense-table-wrap group-table-desktop">
      <table><thead><tr><th>Description</th><th>Amount</th><th>Paid By</th><th>Split Among</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead><tbody id="expenseTableBody"></tbody></table>
    </div>

    <div class="wow-section">
      <h3>&#128176; Settlement — Who Owes Whom</h3>
      <p style="font-size:0.78rem;color:var(--text-dim);margin-bottom:16px;margin-top:-8px">Select a person to see what they owe and mark payments as settled.</p>
      <div class="person-tabs" id="personTabs"></div>
      <div id="personDetails"></div>
    </div>
  </div>

  <!-- PERSONAL EXPENSES -->
  <div class="tab-content" id="tab-personal">
    <div class="pe-person-tabs" id="pePersonTabs"></div>
    <div id="pePanels"></div>
  </div>

  <!-- MUST-TRY -->
  <div class="tab-content" id="tab-musttry">
    <div id="mustTryGrid"></div>
  </div>

  <!-- SETTINGS -->
  <div class="tab-content" id="tab-settings">
    <div class="settings-kicker">
      <svg viewBox="0 0 24 24" fill="currentColor" style="width:14px;height:14px;opacity:0.6"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96a7.37 7.37 0 00-1.62-.94l-.36-2.54A.484.484 0 0014 2h-4a.49.49 0 00-.48.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87a.48.48 0 00.12.61l2.03 1.58A7.2 7.2 0 004.82 12c0 .31.02.64.07.94L2.86 14.52c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h4c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.21.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
      Settings &amp; Sync
    </div>

    <!-- Google Sheets Sync Card -->
    <div class="settings-card">
      <div class="settings-card-head">
        <div class="settings-card-icon" style="background:rgba(61,214,140,0.1);">
          <svg viewBox="0 0 24 24" fill="none" style="width:22px;height:22px"><rect x="3" y="3" width="18" height="18" rx="2" stroke="rgba(61,214,140,0.9)" stroke-width="1.5"/><line x1="3" y1="8" x2="21" y2="8" stroke="rgba(61,214,140,0.6)" stroke-width="1.5"/><line x1="8" y1="8" x2="8" y2="21" stroke="rgba(61,214,140,0.6)" stroke-width="1.5"/></svg>
        </div>
        <div>
          <div class="settings-card-title">Google Sheets Sync</div>
          <div class="settings-sync-on" id="syncIndicator">
            <span class="settings-sync-dot"></span>
            <span id="syncIndicatorText">Checking...</span>
          </div>
        </div>
      </div>
      <div class="settings-last-sync" id="syncStatus">Connecting...</div>
      <div class="settings-btn-row">
        <button class="settings-btn full" onclick="testGsheetsConnection()" style="background:rgba(56,232,255,0.06);border-color:rgba(56,232,255,0.15);color:var(--teal)">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          Test Connection
        </button>
      </div>
      <div class="settings-btn-row">
        <button class="settings-btn" onclick="manualSync()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0020 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 004 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
          Manual
        </button>
        <button class="settings-btn danger" onclick="toggleAutoSync()">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
          <span id="autoSyncBtnText">Disable</span>
        </button>
      </div>
      <button class="settings-help-link" onclick="document.getElementById('settingsSetupDetails').open=!document.getElementById('settingsSetupDetails').open">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width:13px;height:13px;opacity:0.7"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
        How to set up Google Sheets sync
      </button>
      <details id="settingsSetupDetails" class="settings-creds-details">
        <summary>&#9881; Edit credentials <span style="font-size:0.65rem;opacity:0.6">(admin only)</span></summary>
        <div class="settings-creds-inner">
          <div class="settings-row" style="flex-direction:column;gap:5px;margin-bottom:10px">
            <label>Spreadsheet ID</label>
            <input type="text" id="spreadsheetId" placeholder="Paste your Google Sheets ID">
          </div>
          <div class="settings-row" style="flex-direction:column;gap:5px;margin-bottom:10px">
            <label>API Key</label>
            <input type="password" id="apiKey" placeholder="Paste your API key">
          </div>
          <div class="settings-row" style="flex-direction:column;gap:5px;margin-bottom:10px">
            <label>Apps Script URL</label>
            <input type="text" id="webAppUrl" placeholder="Paste your Apps Script Web App URL">
          </div>
          <div class="settings-row" style="flex-direction:column;gap:5px;margin-bottom:10px">
            <label>Secret Token</label>
            <input type="password" id="syncToken" placeholder="Same token as in your Apps Script code">
          </div>
          <button class="btn btn-primary btn-sm" onclick="saveGsheetsConfig()">&#128190; Save Config</button>
          <details style="margin-top:12px">
            <summary style="color:var(--teal);font-size:0.82rem;font-weight:600;cursor:pointer">&#128161; Setup Guide</summary>
            <div style="margin-top:8px;font-size:0.8rem;line-height:1.6;color:var(--text-secondary)">
              <p><b>Step 1:</b> Create a Google Sheet. Copy the ID from the URL (between <code>/d/</code> and <code>/edit</code>). Share it → Anyone with the link → Editor.</p>
              <p><b>Step 2:</b> Extensions → Apps Script → paste this script → Deploy → New deployment → Web app (Execute as: Me, Access: Anyone).</p>
              <pre style="background:#1c1c32;color:#e8a838;padding:10px;border-radius:8px;font-size:0.72rem;overflow-x:auto;white-space:pre-wrap">var SECRET = "bkk2026abc";
function doPost(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sh = ss.getSheetByName("SyncData") || ss.insertSheet("SyncData");
  try {
    var b = JSON.parse(e.postData.contents);
    if (b.token !== SECRET) return ContentService.createTextOutput(JSON.stringify({ok:false,error:"Unauthorized"})).setMimeType(ContentService.MimeType.JSON);
    if (b.action === "write") { sh.getRange("A1").setValue(b.data); return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON); }
  } catch(err) { return ContentService.createTextOutput(JSON.stringify({ok:false,error:err.message})).setMimeType(ContentService.MimeType.JSON); }
  return ContentService.createTextOutput(JSON.stringify({ok:false,error:"unknown"})).setMimeType(ContentService.MimeType.JSON);
}</pre>
              <p><b>Step 3:</b> <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color:var(--amber)">Google Cloud Console</a> → Enable Sheets API → Create API Key.</p>
              <p><b>Step 4:</b> Paste credentials above → Save Config → Test Connection → Manual Sync.</p>
              <p style="color:var(--orange)"><b>Note:</b> Replace <code>bkk2026abc</code> with your own secret password (same in both places).</p>
            </div>
          </details>
        </div>
      </details>
    </div>

    <!-- Exchange Rate Card -->
    <div class="settings-card">
      <div class="settings-card-head">
        <div class="settings-card-icon" style="background:rgba(242,194,78,0.1);">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width:20px;height:20px;color:var(--amber)"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0020 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 004 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
        </div>
        <div class="settings-card-title">Exchange Rate</div>
      </div>
      <div class="settings-rate-row">
        <span class="settings-rate-label">1 THB =</span>
        <input type="number" class="settings-rate-input" id="settingsRate" step="0.01" min="0" placeholder="1.86">
        <span class="settings-rate-currency">PHP</span>
      </div>
      <button class="settings-btn full" onclick="updateRate()" style="background:linear-gradient(135deg,var(--amber),#e8a820);color:#0d0800;font-weight:800;border-color:transparent;letter-spacing:0.1em;text-transform:uppercase;font-size:0.82rem;">
        UPDATE RATE
      </button>
    </div>

    <!-- Data Management Card -->
    <div class="settings-card">
      <div class="settings-card-head">
        <div class="settings-card-icon" style="background:rgba(255,255,255,0.05);">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width:20px;height:20px;color:var(--text-secondary)"><path d="M20 6h-2.18c.07-.44.18-.87.18-1.33C18 2.99 16.21 1 14 1c-1.3 0-2.4.65-3.08 1.62L10 4 9.08 2.62C8.4 1.65 7.3 1 6 1 3.79 1 2 2.99 2 4.67c0 .46.1.89.18 1.33H0v2h4.12l-1.71 9H2v2h20v-2h-.41L19.88 8H24V6h-4zm-6-3c.87 0 1.67.59 1.67 1.67S14.87 6 14 6s-1.67-.59-1.67-1.67S13.13 3 14 3zm-8 0c.87 0 1.67.59 1.67 1.67S6.87 6 6 6s-1.67-.59-1.67-1.67S5.13 3 6 3z"/></svg>
        </div>
        <div class="settings-card-title">Data Management</div>
      </div>
      <div class="settings-btn-row">
        <button class="settings-btn" onclick="exportData()">
          <svg viewBox="0 0 24 24" fill="currentColor" style="color:#7cc4f5"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
          Export
        </button>
        <button class="settings-btn" onclick="document.getElementById('importFile').click()">
          <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--amber)"><path d="M5 15H3v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-4h-2v4H5v-4zm7-2l-4-4 1.41-1.41L11 10.17V3h2v7.17l2.59-2.58L17 9l-5 4z"/></svg>
          Import
        </button>
      </div>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
      <button class="settings-btn danger full" onclick="resetData()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
        Reset All Data
      </button>
    </div>
  </div>
</div>

<div class="mobile-nav" aria-label="Mobile Navigation">
  <div class="mobile-nav-inner">
    <div class="mobile-nav-row">
      <button class="mobile-tab active" data-tab="overview" aria-label="Overview">
        <div class="mobile-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><rect x="3" y="3" width="7.5" height="7.5" rx="1.5"/><rect x="13.5" y="3" width="7.5" height="7.5" rx="1.5"/><rect x="3" y="13.5" width="7.5" height="7.5" rx="1.5"/><rect x="13.5" y="13.5" width="7.5" height="7.5" rx="1.5"/></svg>
        </div>
        <div>Overview</div>
      </button>
      <button class="mobile-tab" data-tab="musttry" aria-label="Must-Try">
        <div class="mobile-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
        </div>
        <div>Must-Try</div>
      </button>
      <button class="mobile-tab" data-tab="expenses" aria-label="Group">
        <div class="mobile-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
        </div>
        <div>Group</div>
      </button>
      <button class="mobile-tab" data-tab="personal" aria-label="Personal">
        <div class="mobile-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
        </div>
        <div>Personal</div>
      </button>
      <button class="mobile-tab" data-tab="settings" aria-label="Settings">
        <div class="mobile-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96a7.37 7.37 0 00-1.62-.94l-.36-2.54A.484.484 0 0014 2h-4a.49.49 0 00-.48.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87a.48.48 0 00.12.61l2.03 1.58A7.2 7.2 0 004.82 12c0 .31.02.64.07.94L2.86 14.52c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h4c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.21.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
        </div>
        <div>Settings</div>
      </button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="directionsModal" onclick="if(event.target===this)closeDirections()">
  <div class="modal dir-modal rec-modal">
    <button class="rec-close" onclick="closeDirections()" aria-label="Close">&times;</button>
    <div id="dirContent" class="rec-content"></div>
  </div>
</div>

<div class="modal-overlay" id="payerModal" onclick="if(event.target===this)closePayerModal()">
  <div class="modal dir-modal" style="max-width:560px;max-height:88vh;overflow-y:auto;padding:0;">
    <div id="payerModalContent"></div>
  </div>
</div>

<div class="modal-overlay" id="groupExpenseModal" onclick="if(event.target===this)closeGroupExpenseModal()">
  <div class="modal group-expense-modal">
    <div class="group-expense-shell">
      <div class="group-expense-head">
        <button class="group-expense-close" onclick="closeGroupExpenseModal()" aria-label="Close">&times;</button>
        <h3 id="formTitle">Add Expense</h3>
        <div style="width:38px;"></div>
      </div>
      <div class="group-expense-form" id="expenseForm">
        <input type="hidden" id="editExpenseId">
        <div class="form-row">
          <div class="form-group" style="flex:1"><label>Description</label><input type="text" id="expDesc" placeholder="Dinner at Jay Fai"></div>
        </div>
        <div class="form-row">
          <div class="form-group" style="flex:2"><label>Amount</label><input type="number" id="expAmount" step="0.01" min="0" placeholder="0.00"></div>
          <div class="form-group" style="flex:1;min-width:100px"><label>Currency</label><select id="expCurrency"><option value="PHP">PHP</option><option value="THB">THB</option></select></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Paid By</label><select id="expPaidBy"></select></div>
          <div class="form-group"><label>Category</label><select id="expCategory"><option value="food">&#127860; Food</option><option value="transport">&#128663; Transport</option><option value="accommodation">&#127968; Accommodation</option><option value="activity">&#127915; Activity</option><option value="shopping">&#128717; Shopping</option><option value="other">&#128178; Other</option></select></div>
        </div>
        <div class="form-group" style="margin-bottom:12px"><label>Split Among</label><div class="checkbox-group" id="splitCheckboxes"></div></div>
        <div class="split-type-toggle">
          <button class="split-type-btn active" data-split="equal">Equal</button>
          <button class="split-type-btn" data-split="custom">Custom</button>
        </div>
        <div class="custom-splits" id="customSplits" style="display:none"></div>
        <div class="form-row" style="margin-top:10px">
          <div class="form-group"><label>Date</label><input type="date" id="expDate"></div>
        </div>
        <button class="group-expense-save" type="button" onclick="saveExpense()">Save Expense</button>
        <button class="btn btn-secondary" type="button" id="cancelEditBtn" style="display:none;margin:10px auto 0;" onclick="cancelEdit()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="personalExpenseModal" onclick="if(event.target===this)closePersonalExpenseModal()">
  <div class="modal pe-modal">
    <div class="pe-modal-shell">
      <div class="pe-modal-head">
        <button class="pe-modal-back" onclick="closePersonalExpenseModal()" aria-label="Close">&larr;</button>
        <h3 class="pe-modal-title" id="peModalTitle">Personal Expense</h3>
        <div style="width:38px"></div>
      </div>

      <div class="pe-modal-card">
        <input type="hidden" id="peModalPersonId">
        <input type="hidden" id="peModalEditId">

        <div class="pe-cur-switch">
          <button type="button" class="pe-cur-btn active" id="peCurTHB" onclick="peSetModalCurrency('THB')">THB (฿)</button>
          <button type="button" class="pe-cur-btn" id="peCurPHP" onclick="peSetModalCurrency('PHP')">PHP (₱)</button>
        </div>

        <div class="pe-amount-wrap">
          <div class="pe-amount-label">Amount Spent</div>
          <div class="pe-amount-input-row">
            <span class="pe-amount-sym" id="peAmountSymbol">฿</span>
            <input type="number" class="pe-amount-input" id="peModalAmount" step="0.01" min="0" placeholder="0.00">
          </div>
        </div>

        <div class="pe-form-grid">
          <div class="pe-input-group">
            <label><span class="ico">&#127915;</span> Description</label>
            <input type="text" id="peModalDesc" placeholder="Dinner at J'Fai">
          </div>

          <div class="pe-modal-row-2">
            <div class="pe-input-group">
              <label><span class="ico">&#128230;</span> Category</label>
              <select id="peModalCat"></select>
            </div>
            <div class="pe-input-group">
              <label><span class="ico">&#128197;</span> Date</label>
              <input type="date" id="peModalDate">
            </div>
          </div>

          <div class="pe-input-group">
            <label><span class="ico">&#128172;</span> Note <span style="opacity:.45;letter-spacing:0;text-transform:none">(optional)</span></label>
            <textarea id="peModalNote" placeholder="Shared with the group..."></textarea>
          </div>
        </div>

        <button class="pe-save-btn" type="button" onclick="peSaveModal()">Save Expense</button>
        <button class="pe-discard-btn" type="button" onclick="closePersonalExpenseModal(true)">Discard Entry</button>
      </div>

      <div class="pe-modal-mini-stats">
        <div class="pe-mini">
          <div class="l">Today</div>
          <div class="v" id="peModalToday">฿0</div>
        </div>
        <div class="pe-mini">
          <div class="l">Remaining</div>
          <div class="v alt" id="peModalRemain">100%</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="mustAreaModal" onclick="if(event.target===this)closeMustArea()">
  <div class="modal dir-modal mustarea-modal">
    <button class="mustarea-close" onclick="closeMustArea()">&times;</button>
    <div id="mustAreaContent"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const CAT_ICONS = {food:"\u{1F374}",transport:"\u{1F697}",accommodation:"\u{1F3E0}",activity:"\u{1F3AB}",shopping:"\u{1F6CD}",other:"\u{1F4B2}"};

const DEFAULT_DATA = {
  meta: { exchangeRate:1.86, primaryCurrency:"PHP", lastUpdated:new Date().toISOString() },
  travelers: [
    {id:"eduard",firstName:"Eduard Martin",middleName:"Legaspi",lastName:"Carlos",birthDate:"August 18, 1998",passportNumber:"P0609973B"},
    {id:"anwell",firstName:"Anwell Joseph",middleName:"Valencia",lastName:"Patdu",birthDate:"August 11, 1999",passportNumber:"P9430398B"},
    {id:"justin",firstName:"Justin Gabriel",middleName:"Fortaleza",lastName:"Reamillo",birthDate:"July 20, 1997",passportNumber:"P8799117A"},
    {id:"kerr",firstName:"Kerr Lorenzo",middleName:"Co",lastName:"Picazo",birthDate:"November 24, 1997",passportNumber:"P5280022C"},
    {id:"august",firstName:"August",middleName:"",lastName:"",birthDate:"",passportNumber:""}
  ],
  itinerary: [
    {day:1,date:"2026-03-25",label:"Day 1 (Wed)"},
    {day:2,date:"2026-03-26",label:"Day 2 (Thu)"},
    {day:3,date:"2026-03-27",label:"Day 3 (Fri)"},
    {day:4,date:"2026-03-28",label:"Day 4 (Sat)"},
    {day:5,date:"2026-03-29",label:"Day 5 (Sun)"},
    {day:6,date:"2026-03-30",label:"Day 6 (Mon)"}
  ],
  // Each cell: [activity, type, rowspan]. null = skip (covered by rowspan above)
  itinGrid:[
    ["5–6 AM",  ["Arrival","travel",1],["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1]],
    ["6–7 AM",  ["Check-in + Rest","sleep",2],["Zzz","sleep",1],["Wakey + Prep","prep",1],["Zzz","sleep",1],["Wakey + Prep","prep",1],["Zzz","sleep",1]],
    ["7–8 AM",  null,["Wakey + Prep","prep",1],["Quick Brekkie","eating",1],["Wakey + Prep","prep",1],["Quick Brekkie","eating",1],["Prep + Breakfast","eating",1]],
    ["8–9 AM",  ["Prep","prep",1],["Quick Brekkie","eating",1],["Travel to AC","travel",1],["Quick Brekkie + Head to Chatuchak","eating",1],["Khlong Lat Floating Market","activity",3],["Head to Suvarnabhumi","travel",1]],
    ["9–10 AM", ["Chinatown + Stroll","activity",2],["Grand Palace + Wat Pho","activity",3],["Ancient City","activity",3],["Chatuchak Weekend Market Stroll","activity",3],null,["","empty",1]],
    ["10–11 AM",null,null,null,null,null,["","empty",1]],
    ["11 AM–12 PM",["Lunch Break","eating",2],null,null,null,["Early Lunch","eating",1],["","empty",1]],
    ["12–1 PM", null,["Lunch Break","eating",2],["Lunch Break","eating",2],["Lunch Break","eating",1],["FREE TIME: Seacon Bangkae + Space Time / Return to Hotel / Last-minute Shopping / Revisit favorites","free",10],["","empty",1]],
    ["1–2 PM",  ["Song Wat + Talat Noi","activity",3],null,null,["Bang Sue Junction + Ace Jolun","activity",2],null,["","empty",1]],
    ["2–3 PM",  null,["Wat Arun","activity",2],["Ancient City","activity",3],null,null,["","empty",1]],
    ["3–4 PM",  null,null,null,["Go to ICONSIAM + Stroll + Palamig from Chatuchak","activity",2],null,["","empty",1]],
    ["4–5 PM",  ["Go to Airbnb","travel",1],["Go to Airbnb","travel",1],null,null,null,["","empty",1]],
    ["5–6 PM",  ["Rest","free",1],["Rest","free",1],["Go to Airbnb","travel",1],["Go to Khao San Road + Stroll + Dinner (Find Michelin Spot)","eating",4],null,["","empty",1]],
    ["6–7 PM",  ["Prep","prep",1],["Pratunam Area Mall Hop (Platinum + December + Big C + CentralWorld) + Dinner","activity",4],["Rest","free",1],null,null,["","empty",1]],
    ["7–8 PM",  ["Asiatique Dinner Cruise","eating",3],null,["Akara Sky Hanuman Dinner + Drinks","eating",4],null,null,["","empty",1]],
    ["8–9 PM",  null,null,null,null,null,["","empty",1]],
    ["9–10 PM", null,null,null,["Optional: Khao San Drinks. Else: Uwi","free",3],null,["","empty",1]],
    ["10–11 PM",["Go to Airbnb","travel",1],["Go to Airbnb","travel",1],null,null,["Zzz","sleep",1],["","empty",1]],
    ["11 PM–12 AM",["Zzz","sleep",1],["Zzz","sleep",1],["Zzz","sleep",1],null,["Zzz","sleep",1],["","empty",1]]
  ],
  directions:{
    // DAY 1 (col 1) — row-col keys
    "1-1":{from:"Suvarnabhumi Airport",to:"Airbnb (Ratchathewi)",method:"ARL + BTS",time:"45–50 min",cost:"~62 THB",steps:["Take Airport Rail Link (City Line) from Suvarnabhumi to Phaya Thai station (26 min, 45 THB)","Transfer to BTS Sukhumvit Line at Phaya Thai (N2), ride 1 stop south to Ratchathewi (N1) (17 THB)","Walk to Airbnb from Ratchathewi station"]},
    "4-1":{from:"Airbnb (Ratchathewi)",to:"Chinatown (Yaowarat)",method:"Grab / Taxi",time:"15–25 min",cost:"~70–100 THB",steps:["Book a Grab or taxi from Ratchathewi directly to Yaowarat Road","Alternative: BTS Ratchathewi → Siam → Sukhumvit Line to Asok → MRT Blue Line to Wat Mangkon (Chinatown station)"]},
    "6-1":{from:"Chinatown (Yaowarat)",to:"Lunch spot nearby",method:"Walk",time:"5–10 min",cost:"Free",steps:["Walk along Yaowarat Road — street food stalls and restaurants are everywhere","Pick any spot that looks good along the main strip or side sois"]},
    "8-1":{from:"Chinatown",to:"Song Wat + Talat Noi",method:"Walk",time:"10–15 min",cost:"Free",steps:["From Yaowarat Road, walk south toward the river along Charoen Krung Road","Turn onto Song Wat Road and continue into the Talat Noi neighborhood","The entire area is a connected walking district from Chinatown"]},
    "11-1":{from:"Song Wat + Talat Noi",to:"Airbnb (Ratchathewi)",method:"Grab / Taxi",time:"15–25 min",cost:"~80–120 THB",steps:["Book a Grab from Talat Noi directly back to Ratchathewi","Alternative: Walk to MRT Wat Mangkon or Hua Lamphong → MRT to Sukhumvit → BTS to Ratchathewi (~45 min)"]},
    "14-1":{from:"Airbnb (Ratchathewi)",to:"Asiatique The Riverfront",method:"BTS + Free Boat",time:"40–45 min",cost:"~35–44 THB",steps:["BTS Ratchathewi (N1) → Siam (CEN), transfer to BTS Silom Line","Ride to Saphan Taksin (S6), exit at Exit 2","Walk to Sathorn Pier and board the free Asiatique shuttle boat (runs 16:00–23:30, every 30 min)"]},
    "17-1":{from:"Asiatique The Riverfront",to:"Airbnb (Ratchathewi)",method:"Free Boat + BTS",time:"40–45 min",cost:"~35–44 THB",steps:["Take the free shuttle boat from Asiatique back to Sathorn Pier (last boat ~23:30)","BTS Saphan Taksin (S6) → Siam (CEN), transfer to Sukhumvit Line","Ride 1 stop north to Ratchathewi (N1)"]},

    // DAY 2 (col 2)
    "4-2":{from:"Airbnb (Ratchathewi)",to:"Grand Palace + Wat Pho",method:"Grab / Taxi",time:"20–40 min",cost:"~80–150 THB",steps:["Grab directly to Grand Palace — go early before 8 AM to beat traffic","Alternative: BTS to Saphan Taksin → Chao Phraya Express Boat to Tha Chang Pier (N9) → 5 min walk to entrance"]},
    "7-2":{from:"Grand Palace + Wat Pho",to:"Lunch spot nearby",method:"Walk",time:"5–10 min",cost:"Free",steps:["Many restaurants along Maharaj Road near the Grand Palace","Tha Tien area has great local food stalls and riverside restaurants"]},
    "9-2":{from:"Grand Palace area",to:"Wat Arun",method:"Cross-river Ferry",time:"10–15 min",cost:"8 THB",steps:["Walk from Grand Palace south to Tha Tien Pier (~10 min, passing Wat Pho)","Take the cross-river ferry directly to Wat Arun pier (5 min, 8 THB)","Ferries depart every 10–15 min, 06:00–21:00"]},
    "11-2":{from:"Wat Arun",to:"Airbnb (Ratchathewi)",method:"Grab / Taxi",time:"25–40 min",cost:"~100–150 THB",steps:["Book a Grab from Wat Arun directly to Ratchathewi","Alternative: Cross-river ferry back → Chao Phraya Boat to Sathorn Pier → BTS to Ratchathewi (~60 min)"]},
    "13-2":{from:"Airbnb (Ratchathewi)",to:"Pratunam Area (Platinum / CentralWorld)",method:"Walk",time:"10–15 min",cost:"Free",steps:["Walk south/southeast from Ratchathewi BTS station","Platinum Fashion Mall is ~10 min via the skywalk system","CentralWorld is a further 10 min south, or 1 BTS stop to Chit Lom (E1)"]},
    "17-2":{from:"Pratunam Area",to:"Airbnb (Ratchathewi)",method:"Walk",time:"10–15 min",cost:"Free",steps:["Walk back north to Ratchathewi BTS via the skywalk or street level","Pratunam is in the same neighborhood as your Airbnb"]},

    // DAY 3 (col 3)
    "3-3":{from:"Airbnb (Ratchathewi)",to:"Ancient City (Muang Boran)",method:"BTS + Grab",time:"~1.5 hours",cost:"~145–165 THB",steps:["BTS Ratchathewi (N1) → Siam (CEN) → Sukhumvit Line all the way to Kheha (E24) terminus (~50 min)","From Kheha station, take a Grab/taxi to Ancient City entrance (~15 min, ~80–100 THB)","Tip: Get a Rabbit Card for convenient BTS tap-and-go"]},
    "7-3":{from:"Ancient City",to:"Lunch spot",method:"Inside Ancient City",time:"N/A",cost:"Included",steps:["Several food stalls and restaurants inside Ancient City grounds","Main food court near the central area of the park"]},
    "9-3":{from:"Lunch",to:"Ancient City (cont.)",method:"Continue exploring",time:"N/A",cost:"N/A",steps:["Continue exploring the park after lunch","Rent a bike (~50 THB) to cover more ground — the park is huge (80 hectares)"]},
    "12-3":{from:"Ancient City",to:"Airbnb (Ratchathewi)",method:"Grab + BTS",time:"~1.5 hours",cost:"~145–165 THB",steps:["Grab/taxi from Ancient City back to Kheha BTS (E24)","BTS Kheha → Siam → Ratchathewi (N1)"]},
    "14-3":{from:"Airbnb (Ratchathewi)",to:"Akara Sky Hanuman",method:"BTS",time:"10–15 min",cost:"~17–25 THB",steps:["BTS Ratchathewi (N1) → Siam (CEN) → 2 stops east to Phloen Chit (E2)","Exit and walk via skywalk into One City Centre building (548 Ploenchit Rd)","Take elevator to 61st floor — opens at 16:30, reservations recommended"]},

    // DAY 4 (col 4)
    "3-4":{from:"Airbnb (Ratchathewi)",to:"Chatuchak Weekend Market",method:"BTS",time:"~15 min",cost:"~30–35 THB",steps:["BTS Ratchathewi (N1) northbound to Mo Chit (N8) — 7 stops, ~13 min","Exit Mo Chit (Exit 1), walk 5 min to market","Pro tip: MRT Kamphaeng Phet Exit 2 drops you right inside the market"]},
    "8-4":{from:"Chatuchak",to:"Bang Sue Junction + Ace Jolun",method:"BTS",time:"~10 min",cost:"~17–25 THB",steps:["BTS Mo Chit (N8) → 3 stops south to Ari (N5)","Ace Jolun is near Phaholyothin Soi 2, short walk from Ari BTS"]},
    "10-4":{from:"Ari area",to:"ICONSIAM",method:"BTS + Gold Line",time:"40–50 min",cost:"~44–50 THB",steps:["BTS Ari (N5) → Siam (CEN), transfer to Silom Line","Ride to Krung Thon Buri (S7), transfer to Gold Line monorail","Gold Line to Charoen Nakhon — ICONSIAM connected via covered walkway","Alternative: BTS to Saphan Taksin → free ICONSIAM shuttle boat (every 15 min)"]},
    "12-4":{from:"ICONSIAM",to:"Khao San Road",method:"Grab / Taxi",time:"15–25 min",cost:"~60–100 THB",steps:["Book a Grab from ICONSIAM to Khao San Road (~5 km)","No practical public transit for this route — Grab is fastest"]},
    "16-4":{from:"Khao San Road",to:"Airbnb (Ratchathewi)",method:"Grab / Taxi",time:"15–25 min",cost:"~60–80 THB",steps:["Book a Grab or hail a metered taxi from Khao San Road","No direct rail connection to Khao San — taxi/Grab is best, especially at night"]},

    // DAY 5 (col 5)
    "3-5":{from:"Airbnb (Ratchathewi)",to:"Khlong Lat Mayom Floating Market",method:"BTS + Grab",time:"45–60 min",cost:"~120–200 THB",steps:["Option A: BTS Ratchathewi → Siam → Silom Line to Bang Wa (S12) terminus, then taxi (~15 min, 75–100 THB)","Option B: Direct Grab from Ratchathewi (~30–45 min, ~200 THB)","Tip: Free shuttle bus from MRT Bang Khun Non Exit 3 on weekends (every 20–30 min, 09:00–16:30)"]},
    "6-5":{from:"Khlong Lat Mayom",to:"Early Lunch",method:"Inside market",time:"N/A",cost:"N/A",steps:["Amazing food stalls inside the floating market","Try the boat noodles and grilled seafood — eat at the canal-side tables"]},
    "7-5":{from:"Khlong Lat Mayom / Airbnb",to:"Free Time Activities",method:"Varies",time:"Varies",cost:"Varies",steps:["To Seacon Bangkae: Grab from market (~15–20 min, ~80–120 THB)","To return to Airbnb: Grab or taxi + BTS Bang Wa to Ratchathewi (~120–145 THB)","Seacon Bangkae is near MRT Phasi Charoen (BL36) for return via Blue Line"]},

    // DAY 6 (col 6)
    "3-6":{from:"Airbnb (Ratchathewi)",to:"Suvarnabhumi Airport",method:"BTS + ARL",time:"45–50 min",cost:"~62 THB",steps:["BTS Ratchathewi (N1) → 1 stop north to Phaya Thai (N2)","Transfer to Airport Rail Link at Phaya Thai station","ARL City Line to Suvarnabhumi Airport (26 min, 45 THB)","Tip: Allow 2+ hours before flight. If before 6 AM, take Grab instead (~250–350 THB)"]}
  },
  // Restaurant & cafe suggestions keyed same as directions: "row-col"
  foodGuide:{
    // DAY 1 — Prep/Brekkie at Ratchathewi (row 3 col 1)
    "3-1":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, modern interior, great espresso",price:"$$"},
      {name:"Mono Cafe",desc:"Scrambled eggs over rice with bacon, 100% Arabica coffee",price:"$"},
      {name:"Caturday Cat Cafe",desc:"Cozy cat cafe near Ratchathewi BTS, good drinks",price:"$$"},
      {name:"Piccolo Vicolo",desc:"Hidden alley cafe with greenery, quiet vibes, great lattes",price:"$$"}
    ],restaurants:[
      {name:"On Lok Yun",desc:"Legendary 1933 breakfast spot — toast, soft-boiled eggs, Thai iced coffee",price:"$"},
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand, famous Hainanese chicken rice (10 min walk)",price:"$"}
    ]},
    // DAY 1 — Lunch in Chinatown (row 6 col 1)
    "6-1":{area:"Chinatown (Yaowarat)",restaurants:[
      {name:"Lim Lao Ngow",desc:"Michelin Bib Gourmand — Kuay Jab rolled rice noodles in peppery pork broth",price:"$"},
      {name:"Jek Pui Curry Rice",desc:"70+ year old Michelin Bib Gourmand curry rice — pre-made curries in giant pots",price:"$"},
      {name:"Nai Ek Roll Noodle",desc:"Famous since the 1960s, hand-rolled noodles in rich broth",price:"$"},
      {name:"T&K Seafood",desc:"Iconic green-shirt staff, giant grilled prawns, tom yum, oyster omelette",price:"$$"}
    ]},
    // DAY 1 — Asiatique Dinner (row 14 col 1)
    "14-1":{area:"Asiatique The Riverfront",restaurants:[
      {name:"Sirimahannop",desc:"Dining on a stunning ship replica — steaks, seafood, Thai fusion",price:"$$$"},
      {name:"Wine I Love You",desc:"Live music, open-air riverside seating, 3-course set menu",price:"$$$"},
      {name:"Happy Fish",desc:"Riverside European/Thai/seafood with great river views",price:"$$"},
      {name:"Peppery Thai Bistro",desc:"Elevated authentic Thai cuisine, beautiful plating",price:"$$"}
    ]},
    // DAY 2 — Brekkie at Ratchathewi (row 3 col 2)
    "3-2":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, modern interior, great espresso",price:"$$"},
      {name:"Mono Cafe",desc:"Scrambled eggs over rice with bacon, 100% Arabica coffee",price:"$"},
      {name:"Piccolo Vicolo",desc:"Hidden alley cafe with greenery, quiet vibes, great lattes",price:"$$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand Hainanese chicken rice",price:"$"},
      {name:"On Lok Yun",desc:"Legendary 1933 breakfast — toast, soft-boiled eggs, Thai iced coffee",price:"$"}
    ]},
    // DAY 2 — Lunch near Grand Palace (row 7 col 2)
    "7-2":{area:"Grand Palace / Tha Tien",restaurants:[
      {name:"Supanniga Eating Room (Tha Tien)",desc:"Thai cuisine with Wat Arun views — must-try Isaan dishes",price:"$$"},
      {name:"Ama Art & Eatery",desc:"Opposite Wat Pho — great Pad Thai and basil rice",price:"$"},
      {name:"Err Urban Rustic Thai",desc:"Michelin Plate — retro shophouse, drinking snacks and Thai tapas",price:"$$"},
      {name:"Krua Apsorn",desc:"Famous crab omelette, beloved by locals for decades",price:"$$"}
    ]},
    // DAY 2 — Pratunam Dinner (row 13 col 2)
    "13-2":{area:"Pratunam / CentralWorld",restaurants:[
      {name:"Uno Mas (54th Floor, Centara Grand)",desc:"Upmarket Spanish — tapas, lobster, oysters with stunning skyline views",price:"$$$"},
      {name:"Red Sky Bar (Centara Grand)",desc:"Rooftop bar with 360° views — grilled meats, cocktails, free-flow drinks",price:"$$$"},
      {name:"CentralWorld Food Court",desc:"Massive variety of Thai and international street food",price:"$"},
      {name:"Platinum Fashion Mall Food Court",desc:"Cheap and cheerful local food, authentic Thai dishes",price:"$"},
      {name:"Kaiton Pratunam Chicken Rice",desc:"Legendary late-night chicken rice, green pants staff, right in Pratunam",price:"$"}
    ]},
    // DAY 3 — Brekkie at Ratchathewi (row 2 col 3)
    "2-3":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, modern interior",price:"$$"},
      {name:"Mono Cafe",desc:"Scrambled eggs, bacon, Arabica coffee",price:"$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand, opens early",price:"$"}
    ]},
    // DAY 3 — Lunch at Ancient City (row 7 col 3)
    "7-3":{area:"Ancient City (Muang Boran)",restaurants:[
      {name:"Ancient City Food Court",desc:"Central food court inside the park — pad thai, som tam, curries",price:"$"},
      {name:"Canal-side Food Stalls",desc:"Scattered around the park — boat noodles, grilled meats, Thai sweets",price:"$"},
      {name:"Floating Market Zone",desc:"Recreated floating market area inside the park with local dishes",price:"$"}
    ]},
    // DAY 3 — Akara Sky Hanuman Dinner (row 14 col 3)
    "14-3":{area:"Akara Sky Hanuman (61F, One City Centre)",restaurants:[
      {name:"Akara Sky Hanuman Dome Restaurant",desc:"Refined Thai seafood — grilled lobster, Lobster Tom Yum Mama, green curry",price:"$$$"},
      {name:"Hanuman Rooftop Garden Bar",desc:"360° city views, signature cocktails like 'Amazing Thailand' and 'Songkran' (~620 THB each)",price:"$$$"}
    ],note:"Reservations recommended. Opens 16:30. Nightly cultural shows with Muay Thai and Thai dance at ~20:00. Sky-mirrored observation deck on 61F."},
    // DAY 4 — Brekkie heading to Chatuchak (row 3 col 4)
    "3-4":{area:"Ratchathewi → Chatuchak",cafes:[
      {name:"CASA LAPIN (Ratchathewi)",desc:"Quick specialty coffee before heading out",price:"$$"},
      {name:"Nana Coffee Roasters (Ari)",desc:"Award-winning roaster near Chatuchak — famous timber ring croissants",price:"$$"},
      {name:"Glig Cafe (Ari)",desc:"Seoul-inspired minimalist cafe, great pour-over",price:"$$"},
      {name:"Landhaus Bakery (Ari)",desc:"Authentic Austrian-Bavarian bakery, fresh bread and pastries",price:"$$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Quick Michelin Bib Gourmand breakfast before BTS",price:"$"},
      {name:"Bar Storia (Ari)",desc:"All-day brunch in a photogenic European-vintage setting",price:"$$"}
    ]},
    // DAY 4 — Lunch at Chatuchak (row 7 col 4)
    "7-4":{area:"Chatuchak Weekend Market",restaurants:[
      {name:"Coco JJ Coconut Ice Cream",desc:"THE iconic Chatuchak treat — coconut ice cream in a husk with toppings (~50 THB)",price:"$"},
      {name:"Big Shrimp Pad Thai",desc:"Always packed — massive shrimp pad thai cooked fresh",price:"$"},
      {name:"King Octopus",desc:"Giant whole octopus grilled and sliced on the spot",price:"$"},
      {name:"Moo Yang (Honey Roast Pork) stalls",desc:"Sweet-savory grilled pork skewers, multiple vendors",price:"$"},
      {name:"Khanom Krok stalls",desc:"Crispy coconut pancakes cooked in round molds — a classic",price:"$"}
    ]},
    // DAY 4 — Khao San Road Dinner (row 12 col 4)
    "12-4":{area:"Khao San Road",restaurants:[
      {name:"Khao San Sek",desc:"Michelin Guide 2025 — build-your-own Thai menu in a beautiful townhouse",price:"$$$"},
      {name:"Pad Thai Thip Samai",desc:"'The best pad thai in Bangkok' — queue is worth it, wrapped-in-egg version is a must",price:"$"},
      {name:"Raan Jay Fai",desc:"Michelin-starred street food legend — famous crab omelette and drunken noodles (reserve ahead!)",price:"$$$"},
      {name:"Praya Dining at Praya Palazzo",desc:"Michelin Guide Italian in a stunning riverside villa near Khao San",price:"$$$"}
    ]},
    // DAY 5 — Brekkie at Ratchathewi (row 2 col 5)
    "2-5":{area:"Ratchathewi",cafes:[
      {name:"CASA LAPIN",desc:"Specialty coffee, reliable every morning",price:"$$"},
      {name:"Piccolo Vicolo",desc:"Green alley cafe, peaceful morning spot",price:"$$"}
    ],restaurants:[
      {name:"On Lok Yun",desc:"Classic Thai breakfast — toast, eggs, coffee",price:"$"},
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Michelin Bib Gourmand, opens early",price:"$"}
    ]},
    // DAY 5 — Early Lunch / Floating Market (row 6 col 5)
    "6-5":{area:"Khlong Lat Mayom Floating Market",restaurants:[
      {name:"Pla Pao (Salt-Crusted Grilled Fish)",desc:"THE must-try — whole snakehead fish grilled in salt crust with spicy sauce",price:"$"},
      {name:"Hoi Tod (Crispy Oyster Omelette)",desc:"Classic Thai canal-side dish, fried crispy with mussels",price:"$"},
      {name:"Boat Noodle stalls",desc:"Rich pork or beef broth noodles served canal-side (~30 THB/bowl)",price:"$"},
      {name:"Kanom Jeen stalls",desc:"Cold rice vermicelli with curry — green curry or fish curry versions",price:"$"},
      {name:"Foy Thong (Golden Threads)",desc:"Delicate Thai dessert — sweet egg yolk threads, unique to floating markets",price:"$"}
    ]},
    // DAY 5 — Free Time food (row 7 col 5)
    "7-5":{area:"Seacon Bangkae / Return to Hotel",restaurants:[
      {name:"Seacon Bangkae Food Court",desc:"Big mall food court with Thai, Japanese, Korean options",price:"$"},
      {name:"MK Suki (Seacon Bangkae)",desc:"Popular Thai hot pot chain — great for groups",price:"$$"},
      {name:"After You Dessert Cafe",desc:"Famous Thai dessert chain — Shibuya Honey Toast is a must",price:"$$"}
    ]},
    // DAY 6 — Last Breakfast (row 2 col 6)
    "2-6":{area:"Ratchathewi (Last Breakfast)",cafes:[
      {name:"CASA LAPIN",desc:"One last specialty coffee before the flight",price:"$$"},
      {name:"Mono Cafe",desc:"Hearty scrambled eggs and bacon for the road",price:"$"}
    ],restaurants:[
      {name:"Go-Ang Pratunam Chicken Rice",desc:"Final Michelin Bib Gourmand chicken rice — a perfect goodbye",price:"$"},
      {name:"On Lok Yun",desc:"Classic 1933 Thai breakfast — end the trip where it all began",price:"$"}
    ]}
  },
  // personalExpenses: { [personId]: [{id, desc, amount, currency, category, date, note}] }
  personalExpenses: {},
  // personalBudgets: { [personId]: budgetAmountInTHB }
  personalBudgets: {},
  expenses: [
    {id:"exp_preset_1",description:"Flight Booking (Roundtrip)",amount:44985.55,currency:"PHP",paidBy:"eduard",splitAmong:["eduard","kerr","justin","anwell","august"],splitType:"equal",customSplits:null,date:"2026-01-15",category:"transport",status:"paid",comments:""},
    {id:"exp_preset_2",description:"Airbnb",amount:26685.61,currency:"PHP",paidBy:"kerr",splitAmong:["eduard","kerr","justin","anwell","august"],splitType:"custom",customSplits:{eduard:5487.12,kerr:5187.12,justin:5487.12,anwell:5487.12,august:5487.12},date:"2026-01-20",category:"accommodation",status:"paid",comments:""}
  ],
  // payments keyed by "personId:expenseId" → { paid:true, date, note }
  payments: {}
};

let data;
const STORAGE_KEY = "bkk2026_v2";

function loadData() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) { try { data = JSON.parse(saved); if (!data.payments || Array.isArray(data.payments)) data.payments = {}; if (!data.personalExpenses || Array.isArray(data.personalExpenses)) data.personalExpenses = {}; if (!data.personalBudgets) data.personalBudgets = {}; return; } catch(e) {} }
  data = JSON.parse(JSON.stringify(DEFAULT_DATA));
  saveData();
}
function saveDataLocal() { data.meta.lastUpdated = new Date().toISOString(); localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
function saveData(pushToSheets = false) {
  saveDataLocal();
  if (pushToSheets && autoSyncEnabled && !isSyncing) {
    clearTimeout(saveData._pushTimer);
    saveData._pushTimer = setTimeout(silentSync, 1500);
  }
}

// Read remote → if someone else changed it, pull & re-render; otherwise push our change
async function silentSync() {
  if (isSyncing) return;
  isSyncing = true;
  try {
    const remote = await gsRead();
    if (remote && remote.meta?.lastUpdated) {
      const remoteTime = new Date(remote.meta.lastUpdated);
      const localTime  = new Date(data.meta.lastUpdated || 0);
      if (remoteTime > localTime) {
        // Another user's change is newer — pull it in and re-render
        data = remote;
        if (!data.payments || Array.isArray(data.payments)) data.payments = {};
        if (!data.personalBudgets) data.personalBudgets = {};
        saveDataLocal();
        renderAll();
        showToast("Updated — pulled changes from another user");
      } else {
        // Our change is newest — push it
        await gsWrite(data);
      }
    } else {
      // Sheet is empty — initialise it with our data
      await gsWrite(data);
    }
    lastSyncTime = new Date().toLocaleTimeString();
    updateSyncStatusUI();
  } catch(e) { /* silent — no connection or not configured yet */ }
  finally { isSyncing = false; }
}
function showToast(msg, isError) { const t=document.getElementById("toast"); t.textContent=msg; t.className="toast show"+(isError?" error":""); setTimeout(()=>t.className="toast",2800); }
function escapeHtml(str) { return String(str||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"); }
function formatMoney(n,curr) { return (curr||"PHP")+" "+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }
function convertToPhp(amount,currency) { return currency==="PHP"?amount:amount*data.meta.exchangeRate; }
function getNameShort(id) { const t=data.travelers.find(t=>t.id===id); return t?t.firstName.split(" ")[0]:id; }
function getInitials(id) { const t=data.travelers.find(t=>t.id===id); if(!t)return"?"; return ((t.firstName?.[0]||"")+(t.lastName?.[0]||"")).toUpperCase()||id[0].toUpperCase(); }

// Tabs
function updateHeaderRateVisibility(tabId) {
  const rateEl = document.getElementById("headerRate");
  const headerEl = document.getElementById("mainHeader");
  if (!rateEl) return;
  const isOverview = tabId === "overview";
  rateEl.style.display = isOverview ? "flex" : "none";
  if (headerEl) headerEl.classList.toggle("compact", !isOverview);
}

function activateTab(tabId) {
  document.querySelectorAll(".tab, .mobile-tab").forEach(t=>{
    t.classList.toggle("active", t.dataset.tab === tabId);
  });
  document.querySelectorAll(".tab-content").forEach(c=>{
    c.classList.toggle("active", c.id === "tab-" + tabId);
  });
  updateHeaderRateVisibility(tabId);
}
document.querySelectorAll(".tab, .mobile-tab").forEach(tab => {
  tab.addEventListener("click", () => activateTab(tab.dataset.tab));
});
updateHeaderRateVisibility((document.querySelector(".tab.active, .mobile-tab.active")||{}).dataset?.tab || "overview");

// Flight card toggles
document.querySelectorAll(".flight-card .flight-toggle").forEach(btn => {
  btn.addEventListener("click", () => {
    const card = btn.closest(".flight-card");
    if(card) card.classList.toggle("collapsed");
  });
});

// Countdown
function updateCountdown() {
  const dep=new Date("2026-03-24T23:45:00+08:00"),now=new Date(),diff=dep-now,el=document.getElementById("countdown");
  if(diff<=0){el.innerHTML='<span style="color:var(--amber);font-weight:700;font-size:0.9rem;">\u{1F389} Trip time!</span>';return;}
  const d=Math.floor(diff/864e5),h=Math.floor(diff%864e5/36e5),m=Math.floor(diff%36e5/6e4),s=Math.floor(diff%6e4/1e3);
  el.innerHTML=[{n:d,l:"Days"},{n:h,l:"Hrs"},{n:m,l:"Min"},{n:s,l:"Sec"}].map(u=>`<div class="cd-box"><div class="cd-num">${String(u.n).padStart(2,"0")}</div><div class="cd-label">${u.l}</div></div>`).join("");
}

// Itinerary
function renderItinerary() {
  const icons={sleep:"\u{1F634}",travel:"\u{1F695}",activity:"\u{2B50}",eating:"\u{1F374}",free:"\u{1F3B2}",prep:"\u{1F9F3}",empty:""};
  const dirs=data.directions||{};
  const food=data.foodGuide||{};
  const hdr=`<thead><tr><th></th>${data.itinerary.map(d=>`<th>${d.label}<div class="day-date">${new Date(d.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}</div></th>`).join("")}</tr></thead>`;
  const rows=data.itinGrid.map((row,ri)=>{
    const time=formatTimeRange(row[0]);
    let cells="";
    for(let i=1;i<=6;i++){
      const c=row[i];
      if(c===null) continue;
      const [act,type,span]=c;
      const icon=act?(icons[type]||""):"";
      const label=act?`${icon?icon+" ":""}${act}`:"";
      const key=ri+"-"+i;
      const isClickable=!!dirs[key]||!!food[key];
      cells+=`<td${span>1?' rowspan="'+span+'"':''}><div class="slot ${type}${isClickable?' clickable':''}"${isClickable?' onclick="showSlotInfo('+ri+','+i+')"':''}>${label}</div></td>`;
    }
    return `<tr><td class="itin-time">${time}</td>${cells}</tr>`;
  }).join("");
  document.getElementById("itineraryGrid").innerHTML=hdr+"<tbody>"+rows+"</tbody>";
}

// ── MOBILE ITINERARY TIMELINE ───────────────────────────────
let mobileActiveDayIdx = 0;
function formatTimeRange(raw){
  if(!raw) return "";
  const s = raw.replace("–","-").replace(/\s+/g," ").trim();
  const m = s.match(/^(\d{1,2})(?::(\d{2}))?\s*(AM|PM)?\s*-\s*(\d{1,2})(?::(\d{2}))?\s*(AM|PM)?$/i);
  if(!m) return raw;
  const h1 = m[1], min1 = m[2]||"00", ap1 = (m[3]||"").toUpperCase();
  const h2 = m[4], min2 = m[5]||"00", ap2 = (m[6]||ap1||"").toUpperCase();
  return `${h1}:${min1} - ${h2}:${min2}${ap2?` ${ap2}`:""}`;
}
function renderItineraryMobile() {
  const selEl = document.getElementById("itinDaySelector");
  const tlEl  = document.getElementById("itinTimeline");
  if(!selEl || !tlEl) return;
  const icons={sleep:"😴",travel:"🚌",activity:"⭐",eating:"🍴",free:"🎲",prep:"🧳",empty:""};
  const dirs  = data.directions||{};
  const food  = data.foodGuide||{};
  const days  = data.itinerary||[];

  // Day selector buttons
  selEl.innerHTML = days.map((d,i)=>{
    const dt = new Date(d.date+"T00:00:00");
    const month = dt.toLocaleDateString("en-US",{month:"short"}).toUpperCase();
    const dayNum = String(dt.getDate());
    return `<button class="itin-day-btn${i===mobileActiveDayIdx?" active":""}" onclick="switchMobileDay(${i})">
      <div class="day-pill">
        <div class="itin-day-label">DAY ${d.day}</div>
        <div class="itin-day-date">${dayNum}</div>
        <div class="itin-day-month">${month}</div>
      </div>
    </button>`;
  }).join("");

  renderMobileTimeline(mobileActiveDayIdx);
}

function switchMobileDay(idx) {
  mobileActiveDayIdx = idx;
  document.querySelectorAll(".itin-day-btn").forEach((b,i)=>b.classList.toggle("active",i===idx));
  renderMobileTimeline(idx);
}

function renderMobileTimeline(dayIdx) {
  const tlEl = document.getElementById("itinTimeline");
  if(!tlEl) return;
  const icons={sleep:"😴",travel:"🚌",activity:"⭐",eating:"🍴",free:"🎲",prep:"🧳",empty:""};
  const dirs  = data.directions||{};
  const food  = data.foodGuide||{};
  const col   = dayIdx+1; // column 1-6

  // Build flat list of slots for this day (skip null = rowspan continuation)
  const slots = [];
  data.itinGrid.forEach((row,ri)=>{
    const time = formatTimeRange(row[0]);
    const cell = row[col];
    if(cell === null) return; // rowspan continuation, skip
    const [act,type] = cell;
    if(!act) return; // empty slot
    const key = ri+"-"+col;
    const isClickable = !!dirs[key]||!!food[key];
    slots.push({time, act, type, key, isClickable, ri});
  });

  tlEl.innerHTML = slots.map(s=>{
    const icon = icons[s.type]||"";
    return `<div class="itin-tl-row" data-type="${s.type}">
      <div class="itin-tl-time-col">
        <div class="itin-tl-time">${s.time}</div>
        <div class="itin-tl-line"></div>
      </div>
      <div class="itin-tl-dot"></div>
      <div class="itin-tl-card${s.isClickable?" clickable":""}${s.type==="sleep"?" sleep-card":""}" data-type="${s.type}"${s.isClickable?` onclick="showSlotInfo(${s.ri},${col})"`:""}>
        ${icon?`<span class="itin-tl-icon">${icon}</span>`:""}
        <span class="itin-tl-label">${s.act}</span>
        ${s.isClickable?`<span class="itin-tl-tap">tap ›</span>`:""}
      </div>
    </div>`;
  }).join("");
}

function showSlotInfo(row,col){
  const key=row+"-"+col;
  const d=(data.directions||{})[key];
  const f=(data.foodGuide||{})[key];
  if(!d&&!f)return;

  // Parse "Name (District)" → title + subtitle
  const rawTitle = d?.to || f?.area || "Details";
  const parenMatch = rawTitle.match(/^([^(]+?)\s*\(([^)]+)\)\s*$/);
  const title    = parenMatch ? parenMatch[1].trim() : rawTitle;
  const subtitle = parenMatch ? parenMatch[2].trim() : (d?.from ? `From ${d.from}` : (f?.area ? "Area Guide" : ""));
  const pc=p=>{
    if(p==="tip"||p==="free") return "tip";
    if(p==="$") return "p1";
    if(p==="$$") return "p2";
    return "p3";
  };
  const renderFoodCards=arr=>(arr||[]).map(r=>`
    <div class="rec-food-card">
      <div>
        <div class="rec-food-name">${r.name}</div>
        <div class="rec-food-desc">${r.desc}</div>
      </div>
      <span class="rec-food-badge ${pc(r.price)}">${r.price}</span>
    </div>`).join("");

  let html = `
    <div class="rec-tag"><span class="rec-tag-dot"></span>DESTINATION DETAIL</div>
    <div class="rec-title">${title}</div>
    ${subtitle?`<div class="rec-subtitle">${subtitle}</div>`:""}
  `;

  if(d){
    html += `
      <div class="rec-mode">
        <div class="rec-mode-icon">🚕</div>
        <div>
          <div class="rec-mode-label">RECOMMENDED MODE</div>
          <div class="rec-mode-value">${d.method}</div>
        </div>
      </div>
      <div class="rec-metrics">
        <div class="rec-metric">
          <div class="rec-metric-head"><span class="rec-metric-emoji">🕒</span><span>TIME</span></div>
          <div class="rec-metric-value">${d.time}</div>
        </div>
        <div class="rec-metric">
          <div class="rec-metric-head"><span class="rec-metric-emoji">💵</span><span>ESTIMATE</span></div>
          <div class="rec-metric-value">${d.cost}</div>
        </div>
      </div>
      <div class="rec-steps">
        ${(d.steps||[]).map((s,i)=>`
          <div class="rec-step">
            <div class="rec-step-num">${i+1}</div>
            <div class="rec-step-title">${s}</div>
          </div>
        `).join("")}
      </div>
    `;
  }

  if(f){
    html += `
      <div class="rec-food">
        <div class="rec-food-title">WHERE TO EAT — ${f.area}</div>
        ${(f.cafes&&f.cafes.length)?`<div class="rec-food-section"><div class="rec-food-title">COFFEE & CAFES</div>${renderFoodCards(f.cafes)}</div>`:""}
        ${(f.restaurants&&f.restaurants.length)?`<div class="rec-food-section"><div class="rec-food-title">RESTAURANTS & STREET FOOD</div>${renderFoodCards(f.restaurants)}</div>`:""}
        ${f.note?`<div class="rec-note">💡 ${f.note}</div>`:""}
      </div>
    `;
  }

  html += `
    <div class="rec-footer">
      <span>ITINERARY REF: <strong style="color:rgba(255,255,255,0.75);font-weight:800">BKK-26</strong></span>
      <div style="display:flex;align-items:center;gap:10px">
        <span style="width:8px;height:8px;border-radius:50%;background:rgba(242,194,78,0.8);box-shadow:0 0 0 4px rgba(242,194,78,0.12)"></span>
        <div style="width:34px;height:34px;border-radius:50%;border:1px solid rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,0.6)">🛡️</div>
      </div>
    </div>
  `;

  document.getElementById("dirContent").innerHTML=html;
  document.getElementById("directionsModal").classList.add("show");
}
function closeDirections(){
  document.getElementById("directionsModal").classList.remove("show");
}

// ==================== MUST-TRY ====================
const mustTryData = [
  {
    id:"ratchathewi", emoji:"🏠", name:"Ratchathewi / Pratunam", day:"Home Base", dayClass:"home",
    tags:["Food","Cafes","Shopping","Local"],
    desc:"Your Airbnb neighborhood — a surprisingly great local area with legendary chicken rice, cozy cafes, and easy access to Pratunam's massive fashion malls.",
    sections:[
      {title:"☕ Must-Try Cafes", items:[
        {name:"CASA LAPIN", desc:"Specialty coffee temple — excellent espresso, minimalist interiors", price:"$$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Casa+Lapin+Bangkok", label:"Maps"}]},
        {name:"Mono Cafe", desc:"Scrambled eggs over rice + bacon + 100% Arabica coffee — perfect morning combo", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Mono+Cafe+Ratchathewi+Bangkok", label:"Maps"}]},
        {name:"Piccolo Vicolo", desc:"Hidden alley cafe, lush greenery, great lattes — worth hunting down", price:"$$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Piccolo+Vicolo+Cafe+Bangkok", label:"Maps"}]},
        {name:"Caturday Cat Cafe", desc:"Cozy cat cafe near BTS Ratchathewi — unique experience with great drinks", price:"$$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Caturday+Cat+Cafe+Bangkok", label:"Maps"}]}
      ]},
      {title:"🍴 Must-Eat Restaurants", items:[
        {name:"Go-Ang Pratunam Chicken Rice", desc:"Michelin Bib Gourmand — legendary Hainanese chicken rice, lines form early, cash only", price:"$", address:"960/2 Petchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Go+Ang+Pratunam+Chicken+Rice+Bangkok", label:"Maps"}]},
        {name:"On Lok Yun", desc:"Since 1933 — toast, soft-boiled eggs & Thai iced coffee. Bangkok's most classic breakfast", price:"$", address:"72 Charoen Krung Rd, Bang Rak, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=On+Lok+Yun+Bangkok", label:"Maps"}]},
        {name:"Kaiton Pratunam Chicken Rice", desc:"Late-night chicken rice legend — unmistakable green-pants staff, open past midnight", price:"$", address:"Phetchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Kaiton+Pratunam+Chicken+Rice+Bangkok", label:"Maps"}]},
        {name:"Platinum Fashion Mall Food Court", desc:"Dirt-cheap authentic Thai dishes inside the mall — local favorites, cash only", price:"$", address:"222 Phetchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Platinum+Fashion+Mall+Bangkok", label:"Maps"}]}
      ]},
      {title:"🛍️ Shopping", items:[
        {name:"Platinum Fashion Mall", desc:"5-floor fashion wholesale hub — clothes, accessories, everything cheap. 10 min walk from Airbnb", price:"$", address:"222 Phetchaburi Rd, Pratunam, Bangkok 10400", links:[{url:"https://www.google.com/maps/search/?api=1&query=Platinum+Fashion+Mall+Bangkok", label:"Maps"}]},
        {name:"Pratunam Market", desc:"Street-level clothing stalls, bags, and accessories — great for bargaining", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Pratunam+Market+Bangkok", label:"Maps"}]},
        {name:"CentralWorld", desc:"Massive upscale mall 1 BTS stop away — international brands, food halls, cinema", price:"$$", address:"4 Ratchadamri Rd, Pathum Wan, Bangkok 10330", links:[{url:"https://www.centralworld.co.th/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=CentralWorld+Bangkok", label:"Maps"}]},
        {name:"Big C Supercenter", desc:"Thai supermarket gold — cheap snacks, Thai chips, seasonings to bring home", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Big+C+Ratchathewi+Bangkok", label:"Maps"}]}
      ]},
      {title:"📍 Instagrammable Spots", items:[
        {name:"Piccolo Vicolo Alley", desc:"Green-draped hidden alley cafe — very photogenic entrance", price:"free", links:[{url:"https://www.google.com/maps/search/?api=1&query=Piccolo+Vicolo+Cafe+Bangkok", label:"Maps"}]},
        {name:"CentralWorld Plaza", desc:"Giant open-air plaza — great city shots especially at night", price:"free", address:"4 Ratchadamri Rd, Pathum Wan, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=CentralWorld+Plaza+Bangkok", label:"Maps"}]},
        {name:"Ratchathewi BTS Skywalk", desc:"Glass-covered skywalk connecting to Pratunam — clean lines and city views", price:"free", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ratchathewi+BTS+Station+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"Pratunam Opening Hours", desc:"Platinum Mall: 8AM–8PM. CentralWorld: 10AM–10PM. Street stalls: all day", price:"tip"},
        {name:"BTS Access", desc:"Ratchathewi (N1) is your home station. 1 stop to Siam (CEN), 1 stop to Phaya Thai (ARL)", price:"tip"}
      ]}
    ],
    note:"Your Airbnb is walking distance from some of Bangkok's best value eats and most accessible shopping. Don't overlook this neighborhood!"
  },
  {
    id:"chinatown", emoji:"🏮", name:"Chinatown (Yaowarat)", day:"Day 1", dayClass:"day1",
    tags:["Michelin","Street Food","Night Market","Temple"],
    desc:"Bangkok's most vibrant neighbourhood — neon-lit Yaowarat Road buzzing with street food vendors, Michelin-starred hawker stalls, century-old shophouses, and the energy of a place that never sleeps.",
    sections:[
      {title:"🍜 Michelin & Must-Eat", items:[
        {name:"Lim Lao Ngow", desc:"Michelin Bib Gourmand — Kuay Jab rolled rice noodles in a peppery pork broth, open since 1966", price:"$", address:"539 Yaowarat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Lim+Lao+Ngow+Yaowarat+Bangkok", label:"Maps"}]},
        {name:"Jek Pui Curry Rice", desc:"70+ yr old Michelin Bib Gourmand — pre-made curries ladled over rice from giant pots", price:"$", address:"49 Yaowarat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Jek+Pui+Curry+Rice+Chinatown+Bangkok", label:"Maps"}]},
        {name:"Nai Ek Roll Noodle", desc:"Famous hand-rolled noodles since the 1960s, rich pork broth", price:"$", address:"442 Yaowarat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Nai+Ek+Roll+Noodle+Bangkok", label:"Maps"}]},
        {name:"T&K Seafood", desc:"Iconic green-shirt staff — giant grilled prawns, tom yum, oyster omelette, always packed", price:"$$", address:"49-51 Phadung Dao Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=T%26K+Seafood+Yaowarat+Bangkok", label:"Maps"}]},
        {name:"Guay Jub Ouan Pochana", desc:"Another legendary bowl of rolled noodles — fan favorite for late nights", price:"$", address:"402 Yaowarat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Guay+Jub+Ouan+Pochana+Bangkok", label:"Maps"}]},
        {name:"Pad Thai Fai Ta Lu", desc:"Wok-charred pad thai from a tiny open kitchen — massive queues, worth it", price:"$", address:"115 Soi Phanurangsi, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Pad+Thai+Fai+Ta+Lu+Chinatown+Bangkok", label:"Maps"}]}
      ]},
      {title:"🧋 Trending Drinks & Desserts", items:[
        {name:"Milk & Honey Boba", desc:"Hugely popular Thai-style milk tea and boba stalls along Yaowarat Road", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Milk+Honey+Boba+Yaowarat+Bangkok", label:"Maps"}]},
        {name:"Mango Sticky Rice stalls", desc:"Classic Thai dessert available all along Yaowarat — Mamuang Khao Niaow", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Mango+Sticky+Rice+Yaowarat+Bangkok", label:"Maps"}]},
        {name:"Durian desserts", desc:"Durian pancakes, durian ice cream, and whole durian — it's wild", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Durian+Chinatown+Yaowarat+Bangkok", label:"Maps"}]}
      ]},
      {title:"🛕 Activities & Sights", items:[
        {name:"Wat Mangkon Kamalawat", desc:"Bangkok's largest and most important Chinese temple — ornate interiors, incense, fortune sticks", price:"free", address:"423 Charoen Krung Rd, Samphanthawong, Bangkok 10100", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Mangkon+Kamalawat+Bangkok", label:"Maps"}]},
        {name:"Sampeng Lane (Soi Wanit 1)", desc:"200-year-old market alleyway — wholesale goods, spices, fabrics, novelties. Extremely fun to browse", price:"free", address:"Soi Wanit 1, Samphanthawong, Bangkok 10100", links:[{url:"https://www.google.com/maps/search/?api=1&query=Sampeng+Lane+Soi+Wanit+1+Bangkok", label:"Maps"}]},
        {name:"Khlong Ong Ang Walkway", desc:"Fairy-light canopy walkway along the canal — magical at night, great for photos", price:"free", address:"Khlong Ong Ang, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Ong+Ang+Walkway+Bangkok", label:"Maps"}]},
        {name:"Chinatown Gate (Odeon Circle)", desc:"Iconic red gate at the end of Yaowarat — the classic Chinatown photo backdrop", price:"free", address:"Odeon Circle, Yaowarat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Chinatown+Gate+Odeon+Circle+Yaowarat+Bangkok", label:"Maps"}]},
        {name:"Talat Noi neighbourhood", desc:"Adjacent area with colonial shophouses and street art — easily walkable from Chinatown", price:"free", address:"Talat Noi, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Talat+Noi+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Yaowarat Road at Night", desc:"The neon-lit main strip at night — one of Bangkok's most photogenic scenes", price:"free", address:"Yaowarat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Yaowarat+Road+Bangkok", label:"Maps"}]},
        {name:"Chinatown Gate Arch", desc:"The big red gate — classic backdrop for Chinatown portraits", price:"free", address:"Odeon Circle, Yaowarat Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Chinatown+Gate+Odeon+Circle+Bangkok", label:"Maps"}]},
        {name:"Khlong Ong Ang Lights", desc:"Fairy light canopy over the canal walkway — dreamy evening photos", price:"free", address:"Khlong Ong Ang, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Ong+Ang+Walkway+Bangkok", label:"Maps"}]},
        {name:"Old Shophouse Facades", desc:"Peeling paint, lanterns, vintage signs — endless street photography opportunities", price:"free", address:"Talat Noi & Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Talat+Noi+shophouses+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"Best Time to Go", desc:"Evenings (after 6PM) when street food vendors set up and the neon signs glow", price:"tip"},
        {name:"Getting There", desc:"MRT Blue Line to Wat Mangkon (Chinatown station) — opens 2022, exits right into the action", price:"tip"},
        {name:"Cash Only", desc:"Almost all street food stalls are cash only. Bring small bills (20s and 50s)", price:"tip"}
      ]}
    ],
    note:"Go hungry. Yaowarat Road is one of Asia's greatest street food destinations. Best experienced on foot — just follow your nose."
  },
  {
    id:"songwat", emoji:"🎨", name:"Song Wat + Talat Noi", day:"Day 1", dayClass:"day1",
    tags:["Street Art","Cafes","Hidden Gem","History"],
    desc:"Bangkok's coolest hidden quarter — a network of 200-year-old lanes packed with creative cafes, murals, vintage warehouses turned art spaces, and river views. Completely walkable from Chinatown.",
    sections:[
      {title:"☕ Cafes & Bars", items:[
        {name:"Coffee Room Yaowarat", desc:"Specialty coffee in a beautifully restored shophouse — one of Bangkok's finest", price:"$$", address:"91 Song Wat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Coffee+Room+Yaowarat+Bangkok", label:"Maps"}]},
        {name:"Local Boys Coffee", desc:"Hip minimalist roastery, excellent pour-overs, very Instagrammable", price:"$$", address:"Song Wat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Local+Boys+Coffee+Bangkok", label:"Maps"}]},
        {name:"e-ga Bangkok", desc:"Quirky art-cafe hybrid — mismatched vintage furniture, specialty drinks, gallery vibes", price:"$$", address:"Song Wat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=e-ga+Cafe+Bangkok", label:"Maps"}]},
        {name:"RISE Bar", desc:"Rooftop bar with stunning river views and Wat Arun silhouette — perfect at sunset", price:"$$$", address:"Song Wat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=RISE+Bar+Song+Wat+Bangkok", label:"Maps"}]},
        {name:"The Old Town Knives & Cleavers Building Cafe", desc:"Atmospheric heritage warehouse cafe — thick walls, cool air, great coffee", price:"$$", address:"Talat Noi, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Old+Town+Knives+Cleavers+Building+Bangkok", label:"Maps"}]}
      ]},
      {title:"🎭 Activities & Sights", items:[
        {name:"Street Art Walk (Talat Noi)", desc:"Massive murals cover the walls of Talat Noi — free open-air gallery, new pieces added regularly", price:"free", address:"Talat Noi, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Talat+Noi+Street+Art+Bangkok", label:"Maps"}]},
        {name:"'I Wanna Bangkok' Sign", desc:"The most famous street art installation in the area — iconic photo spot", price:"free", address:"Soi Wanit 2, Talat Noi, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=I+Wanna+Bangkok+Sign+Talat+Noi", label:"Maps"}]},
        {name:"Talat Noi Community Walk", desc:"Explore the narrow sois on foot — heritage shophouses, Chinese shrines, river glimpses", price:"free", address:"Talat Noi, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Talat+Noi+Community+Bangkok", label:"Maps"}]},
        {name:"Wat Khaek (Sri Maha Mariamman)", desc:"Colorful Hindu temple in the area — extraordinary decorative facade", price:"free", address:"2 Pan Rd, Silom, Bang Rak, Bangkok 10500", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Khaek+Sri+Maha+Mariamman+Bangkok", label:"Maps"}]},
        {name:"The Peninsula Pier area", desc:"Walk down to the river edge for stunning views back toward the city", price:"free", address:"Charoen Nakorn Rd, Khlong San, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Peninsula+Bangkok+Pier", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Song Wat Road Murals", desc:"Giant wall murals every few meters along Song Wat Road — endless content", price:"free", address:"Song Wat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Song+Wat+Road+Murals+Bangkok", label:"Maps"}]},
        {name:"'I Wanna Bangkok' Sign", desc:"THE shot of this neighborhood — do it early before crowds", price:"free", address:"Soi Wanit 2, Talat Noi, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=I+Wanna+Bangkok+Sign+Talat+Noi", label:"Maps"}]},
        {name:"RISE Rooftop", desc:"Sunset shots with Wat Arun and the Chao Phraya river from rooftop level", price:"$$$", address:"Song Wat Rd, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=RISE+Bar+Song+Wat+Bangkok", label:"Maps"}]},
        {name:"Talat Noi Lanes", desc:"The narrow sois themselves are photogenic — colonial textures and local life", price:"free", address:"Talat Noi, Samphanthawong, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Talat+Noi+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"Midday timing", desc:"Visit in the mid-afternoon when the light is good for street photography and cafes are quieter", price:"tip"},
        {name:"Walking route", desc:"Start from Chinatown Gate → Song Wat Road → Talat Noi lanes → river viewpoint. 1-2 hours total", price:"tip"}
      ]}
    ],
    note:"Most tourists skip this area — it's one of Bangkok's true hidden gems. Combine with Chinatown for a full Day 1 experience."
  },
  {
    id:"grandpalace", emoji:"👑", name:"Grand Palace + Wat Pho", day:"Day 2", dayClass:"day2",
    tags:["UNESCO","Temple","Massage","Iconic"],
    desc:"Bangkok's most visited landmark — a dazzling complex of golden spires, emerald Buddhas, and ornate Thai architecture. Wat Pho next door houses the world-famous Reclining Buddha and the birthplace of Thai massage.",
    sections:[
      {title:"🏛️ Must-See Sights", items:[
        {name:"Temple of the Emerald Buddha (Wat Phra Kaew)", desc:"Thailand's most sacred temple — the Emerald Buddha inside is only 66cm tall but of immense spiritual significance", price:"free", address:"Na Phra Lan Rd, Phra Borom Maha Ratchawang, Phra Nakhon, Bangkok", links:[{url:"https://www.royalgrandpalace.th/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Wat+Phra+Kaew+Grand+Palace+Bangkok", label:"Maps"}]},
        {name:"Grand Palace Complex", desc:"400-year-old royal complex — stunning Chakri Maha Prasat Hall, ornate Thai architecture throughout", price:"$$", address:"Na Phra Lan Rd, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.royalgrandpalace.th/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Grand+Palace+Bangkok", label:"Maps"}]},
        {name:"Reclining Buddha at Wat Pho", desc:"46m long, 15m tall golden reclining Buddha — extraordinarily detailed mother-of-pearl feet soles", price:"$", address:"2 Sanam Chai Rd, Phra Borom Maha Ratchawang, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.watpho.com/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Wat+Pho+Bangkok", label:"Maps"}]},
        {name:"Phra Mondop (Library)", desc:"Exquisite gilded library building decorated with ceramic tiles — one of Bangkok's most beautiful structures", price:"free", address:"Inside Wat Pho complex, Sanam Chai Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Pho+Bangkok", label:"Maps"}]}
      ]},
      {title:"💆 Experiences", items:[
        {name:"Wat Pho Traditional Thai Massage", desc:"Learn from where Thai massage was founded — 1-hour sessions available (300–450 THB). Book on-site or in advance", price:"$", address:"2 Sanam Chai Rd, Phra Nakhon, Bangkok 10200", links:[{url:"https://watpomassage.com/en", label:"Book"},{url:"https://www.google.com/maps/search/?api=1&query=Wat+Pho+Massage+Bangkok", label:"Maps"}]},
        {name:"Guided Temple Walk", desc:"Official guide services at the Grand Palace entrance — highly recommended for context and history", price:"$", address:"Na Phra Lan Rd, Phra Nakhon, Bangkok", links:[{url:"https://www.royalgrandpalace.th/", label:"Site"}]},
        {name:"Amulet Market (Tha Maharaj)", desc:"Fascinating market of Buddhist amulets and talismans just outside the complex — free to browse", price:"free", address:"Tha Maharaj, Na Phra Lan Rd, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Tha+Maharaj+Amulet+Market+Bangkok", label:"Maps"}]}
      ]},
      {title:"🍴 Where to Eat Nearby", items:[
        {name:"Supanniga Eating Room (Tha Tien)", desc:"Refined Thai cuisine with a rooftop view of Wat Arun across the river — standout Isaan dishes", price:"$$", address:"392/25-26 Soi Phen Phattana 2, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.supannigaeatingroom.com/", label:"Menu"},{url:"https://www.google.com/maps/search/?api=1&query=Supanniga+Eating+Room+Tha+Tien+Bangkok", label:"Maps"}]},
        {name:"Err Urban Rustic Thai", desc:"Michelin Plate — retro shophouse, drinking snacks and Thai sharing plates", price:"$$", address:"394/35 Maha Rat Rd, Phra Borom Maha Ratchawang, Bangkok", links:[{url:"https://errurbanrusticthai.co.th/food", label:"Menu"},{url:"https://www.google.com/maps/search/?api=1&query=Err+Urban+Rustic+Thai+Bangkok", label:"Maps"}]},
        {name:"Krua Apsorn", desc:"Famous crab omelette beloved by locals and royalty for decades — queues are normal", price:"$$", address:"503-505 Samsen Rd, Dusit, Bangkok 10300", links:[{url:"https://www.google.com/maps/search/?api=1&query=Krua+Apsorn+Bangkok", label:"Maps"}]},
        {name:"Tha Tien street food stalls", desc:"Simple noodles, pad thai, mango sticky rice right outside the temple gates", price:"$", address:"Tha Tien, Phra Borom Maha Ratchawang, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Tha+Tien+Street+Food+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Grand Palace Main Gate", desc:"The iconic white-and-gold entrance — classic Bangkok shot", price:"$$", address:"Na Phra Lan Rd, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.google.com/maps/search/?api=1&query=Grand+Palace+Bangkok", label:"Maps"}]},
        {name:"Wat Phra Kaew Yaksha Giants", desc:"The massive guardian demon statues at the entrance — striking portraits", price:"$$", address:"Na Phra Lan Rd, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Phra+Kaew+Bangkok", label:"Maps"}]},
        {name:"Reclining Buddha feet detail", desc:"The intricate mother-of-pearl inlay on the Buddha's feet — extraordinary macro photography", price:"$", address:"2 Sanam Chai Rd, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Pho+Bangkok", label:"Maps"}]},
        {name:"Tha Tien riverside", desc:"Looking across the river to Wat Arun — one of Bangkok's most iconic views", price:"free", address:"Tha Tien Pier, Maharat Rd, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Tha+Tien+Pier+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"Dress Code STRICTLY enforced", desc:"Shoulders and knees must be covered. Sarongs available for rent at the entrance (refundable deposit)", price:"tip"},
        {name:"Go Early", desc:"Open 8:30AM. Arrive before 9AM to beat tour groups — it gets very crowded and very hot by midday", price:"tip"},
        {name:"Entry Fee", desc:"Grand Palace + Wat Phra Kaew: 500 THB (foreigners). Wat Pho: 200 THB — buy separately", price:"tip"},
        {name:"Tuk-tuk scam", desc:"Ignore any tuk-tuk drivers near the entrance saying 'it's closed today' — it's always open", price:"tip"}
      ]}
    ],
    note:"Budget 3–4 hours minimum. The detail on every surface is extraordinary — slow down and look carefully at the mosaics, statues, and murals."
  },
  {
    id:"watarun", emoji:"🌅", name:"Wat Arun (Temple of Dawn)", day:"Day 2", dayClass:"day2",
    tags:["Temple","Sunset","River","Iconic"],
    desc:"One of Thailand's most recognized landmarks — the 79m porcelain-covered prang (tower) of Wat Arun rises dramatically from the west bank of the Chao Phraya, especially spectacular at sunrise and sunset.",
    sections:[
      {title:"🏛️ Must-See", items:[
        {name:"The Central Prang (Tower)", desc:"79 meters of porcelain-encrusted Buddhist tower — climb the steep steps for panoramic river views", price:"$", address:"158 Thanon Wang Doem, Wat Arun, Bangkok Yai, Bangkok 10600", links:[{url:"https://www.wat-arun.com/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Wat+Arun+Bangkok", label:"Maps"}]},
        {name:"Chao Phraya River View", desc:"Standing at Wat Arun looking east at the Bangkok skyline — one of the city's great views", price:"$", address:"Wat Arun, Bangkok Yai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Arun+Bangkok", label:"Maps"}]},
        {name:"Temple Grounds at Sunset", desc:"The prang turns gold in the late afternoon light — photographer's dream shot", price:"$", address:"158 Thanon Wang Doem, Bangkok Yai, Bangkok 10600", links:[{url:"https://www.wat-arun.com/", label:"Site"}]},
        {name:"Ceramic Detail Work", desc:"Thousands of Chinese porcelain fragments embedded into the tower surface — extraordinary up close", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Arun+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Looking across from Tha Tien Pier", desc:"Classic Wat Arun full-view shot from the eastern bank — best at golden hour", price:"free", address:"Tha Tien Pier, Maharat Rd, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Tha+Tien+Pier+Bangkok", label:"Maps"}]},
        {name:"From inside Wat Arun", desc:"City skyline views looking east from the prang steps", price:"$", address:"158 Thanon Wang Doem, Bangkok Yai, Bangkok 10600", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Arun+Bangkok", label:"Maps"}]},
        {name:"The ferry crossing", desc:"Short 5-min river crossing gives great water-level shots of the prang rising from the river", price:"$", address:"Tha Tien Pier → Wat Arun Pier, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Tha+Tien+Pier+Bangkok", label:"Maps"}]},
        {name:"Prang base up close", desc:"Extreme close-up of the porcelain mosaic work — abstract and stunning", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Arun+Bangkok", label:"Maps"}]}
      ]},
      {title:"🚤 Getting There", items:[
        {name:"Cross-river Ferry", desc:"From Tha Tien Pier (next to Wat Pho) — 5 min crossing, boats every 10–15 min, 6AM–9PM", price:"$", address:"Tha Tien Pier, Maharat Rd, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Tha+Tien+Pier+Bangkok", label:"Maps"}]},
        {name:"Entry Fee", desc:"100 THB for foreigners. Dress code enforced — sarongs available at entrance", price:"$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Best Time", desc:"Late afternoon (4–5 PM) for golden light on the prang. Or sunrise for dramatic misty photos with few crowds", price:"tip"},
        {name:"Combine with Grand Palace", desc:"Cross the river from Tha Tien after visiting Grand Palace and Wat Pho — they're all in the same area", price:"tip"}
      ]}
    ],
    note:"The view of Wat Arun from across the river (at sunset!) is arguably Bangkok's single most beautiful sight. Don't miss it."
  },
  {
    id:"ancientcity", emoji:"🏯", name:"Ancient City (Muang Boran)", day:"Day 3", dayClass:"day3",
    tags:["Culture","Outdoor","History","Full Day"],
    desc:"A sprawling 80-hectare open-air museum in Samut Prakan — 116 full-scale replicas of Thailand's most important temples and monuments, set in a map-shaped park. One of Thailand's greatest hidden treasures.",
    sections:[
      {title:"🗺️ Must-See Structures", items:[
        {name:"Sanphet Prasat Palace", desc:"Exact replica of the original Ayutthaya palace — gold spires and teak interiors", price:"$$", address:"296/1 Sukhumvit Rd, Samut Prakan 10280", links:[{url:"https://www.muangboranmuseum.com/en/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Ancient+City+Muang+Boran+Samut+Prakan", label:"Maps"}]},
        {name:"Prasat Hin Phimai", desc:"Replica of the famous Khmer temple in Nakhon Ratchasima — stunning Angkor-era architecture", price:"$$", links:[{url:"https://www.muangboranmuseum.com/en/", label:"Site"}]},
        {name:"Ancient Town of Sukhothai", desc:"Life-size replica of Sukhothai's ancient core — wandering through feels like actual history", price:"$$", links:[{url:"https://www.muangboranmuseum.com/en/", label:"Site"}]},
        {name:"Erawan Museum (nearby)", desc:"Giant three-headed elephant museum nearby — incredible art collection inside", price:"$$", address:"99/9 Moo 1, Sukhumvit Rd, Samut Prakan 10270", links:[{url:"https://www.google.com/maps/search/?api=1&query=Erawan+Museum+Samut+Prakan", label:"Maps"}]},
        {name:"Floating Market Zone", desc:"A recreated floating market inside the park with local vendors and canal boats", price:"$", links:[{url:"https://www.muangboranmuseum.com/en/", label:"Site"}]}
      ]},
      {title:"🚴 Activities", items:[
        {name:"Rent a Bicycle", desc:"Bicycle rental inside the park (~50 THB) — essential for covering the 80 hectare grounds", price:"$", links:[{url:"https://www.muangboranmuseum.com/en/ticket/", label:"Tickets"}]},
        {name:"Golf Cart Rental", desc:"Electric golf carts available for rent — great for groups or if it's too hot to cycle", price:"$$", links:[{url:"https://www.muangboranmuseum.com/en/ticket/", label:"Tickets"}]},
        {name:"Guided Segway Tour", desc:"Segway tours of the park available — fun way to cover ground quickly", price:"$$", links:[{url:"https://www.muangboranmuseum.com/en/ticket/", label:"Tickets"}]},
        {name:"Cultural Performances", desc:"Live performances of traditional Thai dance and drama on weekends", price:"free", links:[{url:"https://www.muangboranmuseum.com/en/", label:"Site"}]}
      ]},
      {title:"🍴 Food Inside the Park", items:[
        {name:"Central Food Court", desc:"Main food court near the park entrance — pad thai, som tam, curries, and drinks", price:"$", address:"296/1 Sukhumvit Rd, Samut Prakan 10280", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ancient+City+Muang+Boran+Samut+Prakan", label:"Maps"}]},
        {name:"Canal-side Stalls", desc:"Scattered food stalls throughout the park — boat noodles, grilled meats, Thai sweets", price:"$"},
        {name:"Floating Market Food", desc:"Vendor boats serving local dishes along the canals inside the replica floating market zone", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Sanphet Prasat Reflection Pool", desc:"The palace reflected in the surrounding moat — stunning symmetry for photos", price:"$$", address:"296/1 Sukhumvit Rd, Samut Prakan 10280", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ancient+City+Muang+Boran+Samut+Prakan", label:"Maps"}]},
        {name:"Khmer Temple Silhouette", desc:"The Prasat Hin Phimai replica photographed against the sky looks remarkably like the real thing", price:"$$"},
        {name:"Ancient Town Street", desc:"Walking through the replica ancient town feels like a film set — endless photography", price:"$$"},
        {name:"Early Morning Mist", desc:"Arrive right at opening (9AM) for atmospheric mist over the structures", price:"$$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Entry Fee", desc:"700 THB (adult foreigners). Discounted to 350 THB after 4PM — great if doing a half-day afternoon visit", price:"tip"},
        {name:"How to Get There", desc:"BTS to Kheha (E24 terminus) then Grab to the entrance (~15 min, 80–100 THB). Total ~1.5hrs from Ratchathewi", price:"tip"},
        {name:"Time Required", desc:"Allow a full day (6+ hours) to see everything properly. It's genuinely huge", price:"tip"},
        {name:"What to Bring", desc:"Sunscreen, water, and comfortable walking shoes. It's very exposed — hat essential", price:"tip"}
      ]}
    ],
    note:"Massively underrated and often skipped by tourists. This is genuinely one of the best cultural experiences in all of Southeast Asia."
  },
  {
    id:"chatuchak", emoji:"🛍️", name:"Chatuchak Weekend Market", day:"Day 4", dayClass:"day4",
    tags:["Market","Shopping","Food","Massive"],
    desc:"One of the world's largest weekend markets — 15,000+ stalls across 27 zones covering everything from vintage clothing and antiques to live animals, street food, and local design. Pure organized chaos.",
    sections:[
      {title:"🍜 Must-Try Food", items:[
        {name:"Coco JJ Coconut Ice Cream", desc:"THE iconic Chatuchak experience — coconut ice cream served in a coconut husk with toppings (~50 THB). Queue is worth it", price:"$", address:"Near Gate 1, Chatuchak Weekend Market, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Coco+JJ+Coconut+Ice+Cream+Chatuchak+Bangkok", label:"Maps"}]},
        {name:"King Octopus", desc:"Whole octopus grilled and sliced on the spot — spectacular spectacle and delicious", price:"$", address:"Section 26, Chatuchak Market, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=King+Octopus+Chatuchak+Market+Bangkok", label:"Maps"}]},
        {name:"Big Shrimp Pad Thai", desc:"Massive shrimp pad thai wok-fried fresh — always packed with good reason", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Pad+Thai+Chatuchak+Market+Bangkok", label:"Maps"}]},
        {name:"Moo Yang (Honey Roast Pork)", desc:"Sweet-savory grilled pork skewers, multiple vendors throughout the market", price:"$"},
        {name:"Khanom Krok", desc:"Crispy coconut-cream pancakes cooked in round cast-iron molds — sweet/savory versions", price:"$"},
        {name:"Thai Iced Tea stalls", desc:"Bright orange cha yen — everywhere, perfect for the heat", price:"$"}
      ]},
      {title:"🛍️ Shopping Highlights", items:[
        {name:"Zones 2–6 (Clothing)", desc:"Vintage, streetwear, indie labels, custom pieces — best clothing zone in any market in Asia", price:"$", address:"587 Kamphaeng Phet 2 Rd, Chatuchak, Bangkok", links:[{url:"https://www.chatuchakmarket.org/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Chatuchak+Weekend+Market+Bangkok", label:"Maps"}]},
        {name:"Zone 7 (Art & Crafts)", desc:"Local artists selling original prints, ceramics, jewellery, and handmade goods", price:"$"},
        {name:"Zone 13 (Antiques)", desc:"Vintage Thai goods, Buddha statues, old coins, colonial-era items", price:"$$"},
        {name:"Zone 26 (Books)", desc:"Secondhand books, vintage magazines, old maps — treasure-hunting paradise", price:"$"},
        {name:"JJ Mall (indoor)", desc:"Air-conditioned indoor extension of Chatuchak — fashion, accessories, cafes. Great heat escape", price:"$", address:"Kamphaeng Phet 3 Rd, Chatuchak, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=JJ+Mall+Chatuchak+Bangkok", label:"Maps"}]}
      ]},
      {title:"☕ Cafes", items:[
        {name:"Nana Coffee Roasters", desc:"Award-winning roastery just outside Chatuchak — famous for their timber ring croissants and exceptional pour-over", price:"$$", address:"Ari, Phaya Thai, Bangkok", links:[{url:"https://nanacoffeeroasters.com/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Nana+Coffee+Roasters+Ari+Bangkok", label:"Maps"}]},
        {name:"Glig Cafe (Ari)", desc:"Seoul-inspired minimalist cafe a few stops south — great for a post-market coffee", price:"$$", address:"Ari, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Glig+Cafe+Ari+Bangkok", label:"Maps"}]},
        {name:"Chatuchak Park Stalls", desc:"Multiple iced coffee and fresh fruit juice stalls throughout the market", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Coconut Ice Cream Shot", desc:"Coco JJ — the coconut shell + colorful toppings + holding it = perfect market food shot", price:"$", address:"Near Gate 1, Chatuchak Market, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Coco+JJ+Chatuchak+Bangkok", label:"Maps"}]},
        {name:"King Octopus in action", desc:"Video the whole octopus being sliced — dramatic and viral-worthy", price:"$"},
        {name:"Chatuchak Market Clock Tower", desc:"The central clock tower is the landmark navigation point — great orientation shot", price:"free", address:"Center of Chatuchak Weekend Market, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Chatuchak+Market+Clock+Tower+Bangkok", label:"Maps"}]},
        {name:"Vintage clothing stalls", desc:"Racks upon racks of colorful vintage — styled shots in the clothing zone", price:"$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Opening Hours", desc:"Saturday–Sunday only, 9AM–6PM. Gets extremely crowded 11AM–2PM — go early or late", price:"tip"},
        {name:"Cash Only", desc:"Vast majority of vendors are cash only. Plenty of ATMs on site", price:"tip"},
        {name:"Navigation", desc:"Get the free Chatuchak map at the entrance. Section signs are color-coded. Food is near the clock tower", price:"tip"},
        {name:"Getting There", desc:"BTS Mo Chit (N8, Exit 1) or MRT Kamphaeng Phet (Exit 2) — MRT drops you right inside the market", price:"tip"}
      ]}
    ],
    note:"Wear light clothing, bring cash, and go early before it gets unbearably hot. Budget 3–5 hours minimum. The market is genuinely enormous."
  },
  {
    id:"bangsuejolun", emoji:"🎪", name:"Bang Sue / Ari + Ace Jolun", day:"Day 4", dayClass:"day4",
    tags:["Street Art","Cool Kids","Cafes","Local Scene"],
    desc:"Bangkok's trendiest local neighborhoods — Ari is the city's most coveted residential district lined with indie cafes, artisan bakeries and boutiques. Ace Jolun is a creative compound with street art, food vendors and design shops.",
    sections:[
      {title:"☕ Cafes & Bakeries", items:[
        {name:"Nana Coffee Roasters", desc:"Award-winning roastery — their timber ring croissants are legendary, specialty pour-over coffee", price:"$$", address:"24/2 Ari 4 Alley, Samsen Nai, Phaya Thai, Bangkok 10400", links:[{url:"https://nanacoffeeroasters.com/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Nana+Coffee+Roasters+Ari+Bangkok", label:"Maps"}]},
        {name:"Glig Cafe", desc:"Seoul-inspired minimalist cafe — great pour-over, very photogenic interior", price:"$$", address:"Ari, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Glig+Cafe+Ari+Bangkok", label:"Maps"}]},
        {name:"Yellow Lane", desc:"Converted shophouse cafe famous for Japanese-style sandos (sandwiches) and good coffee", price:"$$", address:"Ari Soi 4, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Yellow+Lane+Cafe+Ari+Bangkok", label:"Maps"}]},
        {name:"Landhaus Bakery", desc:"Authentic Austrian-Bavarian bakery — fresh-baked sourdough, pretzels, and pastries", price:"$$", address:"Ari, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Landhaus+Bakery+Bangkok", label:"Maps"}]},
        {name:"Bar Storia", desc:"All-day brunch in a European-vintage setting — stunning decor, great food photos", price:"$$", address:"Ari, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Bar+Storia+Ari+Bangkok", label:"Maps"}]}
      ]},
      {title:"🎨 Activities", items:[
        {name:"Ace Jolun Creative Compound", desc:"Bangkok's hippest creative hub — street art compound with pop-up food stalls, design shops, weekend market", price:"free", address:"Phaholyothin Soi 2, Sam Sen Nai, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ace+Jolun+Bangkok", label:"Maps"}]},
        {name:"Pearl Art Space", desc:"Contemporary art gallery in Ari — rotating exhibitions, free to browse", price:"free", address:"Ari, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Pearl+Art+Space+Ari+Bangkok", label:"Maps"}]},
        {name:"Or Tor Kor Market", desc:"Premium fresh market right next to Chatuchak — high-quality fruits, ready-to-eat Thai food, famous for durian", price:"$", address:"101 Kamphaeng Phet Rd, Chatuchak, Bangkok 10900", links:[{url:"https://www.google.com/maps/search/?api=1&query=Or+Tor+Kor+Market+Bangkok", label:"Maps"}]},
        {name:"Ari Walking Street", desc:"Phaholyothin Soi 7 area — great street-level exploration with local shops and cafes", price:"free", address:"Phaholyothin Soi 7, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ari+Walking+Street+Bangkok", label:"Maps"}]}
      ]},
      {title:"🍴 Restaurants", items:[
        {name:"Or Tor Kor Market Food Stalls", desc:"Premium prepared foods — northern Thai dishes, fresh seafood, tropical fruits", price:"$", address:"101 Kamphaeng Phet Rd, Chatuchak, Bangkok 10900", links:[{url:"https://www.google.com/maps/search/?api=1&query=Or+Tor+Kor+Market+Bangkok", label:"Maps"}]},
        {name:"Soul Food Mahanakorn", desc:"Beloved Thai comfort food restaurant in Ari — craft cocktails, excellent local dishes", price:"$$", address:"56/10 Sukhumvit Soi 55 (Thonglor), Watthana, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Soul+Food+Mahanakorn+Bangkok", label:"Maps"}]},
        {name:"Ace Jolun Food Vendors", desc:"Rotating food vendors inside the compound — typically great quality street food", price:"$", address:"Phaholyothin Soi 2, Sam Sen Nai, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ace+Jolun+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Ace Jolun Street Art", desc:"Entire compound covered in murals — Bangkok street art at its best", price:"free", address:"Phaholyothin Soi 2, Sam Sen Nai, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ace+Jolun+Bangkok", label:"Maps"}]},
        {name:"Nana Coffee Roasters Timber Ring Croissant", desc:"The most photogenic pastry in Bangkok — get it before noon (sells out)", price:"$$", address:"24/2 Ari 4 Alley, Phaya Thai, Bangkok", links:[{url:"https://nanacoffeeroasters.com/", label:"Site"}]},
        {name:"Yellow Lane Sando", desc:"Japanese-style egg sando or katsu sando — beloved food photography subject", price:"$$", address:"Ari Soi 4, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Yellow+Lane+Ari+Bangkok", label:"Maps"}]},
        {name:"Ari's cafe exteriors", desc:"The whole street is lined with photogenic converted shophouses", price:"free", address:"Ari Soi 1–7, Phaya Thai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Ari+BTS+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"Getting to Ari", desc:"BTS Ari (N5) — exit right into the neighborhood. Everything is walkable from the station", price:"tip"},
        {name:"Ace Jolun Location", desc:"Near Phaholyothin Soi 2 (a short Grab from Ari BTS). Weekend events are especially lively", price:"tip"},
        {name:"Or Tor Kor", desc:"Right next to Chatuchak MRT/BTS stations — easy to combine in one visit", price:"tip"}
      ]}
    ],
    note:"Perfect for the late afternoon after Chatuchak. The Ari neighborhood gives a real glimpse of how cool Bangkok locals actually live."
  },
  {
    id:"iconsiam", emoji:"🏙️", name:"ICONSIAM", day:"Day 4", dayClass:"day4",
    tags:["Mall","Luxury","River","Must-See"],
    desc:"Bangkok's most spectacular shopping mall — a 525,000 sqm riverside megadevelopment that feels more like a theme park. Home to SookSiam (indoor floating market), river water shows, and spectacular skyline views.",
    sections:[
      {title:"🌟 Must-Do Experiences", items:[
        {name:"SookSiam Indoor Floating Market", desc:"Full-size traditional Thai floating market recreated indoors on the ground floor — regional food and crafts from all 77 provinces. Completely unique", price:"free", address:"ICONSIAM G/F, 299 Charoen Nakhon Rd, Khlong Ton Sai, Bangkok 10600", links:[{url:"https://www.iconsiam.com/en/attractions/sooksiam", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Bangkok", label:"Maps"}]},
        {name:"Chao Phraya River Waterfront", desc:"The outdoor riverside promenade — stunning views back at Bangkok skyline, especially at sunset", price:"free", address:"299 Charoen Nakhon Rd, Khlong San, Bangkok 10600", links:[{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Riverside+Bangkok", label:"Maps"}]},
        {name:"Light and Water Show", desc:"Free nightly water and light show on the river — check times at the venue", price:"free", links:[{url:"https://www.iconsiam.com/", label:"Site"}]},
        {name:"Glass Bridge", desc:"The iconic glass-floored bridge over the ground-floor water feature — great for photos", price:"free", address:"ICONSIAM G/F, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Bangkok", label:"Maps"}]}
      ]},
      {title:"🛍️ Shopping", items:[
        {name:"ICONLUXE", desc:"Separate luxury wing — Hermes, Chanel, LV, Dior, Cartier, and more. Just window shopping is fun", price:"$$$", links:[{url:"https://www.iconsiam.com/", label:"Site"}]},
        {name:"Thai Design Brands Zone", desc:"Dedicated section for Thai-designed fashion, accessories, and homewares — unique souvenirs", price:"$$", links:[{url:"https://www.iconsiam.com/", label:"Site"}]},
        {name:"Takashimaya (ICONSIAM)", desc:"Japanese department store concept — great for quality products and food hall", price:"$$", links:[{url:"https://www.iconsiam.com/", label:"Site"}]},
        {name:"Free Tourist Card", desc:"Get the ICONSIAM Tourist Privilege Card at the info desk — free discounts at many shops and restaurants", price:"free", links:[{url:"https://www.iconsiam.com/", label:"Site"}]}
      ]},
      {title:"🍴 Restaurants", items:[
        {name:"Baan Khanitha", desc:"Legendary upscale Thai cuisine — refined royal Thai dishes in an elegant setting", price:"$$$", address:"ICONSIAM 4/F, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.baan-khanitha.com/", label:"Menu"},{url:"https://www.google.com/maps/search/?api=1&query=Baan+Khanitha+ICONSIAM+Bangkok", label:"Maps"}]},
        {name:"Fallabella Riverfront", desc:"European riverside dining with excellent views of the Chao Phraya", price:"$$$", address:"ICONSIAM, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Fallabella+ICONSIAM+Bangkok", label:"Maps"}]},
        {name:"SookSiam Food Stalls", desc:"Authentic regional Thai food from every province — excellent value, eat like a local", price:"$", address:"ICONSIAM G/F, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.sooksiam.com/", label:"Site"}]},
        {name:"ICONSIAM Food Hall", desc:"Curated food hall on the upper floors — Thai and international, better quality than average mall food", price:"$$", links:[{url:"https://www.iconsiam.com/", label:"Site"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"SookSiam Gondola Boats", desc:"Actual wooden gondola boats floating inside the mall — unreal photo opportunity", price:"free", address:"ICONSIAM G/F, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Bangkok", label:"Maps"}]},
        {name:"Chao Phraya at Sunset", desc:"The riverside promenade at golden hour — Bangkok skyline reflected in the water", price:"free", address:"ICONSIAM Riverside, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Riverside+Bangkok", label:"Maps"}]},
        {name:"Glass Bridge Over Water", desc:"Standing on the glass floor bridge looking down at the water below", price:"free", address:"ICONSIAM G/F, 299 Charoen Nakhon Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Bangkok", label:"Maps"}]},
        {name:"ICONSIAM exterior at night", desc:"The illuminated facade reflected in the river — spectacular wide-angle photography", price:"free", address:"299 Charoen Nakhon Rd, Khlong San, Bangkok 10600", links:[{url:"https://www.google.com/maps/search/?api=1&query=ICONSIAM+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"How to Get There", desc:"BTS to Saphan Taksin (S6), then take the free ICONSIAM shuttle boat (every 15 min, 16:00–23:30). Or BTS Gold Line to Charoen Nakhon", price:"tip"},
        {name:"Tourist Card", desc:"Get the free tourist privilege card at the information desk on arrival — saves money at shops and restaurants", price:"tip"},
        {name:"Opening Hours", desc:"10AM–10PM daily. Restaurants often open until midnight", price:"tip"}
      ]}
    ],
    note:"Don't just treat this as a shopping mall — SookSiam alone is worth the trip. The riverside views at sunset are among Bangkok's best."
  },
  {
    id:"khaosan", emoji:"🍻", name:"Khao San Road", day:"Day 4", dayClass:"day4",
    tags:["Nightlife","Street Food","Backpacker","Michelin"],
    desc:"Bangkok's most famous backpacker strip — a chaotic, neon-lit carnival of street food, bars, clothing stalls, and international travelers. Touristy? Yes. Worth experiencing? Absolutely.",
    sections:[
      {title:"🍴 Michelin & Must-Eat", items:[
        {name:"Pad Thai Thip Samai", desc:"'The best Pad Thai in Bangkok' — wrapped in egg, ultra-thin noodles, 15 min walk away. Queue up", price:"$", address:"313 Maha Chai Rd, Samran Rat, Phra Nakhon, Bangkok 10200", links:[{url:"https://thipsamai.com/our-menu/", label:"Menu"},{url:"https://www.google.com/maps/search/?api=1&query=Pad+Thai+Thip+Samai+Bangkok", label:"Maps"}]},
        {name:"Khao San Sek", desc:"Michelin Guide 2025 — build-your-own Thai set menu in a beautiful townhouse. Make a reservation", price:"$$$", address:"Khao San Rd, Talat Yot, Phra Nakhon, Bangkok", links:[{url:"https://www.khaosansek.com/reservation", label:"Reserve"},{url:"https://www.google.com/maps/search/?api=1&query=Khao+San+Sek+Bangkok", label:"Maps"}]},
        {name:"Raan Jay Fai", desc:"Michelin-starred street food legend — famous crab omelette and drunken noodles. Queue from 7AM, opens 9AM (no reservations)", price:"$$$", address:"327 Maha Chai Rd, Samran Rat, Phra Nakhon, Bangkok 10200", links:[{url:"https://guide.michelin.com/us/en/bangkok-region/bangkok/restaurant/jay-fai", label:"Michelin"},{url:"https://www.google.com/maps/search/?api=1&query=Raan+Jay+Fai+Bangkok", label:"Maps"}]},
        {name:"Praya Dining", desc:"Michelin Guide-listed riverside dining in a stunning century-old colonial villa — accessible by boat only", price:"$$$", address:"757/1 Somdet Phra Pin Klao Rd, Arun Amarin, Bangkok Noi, Bangkok 10700", links:[{url:"https://prayapalazzo.com/praya-dining/", label:"Menu"},{url:"https://www.google.com/maps/search/?api=1&query=Praya+Palazzo+Bangkok", label:"Maps"}]}
      ]},
      {title:"🍹 Nightlife & Bars", items:[
        {name:"Brick Bar", desc:"Legendary Khao San live music bar — Thai bands playing rock covers, great atmosphere", price:"$$", address:"265 Khao San Rd, Talat Yot, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Brick+Bar+Khao+San+Bangkok", label:"Maps"}]},
        {name:"The Club (Khao San)", desc:"Bangkok's most iconic backpacker club — cheap buckets, packed dance floor, 2AM closing", price:"$$", address:"Khao San Rd, Talat Yot, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=The+Club+Khao+San+Bangkok", label:"Maps"}]},
        {name:"Roof Bar Khao San", desc:"Rooftop bar above the street level — elevated views of the Khao San chaos below", price:"$$", address:"Khao San Rd, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Roof+Bar+Khao+San+Bangkok", label:"Maps"}]},
        {name:"Soi Rambuttri", desc:"The slightly calmer, cooler parallel street — better bars, more mature crowd, still very fun", price:"$$", address:"Soi Rambuttri, Talat Yot, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Soi+Rambuttri+Bangkok", label:"Maps"}]}
      ]},
      {title:"🛍️ Street Shopping", items:[
        {name:"Custom stamp souvenirs", desc:"Thai name stamps carved on the spot — a classic backpacker souvenir", price:"$"},
        {name:"Harem pants and tie-dye", desc:"The quintessential Southeast Asia backpacker market clothing", price:"$"},
        {name:"Thai boxing shorts", desc:"Genuine Muay Thai shorts for ~200 THB — actually high quality", price:"$"}
      ]},
      {title:"🛕 Sights Nearby", items:[
        {name:"Wat Chana Songkhram", desc:"Peaceful temple directly opposite the chaos of Khao San — beautiful contrast", price:"free", address:"Chakrabongse Rd, Talat Yot, Phra Nakhon, Bangkok 10200", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wat+Chana+Songkhram+Bangkok", label:"Maps"}]},
        {name:"Sanam Luang (Royal Field)", desc:"Large open ceremonial ground near the Grand Palace — 10 min walk", price:"free", address:"Na Phra Lan, Phra Borom Maha Ratchawang, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Sanam+Luang+Bangkok", label:"Maps"}]},
        {name:"Soi Rambuttri Area", desc:"The whole area around Rambuttri is full of atmospheric little cafes and guesthouses", price:"free", address:"Soi Rambuttri, Talat Yot, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Soi+Rambuttri+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Thip Samai Pad Thai", desc:"The famous egg-wrapped pad thai is a great food photo subject — shoot before eating", price:"$", address:"313 Maha Chai Rd, Bangkok", links:[{url:"https://thipsamai.com/our-menu/", label:"Menu"},{url:"https://www.google.com/maps/search/?api=1&query=Pad+Thai+Thip+Samai+Bangkok", label:"Maps"}]},
        {name:"Khao San Road at Night", desc:"The whole strip lit up at night — chaotic, colorful, cinematic", price:"free", address:"Khao San Rd, Talat Yot, Phra Nakhon, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khao+San+Road+Bangkok", label:"Maps"}]},
        {name:"Thai Boxing Shorts Market", desc:"Rows of Muay Thai shorts hanging in the market stalls — colorful and very Thai", price:"$"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Thip Samai Queue", desc:"Pad Thai Thip Samai opens at 5PM — arrive early or expect a 30-45 min queue. Worth it", price:"tip"},
        {name:"Raan Jay Fai", desc:"Close to Khao San, closes when ingredients run out — try to go for early dinner, not late night", price:"tip"},
        {name:"Stay safe", desc:"Ignore tuk-tuk offers near Khao San, keep bags in front, normal urban common sense applies", price:"tip"}
      ]}
    ],
    note:"Even if you hate tourist traps — at least one night on Khao San Road is a Bangkok rite of passage. Lean into the chaos."
  },
  {
    id:"asiatique", emoji:"🎡", name:"Asiatique The Riverfront", day:"Day 1", dayClass:"day1",
    tags:["Nightlife","Shows","River","Shopping"],
    desc:"Bangkok's most popular riverside night bazaar — a sprawling warehouse district transformed into an open-air shopping, dining, and entertainment complex. Free ferry from Sathorn Pier, free Ferris wheel views, nightly shows.",
    sections:[
      {title:"🎭 Must-Do Shows", items:[
        {name:"Calypso Cabaret (Ladyboy Show)", desc:"World-famous Thai cabaret show — elaborate costumes, lip-sync performances, fantastic entertainment. Shows at 19:30 and 21:00", price:"$$", address:"Asiatique Warehouse 3, 2194 Charoen Krung Rd, Bangkok 10120", links:[{url:"https://www.klook.com/activity/361-calypso-cabaret-show-bangkok/", label:"Book"},{url:"https://www.google.com/maps/search/?api=1&query=Calypso+Cabaret+Asiatique+Bangkok", label:"Maps"}]},
        {name:"Muay Thai Live Show", desc:"Professional Muay Thai boxing show at the dedicated arena — Tue–Sun, shows at 8PM", price:"$$", address:"Asiatique The Stage, 2194 Charoen Krung Rd, Bangkok 10120", links:[{url:"https://www.muaythailive.com/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Muay+Thai+Live+Asiatique+Bangkok", label:"Maps"}]},
        {name:"Asiatique Sky Ferris Wheel", desc:"60m Ferris wheel with panoramic Chao Phraya views — book online for discounts", price:"$", address:"2194 Charoen Krung Rd, Bang Kho Laem, Bangkok 10120", links:[{url:"https://www.asiatiquethailand.com/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Asiatique+The+Riverfront+Bangkok", label:"Maps"}]}
      ]},
      {title:"🎡 Attractions", items:[
        {name:"60m Observation Ferris Wheel", desc:"Ride the giant Ferris wheel for panoramic views over the Chao Phraya — a signature Asiatique experience", price:"$", address:"Asiatique The Riverfront, Charoen Krung Rd, Bangkok", links:[{url:"https://www.asiatiquethailand.com/", label:"Site"}]},
        {name:"Sirimahannop Ship", desc:"Full-size replica of a vintage ship permanently moored — houses restaurants and is extraordinarily photogenic at night", price:"free", address:"Asiatique Pier, 2194 Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Sirimahannop+Ship+Asiatique+Bangkok", label:"Maps"}]},
        {name:"1,500+ Shopping Stalls", desc:"Clothing, accessories, Thai crafts, souvenirs — wandering the warehouse corridors is entertaining itself", price:"free", address:"2194 Charoen Krung Rd, Bang Kho Laem, Bangkok 10120", links:[{url:"https://www.asiatiquethailand.com/", label:"Site"}]}
      ]},
      {title:"🍴 Restaurants", items:[
        {name:"Sirimahannop Restaurant", desc:"Dining aboard the ship replica — steaks, seafood, Thai fusion, stunning ambiance", price:"$$$", address:"Asiatique Pier, 2194 Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Sirimahannop+Restaurant+Bangkok", label:"Maps"}]},
        {name:"Wine I Love You", desc:"Live music, open-air riverside seating, 3-course set menu with wine pairings", price:"$$$", address:"Asiatique, 2194 Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Wine+I+Love+You+Asiatique+Bangkok", label:"Maps"}]},
        {name:"Happy Fish", desc:"European and Thai seafood with excellent river views", price:"$$", address:"Asiatique, 2194 Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Happy+Fish+Asiatique+Bangkok", label:"Maps"}]},
        {name:"Peppery Thai Bistro", desc:"Elevated authentic Thai cuisine with beautiful plating", price:"$$", address:"Asiatique, 2194 Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Peppery+Thai+Bistro+Asiatique+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Sirimahannop at Night", desc:"The illuminated ship replica against the dark river — one of the most dramatic shots in Bangkok", price:"free", address:"Asiatique Pier, 2194 Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Asiatique+The+Riverfront+Bangkok", label:"Maps"}]},
        {name:"Ferris Wheel at Night", desc:"The glowing Ferris wheel reflected in the river — spectacular wide shots", price:"$", links:[{url:"https://www.asiatiquethailand.com/", label:"Site"}]},
        {name:"Riverside Promenade", desc:"Walking the riverside with the Bangkok skyline across the water", price:"free", address:"Asiatique Riverfront, Charoen Krung Rd, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Asiatique+Riverside+Bangkok", label:"Maps"}]},
        {name:"Warehouse corridors", desc:"The lit-up night market corridors with shopfronts — very atmospheric and photogenic", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Getting There", desc:"BTS to Saphan Taksin (S6) → free Asiatique shuttle boat from Sathorn Pier (runs 16:00–23:30, every 30 min)", price:"tip"},
        {name:"Opening Hours", desc:"Opens 17:00, most active 18:00–23:00. Last shuttle boat back ~23:30", price:"tip"},
        {name:"Calypso Tickets", desc:"Book Calypso Cabaret tickets online in advance — shows sell out on weekends", price:"tip"},
        {name:"Dinner Timing", desc:"Eat dinner at Asiatique before the 19:30 show — everything is walkable within the complex", price:"tip"}
      ]}
    ],
    note:"Best visited in the evening — everything comes alive after dark. Make it a dinner + show night for the full experience."
  },
  {
    id:"khlonglatmayom", emoji:"⛵", name:"Khlong Lat Mayom Floating Market", day:"Day 5", dayClass:"day5",
    tags:["Floating Market","Local","Canal Food","Weekend Only"],
    desc:"Bangkok's most beloved traditional floating market — a genuine local experience far from the tourist trail. Wooden boats loaded with food line the Khlong Lat Mayom canal, weekends only.",
    sections:[
      {title:"🍽️ Must-Try Canal Food", items:[
        {name:"Pla Pao (Salt-Crusted Grilled Fish)", desc:"THE signature dish — whole snakehead fish encrusted in salt and grilled over charcoal, served with spicy dipping sauce. Unmissable", price:"$", address:"Khlong Lat Mayom Floating Market, Bang Raek Yai, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Lat+Mayom+Floating+Market+Bangkok", label:"Maps"}]},
        {name:"Hoi Tod (Crispy Oyster Omelette)", desc:"Pan-fried oysters in a crispy egg batter — a canal-side classic", price:"$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Lat+Mayom+Floating+Market+Bangkok", label:"Maps"}]},
        {name:"Boat Noodles", desc:"Rich pork or beef broth noodles served from canal-side boats — ~30 THB per bowl, must eat 3+", price:"$"},
        {name:"Kanom Jeen (Rice Vermicelli + Curry)", desc:"Cold rice noodles served with green or fish curry — quintessentially Thai, unique to markets like this", price:"$"},
        {name:"Foy Thong (Golden Threads)", desc:"Delicate Thai dessert of sweet egg yolk threads spun into golden wisps — very traditional, very special", price:"$"},
        {name:"Mango Sticky Rice", desc:"Classic khao niaow ma muang — glutinous rice with fresh mango and coconut cream from floating vendors", price:"$"}
      ]},
      {title:"🚣 Market Experience", items:[
        {name:"Walk the Canal Boardwalk", desc:"The entire market lines the canal edges — walk the full length and back to see everything before choosing", price:"free", address:"Khlong Lat Mayom Canal, Bang Raek Yai, Taling Chan, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Lat+Mayom+Floating+Market+Bangkok", label:"Maps"}]},
        {name:"Boat Vendor Interaction", desc:"Vendors paddle wooden boats right to the bank — wave them over, point, pay cash", price:"free"},
        {name:"Paddleboat Rental", desc:"Rent a small paddleboat to explore the canal from the water — unique perspective", price:"$"}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Salt-Crusted Fish on the Grill", desc:"The whole fish crusted in white salt on a charcoal grill — dramatic food photography", price:"$", address:"Khlong Lat Mayom Market, Taling Chan, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Lat+Mayom+Floating+Market+Bangkok", label:"Maps"}]},
        {name:"Wooden Boats on the Canal", desc:"Overloaded wooden vendor boats on the canal — quintessential Thai floating market shot", price:"free", address:"Khlong Lat Mayom Canal, Taling Chan, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Khlong+Lat+Mayom+Floating+Market+Bangkok", label:"Maps"}]},
        {name:"Golden Threads Dessert", desc:"Foy Thong — the intricate golden egg threads are visually extraordinary and unique", price:"$"},
        {name:"Canal Reflections", desc:"Early morning when the market opens, the canal is mirror-calm — perfect reflection shots", price:"free"}
      ]},
      {title:"💡 Tips", items:[
        {name:"Weekends Only", desc:"Saturday and Sunday only, 8AM–5PM. Opens early — go before 11AM to beat the crowds", price:"tip"},
        {name:"Getting There", desc:"Option A: BTS Bang Wa (S12 terminus) then taxi. Option B: Free shuttle from MRT Bang Khun Non (Exit 3) weekends only. Option C: Direct Grab (~200 THB)", price:"tip"},
        {name:"Cash Only", desc:"Bring small Thai baht bills. No card or phone pay accepted at most stalls", price:"tip"},
        {name:"Mosquito Repellent", desc:"It's a canal market — bring repellent especially for morning visits", price:"tip"}
      ]}
    ],
    note:"This is the real deal. Khlong Lat Mayom is what floating markets used to be before tourist dollars changed them. Go early, eat everything."
  },
  {
    id:"pratunam", emoji:"🏬", name:"Pratunam / CentralWorld Area", day:"Day 2", dayClass:"day2",
    tags:["Shopping","Malls","Rooftop","Sky Bars"],
    desc:"Bangkok's commercial core — from Platinum Fashion Mall's floor-to-ceiling cheap fashion to CentralWorld's 8 floors of international brands, capped with rooftop bars and sky-high restaurants at dizzying views.",
    sections:[
      {title:"🛍️ Shopping", items:[
        {name:"Platinum Fashion Mall", desc:"5-floor wholesale fashion paradise — clothes from 100 THB, accessories, bags. Hugely popular with Thais and Asian tourists", price:"$", address:"222 Phetchaburi Rd, Pratunam, Ratchathewi, Bangkok 10400", links:[{url:"https://www.google.com/maps/search/?api=1&query=Platinum+Fashion+Mall+Bangkok", label:"Maps"}]},
        {name:"CentralWorld", desc:"One of Southeast Asia's largest malls — 500+ stores, Isetan, Uniqlo, Nike, cinemas, and an enormous food hall", price:"$$", address:"4 Ratchadamri Rd, Pathum Wan, Bangkok 10330", links:[{url:"https://www.centralworld.co.th/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=CentralWorld+Bangkok", label:"Maps"}]},
        {name:"Big C Extra Pratunam", desc:"Huge Thai supermarket — souvenir snacks, instant noodles, sauces, all the things to bring home", price:"$", address:"97-99 Ratchadamri Rd, Lumphini, Pathum Wan, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Big+C+Extra+Pratunam+Bangkok", label:"Maps"}]},
        {name:"Amari Watergate Shopping", desc:"Designer boutiques and beauty brands in an upscale hotel setting", price:"$$$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Amari+Watergate+Bangkok", label:"Maps"}]},
        {name:"Pratunam Street Market", desc:"Street-level market stalls for clothing, bags, and accessories — great bargaining spot", price:"$", address:"Phetchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Pratunam+Market+Bangkok", label:"Maps"}]}
      ]},
      {title:"☁️ Rooftop Bars & Sky Dining", items:[
        {name:"Red Sky Bar (Centara Grand)", desc:"55th floor 360° rooftop bar — stunning Bangkok skyline views, craft cocktails, grilled meats", price:"$$$", address:"Centara Grand, 999/99 Rama 1 Rd, Pathum Wan, Bangkok 10330", links:[{url:"https://www.centarahotelsresorts.com/centaragrand/cwb/restaurants/red-sky/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Red+Sky+Bar+Centara+Grand+Bangkok", label:"Maps"}]},
        {name:"Uno Mas (Centara Grand, 54F)", desc:"Spanish tapas and seafood at 54th floor with spectacular skyline panorama", price:"$$$", address:"Centara Grand, 999/99 Rama 1 Rd, Pathum Wan, Bangkok 10330", links:[{url:"https://www.google.com/maps/search/?api=1&query=Uno+Mas+Centara+Grand+Bangkok", label:"Maps"}]},
        {name:"Zenith Rooftop Bar (Hotel Indigo)", desc:"Rooftop pool bar with views over CentralWorld and Lumpini Park", price:"$$$", links:[{url:"https://www.google.com/maps/search/?api=1&query=Zenith+Rooftop+Bar+Hotel+Indigo+Bangkok", label:"Maps"}]},
        {name:"Above Eleven", desc:"Tropic-themed rooftop bar + Nikkei restaurant, great cocktails", price:"$$$", address:"Fraser Suites, Sukhumvit 11, Khlong Toei Nuea, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Above+Eleven+Bangkok", label:"Maps"}]}
      ]},
      {title:"🍴 Must-Eat", items:[
        {name:"Kaiton Pratunam Chicken Rice", desc:"The most famous late-night chicken rice in Bangkok — green-pants staff, open till 2AM, right in Pratunam", price:"$", address:"Phetchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Kaiton+Pratunam+Chicken+Rice+Bangkok", label:"Maps"}]},
        {name:"Go-Ang Pratunam Chicken Rice", desc:"Michelin Bib Gourmand — arguably better, opens morning. Queue from 7AM", price:"$", address:"960/2 Petchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Go+Ang+Pratunam+Chicken+Rice+Bangkok", label:"Maps"}]},
        {name:"CentralWorld Food Hall", desc:"Massive variety of quality Thai and international dishes — sit-down level above the food court", price:"$$", address:"4 Ratchadamri Rd, Pathum Wan, Bangkok 10330", links:[{url:"https://www.centralworld.co.th/", label:"Site"}]},
        {name:"Platinum Food Court", desc:"Dirt cheap authentic Thai — pad krapao, boat noodles, mango sticky rice", price:"$", address:"222 Phetchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Platinum+Fashion+Mall+Bangkok", label:"Maps"}]}
      ]},
      {title:"📸 Instagrammable Spots", items:[
        {name:"Red Sky Bar Rooftop", desc:"Bangkok skyline photography from 55 floors up — golden hour and night shots are extraordinary", price:"$$$", address:"Centara Grand, 55/F, 999/99 Rama 1 Rd, Bangkok", links:[{url:"https://www.centarahotelsresorts.com/centaragrand/cwb/restaurants/red-sky/", label:"Site"},{url:"https://www.google.com/maps/search/?api=1&query=Red+Sky+Bar+Bangkok", label:"Maps"}]},
        {name:"CentralWorld Main Atrium", desc:"The enormous glass atrium — architectural photography and crowd shots", price:"free", address:"4 Ratchadamri Rd, Pathum Wan, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=CentralWorld+Bangkok", label:"Maps"}]},
        {name:"Platinum Mall exterior", desc:"The dense Pratunam market area at ground level — very Bangkok urban energy", price:"free", address:"222 Phetchaburi Rd, Pratunam, Bangkok", links:[{url:"https://www.google.com/maps/search/?api=1&query=Platinum+Fashion+Mall+Bangkok", label:"Maps"}]}
      ]},
      {title:"💡 Tips", items:[
        {name:"From Ratchathewi", desc:"Walk 10–15 min south to Pratunam, or 1 BTS stop to Chit Lom (E1) for CentralWorld/Erawan", price:"tip"},
        {name:"Rooftop Dress Code", desc:"Smart casual required for Red Sky and sky bars. No flip-flops or shorts", price:"tip"},
        {name:"Platinum Hours", desc:"8AM–8PM. Gets very crowded on weekends — weekday mornings are best for browsing", price:"tip"}
      ]}
    ],
    note:"Your Airbnb is walking distance from Pratunam — a massive advantage. Take advantage and pop in anytime for snacks or last-minute shopping."
  }
];

function renderMustTry() {
  const grid = document.getElementById("mustTryGrid");
  if (!grid) return;
  const dayOrder = {"Day 1":0,"Day 2":1,"Day 3":2,"Day 4":3,"Day 5":4,"Home Base":5};
  const sorted = [...mustTryData].sort((a,b)=>(dayOrder[a.day]??9)-(dayOrder[b.day]??9));
  const districtLabel = {
    ratchathewi:"Ratchathewi District",
    chinatown:"Yaowarat District",
    songwat:"Creative Hub",
    grandpalace:"Historic Center",
    watarun:"Riverside Temple",
    ancientcity:"Cultural Park",
    akarasky:"Skyline Spot",
    ari:"Cafe District",
    chatuchak:"Weekend Market",
    khaosan:"Nightlife Strip",
    khlonglatmayom:"Floating Market",
    pratunam:"Shopping District"
  };
  grid.className = "musttry-grid";
  grid.innerHTML = sorted.map(area=>`
    <div class="musttry-card ${area.dayClass}" onclick="showMustArea('${area.id}')">
      <div class="musttry-card-inner">
        <div class="musttry-card-emoji">${area.emoji}</div>
        <div class="musttry-card-text">
          <div class="musttry-card-name">${area.name}</div>
          <div class="musttry-card-day">${(() => { const d = districtLabel[area.id]; return d && d !== area.day ? `${area.day} &bull; ${d}` : area.day; })()}</div>
          <div class="musttry-card-tags">${area.tags.slice(0,3).map(t=>`<span class="musttry-tag">${t}</span>`).join("")}</div>
        </div>
        <div class="musttry-arrow">›</div>
      </div>
    </div>`).join("");
}

function showMustArea(id) {
  const area = mustTryData.find(a => a.id === id);
  if (!area) return;
  const secClass = title => {
    const t = (title || "").toLowerCase();
    if (t.includes("tip")) return "cat-tips";
    if (t.includes("instagram") || t.includes("photo")) return "cat-photo";
    if (t.includes("drink") || t.includes("dessert")) return "cat-drink";
    if (t.includes("activit") || t.includes("sight") || t.includes("attraction") || t.includes("must-see") || t.includes("experience") || t.includes("getting there")) return "cat-activity";
    if (t.includes("eat") || t.includes("food") || t.includes("michelin") || t.includes("restaurant") || t.includes("cafe")) return "cat-eat";
    return "cat-activity";
  };
  const pc = p => p==="$"?"p1":p==="$$"?"p2":p==="$$$"?"p3":p==="free"?"pfree":"tip";
  const lkClass = label => "lk-" + (label||"").toLowerCase().replace(/\s+/g,"-");
  const lkIcon  = label => ({maps:"📍",menu:"🍽️",book:"🎟️",site:"🔗",reserve:"📅",michelin:"⭐",tickets:"🎫"}[lkClass(label).slice(3)]||"🔗");
  const renderItems = items => items.map(item => {
    const links = item.links || (item.url ? [{url:item.url, label:item.urlLabel||"Link"}] : []);
    const hasPhoto = item.photo;
    return `
    <div class="mustarea-item">
      ${hasPhoto ? `<div class="mustarea-item-photo"><img src="${item.photo}" alt="${item.name}" loading="lazy" onerror="this.parentNode.style.display='none'"></div>` : ""}
      <div class="mustarea-item-left">
        <div class="mustarea-item-name">${item.name}</div>
        <div class="mustarea-item-desc">${item.desc}</div>
        ${item.address ? `<div class="mustarea-item-address">📍 ${item.address}</div>` : ""}
        ${links.length ? `<div class="mustarea-item-actions">${links.map(lk=>`<a href="${lk.url}" target="_blank" rel="noopener noreferrer" class="mustarea-item-link ${lkClass(lk.label)}" onclick="event.stopPropagation()">${lkIcon(lk.label)} ${lk.label}</a>`).join("")}</div>` : ""}
      </div>
      <span class="mustarea-badge ${pc(item.price)}">${item.price==="free"?"Free":item.price==="tip"?"Tip":item.price}</span>
    </div>
  `;}).join("");
  const sectionsHtml = area.sections.map(s => `
    <div class="mustarea-section ${secClass(s.title)}">
      <div class="mustarea-section-title">${s.title}</div>
      ${renderItems(s.items)}
    </div>
  `).join("");
  const html = `
    <div class="mustarea-layout">
      <div class="mustarea-hero">
        <div class="mustarea-day-kicker">${area.day} &bull; BKK</div>
        <div class="mustarea-emoji">${area.emoji}</div>
        <div class="mustarea-title">${area.name}</div>
        <div class="mustarea-desc">${area.desc}</div>
      </div>
      <div class="mustarea-body">
        ${sectionsHtml}
        ${area.note?`<div class="mustarea-note">💡 ${area.note}</div>`:""}
      </div>
    </div>
  `;
  const modal = document.querySelector("#mustAreaModal .mustarea-modal");
  if (modal) {
    modal.classList.remove("day1-theme","day2-theme","day3-theme","day4-theme","day5-theme","home-theme");
    modal.classList.add(`${area.dayClass}-theme`);
  }
  document.getElementById("mustAreaContent").innerHTML = html;
  document.getElementById("mustAreaModal").classList.add("show");
}

function closeMustArea() {
  document.getElementById("mustAreaModal").classList.remove("show");
}

function openGroupExpenseModal() {
  document.getElementById("groupExpenseModal").classList.add("show");
}

function closeGroupExpenseModal() {
  document.getElementById("groupExpenseModal").classList.remove("show");
}

// Expense form
let splitType="equal";
function renderExpenseForm(){
  document.getElementById("expPaidBy").innerHTML=data.travelers.map(t=>`<option value="${t.id}">${getNameShort(t.id)}</option>`).join("");
  document.getElementById("splitCheckboxes").innerHTML=data.travelers.map(t=>`<label class="checkbox-label"><input type="checkbox" value="${t.id}" checked onchange="updateCustomSplitInputs()"><span class="check-dot" data-initials="${getInitials(t.id)}"></span><span class="cb-name">${getNameShort(t.id)}</span></label>`).join("");
  document.getElementById("expDate").value=new Date().toISOString().slice(0,10);
  updateCustomSplitInputs();
}
document.querySelectorAll(".split-type-btn").forEach(btn=>{btn.addEventListener("click",()=>{document.querySelectorAll(".split-type-btn").forEach(b=>b.classList.remove("active"));btn.classList.add("active");splitType=btn.dataset.split;document.getElementById("customSplits").style.display=splitType==="custom"?"flex":"none";updateCustomSplitInputs();});});
function getCheckedPeople(){return[...document.querySelectorAll("#splitCheckboxes input:checked")].map(c=>c.value);}
function updateCustomSplitInputs(){const p=getCheckedPeople(),c=document.getElementById("customSplits");if(splitType!=="custom"){c.innerHTML="";return;}c.innerHTML=p.map(id=>`<div class="custom-split-input"><label>${getNameShort(id)}</label><input type="number" step="0.01" min="0" id="csplit_${id}" placeholder="0.00"></div>`).join("");}

function saveExpense(){
  const desc=document.getElementById("expDesc").value.trim(),amount=parseFloat(document.getElementById("expAmount").value),currency=document.getElementById("expCurrency").value,paidBy=document.getElementById("expPaidBy").value,category=document.getElementById("expCategory").value,date=document.getElementById("expDate").value,people=getCheckedPeople();
  if(!desc){showToast("Enter a description",true);return;} if(!amount||amount<=0){showToast("Enter a valid amount",true);return;} if(people.length<1){showToast("Select at least 1 person",true);return;}
  let customSplits=null;
  if(splitType==="custom"){customSplits={};let total=0;for(const id of people){const v=parseFloat(document.getElementById("csplit_"+id)?.value||0);customSplits[id]=v;total+=v;}if(Math.abs(total-amount)>0.02){showToast(`Custom splits (${total.toFixed(2)}) must equal total (${amount.toFixed(2)})`,true);return;}}
  const editId=document.getElementById("editExpenseId").value;
  if(editId){const exp=data.expenses.find(e=>e.id===editId);Object.assign(exp,{description:desc,amount,currency,paidBy,splitAmong:people,splitType,customSplits,date,category});}
  else{data.expenses.push({id:"exp_"+Date.now(),description:desc,amount,currency,paidBy,splitAmong:people,splitType,customSplits,date,category,status:"pending",comments:""});}
  saveData(true);clearExpenseForm();renderExpenses();closeGroupExpenseModal();showToast(editId?"Expense updated!":"Expense added!");
}
function clearExpenseForm(){document.getElementById("expDesc").value="";document.getElementById("expAmount").value="";document.getElementById("editExpenseId").value="";document.getElementById("formTitle").innerHTML="\u271A Add Expense";document.getElementById("cancelEditBtn").style.display="none";document.querySelectorAll("#splitCheckboxes input").forEach(c=>c.checked=true);splitType="equal";document.querySelectorAll(".split-type-btn").forEach(b=>b.classList.toggle("active",b.dataset.split==="equal"));document.getElementById("customSplits").style.display="none";updateCustomSplitInputs();}
function cancelEdit(){clearExpenseForm();closeGroupExpenseModal();}
function editExpense(id){const exp=data.expenses.find(e=>e.id===id);if(!exp)return;openGroupExpenseModal();document.getElementById("editExpenseId").value=id;document.getElementById("formTitle").innerHTML="\u270E Edit Expense";document.getElementById("cancelEditBtn").style.display="";document.getElementById("expDesc").value=exp.description;document.getElementById("expAmount").value=exp.amount;document.getElementById("expCurrency").value=exp.currency;document.getElementById("expPaidBy").value=exp.paidBy;document.getElementById("expCategory").value=exp.category;document.getElementById("expDate").value=exp.date;document.querySelectorAll("#splitCheckboxes input").forEach(c=>{c.checked=exp.splitAmong.includes(c.value);});splitType=exp.splitType;document.querySelectorAll(".split-type-btn").forEach(b=>b.classList.toggle("active",b.dataset.split===splitType));document.getElementById("customSplits").style.display=splitType==="custom"?"flex":"none";updateCustomSplitInputs();if(exp.customSplits){for(const[id,val]of Object.entries(exp.customSplits)){const el=document.getElementById("csplit_"+id);if(el)el.value=val;}}}
function deleteExpense(id){if(!confirm("Delete this expense?"))return;data.expenses=data.expenses.filter(e=>e.id!==id);saveData(true);renderExpenses();showToast("Expense deleted");}
function toggleStatus(id){const exp=data.expenses.find(e=>e.id===id);exp.status=exp.status==="paid"?"pending":"paid";saveData(true);renderExpenses();}

// ==================== DEBT COMPUTATION ====================
// Returns array of { expenseId, description, category, owedTo, amount (PHP), paymentKey }
function getDebtsForPerson(personId) {
  const debts = [];
  data.expenses.forEach(exp => {
    if (!exp.splitAmong.includes(personId)) return;
    if (exp.paidBy === personId) return; // you don't owe yourself
    let share;
    if (exp.splitType === "custom" && exp.customSplits) {
      share = convertToPhp(exp.customSplits[personId] || 0, exp.currency);
    } else {
      share = convertToPhp(exp.amount, exp.currency) / exp.splitAmong.length;
    }
    if (share < 0.01) return;
    const paymentKey = personId + ":" + exp.id;
    debts.push({
      expenseId: exp.id,
      description: exp.description,
      category: exp.category,
      owedTo: exp.paidBy,
      amount: share,
      paymentKey
    });
  });
  return debts;
}

function isDebtPaid(paymentKey) {
  return !!(data.payments && data.payments[paymentKey]?.paid);
}

function toggleDebtPaid(paymentKey, personId) {
  if (!data.payments) data.payments = {};
  if (data.payments[paymentKey]?.paid) {
    delete data.payments[paymentKey];
  } else {
    data.payments[paymentKey] = { paid: true, date: new Date().toISOString().slice(0,10) };
  }
  saveData(true);
  renderExpenses();
  // Re-select the same person tab
  selectPersonTab(personId);
}

// ==================== RENDER ====================
let selectedPerson = null;

function selectPersonTab(id) {
  selectedPerson = id;
  document.querySelectorAll(".person-tab").forEach(t => t.classList.toggle("active", t.dataset.person === id));
  document.querySelectorAll(".person-detail").forEach(d => d.classList.toggle("active", d.dataset.person === id));
}

function renderExpenses() {
  // ── Expense table with total row ──
  const totalPhp = data.expenses.reduce((s, e) => s + convertToPhp(e.amount, e.currency), 0);
  const rows = data.expenses.map(exp => `
    <tr>
      <td><span class="cat-icon">${CAT_ICONS[exp.category]||""}</span>${escapeHtml(exp.description)}</td>
      <td class="amount-cell">${formatMoney(exp.amount,exp.currency)}</td>
      <td>${getNameShort(exp.paidBy)}</td>
      <td style="font-size:0.78rem;color:var(--text-secondary)">${exp.splitAmong.map(id=>getNameShort(id)).join(", ")}</td>
      <td style="font-size:0.78rem;color:var(--text-dim)">${exp.date}</td>
      <td><span class="status-badge status-${exp.status}" onclick="toggleStatus('${exp.id}')">${exp.status}</span></td>
      <td><div class="actions-cell"><button class="btn btn-secondary btn-xs" onclick="editExpense('${exp.id}')">Edit</button><button class="btn btn-danger btn-xs" onclick="deleteExpense('${exp.id}')">Del</button></div></td>
    </tr>`).join("");
  const totalRow = `<tr class="expense-total-row">
    <td colspan="4" class="expense-total-label">&#127758; Total Group Expenses</td>
    <td colspan="3" class="expense-total-value">${formatMoney(totalPhp)}</td>
  </tr>`;
  document.getElementById("expenseTableBody").innerHTML = rows + totalRow;
  const expenseList = document.getElementById("expenseList");
  if (expenseList) {
    const EXPENSE_LIMIT = 3;
    const sorted = [...data.expenses].sort((a,b)=>new Date(b.date||"1970-01-01")-new Date(a.date||"1970-01-01"));
    const makeExpCard = exp => `
      <div class="group-expense-card">
        <div class="group-expense-main">
          <div class="group-expense-icon">${CAT_ICONS[exp.category]||"&#128176;"}</div>
          <div style="min-width:0;">
            <div class="group-expense-title">${escapeHtml(exp.description)}</div>
            <div class="group-expense-sub">Paid by ${getNameShort(exp.paidBy)} • ${exp.date}</div>
          </div>
        </div>
        <div class="group-expense-right">
          <div class="group-expense-amt">${formatMoney(exp.amount,exp.currency)}</div>
          <span class="status-badge status-${exp.status}" onclick="toggleStatus('${exp.id}')">${exp.status}</span>
          <div class="group-expense-actions">
            <button class="btn btn-secondary btn-xs" onclick="editExpense('${exp.id}')">Edit</button>
            <button class="btn btn-danger btn-xs" onclick="deleteExpense('${exp.id}')">Del</button>
          </div>
        </div>
      </div>`;
    const visibleCards = sorted.slice(0, EXPENSE_LIMIT).map(makeExpCard).join("");
    const hiddenCards  = sorted.slice(EXPENSE_LIMIT).map(makeExpCard).join("");
    const extraCount   = sorted.length - EXPENSE_LIMIT;
    expenseList.innerHTML = visibleCards
      + (extraCount > 0 ? `<div class="expense-overflow" id="expenseOverflow" style="display:none">${hiddenCards}</div>` : "")
      + `<div class="group-total-spend">
        <span class="group-total-label">Total Group Spend</span>
        <span class="group-total-value">${formatMoney(totalPhp)}</span>
      </div>`;
    // Wire View All button
    const viewAllBtn = document.getElementById("expViewAllBtn");
    if (viewAllBtn) {
      if (extraCount > 0) {
        viewAllBtn.textContent = `View All (${extraCount} more)`;
        viewAllBtn.onclick = () => {
          const ov = document.getElementById("expenseOverflow");
          if (!ov) return;
          const expanding = ov.style.display === "none";
          ov.style.display = expanding ? "grid" : "none";
          viewAllBtn.textContent = expanding ? "Show Less" : `View All (${extraCount} more)`;
        };
      } else {
        viewAllBtn.textContent = "";
        viewAllBtn.onclick = null;
      }
    }
  }

  // ── Compute balances ──
  const rawBalances = {};
  data.travelers.forEach(t => { rawBalances[t.id] = {paid:0, owed:0}; });
  data.expenses.forEach(exp => {
    const php = convertToPhp(exp.amount, exp.currency);
    if (rawBalances[exp.paidBy]) rawBalances[exp.paidBy].paid += php;
    exp.splitAmong.forEach(id => {
      if (!rawBalances[id]) return;
      let share;
      if (exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[id]||0,exp.currency);
      else share=php/exp.splitAmong.length;
      rawBalances[id].owed += share;
    });
  });

  // ── Summary cards (clickable) ──
  // Net after accounting for payments already marked paid
  document.getElementById("summaryGrid").innerHTML = data.travelers.map(t => {
    const b = rawBalances[t.id];
    // "Total still owed to you" = your paid amount minus shares already settled back to you
    const debtsOwedToMe = [];
    data.expenses.forEach(exp => {
      if (exp.paidBy !== t.id) return;
      const php = convertToPhp(exp.amount, exp.currency);
      exp.splitAmong.forEach(debtor => {
        if (debtor === t.id) return;
        let share;
        if (exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[debtor]||0,exp.currency);
        else share=php/exp.splitAmong.length;
        if (share < 0.01) return;
        const pk = debtor+":"+exp.id;
        debtsOwedToMe.push({share, paid: isDebtPaid(pk)});
      });
    });
    const totalRecoverable = debtsOwedToMe.reduce((s,d)=>s+d.share,0);
    const totalRecovered   = debtsOwedToMe.filter(d=>d.paid).reduce((s,d)=>s+d.share,0);
    const totalStillOwed   = totalRecoverable - totalRecovered;

    // How much this person still owes others (unpaid debts)
    const myDebts = getDebtsForPerson(t.id);
    const iStillOwe = myDebts.filter(d=>!isDebtPaid(d.paymentKey)).reduce((s,d)=>s+d.amount,0);
    const fullySettled = iStillOwe < 0.01;
    const netPosition = totalStillOwed - iStillOwe;
    const bottomPositive = netPosition > 0.01;
    const bottomNeutral = Math.abs(netPosition) <= 0.01;
    const bottomLabel = bottomNeutral ? "Settled" : (bottomPositive ? "Owed Back" : "Still Owes");
    const bottomValue = bottomNeutral ? "PHP 0.00" : formatMoney(Math.abs(netPosition));
    const bottomColor = bottomNeutral ? "rgba(255,255,255,0.62)" : (bottomPositive ? "var(--green)" : "var(--red)");

    return `<div class="summary-card group-summary-card" data-person="${t.id}" onclick="openPayerModal('${t.id}')">
      <div class="summary-avatar">${getInitials(t.id)}</div>
      <div class="summary-name">${getNameShort(t.id)}</div>
      <div class="summary-row">
        <span class="label">Paid by</span>
        <span class="value">${formatMoney(b.paid)}</span>
      </div>
      <div class="summary-row">
        <span class="label">Their Share</span>
        <span class="value">${formatMoney(b.owed)}</span>
      </div>
      <div class="summary-divider"></div>
      <div class="summary-row summary-highlight">
        <span class="label">${bottomLabel}</span>
        <span class="value" style="color:${bottomColor};">${bottomValue}</span>
      </div>
    </div>`;
  }).join("");

  // ── Who Owes Whom ──
  renderWhoOwesWhom();
}

// ── Payer Detail Modal ──
function openPayerModal(payerId) {
  const payer = data.travelers.find(t=>t.id===payerId);
  if (!payer) return;
  const payerName = getNameShort(payerId);

  const myExpenses = data.expenses.filter(e=>e.paidBy===payerId);
  const totalPaidOut = myExpenses.reduce((s,e)=>s+convertToPhp(e.amount,e.currency),0);
  const myDebts = getDebtsForPerson(payerId);
  const totalIOwe = myDebts.reduce((s,d)=>s+d.amount,0);
  const totalPaidToOthers = myDebts.filter(d=>isDebtPaid(d.paymentKey)).reduce((s,d)=>s+d.amount,0);
  const totalIStillOwe = totalIOwe - totalPaidToOthers;

  let totalCollected = 0;
  myExpenses.forEach(exp => {
    const phpAmt = convertToPhp(exp.amount, exp.currency);
    exp.splitAmong.filter(id=>id!==payerId).forEach(debtorId => {
      let share;
      if(exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[debtorId]||0,exp.currency);
      else share=phpAmt/exp.splitAmong.length;
      if(share<0.01) return;
      const paid = isDebtPaid(debtorId+":"+exp.id);
      if (paid) totalCollected += share;
    });
  });

  const fullName = [payer.firstName,payer.middleName,payer.lastName].filter(Boolean).join(" ") || payerName;
  let html = `<div class="payer-hero">
    <div class="payer-head">
      <div class="payer-identity">
        <div class="payer-avatar-lg">${getInitials(payerId)}</div>
        <div>
          <div class="payer-hero-name">${fullName.replace(/\s+/g," ")}</div>
        </div>
      </div>
      <button class="payer-close-btn" onclick="closePayerModal()" aria-label="Close">&times;</button>
    </div>
    <div class="payer-stats">
      <div class="payer-stat">
        <div class="payer-stat-label">Total Paid</div>
        <div class="payer-stat-value" style="color:var(--amber)">${formatMoney(totalPaidOut)}</div>
        <div class="payer-stat-currency">PHP</div>
      </div>
      <div class="payer-stat">
        <div class="payer-stat-label">I Owe</div>
        <div class="payer-stat-value" style="color:var(--red)">${formatMoney(totalIStillOwe)}</div>
        <div class="payer-stat-currency">PHP</div>
      </div>
      <div class="payer-stat">
        <div class="payer-stat-label">Paid Back</div>
        <div class="payer-stat-value" style="color:var(--green)">${formatMoney(totalCollected)}</div>
        <div class="payer-stat-currency">PHP</div>
      </div>
    </div>
  </div>
  <div class="payer-body">`;

  if (myExpenses.length === 0) {
    html += `<div class="no-debts" style="margin:18px 0">&#128179; ${payerName} hasn't paid for any group expenses yet.</div>`;
  } else {
    html += `<div class="payer-section-head"><div class="payer-section-title">Expenses Paid</div><div class="payer-section-count">${myExpenses.length} Item${myExpenses.length===1?"":"s"}</div></div>`;
    myExpenses.forEach(exp => {
      const phpAmt = convertToPhp(exp.amount, exp.currency);
      const debtors = exp.splitAmong.filter(id=>id!==payerId);
      let settleRows = "";
      let settledTotal = 0;
      let unsettledTotal = 0;
      debtors.forEach(debtorId=>{
        let share;
        if(exp.splitType==="custom"&&exp.customSplits) share=convertToPhp(exp.customSplits[debtorId]||0,exp.currency);
        else share=phpAmt/exp.splitAmong.length;
        if(share<0.01)return;
        const pk = debtorId+":"+exp.id;
        const paid = isDebtPaid(pk);
        if(paid) settledTotal+=share; else unsettledTotal+=share;
        settleRows+=`<div class="payer-settle-row">
          <span class="payer-settle-left">
            <span class="payer-settle-avatar">${getInitials(debtorId)}</span>
            <span>
              <div class="payer-settle-who">${getNameShort(debtorId)}</div>
              <div class="payer-settle-sub">${paid ? "Settlement completed" : "Awaiting settlement"}</div>
            </span>
          </span>
          <span style="display:flex;align-items:center;gap:6px">
            <span class="payer-settle-amount">${formatMoney(share)}</span>
            <span class="payer-settle-status ${paid?'paid':'unpaid'}">${paid?'PAID':'UNPAID'}</span>
          </span>
        </div>`;
      });
      let selfShare=0;
      if(exp.splitAmong.includes(payerId)){
        if(exp.splitType==="custom"&&exp.customSplits) selfShare=convertToPhp(exp.customSplits[payerId]||0,exp.currency);
        else selfShare=phpAmt/exp.splitAmong.length;
      }
      const footerCls = unsettledTotal<0.01?"settled":settledTotal>0?"partial":"none";
      const footerLabel = unsettledTotal<0.01?"Fully Collected":settledTotal>0?"Partially Collected":"Not Yet Collected";
      html+=`<div class="payer-exp-block">
        <div class="payer-exp-header">
          <span class="payer-exp-icon">${CAT_ICONS[exp.category]||"\u{1F4B2}"}</span>
          <span style="flex:1;min-width:0;">
            <div class="payer-exp-title">${escapeHtml(exp.description)}</div>
            <div class="payer-exp-sub">${exp.date}</div>
          </span>
          <span style="text-align:right;">
            <div class="payer-exp-amount">${formatMoney(exp.amount,exp.currency)}</div>
            <div class="payer-exp-currency">${exp.currency} Total</div>
          </span>
        </div>
        ${selfShare>0.01?`<div class="payer-self-share"><span class="label">Personal Share</span><span class="value">${formatMoney(selfShare)}</span></div>`:""}
        ${settleRows}
        ${debtors.length>0?`<div class="payer-exp-footer ${footerCls==='partial'?'warn':footerCls==='none'?'none':''}"><span class="footer-label">${footerLabel}</span><span class="footer-val">${formatMoney(settledTotal+unsettledTotal)} Total Receivable</span></div>`:""}
      </div>`;
    });
  }

  if (myDebts.length > 0) {
    html += `<div class="payer-section-head" style="margin-top:6px"><div class="payer-section-title">Outstanding Debts</div><div class="payer-section-count">${myDebts.length} Item${myDebts.length===1?"":"s"}</div></div>`;
    myDebts.forEach(d=>{
      const paid = isDebtPaid(d.paymentKey);
      html+=`<div class="payer-settle-row" style="background:rgba(255,255,255,0.045);border:1px solid rgba(255,255,255,0.09);border-radius:16px;margin-bottom:8px">
        <span class="payer-settle-left">
          <span class="payer-settle-avatar">${getInitials(d.owedTo)}</span>
          <span>
            <div class="payer-settle-who">To ${getNameShort(d.owedTo)}</div>
            <div class="payer-settle-sub">${escapeHtml(d.description)}</div>
          </span>
        </span>
        <span style="display:flex;align-items:center;gap:6px">
          <span class="payer-settle-amount">${formatMoney(d.amount)}</span>
          <span class="payer-settle-status ${paid?'paid':'unpaid'}">${paid?'PAID':'UNPAID'}</span>
        </span>
      </div>`;
    });
  }

  html += `</div>`;
  document.getElementById("payerModalContent").innerHTML = html;
  document.getElementById("payerModal").classList.add("show");
}

function closePayerModal() {
  document.getElementById("payerModal").classList.remove("show");
}

function renderWhoOwesWhom() {
  const tabsEl = document.getElementById("personTabs");
  const detailsEl = document.getElementById("personDetails");

  let tabsHtml = "";
  let detailsHtml = "";

  data.travelers.forEach(t => {
    const debts = getDebtsForPerson(t.id);
    const unpaidCount = debts.filter(d => !isDebtPaid(d.paymentKey)).length;
    const totalUnpaid = debts.filter(d => !isDebtPaid(d.paymentKey)).reduce((s,d) => s+d.amount, 0);
    const totalAll = debts.reduce((s,d) => s+d.amount, 0);
    const totalPaid = debts.filter(d => isDebtPaid(d.paymentKey)).reduce((s,d) => s+d.amount, 0);
    const allPaid = debts.length > 0 && unpaidCount === 0;

    let badgeHtml = "";
    if (debts.length > 0) {
      badgeHtml = allPaid
        ? `<span class="tab-badge settled">\u2713</span>`
        : `<span class="tab-badge has-debt">${unpaidCount}</span>`;
    }

    tabsHtml += `<button class="person-tab${selectedPerson===t.id?" active":""}" data-person="${t.id}" onclick="selectPersonTab('${t.id}')"><span class="person-avatar">${getInitials(t.id)}</span><span class="person-name">${getNameShort(t.id)}</span>${badgeHtml}</button>`;

    detailsHtml += `<div class="person-detail${selectedPerson===t.id?" active":""}" data-person="${t.id}">`;

    if (debts.length === 0) {
      detailsHtml += `<div class="no-debts">\u2705 ${getNameShort(t.id)} doesn't owe anyone!</div>`;
    } else {
      detailsHtml += `<div class="person-summary-bar">
        <div class="psb-item"><div class="psb-label">Total Share</div><div class="psb-value" style="color:var(--red)">${formatMoney(totalAll)}</div></div>
        <div class="psb-item"><div class="psb-label">Already Paid</div><div class="psb-value" style="color:var(--green)">${formatMoney(totalPaid)}</div></div>
        <div class="psb-item"><div class="psb-label">Still Owe</div><div class="psb-value" style="color:${totalUnpaid<0.01?'var(--green)':'var(--amber)'}">${formatMoney(totalUnpaid)}</div></div>
      </div>`;

      debts.forEach(d => {
        const paid = isDebtPaid(d.paymentKey);
        detailsHtml += `
          <div class="debt-item${paid?" is-paid":""}">
            <div class="debt-icon">${CAT_ICONS[d.category]||"\u{1F4B2}"}</div>
            <div class="debt-info">
              <div class="debt-desc">${escapeHtml(d.description)}</div>
              <div class="debt-sub">Your share — pay back <strong>${getNameShort(d.owedTo)}</strong></div>
            </div>
            <div class="debt-amount${paid?" paid":""}">${formatMoney(d.amount)}</div>
            <div class="debt-actions">
              ${paid
                ? `<span class="paid-check">\u2705</span><button class="btn btn-danger btn-xs" onclick="toggleDebtPaid('${d.paymentKey}','${t.id}')" title="Undo">Undo</button>`
                : `<button class="btn btn-teal btn-sm" onclick="toggleDebtPaid('${d.paymentKey}','${t.id}')">Mark Paid</button>`
              }
            </div>
          </div>`;
      });
    }
    detailsHtml += `</div>`;
  });

  tabsEl.innerHTML = tabsHtml;
  detailsEl.innerHTML = detailsHtml;

  // Auto-select first person if none selected
  if (!selectedPerson || !data.travelers.find(t=>t.id===selectedPerson)) {
    const first = data.travelers[0];
    if (first) selectPersonTab(first.id);
  }
}

// Settings
function updateRate(){const r=parseFloat(document.getElementById("settingsRate").value);if(!r||r<=0){showToast("Enter a valid rate",true);return;}data.meta.exchangeRate=r;document.getElementById("rateInput").value=r;saveData();renderExpenses();showToast("Exchange rate updated!");}
function exportData(){const b=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download="bkk2026-backup.json";a.click();URL.revokeObjectURL(u);showToast("Data exported!");}
function importData(event){const f=event.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(e){try{const imp=JSON.parse(e.target.result);if(!imp.travelers||!imp.expenses)throw new Error("Invalid format");if(!imp.payments||Array.isArray(imp.payments))imp.payments={};data=imp;saveData();renderAll();showToast("Data imported!");}catch(err){showToast("Invalid file: "+err.message,true);}};r.readAsText(f);event.target.value="";}
function resetData(){if(!confirm("Reset ALL data to defaults? This cannot be undone."))return;if(!confirm("Are you really sure?"))return;data=JSON.parse(JSON.stringify(DEFAULT_DATA));saveData();selectedPerson=null;renderAll();showToast("Data reset to defaults");}

document.getElementById("rateInput").addEventListener("change",function(){const r=parseFloat(this.value);if(r>0){data.meta.exchangeRate=r;document.getElementById("settingsRate").value=r;saveData();renderExpenses();}});

// ==================== PERSONAL EXPENSES ====================
const PE_CATS = {
  food:      {label:"🍜 Food & Drinks",   color:"rgba(246,173,85,0.12)",  text:"#f6ad55"},
  shopping:  {label:"🛍️ Shopping",        color:"rgba(183,148,244,0.12)", text:"#c4a8f7"},
  transport: {label:"🚗 Transport",        color:"rgba(99,179,237,0.12)",  text:"#7cc4f5"},
  activity:  {label:"🎟️ Activities",      color:"rgba(104,211,145,0.12)", text:"#7ee8a8"},
  beauty:    {label:"💆 Health & Beauty",  color:"rgba(252,129,129,0.12)", text:"#fc8181"},
  other:     {label:"📦 Other",            color:"rgba(160,160,190,0.1)",  text:"#9898b0"}
};

let peSelectedPerson = null;
let peEditId = null;

function peSetBudget(personId, value) {
  const v = parseFloat(value);
  if (!data.personalBudgets) data.personalBudgets = {};
  data.personalBudgets[personId] = (!v || v <= 0) ? 0 : v;
  saveData(true);
  renderPersonalExpenses();
}

function getPeList(personId) {
  if (!data.personalExpenses) data.personalExpenses = {};
  if (!data.personalExpenses[personId]) data.personalExpenses[personId] = [];
  return data.personalExpenses[personId];
}

function renderPersonalExpenses() {
  const tabsEl   = document.getElementById("pePersonTabs");
  const panelsEl = document.getElementById("pePanels");
  if (!tabsEl || !panelsEl) return;

  if (!peSelectedPerson) peSelectedPerson = data.travelers[0]?.id || null;

  tabsEl.innerHTML = data.travelers.map(t =>
    `<button class="pe-person-tab${peSelectedPerson===t.id?" active":""}" data-pe-tab="${t.id}" onclick="peSwitchPerson('${t.id}')">${getNameShort(t.id)}</button>`
  ).join("");

  const fmtNum = n => n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  const fmtDate = d => {
    if (!d) return "No date";
    const dt = new Date(d+"T00:00:00");
    if (Number.isNaN(dt.getTime())) return d;
    return dt.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});
  };

  panelsEl.innerHTML = data.travelers.map(t => {
    const list = getPeList(t.id);
    const totalPhp = list.reduce((s,e) => s + convertToPhp(e.amount, e.currency), 0);
    const totalThb = list.reduce((s,e)=>s + (e.currency==="THB" ? e.amount : e.amount/(data.meta.exchangeRate||1.86)),0);
    const catTotals = {};
    list.forEach(e => {
      const php = convertToPhp(e.amount, e.currency);
      catTotals[e.category] = (catTotals[e.category]||0) + php;
    });
    const topCat = Object.entries(catTotals).sort((a,b)=>b[1]-a[1])[0];
    const topCatLabel = topCat ? (PE_CATS[topCat[0]]||PE_CATS.other).label : "—";
    const topCatShort = topCatLabel==="—" ? "—" : topCatLabel.split(" ").slice(0,2).join(" ");
    const recent = [...list].sort((a,b)=>{
      const ad = new Date((a.date||"1970-01-01")+"T00:00:00").getTime();
      const bd = new Date((b.date||"1970-01-01")+"T00:00:00").getTime();
      return bd-ad;
    });

    const budgetThb = data.personalBudgets?.[t.id] || 0;
    const spentThb   = totalThb;
    const budgetSet  = budgetThb > 0;
    const budgetPct  = budgetSet ? Math.min(100, (spentThb / budgetThb) * 100) : 0;
    const budgetOver = budgetSet && spentThb > budgetThb;
    const budgetFillColor = budgetOver ? "var(--red)" : (budgetPct > 75 ? "var(--orange)" : "var(--teal)");
    const budgetRemain = budgetSet ? Math.max(0, budgetThb - spentThb) : 0;
    const budgetPctLabel = budgetSet ? (budgetOver ? "OVER BUDGET" : `${budgetPct.toFixed(0)}% used`) : "No budget set";

    return `<div class="pe-panel${peSelectedPerson===t.id?" active":""}" data-pe-person="${t.id}">
      <div class="pe-overview-card">
        <div class="pe-kicker"><span class="dot"></span>Personal Spend</div>
        <div class="pe-total-php">${formatMoney(totalPhp).replace("PHP ","PHP ")}</div>
        <div class="pe-total-thb">~ ${fmtNum(totalThb)} ฿</div>
        <div class="pe-overview-stats">
          <div class="pe-over-stat">
            <div class="label">Entries</div>
            <div class="val">${list.length}</div>
          </div>
          <div class="pe-over-stat">
            <div class="label">Top Category</div>
            <div class="val small">${topCatShort}</div>
          </div>
        </div>
      </div>

      <div class="pe-budget-section">
        <div class="pe-budget-card">
          <div class="pe-budget-header">
            <span class="pe-budget-label">Trip Budget (฿)</span>
            <span class="pe-budget-pct" style="color:${budgetOver?"var(--red)":budgetPct>75?"var(--orange)":"var(--teal)"}">${budgetPctLabel}</span>
          </div>
          <div class="pe-budget-input-row">
            <span class="pe-budget-sym">฿</span>
            <input class="pe-budget-input" type="number" min="0" step="100"
              placeholder="10,000"
              value="${budgetThb > 0 ? budgetThb : ""}"
              onchange="peSetBudget('${t.id}', this.value)"
              onblur="peSetBudget('${t.id}', this.value)"
            >
            ${budgetSet ? `<span style="font-size:0.68rem;color:var(--text-secondary);">${fmtNum(budgetRemain)} ฿ left</span>` : ""}
          </div>
          <div class="pe-budget-progress-track">
            <div class="pe-budget-progress-fill" style="width:${budgetPct}%;background:${budgetFillColor};"></div>
          </div>
        </div>
      </div>

      <div class="pe-list-head">
        <div class="pe-list-title">Recent Entries</div>
        <div class="pe-list-chip">Thailand Trip</div>
      </div>

      ${(() => {
        if (recent.length === 0) return `<div class="pe-expense-stack"><div class="pe-empty">&#128683; No personal expenses yet. Add your first entry.</div></div>`;
        const PE_LIMIT = 5;
        const makePeCard = e => {
          const c = PE_CATS[e.category]||PE_CATS.other;
          const inPhp = convertToPhp(e.amount,e.currency);
          const inThb = e.currency==="THB" ? e.amount : (e.amount/(data.meta.exchangeRate||1.86));
          return `<div class="pe-expense-card">
            <div class="pe-expense-left">
              <div class="pe-expense-icon">${c.label.split(" ")[0]}</div>
              <div style="min-width:0">
                <div class="pe-expense-name">${escapeHtml(e.desc)}</div>
                <div class="pe-expense-meta">${fmtDate(e.date)} • ${c.label.split(" ").slice(1,2).join(" ")||"Other"}</div>
              </div>
            </div>
            <div class="pe-expense-right">
              <div class="pe-expense-main">${fmtNum(inPhp)} ₱</div>
              <div class="pe-expense-sub">${fmtNum(inThb)} ฿</div>
              <div class="pe-expense-actions">
                <button class="btn btn-secondary btn-xs" onclick="peEdit('${t.id}','${e.id}')">Edit</button>
                <button class="btn btn-danger btn-xs" onclick="peDel('${t.id}','${e.id}')">Del</button>
              </div>
            </div>
          </div>`;
        };
        const visible = recent.slice(0, PE_LIMIT);
        const hidden  = recent.slice(PE_LIMIT);
        return `<div class="pe-expense-stack">
          ${visible.map(makePeCard).join("")}
          ${hidden.length ? `<div id="peHistory_${t.id}" style="display:none">${hidden.map(makePeCard).join("")}</div>` : ""}
        </div>`;
      })()}

      ${recent.length > 5 ? `<button class="pe-history-btn" id="peHistoryBtn_${t.id}" type="button" onclick="peToggleHistory('${t.id}')">View Transaction History (${recent.length - 5} more)</button>` : ""}

      <button class="pe-add-fab" type="button" onclick="openPersonalExpenseModal('${t.id}')" aria-label="Add personal expense">+</button>
    </div>`;
  }).join("");
}

function peToggleHistory(personId) {
  const el  = document.getElementById("peHistory_" + personId);
  const btn = document.getElementById("peHistoryBtn_" + personId);
  if (!el || !btn) return;
  const expanding = el.style.display === "none";
  el.style.display = expanding ? "grid" : "none";
  const list = getPeList(personId);
  const hiddenCount = Math.max(0, list.length - 5);
  btn.textContent = expanding ? "Hide History" : `View Transaction History (${hiddenCount} more)`;
}

function peSetModalCurrency(currency) {
  const thbBtn = document.getElementById("peCurTHB");
  const phpBtn = document.getElementById("peCurPHP");
  const symbol = document.getElementById("peAmountSymbol");
  if (!thbBtn || !phpBtn || !symbol) return;
  thbBtn.classList.toggle("active", currency==="THB");
  phpBtn.classList.toggle("active", currency==="PHP");
  symbol.textContent = currency==="THB" ? "฿" : "₱";
}

function openPersonalExpenseModal(personId, entryId=null) {
  if (!personId) personId = peSelectedPerson || data.travelers[0]?.id;
  if (!personId) return;
  if (peSelectedPerson !== personId) {
    peSelectedPerson = personId;
    renderPersonalExpenses();
  } else {
    peSelectedPerson = personId;
  }
  const list = getPeList(personId);
  const catSel = document.getElementById("peModalCat");
  catSel.innerHTML = Object.entries(PE_CATS).map(([k,v])=>`<option value="${k}">${v.label}</option>`).join("");

  const today = new Date().toISOString().slice(0,10);
  const todayThb = list.filter(e=>e.date===today).reduce((s,e)=>s + (e.currency==="THB" ? e.amount : e.amount/(data.meta.exchangeRate||1.86)),0);
  const totalThb = list.reduce((s,e)=>s + (e.currency==="THB" ? e.amount : e.amount/(data.meta.exchangeRate||1.86)),0);
  const budgetThb = 10000;
  const remainingPct = Math.max(0, Math.min(100, 100 - (totalThb/budgetThb)*100));

  document.getElementById("peModalPersonId").value = personId;
  document.getElementById("peModalEditId").value = "";
  document.getElementById("peModalTitle").textContent = "Personal Expense";
  document.getElementById("peModalDesc").value = "";
  document.getElementById("peModalAmount").value = "";
  document.getElementById("peModalDate").value = today;
  document.getElementById("peModalNote").value = "";
  document.getElementById("peModalCat").value = "food";
  document.getElementById("peModalToday").textContent = `฿${Math.round(todayThb).toLocaleString()}`;
  document.getElementById("peModalRemain").textContent = `${Math.round(remainingPct)}%`;
  peSetModalCurrency("THB");

  if (entryId) {
    const entry = list.find(e=>e.id===entryId);
    if (entry) {
      document.getElementById("peModalEditId").value = entry.id;
      document.getElementById("peModalTitle").textContent = "Edit Personal Expense";
      document.getElementById("peModalDesc").value = entry.desc||"";
      document.getElementById("peModalAmount").value = entry.amount;
      document.getElementById("peModalDate").value = entry.date||today;
      document.getElementById("peModalNote").value = entry.note||"";
      document.getElementById("peModalCat").value = entry.category||"other";
      peSetModalCurrency(entry.currency||"THB");
    }
  }
  document.getElementById("personalExpenseModal").classList.add("show");
  setTimeout(()=>document.getElementById("peModalAmount").focus(), 40);
}

function closePersonalExpenseModal(reset=false) {
  const m = document.getElementById("personalExpenseModal");
  if (m) m.classList.remove("show");
  if (reset) document.getElementById("peModalEditId").value = "";
}

function peSaveModal() {
  const personId = document.getElementById("peModalPersonId").value || peSelectedPerson;
  if (!personId) return;
  const desc = document.getElementById("peModalDesc").value.trim();
  const amount = parseFloat(document.getElementById("peModalAmount").value);
  const currency = document.getElementById("peCurPHP").classList.contains("active") ? "PHP" : "THB";
  const cat = document.getElementById("peModalCat").value || "other";
  const date = document.getElementById("peModalDate").value || new Date().toISOString().slice(0,10);
  const note = document.getElementById("peModalNote").value.trim();
  const editId = document.getElementById("peModalEditId").value;
  if (!desc) { showToast("Enter a description", true); return; }
  if (!amount || amount<=0) { showToast("Enter a valid amount", true); return; }
  const list = getPeList(personId);
  if (editId) {
    const entry = list.find(e=>e.id===editId);
    if (entry) Object.assign(entry, {desc, amount, currency, category:cat, date, note});
  } else {
    list.push({id:"pe_"+Date.now(), desc, amount, currency, category:cat, date, note});
  }
  if (!data.personalExpenses) data.personalExpenses = {};
  data.personalExpenses[personId] = list;
  saveData(true);
  renderPersonalExpenses();
  closePersonalExpenseModal(true);
  showToast(editId ? "Entry updated!" : "Expense added!");
}

function peSwitchPerson(id) {
  peSelectedPerson = id;
  peEditId = null;
  renderPersonalExpenses();
}

function peSave(personId) {
  openPersonalExpenseModal(personId);
}

function peEdit(personId, entryId) {
  peSelectedPerson = personId;
  renderPersonalExpenses();
  openPersonalExpenseModal(personId, entryId);
}

function peCancel(personId) {
  closePersonalExpenseModal(true);
}

function peDel(personId, entryId) {
  if (!confirm("Delete this entry?")) return;
  data.personalExpenses[personId] = getPeList(personId).filter(e=>e.id!==entryId);
  saveData(true);
  renderPersonalExpenses();
  showToast("Entry deleted");
}

function renderAll(){document.getElementById("rateInput").value=data.meta.exchangeRate;document.getElementById("settingsRate").value=data.meta.exchangeRate;renderItinerary();renderItineraryMobile();renderExpenseForm();renderExpenses();renderPersonalExpenses();renderMustTry();}

// ==================== GOOGLE SHEETS SYNC ====================
const GS_CONFIG_KEY = "bkk2026_gsconfig";
const SYNC_SHEET_NAME = "SyncData";
const SYNC_INTERVAL_MS = 30000; // 30 seconds
// Credentials loaded at runtime from /api/config (Vercel env vars) — never hardcoded in source
let gsConfig = {
  spreadsheetId: "",
  apiKey:        "",
  webAppUrl:     "",
  syncToken:     ""
};
let autoSyncEnabled = false;
let autoSyncTimer = null;
let lastSyncTime = null;
let isSyncing = false;

async function loadGsConfig() {
  // 1. Fetch server-side credentials from Vercel API route (keeps secrets out of source)
  try {
    const res = await fetch('/api/config');
    if (res.ok) {
      const cfg = await res.json();
      if (cfg.spreadsheetId) gsConfig = Object.assign({}, gsConfig, cfg);
    }
  } catch(e) {} // gracefully skip if running locally without a server
  // 2. localStorage overrides server config (allows manual user customisation)
  try {
    const saved = localStorage.getItem(GS_CONFIG_KEY);
    if (saved) gsConfig = Object.assign({}, gsConfig, JSON.parse(saved));
  } catch(e) {}
  document.getElementById("spreadsheetId").value = gsConfig.spreadsheetId || "";
  document.getElementById("apiKey").value = gsConfig.apiKey || "";
  document.getElementById("webAppUrl").value = gsConfig.webAppUrl || "";
  document.getElementById("syncToken").value = gsConfig.syncToken || "";
  updateSyncStatusUI();
}

function saveGsheetsConfig() {
  gsConfig.spreadsheetId = document.getElementById("spreadsheetId").value.trim();
  gsConfig.apiKey = document.getElementById("apiKey").value.trim();
  gsConfig.webAppUrl = document.getElementById("webAppUrl").value.trim();
  gsConfig.syncToken = document.getElementById("syncToken").value.trim();
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Enter both Spreadsheet ID and API Key", true); return; }
  localStorage.setItem(GS_CONFIG_KEY, JSON.stringify(gsConfig));
  showToast("Config saved! Click Test Connection to verify.");
  updateSyncStatusUI();
}

function updateSyncStatusUI() {
  const el = document.getElementById("syncStatus");
  const btnText = document.getElementById("autoSyncBtnText");
  const indicator = document.getElementById("syncIndicatorText");
  const dot = document.querySelector(".settings-sync-dot");
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) {
    if (el) { el.style.cssText = "border:1px solid rgba(107,107,138,0.2);color:var(--text-dim)"; el.innerHTML = "Not configured — enter your credentials below."; }
    if (indicator) indicator.textContent = "Not configured";
    if (dot) dot.style.background = "var(--text-dim)";
    if (btnText) btnText.innerHTML = "Enable";
    return;
  }
  if (autoSyncEnabled) {
    if (el) { el.style.cssText = "border:1px solid rgba(56,178,172,0.2);color:var(--teal)"; el.innerHTML = "Sync <b>ON</b> — syncs on change" + (lastSyncTime ? " · Last: <span style='color:var(--text)'>" + lastSyncTime + "</span>" : ""); }
    if (indicator) indicator.textContent = "Syncs on change";
    if (dot) dot.style.background = "var(--teal)";
    if (btnText) btnText.innerHTML = "Disable";
  } else {
    if (el) { el.style.cssText = "border:1px solid rgba(232,168,56,0.18);color:var(--amber)"; el.innerHTML = "Connected — Sync <b>OFF</b>" + (lastSyncTime ? " · Last: <span style='color:var(--text)'>" + lastSyncTime + "</span>" : ""); }
    if (indicator) indicator.textContent = "Sync OFF";
    if (dot) { dot.style.background = "var(--amber)"; dot.style.boxShadow = "0 0 6px rgba(242,194,78,0.7)"; }
    if (btnText) btnText.innerHTML = "Enable";
  }
}

// READ from Google Sheets (public read via API key)
async function gsRead() {
  const { spreadsheetId, apiKey } = gsConfig;
  const range = encodeURIComponent(SYNC_SHEET_NAME + "!A1");
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
  const res = await fetch(url);
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    const msg = err.error?.message || `HTTP ${res.status}`;
    // "Unable to parse range" means the SyncData sheet tab doesn't exist yet — treat as empty
    if (msg.includes("Unable to parse range") || msg.includes("not found")) return null;
    throw new Error(msg);
  }
  const json = await res.json();
  const val = json.values?.[0]?.[0];
  return val ? JSON.parse(val) : null;
}

// WRITE to Google Sheets via Apps Script Web App URL (stored in config)
async function gsWrite(payload) {
  const { webAppUrl, syncToken } = gsConfig;
  if (!webAppUrl) throw new Error("NO_WEBAPP");

  const body = JSON.stringify({ action: "write", token: syncToken || "", data: JSON.stringify(payload) });

  // IMPORTANT: Use Content-Type: text/plain so the browser treats this as a "simple request"
  // and skips the CORS preflight. Apps Script does not handle OPTIONS preflight requests,
  // causing "Failed to fetch" if any other Content-Type is used. This works on both
  // file:// and https:// origins without needing mode: "no-cors".
  const res = await fetch(webAppUrl, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body
  });

  // Apps Script always returns HTTP 200 — check the JSON body for actual errors
  const text = await res.text();
  try {
    const json = JSON.parse(text);
    if (json.ok === false) throw new Error(json.error || "Write failed");
    return json;
  } catch(e) {
    if (e.message.includes("Write failed") || e.message.includes("Unauthorized")) throw e;
    // Response wasn't parseable JSON but request went through — treat as success
    return { ok: true };
  }
}

async function testGsheetsConnection() {
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Save your config first", true); return; }
  showToast("Testing connection...");
  try {
    await gsRead();
    showToast("Connection successful! Google Sheets is accessible.");
    lastSyncTime = new Date().toLocaleTimeString();
    updateSyncStatusUI();
  } catch(e) {
    showToast("Connection failed: " + e.message, true);
  }
}

async function manualSync() {
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Configure Google Sheets first", true); return; }
  if (isSyncing) return;
  isSyncing = true;
  showToast("Syncing...");
  try {
    const remote = await gsRead();
    if (remote && remote.meta?.lastUpdated) {
      const remoteTime = new Date(remote.meta.lastUpdated);
      const localTime = new Date(data.meta.lastUpdated || 0);
      if (localTime > remoteTime) {
        // Local is strictly newer — push
        try {
          await gsWrite(data);
          showToast("Pushed local data to Google Sheets!");
        } catch(we) {
          if (we.message === "NO_WEBAPP") {
            showToast("Read-only mode: your data is newer. Set up Apps Script to push changes.", true);
          } else throw we;
        }
      } else {
        // Remote is same age or newer — always pull so other sessions' changes appear
        if (!remote.payments || Array.isArray(remote.payments)) remote.payments = {};
        data = remote;
        saveDataLocal();
        renderAll();
        if (remoteTime > localTime) {
          showToast("Pulled latest data from Google Sheets!");
        } else {
          showToast("Up to date!");
        }
      }
    } else {
      // Nothing in sheet yet (tab missing or empty) — push our data
      try {
        await gsWrite(data);
        showToast("✅ Initialized! Data written to Google Sheets for the first time.");
      } catch(we) {
        if (we.message === "NO_WEBAPP") {
          showToast("Sheet is empty — add your Apps Script URL to enable writing (see setup guide below).", true);
        } else throw we;
      }
    }
    lastSyncTime = new Date().toLocaleTimeString();
    updateSyncStatusUI();
  } catch(e) {
    showToast("Sync error: " + e.message, true);
  } finally {
    isSyncing = false;
  }
}

function toggleAutoSync() {
  if (!gsConfig.spreadsheetId || !gsConfig.apiKey) { showToast("Configure Google Sheets first", true); return; }
  autoSyncEnabled = !autoSyncEnabled;
  if (autoSyncEnabled) {
    manualSync(); // pull latest state from sheet on re-enable
    showToast("Sync enabled — will sync on every change");
  } else {
    showToast("Sync disabled");
  }
  updateSyncStatusUI();
}

loadData();renderAll();updateCountdown();setInterval(updateCountdown,1000);
(async () => {
  await loadGsConfig();
  const _hasCreds = gsConfig.spreadsheetId && gsConfig.apiKey && gsConfig.webAppUrl;
  if (_hasCreds) {
    manualSync(); // pull latest on page load — one-time initial sync
    autoSyncEnabled = true;
    updateSyncStatusUI();
  }
})();

// Collapse flight details by default on mobile
if (window.matchMedia && window.matchMedia("(max-width: 768px)").matches) {
  document.querySelectorAll(".flight-card").forEach(c=>c.classList.add("collapsed"));
}
</script>
</body>
</html>
